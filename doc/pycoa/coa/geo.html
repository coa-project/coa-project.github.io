<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.1.0"/>
    <title>pycoa.coa.geo API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../coa.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;pycoa.coa</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>

            <h2>Contents</h2>
            <ul>
  <li><a href="#about">About :</a></li>
</ul>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#GeoManager">GeoManager</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#GeoManager.__init__">GeoManager</a>
                        </li>
                        <li>
                                <a class="function" href="#GeoManager.get_GeoRegion">get_GeoRegion</a>
                        </li>
                        <li>
                                <a class="function" href="#GeoManager.get_region_list">get_region_list</a>
                        </li>
                        <li>
                                <a class="function" href="#GeoManager.get_list_standard">get_list_standard</a>
                        </li>
                        <li>
                                <a class="function" href="#GeoManager.get_list_output">get_list_output</a>
                        </li>
                        <li>
                                <a class="function" href="#GeoManager.get_list_db">get_list_db</a>
                        </li>
                        <li>
                                <a class="function" href="#GeoManager.get_standard">get_standard</a>
                        </li>
                        <li>
                                <a class="function" href="#GeoManager.set_standard">set_standard</a>
                        </li>
                        <li>
                                <a class="function" href="#GeoManager.to_standard">to_standard</a>
                        </li>
                        <li>
                                <a class="function" href="#GeoManager.first_db_translation">first_db_translation</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#GeoInfo">GeoInfo</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#GeoInfo.__init__">GeoInfo</a>
                        </li>
                        <li>
                                <a class="function" href="#GeoInfo.get_GeoManager">get_GeoManager</a>
                        </li>
                        <li>
                                <a class="function" href="#GeoInfo.get_list_field">get_list_field</a>
                        </li>
                        <li>
                                <a class="function" href="#GeoInfo.get_source">get_source</a>
                        </li>
                        <li>
                                <a class="function" href="#GeoInfo.add_field">add_field</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#GeoRegion">GeoRegion</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#GeoRegion.__init__">GeoRegion</a>
                        </li>
                        <li>
                                <a class="function" href="#GeoRegion.get_source">get_source</a>
                        </li>
                        <li>
                                <a class="function" href="#GeoRegion.get_region_list">get_region_list</a>
                        </li>
                        <li>
                                <a class="function" href="#GeoRegion.is_region">is_region</a>
                        </li>
                        <li>
                                <a class="function" href="#GeoRegion.get_countries_from_region">get_countries_from_region</a>
                        </li>
                        <li>
                                <a class="function" href="#GeoRegion.get_pandas">get_pandas</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#GeoCountry">GeoCountry</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#GeoCountry.__init__">GeoCountry</a>
                        </li>
                        <li>
                                <a class="function" href="#GeoCountry.set_dense_geometry">set_dense_geometry</a>
                        </li>
                        <li>
                                <a class="function" href="#GeoCountry.set_exploded_geometry">set_exploded_geometry</a>
                        </li>
                        <li>
                                <a class="function" href="#GeoCountry.set_main_geometry">set_main_geometry</a>
                        </li>
                        <li>
                                <a class="function" href="#GeoCountry.is_dense_geometry">is_dense_geometry</a>
                        </li>
                        <li>
                                <a class="function" href="#GeoCountry.is_exploded_geometry">is_exploded_geometry</a>
                        </li>
                        <li>
                                <a class="function" href="#GeoCountry.is_main_geometry">is_main_geometry</a>
                        </li>
                        <li>
                                <a class="function" href="#GeoCountry.get_source">get_source</a>
                        </li>
                        <li>
                                <a class="function" href="#GeoCountry.get_country">get_country</a>
                        </li>
                        <li>
                                <a class="function" href="#GeoCountry.get_list_countries">get_list_countries</a>
                        </li>
                        <li>
                                <a class="function" href="#GeoCountry.is_init">is_init</a>
                        </li>
                        <li>
                                <a class="function" href="#GeoCountry.test_is_init">test_is_init</a>
                        </li>
                        <li>
                                <a class="function" href="#GeoCountry.get_region_list">get_region_list</a>
                        </li>
                        <li>
                                <a class="function" href="#GeoCountry.is_region">is_region</a>
                        </li>
                        <li>
                                <a class="function" href="#GeoCountry.get_subregion_list">get_subregion_list</a>
                        </li>
                        <li>
                                <a class="function" href="#GeoCountry.is_subregion">is_subregion</a>
                        </li>
                        <li>
                                <a class="function" href="#GeoCountry.get_subregions_from_region">get_subregions_from_region</a>
                        </li>
                        <li>
                                <a class="function" href="#GeoCountry.get_subregions_from_list_of_region_names">get_subregions_from_list_of_region_names</a>
                        </li>
                        <li>
                                <a class="function" href="#GeoCountry.get_regions_from_subregion">get_regions_from_subregion</a>
                        </li>
                        <li>
                                <a class="function" href="#GeoCountry.get_regions_from_list_of_subregion_codes">get_regions_from_list_of_subregion_codes</a>
                        </li>
                        <li>
                                <a class="function" href="#GeoCountry.get_regions_from_macroregion">get_regions_from_macroregion</a>
                        </li>
                        <li>
                                <a class="function" href="#GeoCountry.get_list_properties">get_list_properties</a>
                        </li>
                        <li>
                                <a class="function" href="#GeoCountry.get_data">get_data</a>
                        </li>
                        <li>
                                <a class="function" href="#GeoCountry.add_field">add_field</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
pycoa<wbr>.<a href="./../coa.html">coa</a><wbr>.geo    </h1>

                        <div class="docstring"><p>Project : PyCoA
Date :    april 2020 - november 2023
Authors : Olivier Dadoun, Julien Browaeys, Tristan Beau
Copyright ©pycoa.fr
License: See joint LICENSE file</p>

<p>Module : coa.geo</p>

<h2 id="about">About :</h2>

<p>Geo classes within the PyCoA framework.</p>

<p>GeoManager class provides translations between naming normalisations
of countries. It's based on the pycountry module.</p>

<p>GeoInfo class allow to add new fields to a pandas DataFrame about
statistical information for countries.</p>

<p>GeoRegion class helps returning list of countries in a specified region</p>

<p>GeoCountry manages information for a single country.</p>
</div>

                        <input id="mod-geo-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-geo-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="c1"># -*- coding: utf-8 -*-</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a><span class="sd">&quot;&quot;&quot; Project : PyCoA</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a><span class="sd">Date :    april 2020 - november 2023</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a><span class="sd">Authors : Olivier Dadoun, Julien Browaeys, Tristan Beau</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a><span class="sd">Copyright ©pycoa.fr</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a><span class="sd">License: See joint LICENSE file</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a><span class="sd">Module : coa.geo</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a><span class="sd">About :</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a><span class="sd">-------</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a><span class="sd">Geo classes within the PyCoA framework.</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a><span class="sd">GeoManager class provides translations between naming normalisations</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a><span class="sd">of countries. It&#39;s based on the pycountry module.</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a><span class="sd">GeoInfo class allow to add new fields to a pandas DataFrame about</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a><span class="sd">statistical information for countries.</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a><span class="sd">GeoRegion class helps returning list of countries in a specified region</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a><span class="sd">GeoCountry manages information for a single country.</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a><span class="kn">import</span> <span class="nn">inspect</span>  <span class="c1"># for debug purpose</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a><span class="kn">import</span> <span class="nn">warnings</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a><span class="kn">import</span> <span class="nn">pycountry</span> <span class="k">as</span> <span class="nn">pc</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a><span class="kn">import</span> <span class="nn">pycountry_convert</span> <span class="k">as</span> <span class="nn">pcc</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a><span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a><span class="kn">import</span> <span class="nn">shapely.geometry</span> <span class="k">as</span> <span class="nn">sg</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a><span class="kn">import</span> <span class="nn">shapely.affinity</span> <span class="k">as</span> <span class="nn">sa</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a><span class="kn">import</span> <span class="nn">shapely.ops</span> <span class="k">as</span> <span class="nn">so</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a><span class="kn">import</span> <span class="nn">bs4</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a><span class="kn">from</span> <span class="nn">coa.tools</span> <span class="kn">import</span> <span class="n">verb</span><span class="p">,</span><span class="n">kwargs_test</span><span class="p">,</span><span class="n">get_local_from_url</span><span class="p">,</span><span class="n">dotdict</span><span class="p">,</span><span class="n">tostdstring</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a><span class="kn">from</span> <span class="nn">coa.error</span> <span class="kn">import</span> <span class="o">*</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a><span class="c1"># ---------------------------------------------------------------------</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a><span class="c1"># --- GeoManager class ------------------------------------------------</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a><span class="c1"># ---------------------------------------------------------------------</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a><span class="k">class</span> <span class="nc">GeoManager</span><span class="p">():</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;GeoManager class definition. No inheritance from any other class.</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a><span class="sd">    It should raise only CoaError and derived exceptions in case</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a><span class="sd">    of errors (see pycoa.error)</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a>    <span class="n">_list_standard</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;iso2&#39;</span><span class="p">,</span>   <span class="c1"># Iso2 standard, default</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a>            <span class="s1">&#39;iso3&#39;</span><span class="p">,</span>           <span class="c1"># Iso3 standard</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a>            <span class="s1">&#39;name&#39;</span><span class="p">,</span>           <span class="c1"># Standard name ( != Official, caution )</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a>            <span class="s1">&#39;num&#39;</span><span class="p">]</span>            <span class="c1"># Numeric standard</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a>    <span class="n">_list_db</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;jhu&#39;</span><span class="p">,</span><span class="s1">&#39;worldometers&#39;</span><span class="p">,</span><span class="s1">&#39;owid&#39;</span><span class="p">,</span><span class="s1">&#39;opencovid19national&#39;</span><span class="p">,</span><span class="s1">&#39;spfnational&#39;</span><span class="p">,</span><span class="s1">&#39;mpoxgh&#39;</span><span class="p">]</span> <span class="c1"># first is default</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a>    <span class="n">_list_output</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;list&#39;</span><span class="p">,</span><span class="s1">&#39;dict&#39;</span><span class="p">,</span><span class="s1">&#39;pandas&#39;</span><span class="p">]</span> <span class="c1"># first is default</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a>    <span class="n">_standard</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># currently used normalisation standard</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">standard</span><span class="o">=</span><span class="n">_list_standard</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; __init__ member function, with default definition of</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a><span class="sd">        the used standard. To get the current default standard,</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a><span class="sd">        see get_list_standard()[0].</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a>        <span class="n">verb</span><span class="p">(</span><span class="s2">&quot;Init of GeoManager() from &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_standard</span><span class="p">(</span><span class="n">standard</span><span class="p">)</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_gr</span><span class="o">=</span><span class="n">GeoRegion</span><span class="p">()</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a>    <span class="k">def</span> <span class="nf">get_GeoRegion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; return the GeoRegion local instance</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gr</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a>    <span class="k">def</span> <span class="nf">get_region_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; return the list of region via the GeoRegion instance</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gr</span><span class="o">.</span><span class="n">get_region_list</span><span class="p">()</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a>    <span class="k">def</span> <span class="nf">get_list_standard</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; return the list of supported standard name of countries.</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a><span class="sd">        First one is default for the class</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_list_standard</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a>    <span class="k">def</span> <span class="nf">get_list_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; return supported list of output type. First one is default</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a><span class="sd">        for the class</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_list_output</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a>    <span class="k">def</span> <span class="nf">get_list_db</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; return supported list of database name for translation of</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a><span class="sd">        country names to standard.</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_list_db</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a>    <span class="k">def</span> <span class="nf">get_standard</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; return current standard use within the GeoManager class</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_standard</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a>    <span class="k">def</span> <span class="nf">set_standard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">standard</span><span class="p">):</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a><span class="sd">        set the working standard type within the GeoManager class.</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a><span class="sd">        The standard should meet the get_list_standard() requirement</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">standard</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a>            <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s1">&#39;GeoManager error, the standard argument&#39;</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a>                <span class="s1">&#39; must be a string&#39;</span><span class="p">)</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a>        <span class="k">if</span> <span class="n">standard</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list_standard</span><span class="p">():</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;GeoManager.set_standard error, &quot;&#39;</span><span class="o">+</span>\
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a>                                    <span class="n">standard</span><span class="o">+</span><span class="s1">&#39; not managed. Please see &#39;</span>\
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a>                                    <span class="s1">&#39;get_list_standard() function&#39;</span><span class="p">)</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_standard</span><span class="o">=</span><span class="n">standard</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_standard</span><span class="p">()</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a>    <span class="k">def</span> <span class="nf">to_standard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Given a list of string of locations (countries), returns a</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a><span class="sd">        normalised list according to the used standard (defined</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a><span class="sd">        via the setStandard() or __init__ function. Current default is iso2.</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a><span class="sd">        Arguments</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a><span class="sd">        -----------------</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a><span class="sd">        first arg        --  w, list of string of locations (or single string)</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a><span class="sd">                             to convert to standard one</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a><span class="sd">        output           -- &#39;list&#39; (default), &#39;dict&#39; or &#39;pandas&#39;</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a><span class="sd">        db               -- database name to help conversion.</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a><span class="sd">                            Default : None, meaning best effort to convert.</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a><span class="sd">                            Known database : jhu, wordometer...</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a><span class="sd">                            See get_list_db() for full list of known db for</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a><span class="sd">                            standardization</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a><span class="sd">        interpret_region -- Boolean, default=False. If yes, the output should</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a><span class="sd">                            be only &#39;list&#39;.</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a>        <span class="n">kwargs_test</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;output&#39;</span><span class="p">,</span><span class="s1">&#39;db&#39;</span><span class="p">,</span><span class="s1">&#39;interpret_region&#39;</span><span class="p">],</span><span class="s1">&#39;Bad args used in the to_standard() function.&#39;</span><span class="p">)</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a>        <span class="n">output</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;output&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">get_list_output</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a>        <span class="k">if</span> <span class="n">output</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list_output</span><span class="p">():</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;Incorrect output type. See get_list_output()&#39;</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a>                <span class="s1">&#39; or help.&#39;</span><span class="p">)</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a>        <span class="n">db</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;db&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">get_list_db</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a>        <span class="k">if</span> <span class="n">db</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list_db</span><span class="p">():</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a>            <span class="k">raise</span> <span class="n">CoaDbError</span><span class="p">(</span><span class="s1">&#39;Unknown database &quot;&#39;</span><span class="o">+</span><span class="n">db</span><span class="o">+</span><span class="s1">&#39;&quot; for translation to &#39;</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a>                <span class="s1">&#39;standardized location names. See get_list_db() or help.&#39;</span><span class="p">)</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a>        <span class="n">interpret_region</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;interpret_region&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">interpret_region</span><span class="p">,</span><span class="nb">bool</span><span class="p">):</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a>            <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s1">&#39;The interpret_region argument is a boolean, &#39;</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a>                <span class="s1">&#39;not a &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">interpret_region</span><span class="p">)))</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a>        <span class="k">if</span> <span class="n">interpret_region</span><span class="o">==</span><span class="kc">True</span> <span class="ow">and</span> <span class="n">output</span><span class="o">!=</span><span class="s1">&#39;list&#39;</span><span class="p">:</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;The interpret_region True argument is incompatible &#39;</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a>                <span class="s1">&#39;with non list output option.&#39;</span><span class="p">)</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a>            <span class="n">w</span><span class="o">=</span><span class="p">[</span><span class="n">w</span><span class="p">]</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a>            <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s1">&#39;Waiting for str, list of str or pandas&#39;</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a>                <span class="s1">&#39;as input of get_standard function member of GeoManager&#39;</span><span class="p">)</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a>        <span class="n">w</span><span class="o">=</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">title</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">w</span><span class="p">]</span> <span class="c1"># capitalize first letter of each name</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a>        <span class="n">w0</span><span class="o">=</span><span class="n">w</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a>        <span class="k">if</span> <span class="n">db</span><span class="p">:</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a>            <span class="n">w</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">first_db_translation</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">db</span><span class="p">)</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a>        <span class="n">n</span><span class="o">=</span><span class="p">[]</span> <span class="c1"># will contain standardized name of countries (if possible)</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a>        <span class="c1">#for c in w:</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a>        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a>            <span class="n">c</span><span class="o">=</span><span class="n">w</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a>            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">==</span><span class="nb">int</span><span class="p">:</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a>                <span class="n">c</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a>            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">!=</span><span class="nb">str</span><span class="p">:</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a>                <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s1">&#39;Locations should be given as &#39;</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a>                    <span class="s1">&#39;strings or integers only&#39;</span><span class="p">)</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gr</span><span class="o">.</span><span class="n">get_region_list</span><span class="p">())</span> <span class="ow">and</span> <span class="n">interpret_region</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a>                <span class="n">w</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_gr</span><span class="o">.</span><span class="n">get_countries_from_region</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">+</span><span class="n">w</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a>                    <span class="n">n1</span><span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="c1">#None</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a>                        <span class="n">n0</span><span class="o">=</span><span class="n">pc</span><span class="o">.</span><span class="n">countries</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a>                    <span class="k">except</span> <span class="ne">LookupError</span><span class="p">:</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a>                        <span class="k">try</span><span class="p">:</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a>                            <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Owid_&#39;</span><span class="p">):</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a>                                <span class="n">nf</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;owid_*&#39;</span><span class="p">]</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a>                                <span class="n">n1</span><span class="o">=</span><span class="s1">&#39;OWID_*&#39;</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a>                                <span class="n">nf</span><span class="o">=</span><span class="n">pc</span><span class="o">.</span><span class="n">countries</span><span class="o">.</span><span class="n">search_fuzzy</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a>                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nf</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a>                                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Caution. More than one country match the key &quot;&#39;</span><span class="o">+</span>\
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a>                                <span class="n">c</span><span class="o">+</span><span class="s1">&#39;&quot; : &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">([</span> <span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;, &#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">nf</span><span class="p">])</span><span class="o">+</span>\
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a>                                <span class="s1">&#39;, using first one.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a>                            <span class="n">n0</span><span class="o">=</span><span class="n">nf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a>                        <span class="k">except</span> <span class="ne">LookupError</span><span class="p">:</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a>                            <span class="k">raise</span> <span class="n">CoaLookupError</span><span class="p">(</span><span class="s1">&#39;No country match the key &quot;&#39;</span><span class="o">+</span><span class="n">c</span><span class="o">+</span><span class="s1">&#39;&quot;. Error.&#39;</span><span class="p">)</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a>                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e1</span><span class="p">:</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a>                            <span class="k">raise</span> <span class="n">CoaNotManagedError</span><span class="p">(</span><span class="s1">&#39;Not managed error &#39;</span><span class="o">+</span><span class="nb">type</span><span class="p">(</span><span class="n">e1</span><span class="p">))</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a>                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e2</span><span class="p">:</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a>                        <span class="k">raise</span> <span class="n">CoaNotManagedError</span><span class="p">(</span><span class="s1">&#39;Not managed error&#39;</span><span class="o">+</span><span class="nb">type</span><span class="p">(</span><span class="n">e1</span><span class="p">))</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a>                    <span class="k">if</span> <span class="n">n0</span> <span class="o">!=</span> <span class="s1">&#39;owid_*&#39;</span><span class="p">:</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_standard</span><span class="o">==</span><span class="s1">&#39;iso2&#39;</span><span class="p">:</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a>                            <span class="n">n1</span><span class="o">=</span><span class="n">n0</span><span class="o">.</span><span class="n">alpha_2</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a>                        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_standard</span><span class="o">==</span><span class="s1">&#39;iso3&#39;</span><span class="p">:</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a>                            <span class="n">n1</span><span class="o">=</span><span class="n">n0</span><span class="o">.</span><span class="n">alpha_3</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a>                        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_standard</span><span class="o">==</span><span class="s1">&#39;name&#39;</span><span class="p">:</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a>                            <span class="n">n1</span><span class="o">=</span><span class="n">n0</span><span class="o">.</span><span class="n">name</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a>                        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_standard</span><span class="o">==</span><span class="s1">&#39;num&#39;</span><span class="p">:</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a>                            <span class="n">n1</span><span class="o">=</span><span class="n">n0</span><span class="o">.</span><span class="n">numeric</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a>                            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;Current standard is &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_standard</span><span class="o">+</span>\
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a>                                <span class="s1">&#39; which is not managed. Error.&#39;</span><span class="p">)</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a>                <span class="n">n</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n1</span><span class="p">)</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a>        <span class="k">if</span> <span class="n">output</span><span class="o">==</span><span class="s1">&#39;list&#39;</span><span class="p">:</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a>            <span class="k">return</span> <span class="n">n</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a>        <span class="k">elif</span> <span class="n">output</span><span class="o">==</span><span class="s1">&#39;dict&#39;</span><span class="p">:</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a>            <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">w0</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a>        <span class="k">elif</span> <span class="n">output</span><span class="o">==</span><span class="s1">&#39;pandas&#39;</span><span class="p">:</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a>            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([{</span><span class="s1">&#39;inputname&#39;</span><span class="p">:</span><span class="n">w0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_standard</span><span class="p">:</span><span class="n">n</span><span class="p">}])</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a>            <span class="k">return</span> <span class="kc">None</span> <span class="c1"># should not be here</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a>    <span class="k">def</span> <span class="nf">first_db_translation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">db</span><span class="p">):</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; This function helps to translate from country name to</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a><span class="sd">        standard for specific databases. It&#39;s the first step</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a><span class="sd">        before final translation.</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a><span class="sd">        One can easily add some database support adding some new rules</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a><span class="sd">        for specific databases</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a>        <span class="n">translation_dict</span><span class="o">=</span><span class="p">{}</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a>        <span class="c1"># Caution : keys need to be in title mode, i.e. first letter capitalized</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a>        <span class="k">if</span> <span class="n">db</span><span class="o">==</span><span class="s1">&#39;jhu&#39;</span><span class="p">:</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a>            <span class="n">translation_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>\
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a>                <span class="s2">&quot;Congo (Brazzaville)&quot;</span><span class="p">:</span><span class="s2">&quot;Republic of the Congo&quot;</span><span class="p">,</span>\
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a>                <span class="s2">&quot;Congo (Kinshasa)&quot;</span><span class="p">:</span><span class="s2">&quot;COD&quot;</span><span class="p">,</span>\
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a>                <span class="s2">&quot;Korea, South&quot;</span><span class="p">:</span><span class="s2">&quot;KOR&quot;</span><span class="p">,</span>\
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a>                <span class="s2">&quot;Taiwan*&quot;</span><span class="p">:</span><span class="s2">&quot;Taiwan&quot;</span><span class="p">,</span>\
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a>                <span class="s2">&quot;Laos&quot;</span><span class="p">:</span><span class="s2">&quot;LAO&quot;</span><span class="p">,</span>\
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a>                <span class="s2">&quot;West Bank And Gaza&quot;</span><span class="p">:</span><span class="s2">&quot;PSE&quot;</span><span class="p">,</span>\
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a>                <span class="s2">&quot;Burma&quot;</span><span class="p">:</span><span class="s2">&quot;Myanmar&quot;</span><span class="p">,</span>\
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a>                <span class="s2">&quot;Iran&quot;</span><span class="p">:</span><span class="s2">&quot;IRN&quot;</span><span class="p">,</span>\
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a>                <span class="s2">&quot;Diamond Princess&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span>\
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a>                <span class="s2">&quot;Ms Zaandam&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span>\
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a>                <span class="s2">&quot;Summer Olympics 2020&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span>\
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a>                <span class="s2">&quot;Micronesia&quot;</span><span class="p">:</span><span class="s2">&quot;FSM&quot;</span><span class="p">,</span>\
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a>                <span class="s2">&quot;Winter Olympics 2022&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span>\
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a>                <span class="s2">&quot;Antarctica&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span>\
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a>                <span class="s2">&quot;Korea, North&quot;</span><span class="p">:</span><span class="s2">&quot;PRK&quot;</span><span class="p">,</span>\
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a>                    <span class="p">})</span>  <span class="c1"># last two are names of boats</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a>        <span class="k">elif</span> <span class="n">db</span><span class="o">==</span><span class="s1">&#39;worldometers&#39;</span><span class="p">:</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a>            <span class="n">translation_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>\
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a>                <span class="s2">&quot;Dr Congo&quot;</span><span class="p">:</span><span class="s2">&quot;COD&quot;</span><span class="p">,</span>\
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a>                <span class="s2">&quot;Congo&quot;</span><span class="p">:</span><span class="s2">&quot;COG&quot;</span><span class="p">,</span>\
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a>                <span class="s2">&quot;Iran&quot;</span><span class="p">:</span><span class="s2">&quot;IRN&quot;</span><span class="p">,</span>\
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a>                <span class="s2">&quot;South Korea&quot;</span><span class="p">:</span><span class="s2">&quot;KOR&quot;</span><span class="p">,</span>\
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a>                <span class="s2">&quot;North Korea&quot;</span><span class="p">:</span><span class="s2">&quot;PRK&quot;</span><span class="p">,</span>\
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a>                <span class="s2">&quot;Czech Republic (Czechia)&quot;</span><span class="p">:</span><span class="s2">&quot;CZE&quot;</span><span class="p">,</span>\
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a>                <span class="s2">&quot;Laos&quot;</span><span class="p">:</span><span class="s2">&quot;LAO&quot;</span><span class="p">,</span>\
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a>                <span class="s2">&quot;Sao Tome &amp; Principe&quot;</span><span class="p">:</span><span class="s2">&quot;STP&quot;</span><span class="p">,</span>\
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a>                <span class="s2">&quot;Channel Islands&quot;</span><span class="p">:</span><span class="s2">&quot;JEY&quot;</span><span class="p">,</span>\
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a>                <span class="s2">&quot;St. Vincent &amp; Grenadines&quot;</span><span class="p">:</span><span class="s2">&quot;VCT&quot;</span><span class="p">,</span>\
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a>                <span class="s2">&quot;U.S. Virgin Islands&quot;</span><span class="p">:</span><span class="s2">&quot;VIR&quot;</span><span class="p">,</span>\
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a>                <span class="s2">&quot;Saint Kitts &amp; Nevis&quot;</span><span class="p">:</span><span class="s2">&quot;KNA&quot;</span><span class="p">,</span>\
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a>                <span class="s2">&quot;Faeroe Islands&quot;</span><span class="p">:</span><span class="s2">&quot;FRO&quot;</span><span class="p">,</span>\
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a>                <span class="s2">&quot;Caribbean Netherlands&quot;</span><span class="p">:</span><span class="s2">&quot;BES&quot;</span><span class="p">,</span>\
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a>                <span class="s2">&quot;Wallis &amp; Futuna&quot;</span><span class="p">:</span><span class="s2">&quot;WLF&quot;</span><span class="p">,</span>\
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a>                <span class="s2">&quot;Saint Pierre &amp; Miquelon&quot;</span><span class="p">:</span><span class="s2">&quot;SPM&quot;</span><span class="p">,</span>\
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a>                <span class="s2">&quot;Sint Maarten&quot;</span><span class="p">:</span><span class="s2">&quot;SXM&quot;</span><span class="p">,</span>\
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a>                <span class="p">}</span> <span class="p">)</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a>        <span class="k">elif</span> <span class="n">db</span><span class="o">==</span><span class="s1">&#39;owid&#39;</span><span class="p">:</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a>            <span class="n">translation_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>\
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a>                    <span class="s2">&quot;Bonaire Sint Eustatius And Saba&quot;</span><span class="p">:</span><span class="s2">&quot;BES&quot;</span><span class="p">,</span>\
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a>                    <span class="s2">&quot;Cape Verde&quot;</span><span class="p">:</span><span class="s2">&quot;CPV&quot;</span><span class="p">,</span>\
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a>                    <span class="s2">&quot;Democratic Republic Of Congo&quot;</span><span class="p">:</span><span class="s2">&quot;COD&quot;</span><span class="p">,</span>\
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a>                    <span class="s2">&quot;Faeroe Islands&quot;</span><span class="p">:</span><span class="s2">&quot;FRO&quot;</span><span class="p">,</span>\
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a>                    <span class="s2">&quot;Laos&quot;</span><span class="p">:</span><span class="s2">&quot;LAO&quot;</span><span class="p">,</span>\
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a>                    <span class="s2">&quot;South Korea&quot;</span><span class="p">:</span><span class="s2">&quot;KOR&quot;</span><span class="p">,</span>\
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a>                    <span class="s2">&quot;Swaziland&quot;</span><span class="p">:</span><span class="s2">&quot;SWZ&quot;</span><span class="p">,</span>\
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a>                    <span class="s2">&quot;United States Virgin Islands&quot;</span><span class="p">:</span><span class="s2">&quot;VIR&quot;</span><span class="p">,</span>\
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a>                    <span class="s2">&quot;Iran&quot;</span><span class="p">:</span><span class="s2">&quot;IRN&quot;</span><span class="p">,</span>\
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a>                    <span class="s2">&quot;Micronesia (Country)&quot;</span><span class="p">:</span><span class="s2">&quot;FSM&quot;</span><span class="p">,</span>\
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a>                    <span class="s2">&quot;Northern Cyprus&quot;</span><span class="p">:</span><span class="s2">&quot;CYP&quot;</span><span class="p">,</span>\
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a>                    <span class="s2">&quot;Curacao&quot;</span><span class="p">:</span><span class="s2">&quot;CUW&quot;</span><span class="p">,</span>\
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a>                    <span class="s2">&quot;Faeroe Islands&quot;</span><span class="p">:</span><span class="s2">&quot;FRO&quot;</span><span class="p">,</span>\
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a>                    <span class="s2">&quot;Vatican&quot;</span><span class="p">:</span><span class="s2">&quot;VAT&quot;</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a>                <span class="p">})</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">translation_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">w</span><span class="p">]</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a><span class="c1"># ---------------------------------------------------------------------</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a><span class="c1"># --- GeoInfo class ---------------------------------------------------</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a><span class="c1"># ---------------------------------------------------------------------</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a><span class="k">class</span> <span class="nc">GeoInfo</span><span class="p">():</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;GeoInfo class definition. No inheritance from any other class.</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a><span class="sd">    It should raise only CoaError and derived exceptions in case</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a><span class="sd">    of errors (see pycoa.error)</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a>    <span class="n">_list_field</span><span class="o">=</span><span class="p">{</span>\
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a>        <span class="s1">&#39;continent_code&#39;</span><span class="p">:</span><span class="s1">&#39;pycountry_convert (https://pypi.org/project/pycountry-convert/)&#39;</span><span class="p">,</span>\
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a>        <span class="s1">&#39;continent_name&#39;</span><span class="p">:</span><span class="s1">&#39;pycountry_convert (https://pypi.org/project/pycountry-convert/)&#39;</span> <span class="p">,</span>\
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a>        <span class="s1">&#39;country_name&#39;</span><span class="p">:</span><span class="s1">&#39;pycountry_convert (https://pypi.org/project/pycountry-convert/)&#39;</span> <span class="p">,</span>\
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a>        <span class="s1">&#39;population&#39;</span><span class="p">:</span><span class="s1">&#39;https://www.worldometers.info/world-population/population-by-country/&#39;</span><span class="p">,</span>\
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a>        <span class="s1">&#39;area&#39;</span><span class="p">:</span><span class="s1">&#39;https://www.worldometers.info/world-population/population-by-country/&#39;</span><span class="p">,</span>\
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a>        <span class="s1">&#39;fertility&#39;</span><span class="p">:</span><span class="s1">&#39;https://www.worldometers.info/world-population/population-by-country/&#39;</span><span class="p">,</span>\
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a>        <span class="s1">&#39;median_age&#39;</span><span class="p">:</span><span class="s1">&#39;https://www.worldometers.info/world-population/population-by-country/&#39;</span><span class="p">,</span>\
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a>        <span class="s1">&#39;urban_rate&#39;</span><span class="p">:</span><span class="s1">&#39;https://www.worldometers.info/world-population/population-by-country/&#39;</span><span class="p">,</span>\
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a>        <span class="c1">#&#39;geometry&#39;:&#39;https://github.com/johan/world.geo.json/&#39;,\</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a>        <span class="s1">&#39;geometry&#39;</span><span class="p">:</span><span class="s1">&#39;http://thematicmapping.org/downloads/world_borders.php and https://github.com/johan/world.geo.json/&#39;</span><span class="p">,</span>\
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a>        <span class="s1">&#39;region_code_list&#39;</span><span class="p">:</span><span class="s1">&#39;https://en.wikipedia.org/w/index.php?title=List_of_countries_by_United_Nations_geoscheme&amp;oldid=1008989486&#39;</span><span class="p">,</span>\
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a>        <span class="c1">#https://en.wikipedia.org/wiki/List_of_countries_by_United_Nations_geoscheme&#39;,\</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a>        <span class="s1">&#39;region_name_list&#39;</span><span class="p">:</span><span class="s1">&#39;https://en.wikipedia.org/w/index.php?title=List_of_countries_by_United_Nations_geoscheme&amp;oldid=1008989486&#39;</span><span class="p">,</span>\
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a>        <span class="c1">#https://en.wikipedia.org/wiki/List_of_countries_by_United_Nations_geoscheme&#39;,\</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a>        <span class="s1">&#39;capital&#39;</span><span class="p">:</span><span class="s1">&#39;https://en.wikipedia.org/w/index.php?title=List_of_countries_by_United_Nations_geoscheme&amp;oldid=1008989486&#39;</span><span class="p">,</span>\
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a>        <span class="c1">#https://en.wikipedia.org/wiki/List_of_countries_by_United_Nations_geoscheme&#39;,\</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a>        <span class="s1">&#39;flag&#39;</span><span class="p">:</span><span class="s1">&#39;https://github.com/linssen/country-flag-icons/blob/master/countries.json&#39;</span><span class="p">,</span>\
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a>        <span class="p">}</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a>    <span class="n">_data_geometry</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a>    <span class="n">_data_population</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a>    <span class="n">_data_flag</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">gm</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; __init__ member function.</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a>        <span class="n">verb</span><span class="p">(</span><span class="s2">&quot;Init of GeoInfo() from &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a>        <span class="k">if</span> <span class="n">gm</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_gm</span><span class="o">=</span><span class="n">gm</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_gm</span><span class="o">=</span><span class="n">GeoManager</span><span class="p">()</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_grp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_gm</span><span class="o">.</span><span class="n">_gr</span><span class="o">.</span><span class="n">get_pandas</span><span class="p">()</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a>    <span class="k">def</span> <span class="nf">get_GeoManager</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; return the local instance of used GeoManager()</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gm</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a>    <span class="k">def</span> <span class="nf">get_list_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; return the list of supported additionnal fields available</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a>        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_list_field</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a>    <span class="k">def</span> <span class="nf">get_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">field</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; return the source of the information provided for a given</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a><span class="sd">        field.</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a>        <span class="k">if</span> <span class="n">field</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_list_field</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a>        <span class="k">elif</span> <span class="n">field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list_field</span><span class="p">():</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;The field &quot;&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">field</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;&quot; is not &#39;</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a>                <span class="s1">&#39;a supported field of GeoInfo(). Please see help or &#39;</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a>                <span class="s1">&#39;the get_list_field() output.&#39;</span><span class="p">)</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a>        <span class="k">return</span> <span class="n">field</span><span class="o">+</span><span class="s1">&#39; : &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_list_field</span><span class="p">[</span><span class="n">field</span><span class="p">]</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a>    <span class="k">def</span> <span class="nf">add_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; this is the main function of the GeoInfo class. It adds to</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a><span class="sd">        the input pandas dataframe some fields according to</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a><span class="sd">        the geofield field of input.</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a><span class="sd">        The return value is the pandas dataframe.</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a><span class="sd">        Arguments :</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a><span class="sd">        field    -- should be given as a string of list of strings and</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a><span class="sd">                    should be valid fields (see get_list_field() )</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a><span class="sd">                    Mandatory.</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a><span class="sd">        input    -- provide the input pandas dataframe. Mandatory.</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a><span class="sd">        geofield -- provide the field name in the pandas where the</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a><span class="sd">                    location is stored. Default : &#39;where&#39;</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a><span class="sd">        overload -- Allow to overload a field. Boolean value.</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a><span class="sd">                    Default : False</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a>        <span class="c1"># --- kwargs analysis ---</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a>        <span class="n">kwargs_test</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;field&#39;</span><span class="p">,</span><span class="s1">&#39;input&#39;</span><span class="p">,</span><span class="s1">&#39;geofield&#39;</span><span class="p">,</span><span class="s1">&#39;overload&#39;</span><span class="p">],</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a>            <span class="s1">&#39;Bad args used in the add_field() function.&#39;</span><span class="p">)</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a>        <span class="n">p</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span> <span class="c1"># the panda</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a>            <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s1">&#39;You should provide a valid input pandas&#39;</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a>                <span class="s1">&#39; DataFrame as input. See help.&#39;</span><span class="p">)</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a>        <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a>        <span class="n">overload</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;overload&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">overload</span><span class="p">,</span><span class="nb">bool</span><span class="p">):</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a>            <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s1">&#39;The overload option should be a boolean.&#39;</span><span class="p">)</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a>        <span class="n">fl</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;field&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span> <span class="c1"># field list</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a>        <span class="k">if</span> <span class="n">fl</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;No field given. See help.&#39;</span><span class="p">)</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a>            <span class="n">fl</span><span class="o">=</span><span class="p">[</span><span class="n">fl</span><span class="p">]</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list_field</span><span class="p">()</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fl</span><span class="p">):</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;All fields are not valid or supported &#39;</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a>                <span class="s1">&#39;ones. Please see help of get_list_field()&#39;</span><span class="p">)</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">overload</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">f</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fl</span><span class="p">):</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;Some fields already exist in you panda &#39;</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a>                <span class="s1">&#39;dataframe columns. You may set overload to True.&#39;</span><span class="p">)</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a>        <span class="n">geofield</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;geofield&#39;</span><span class="p">,</span><span class="s1">&#39;where&#39;</span><span class="p">)</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geofield</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a>            <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s1">&#39;The geofield should be given as a &#39;</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a>                <span class="s1">&#39;string.&#39;</span><span class="p">)</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a>        <span class="k">if</span> <span class="n">geofield</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;The geofield &quot;&#39;</span><span class="o">+</span><span class="n">geofield</span><span class="o">+</span><span class="s1">&#39;&quot; given is &#39;</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a>                <span class="s1">&#39;not a valid column name of the input pandas dataframe.&#39;</span><span class="p">)</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_gm</span><span class="o">.</span><span class="n">set_standard</span><span class="p">(</span><span class="s1">&#39;iso2&#39;</span><span class="p">)</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a>        <span class="n">countries_iso2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_gm</span><span class="o">.</span><span class="n">to_standard</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">geofield</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_gm</span><span class="o">.</span><span class="n">set_standard</span><span class="p">(</span><span class="s1">&#39;iso3&#39;</span><span class="p">)</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a>        <span class="n">countries_iso3</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_gm</span><span class="o">.</span><span class="n">to_standard</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">geofield</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a>        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;iso2_tmp&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">countries_iso2</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a>        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;iso3_tmp&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">countries_iso3</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a>        <span class="c1"># --- loop over all needed fields ---</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a>        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fl</span><span class="p">:</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a>            <span class="k">if</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a>                <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a>            <span class="c1"># ----------------------------------------------------------</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a>            <span class="k">if</span> <span class="n">f</span> <span class="o">==</span> <span class="s1">&#39;continent_code&#39;</span><span class="p">:</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a>                <span class="n">p</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">pcc</span><span class="o">.</span><span class="n">country_alpha2_to_continent_code</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">countries_iso2</span><span class="p">]</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a>            <span class="c1"># ----------------------------------------------------------</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a>            <span class="k">elif</span> <span class="n">f</span> <span class="o">==</span> <span class="s1">&#39;continent_name&#39;</span><span class="p">:</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a>                <span class="n">p</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">pcc</span><span class="o">.</span><span class="n">convert_continent_code_to_continent_name</span><span class="p">(</span> \
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a>                    <span class="n">pcc</span><span class="o">.</span><span class="n">country_alpha2_to_continent_code</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">countries_iso2</span> <span class="p">]</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a>            <span class="c1"># ----------------------------------------------------------</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a>            <span class="k">elif</span> <span class="n">f</span> <span class="o">==</span> <span class="s1">&#39;country_name&#39;</span><span class="p">:</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a>                <span class="n">p</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">pcc</span><span class="o">.</span><span class="n">country_alpha2_to_country_name</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">countries_iso2</span><span class="p">]</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a>            <span class="c1"># ----------------------------------------------------------</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a>            <span class="k">elif</span> <span class="n">f</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;population&#39;</span><span class="p">,</span><span class="s1">&#39;area&#39;</span><span class="p">,</span><span class="s1">&#39;fertility&#39;</span><span class="p">,</span><span class="s1">&#39;median_age&#39;</span><span class="p">,</span><span class="s1">&#39;urban_rate&#39;</span><span class="p">]:</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_population</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a>                    <span class="n">field_descr</span><span class="o">=</span><span class="p">(</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;idx&#39;</span><span class="p">),</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a>                        <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;Country&#39;</span><span class="p">,</span><span class="s1">&#39;country&#39;</span><span class="p">),</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a>                        <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;Population&#39;</span><span class="p">,</span><span class="s1">&#39;population&#39;</span><span class="p">),</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a>                        <span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;Land Area&#39;</span><span class="p">,</span><span class="s1">&#39;area&#39;</span><span class="p">),</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a>                        <span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="s1">&#39;Fert&#39;</span><span class="p">,</span><span class="s1">&#39;fertility&#39;</span><span class="p">),</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a>                        <span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="s1">&#39;Med&#39;</span><span class="p">,</span><span class="s1">&#39;median_age&#39;</span><span class="p">),</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a>                        <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="s1">&#39;Urban&#39;</span><span class="p">,</span><span class="s1">&#39;urban_rate&#39;</span><span class="p">),</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a>                        <span class="p">)</span> <span class="c1"># containts tuples with position in table, name of column, new name of field</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a>                    <span class="c1"># get data with cache ok for about 1 month</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_data_population</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="s1">&#39;https://www.worldometers.info/world-population/population-by-country/&#39;</span><span class="p">,</span><span class="mf">30e5</span><span class="p">)</span> <span class="p">)</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">field_descr</span><span class="p">]]</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a>                    <span class="c1"># test that field order hasn&#39;t changed in the db</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span> <span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">field_descr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_population</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="p">):</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a>                        <span class="k">raise</span> <span class="n">CoaDbError</span><span class="p">(</span><span class="s1">&#39;The worldometers database changed its field names. &#39;</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a>                            <span class="s1">&#39;The GeoInfo should be updated. Please contact developers.&#39;</span><span class="p">)</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a>                    <span class="c1"># change field name</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_data_population</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">field_descr</span><span class="p">]</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a>                    <span class="c1"># standardization of country name</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_data_population</span><span class="p">[</span><span class="s1">&#39;iso3_tmp2&#39;</span><span class="p">]</span><span class="o">=</span>\
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_gm</span><span class="o">.</span><span class="n">to_standard</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_population</span><span class="p">[</span><span class="s1">&#39;country&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>\
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a>                        <span class="n">db</span><span class="o">=</span><span class="s1">&#39;worldometers&#39;</span><span class="p">)</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a>                <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_population</span><span class="p">[[</span><span class="s2">&quot;iso3_tmp2&quot;</span><span class="p">,</span><span class="n">f</span><span class="p">]],</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>\
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a>                        <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;iso3_tmp&#39;</span><span class="p">,</span><span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;iso3_tmp2&#39;</span><span class="p">,</span>\
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a>                        <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;_tmp&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;iso3_tmp2&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a>            <span class="c1"># ----------------------------------------------------------</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a>            <span class="k">elif</span> <span class="n">f</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;region_code_list&#39;</span><span class="p">,</span><span class="s1">&#39;region_name_list&#39;</span><span class="p">]:</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a>                <span class="k">if</span> <span class="n">f</span> <span class="o">==</span> <span class="s1">&#39;region_code_list&#39;</span><span class="p">:</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a>                    <span class="n">ff</span> <span class="o">=</span> <span class="s1">&#39;region&#39;</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a>                <span class="k">elif</span> <span class="n">f</span> <span class="o">==</span> <span class="s1">&#39;region_name_list&#39;</span><span class="p">:</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a>                    <span class="n">ff</span> <span class="o">=</span> <span class="s1">&#39;region_name&#39;</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a>                <span class="n">p</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_grp</span><span class="p">[[</span><span class="s1">&#39;iso3&#39;</span><span class="p">,</span><span class="n">ff</span><span class="p">]],</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>\
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a>                    <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;iso3_tmp&#39;</span><span class="p">,</span><span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;iso3&#39;</span><span class="p">,</span>\
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a>                    <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;_tmp&#39;</span><span class="p">))</span> \
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a>                    <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;iso3_tmp&#39;</span><span class="p">)[</span><span class="n">ff</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a>            <span class="c1"># ----------------------------------------------------------</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a>            <span class="k">elif</span> <span class="n">f</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;capital&#39;</span><span class="p">]:</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a>                <span class="n">p</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_grp</span><span class="p">[[</span><span class="s1">&#39;iso3&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(),</span> \
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a>                    <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;iso3_tmp&#39;</span><span class="p">,</span><span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;iso3&#39;</span><span class="p">,</span>\
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a>                    <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;_tmp&#39;</span><span class="p">))[</span><span class="n">f</span><span class="p">]</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a>            <span class="c1"># ----------------------------------------------------------</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a>            <span class="k">elif</span> <span class="n">f</span> <span class="o">==</span> <span class="s1">&#39;geometry&#39;</span><span class="p">:</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_geometry</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a>                    <span class="c1">#geojsondatafile = &#39;https://raw.githubusercontent.com/johan/world.geo.json/master/countries.geo.json&#39;</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a>                    <span class="c1">#self._data_geometry = gpd.read_file(get_local_from_url(geojsondatafile,0,&#39;.json&#39;))[[&quot;id&quot;,&quot;geometry&quot;]]</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a>                    <span class="n">world_geometry_url_zipfile</span><span class="o">=</span><span class="s1">&#39;http://thematicmapping.org/downloads/TM_WORLD_BORDERS_SIMPL-0.3.zip&#39;</span> <span class="c1"># too much simplified version ?</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a>                    <span class="c1"># world_geometry_url_zipfile=&#39;http://thematicmapping.org/downloads/TM_WORLD_BORDERS-0.3.zip&#39; # too precize version ?</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_data_geometry</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;zip://&#39;</span><span class="o">+</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="n">world_geometry_url_zipfile</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;.zip&#39;</span><span class="p">))[[</span><span class="s1">&#39;ISO3&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]]</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_data_geometry</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;id_tmp&quot;</span><span class="p">,</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a>                    <span class="c1"># About some countries not properly managed by this database (south and north soudan)</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_data_geometry</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_geometry</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;id_tmp&#39;</span><span class="p">:</span><span class="s1">&#39;SSD&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">},</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a>                    <span class="c1">#self._data_geometry=self._data_geometry.append({&#39;id_tmp&#39;:&#39;SSD&#39;,&#39;geometry&#39;:None},ignore_index=True) # adding the SSD row</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a>                    <span class="c1">#self._data_geometry=pd.concat([self._data_geometry,pd.DataFrame({&#39;id_tmp&#39;:&#39;SSD&#39;,&#39;geometry&#39;:None})])</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a>                    <span class="k">for</span> <span class="n">newc</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;SSD&#39;</span><span class="p">,</span><span class="s1">&#39;SDN&#39;</span><span class="p">]:</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a>                        <span class="n">newgeo</span><span class="o">=</span><span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="s1">&#39;https://github.com/johan/world.geo.json/raw/master/countries/&#39;</span><span class="o">+</span><span class="n">newc</span><span class="o">+</span><span class="s1">&#39;.geo.json&#39;</span><span class="p">))</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a>                        <span class="n">poly</span><span class="o">=</span><span class="n">newgeo</span><span class="p">[</span><span class="n">newgeo</span><span class="o">.</span><span class="n">id</span><span class="o">==</span><span class="n">newc</span><span class="p">]</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_data_geometry</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_geometry</span><span class="o">.</span><span class="n">id_tmp</span><span class="o">==</span><span class="n">newc</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a>                    <span class="c1"># About countries that we artificially put on the east of the map</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a>                    <span class="k">for</span> <span class="n">newc</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;RUS&#39;</span><span class="p">,</span><span class="s1">&#39;FJI&#39;</span><span class="p">,</span><span class="s1">&#39;NZL&#39;</span><span class="p">,</span><span class="s1">&#39;WSM&#39;</span><span class="p">]:</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a>                        <span class="n">poly</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_geometry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_geometry</span><span class="o">.</span><span class="n">id_tmp</span><span class="o">==</span><span class="n">newc</span><span class="p">]</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a>                        <span class="n">poly</span><span class="o">=</span><span class="n">so</span><span class="o">.</span><span class="n">unary_union</span><span class="p">(</span><span class="n">sg</span><span class="o">.</span><span class="n">MultiPolygon</span><span class="p">([</span><span class="n">sg</span><span class="o">.</span><span class="n">Polygon</span><span class="p">([(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="k">else</span> <span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mi">360</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">coords</span><span class="p">])</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">poly</span><span class="o">.</span><span class="n">geoms</span><span class="p">]))</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_data_geometry</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_geometry</span><span class="o">.</span><span class="n">id_tmp</span><span class="o">==</span><span class="n">newc</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a>                    <span class="c1"># About countries that we artificially put on the west of the map</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a>                    <span class="k">for</span> <span class="n">newc</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;USA&#39;</span><span class="p">]:</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a>                        <span class="n">poly</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_geometry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_geometry</span><span class="o">.</span><span class="n">id_tmp</span><span class="o">==</span><span class="n">newc</span><span class="p">]</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a>                        <span class="n">poly</span><span class="o">=</span><span class="n">so</span><span class="o">.</span><span class="n">unary_union</span><span class="p">(</span><span class="n">sg</span><span class="o">.</span><span class="n">MultiPolygon</span><span class="p">([</span><span class="n">sg</span><span class="o">.</span><span class="n">Polygon</span><span class="p">([(</span><span class="n">x</span><span class="o">-</span><span class="mi">360</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="k">else</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">coords</span><span class="p">])</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">poly</span><span class="o">.</span><span class="n">geoms</span><span class="p">]))</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_data_geometry</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_geometry</span><span class="o">.</span><span class="n">id_tmp</span><span class="o">==</span><span class="n">newc</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a>                <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_geometry</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>\
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a>                    <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;iso3_tmp&#39;</span><span class="p">,</span><span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;id_tmp&#39;</span><span class="p">,</span>\
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a>                    <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;_tmp&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;id_tmp&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a>            <span class="c1"># -----------------------------------------------------------</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a>            <span class="k">elif</span> <span class="n">f</span> <span class="o">==</span> <span class="s1">&#39;flag&#39;</span><span class="p">:</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_flag</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_data_flag</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="s1">&#39;https://github.com/linssen/country-flag-icons/raw/master/countries.json&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_data_flag</span><span class="p">[</span><span class="s1">&#39;flag_url&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;http:&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_flag</span><span class="p">[</span><span class="s1">&#39;file_url&#39;</span><span class="p">]</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a>                <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_flag</span><span class="p">[[</span><span class="s1">&#39;alpha3&#39;</span><span class="p">,</span><span class="s1">&#39;flag_url&#39;</span><span class="p">]],</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>\
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a>                    <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;iso3_tmp&#39;</span><span class="p">,</span><span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;alpha3&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;alpha3&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a>        <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;iso2_tmp&#39;</span><span class="p">,</span><span class="s1">&#39;iso3_tmp&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a><span class="c1"># ---------------------------------------------------------------------</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a><span class="c1"># --- GeoRegion class -------------------------------------------------</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a><span class="c1"># ---------------------------------------------------------------------</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a><span class="k">class</span> <span class="nc">GeoRegion</span><span class="p">():</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;GeoRegion class definition. Does not inheritate from any other</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a><span class="sd">    class.</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a><span class="sd">    It should raise only CoaError and derived exceptions in case</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a><span class="sd">    of errors (see pycoa.error)</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a>    <span class="n">_source_dict</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;UN_M49&quot;</span><span class="p">:</span><span class="s2">&quot;https://en.wikipedia.org/w/index.php?title=UN_M49&amp;oldid=986603718&quot;</span><span class="p">,</span> <span class="c1"># pointing the previous correct ref . https://en.wikipedia.org/wiki/UN_M49&quot;,\</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a>        <span class="s2">&quot;GeoScheme&quot;</span><span class="p">:</span><span class="s2">&quot;https://en.wikipedia.org/w/index.php?title=List_of_countries_by_United_Nations_geoscheme&amp;oldid=1008989486&quot;</span><span class="p">,</span> <span class="c1">#pointing the previous correct ref. https://en.wikipedia.org/wiki/List_of_countries_by_United_Nations_geoscheme&quot;,</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a>        <span class="s2">&quot;European Union&quot;</span><span class="p">:</span><span class="s2">&quot;https://europa.eu/european-union/about-eu/countries/member-countries_en&quot;</span><span class="p">,</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a>        <span class="s2">&quot;G7&quot;</span><span class="p">:</span><span class="s2">&quot;https://en.wikipedia.org/wiki/Group_of_Seven&quot;</span><span class="p">,</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a>        <span class="s2">&quot;G8&quot;</span><span class="p">:</span><span class="s2">&quot;https://en.wikipedia.org/wiki/Group_of_Eight&quot;</span><span class="p">,</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a>        <span class="s2">&quot;G20&quot;</span><span class="p">:</span><span class="s2">&quot;https://en.wikipedia.org/wiki/G20&quot;</span><span class="p">,</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a>        <span class="s2">&quot;G77&quot;</span><span class="p">:</span><span class="s2">&quot;https://www.g77.org/doc/members.html&quot;</span><span class="p">,</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a>        <span class="s2">&quot;OECD&quot;</span><span class="p">:</span><span class="s2">&quot;https://en.wikipedia.org/wiki/OECD&quot;</span><span class="p">,</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a>        <span class="s2">&quot;BRICS&quot;</span><span class="p">:</span><span class="s2">&quot;https://en.wikipedia.org/wiki/BRICS&quot;</span><span class="p">,</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a>        <span class="s2">&quot;CELAC&quot;</span><span class="p">:</span><span class="s2">&quot;https://en.wikipedia.org/wiki/Community_of_Latin_American_and_Caribbean_States&quot;</span><span class="p">,</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a>        <span class="s2">&quot;CEDEAO&quot;</span><span class="p">:</span><span class="s2">&quot;https://fr.wikipedia.org/wiki/Communaut%C3%A9_%C3%A9conomique_des_%C3%89tats_de_l%27Afrique_de_l%27Ouest&quot;</span><span class="p">,</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a>        <span class="s2">&quot;SADC&quot;</span><span class="p">:</span><span class="s2">&quot;https://en.wikipedia.org/wiki/Southern_African_Development_Community&quot;</span><span class="p">,</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a>        <span class="s2">&quot;AMU&quot;</span><span class="p">:</span><span class="s2">&quot;https://en.wikipedia.org/wiki/Arab_Maghreb_Union&quot;</span><span class="p">,</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a>        <span class="s2">&quot;CEEAC&quot;</span><span class="p">:</span><span class="s2">&quot;https://fr.wikipedia.org/wiki/Communaut%C3%A9_%C3%A9conomique_des_%C3%89tats_de_l%27Afrique_centrale&quot;</span><span class="p">,</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a>        <span class="s2">&quot;EAC&quot;</span><span class="p">:</span><span class="s2">&quot;https://en.wikipedia.org/wiki/East_African_Community&quot;</span><span class="p">,</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a>        <span class="s2">&quot;CENSAD&quot;</span><span class="p">:</span><span class="s2">&quot;https://en.wikipedia.org/wiki/Community_of_Sahel</span><span class="si">%E</span><span class="s2">2</span><span class="si">%80%</span><span class="s2">93Saharan_States&quot;</span><span class="p">,</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a>        <span class="s2">&quot;COMESA&quot;</span><span class="p">:</span><span class="s2">&quot;https://www.worlddata.info/trade-agreements/comesa.php&quot;</span><span class="p">,</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a>        <span class="s2">&quot;Commonwealth&quot;</span><span class="p">:</span><span class="s2">&quot;https://en.wikipedia.org/wiki/Member_states_of_the_Commonwealth_of_Nations&quot;</span><span class="p">,</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a>        <span class="p">}</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a>    <span class="n">_region_dict</span><span class="o">=</span><span class="p">{}</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a>    <span class="n">_p_gs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,):</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; __init__ member function.</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a>        <span class="c1">#if &#39;XK&#39; in self._country_list:</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a>        <span class="c1">#    del self._country_list[&#39;XK&#39;] # creates bugs in pycountry and is currently a contested country as country</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a>        <span class="c1"># --- get the UN M49 information and organize the data in the _region_dict</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a>        <span class="n">verb</span><span class="p">(</span><span class="s2">&quot;Init of GeoRegion() from &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a>        <span class="n">p_m49</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_source_dict</span><span class="p">[</span><span class="s2">&quot;UN_M49&quot;</span><span class="p">],</span><span class="mi">0</span><span class="p">))[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a>        <span class="n">p_m49</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">,</span><span class="s1">&#39;region_name&#39;</span><span class="p">]</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a>        <span class="n">p_m49</span><span class="p">[</span><span class="s1">&#39;region_name&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">title</span><span class="p">()</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">p_m49</span><span class="o">.</span><span class="n">region_name</span><span class="p">]</span>  <span class="c1"># suppress information in parenthesis in region name</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a>        <span class="n">p_m49</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;code&#39;</span><span class="p">)</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_region_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">p_m49</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s1">&#39;split&#39;</span><span class="p">)[</span><span class="s1">&#39;data&#39;</span><span class="p">])</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_region_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>  <span class="s2">&quot;UE&quot;</span><span class="p">:</span><span class="s2">&quot;European Union&quot;</span><span class="p">,</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a>                                    <span class="s2">&quot;G7&quot;</span><span class="p">:</span><span class="s2">&quot;G7&quot;</span><span class="p">,</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a>                                    <span class="s2">&quot;G8&quot;</span><span class="p">:</span><span class="s2">&quot;G8&quot;</span><span class="p">,</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a>                                    <span class="s2">&quot;G20&quot;</span><span class="p">:</span><span class="s2">&quot;G20&quot;</span><span class="p">,</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a>                                    <span class="s2">&quot;OECD&quot;</span><span class="p">:</span><span class="s2">&quot;Oecd&quot;</span><span class="p">,</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a>                                    <span class="s2">&quot;BRICS&quot;</span><span class="p">:</span><span class="s2">&quot;Brics&quot;</span><span class="p">,</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a>                                    <span class="s2">&quot;CELAC&quot;</span><span class="p">:</span><span class="s2">&quot;Celac&quot;</span><span class="p">,</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a>                                    <span class="s2">&quot;CEDEAO&quot;</span><span class="p">:</span><span class="s2">&quot;Cedeao&quot;</span><span class="p">,</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a>                                    <span class="s2">&quot;AMU&quot;</span><span class="p">:</span><span class="s2">&quot;Amu&quot;</span><span class="p">,</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a>                                    <span class="s2">&quot;CEEAC&quot;</span><span class="p">:</span><span class="s2">&quot;Ceeac&quot;</span><span class="p">,</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a>                                    <span class="s2">&quot;EAC&quot;</span><span class="p">:</span><span class="s2">&quot;Eac&quot;</span><span class="p">,</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a>                                    <span class="s2">&quot;SADC&quot;</span><span class="p">:</span><span class="s2">&quot;Sadc&quot;</span><span class="p">,</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a>                                    <span class="s2">&quot;CENSAD&quot;</span><span class="p">:</span><span class="s2">&quot;Censad&quot;</span><span class="p">,</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a>                                    <span class="s2">&quot;COMESA&quot;</span><span class="p">:</span><span class="s2">&quot;Comesa&quot;</span><span class="p">,</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a>                                    <span class="s2">&quot;G77&quot;</span><span class="p">:</span><span class="s2">&quot;G77&quot;</span><span class="p">,</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a>                                    <span class="s2">&quot;CW&quot;</span><span class="p">:</span><span class="s2">&quot;Commonwealth&quot;</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a>                                    <span class="p">})</span>  <span class="c1"># add UE for other analysis</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a>        <span class="c1"># --- filling cw information</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a>        <span class="n">p_cw</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="s1">&#39;https://en.wikipedia.org/w/index.php?title=Member_states_of_the_Commonwealth_of_Nations&amp;oldid=1090420488&#39;</span><span class="p">))</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_cw</span><span class="o">=</span><span class="p">[</span><span class="n">w</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">p_cw</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Country&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()]</span>   <span class="c1"># removing wikipedia notes</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a>        <span class="c1"># --- filling celac information</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a>        <span class="n">p_celac</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="s1">&#39;https://en.wikipedia.org/wiki/Community_of_Latin_American_and_Caribbean_States&#39;</span><span class="p">))</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_celac</span><span class="o">=</span><span class="p">[</span><span class="n">w</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">p_celac</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="n">p_celac</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">&lt;</span><span class="mi">33</span><span class="p">][</span><span class="s2">&quot;Country&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()]</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a>        <span class="c1"># --- filling cedeao information</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a>        <span class="n">p_cedeao</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="s1">&#39;https://en.wikipedia.org/wiki/Economic_Community_of_West_African_States&#39;</span><span class="p">))</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_cedeao</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Cabo Verde&quot;</span> <span class="k">if</span> <span class="n">x</span><span class="o">==</span><span class="s2">&quot;Cape Verde&quot;</span> <span class="k">else</span> <span class="s2">&quot;CIV&quot;</span> <span class="k">if</span> <span class="n">x</span><span class="o">==</span><span class="s2">&quot;Ivory Coast&quot;</span> <span class="k">else</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">p_cedeao</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">p_cedeao</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span><span class="o">.</span><span class="n">Country</span><span class="o">.</span><span class="n">to_list</span><span class="p">()]</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a>        <span class="c1"># --- filling sadc information</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a>        <span class="n">p_sadc</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="s1">&#39;https://en.wikipedia.org/wiki/Southern_African_Development_Community&#39;</span><span class="p">))</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_sadc</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;COD&quot;</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">&quot;Democratic Republic of the Congo&quot;</span> <span class="k">else</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="n">w</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">p_sadc</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">p_sadc</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()]]</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a>        <span class="c1"># --- filling amu information</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a>        <span class="n">p_amu</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="s1">&#39;https://en.wikipedia.org/wiki/Arab_Maghreb_Union&#39;</span><span class="p">))</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_amu</span><span class="o">=</span><span class="n">p_amu</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">Country</span><span class="o">.</span><span class="n">to_list</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a>        <span class="c1"># --- filling ceeac information</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a>        <span class="n">p_ceeac</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="s1">&#39;https://en.wikipedia.org/wiki/Economic_Community_of_Central_African_States&#39;</span><span class="p">))</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ceeac</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;COD&quot;</span> <span class="k">if</span> <span class="n">w</span> <span class="o">==</span> <span class="s2">&quot;Democratic Republic of the Congo&quot;</span> <span class="k">else</span> <span class="n">w</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">p_ceeac</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">Country</span><span class="o">.</span><span class="n">to_list</span><span class="p">()]]</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a>        <span class="c1"># --- filling eac information</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a>        <span class="n">p_eac</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="s1">&#39;https://en.wikipedia.org/wiki/East_African_Community&#39;</span><span class="p">))</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_eac</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;COD&quot;</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">&quot;DR Congo&quot;</span> <span class="k">else</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">p_eac</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">Country</span><span class="o">.</span><span class="n">to_list</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a>        <span class="c1"># --- filling censad information</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a>        <span class="n">p_censad</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="s1">&#39;https://en.wikipedia.org/wiki/Community_of_Sahel</span><span class="si">%E</span><span class="s1">2</span><span class="si">%80%</span><span class="s1">93Saharan_States&#39;</span><span class="p">))</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_censad</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Cabo Verde&quot;</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">&quot;Cape Verde&quot;</span> <span class="k">else</span> <span class="s2">&quot;CIV&quot;</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">&quot;Ivory Coast&quot;</span> <span class="k">else</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">p_censad</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">p_censad</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a>        <span class="c1"># --- filing comesa information</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a>        <span class="n">p_comesa</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="s1">&#39;https://www.worlddata.info/trade-agreements/comesa.php&#39;</span><span class="p">))</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_comesa</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;COD&quot;</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">&quot;Congo (Dem. Republic)&quot;</span> <span class="k">else</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">p_comesa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">Country</span><span class="o">.</span><span class="n">to_list</span><span class="p">()]</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a>        <span class="c1"># --- get the UnitedNation GeoScheme and organize the data</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a>        <span class="n">p_gs</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_source_dict</span><span class="p">[</span><span class="s2">&quot;GeoScheme&quot;</span><span class="p">],</span><span class="mi">0</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a>        <span class="n">p_gs</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;country&#39;</span><span class="p">,</span><span class="s1">&#39;capital&#39;</span><span class="p">,</span><span class="s1">&#39;iso2&#39;</span><span class="p">,</span><span class="s1">&#39;iso3&#39;</span><span class="p">,</span><span class="s1">&#39;num&#39;</span><span class="p">,</span><span class="s1">&#39;m49&#39;</span><span class="p">]</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a>        <span class="n">p_gs</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">p_gs</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;country&#39;</span><span class="p">:</span><span class="s1">&#39;Taiwan&#39;</span><span class="p">,</span><span class="s1">&#39;iso2&#39;</span><span class="p">:</span><span class="s1">&#39;TW&#39;</span><span class="p">,</span><span class="s1">&#39;iso3&#39;</span><span class="p">:</span><span class="s1">&#39;TWN&#39;</span><span class="p">,</span><span class="s1">&#39;num&#39;</span><span class="p">:</span><span class="s1">&#39;158&#39;</span><span class="p">,</span><span class="s1">&#39;m49&#39;</span><span class="p">:</span><span class="s1">&#39;030 &lt; 0142 &lt; 001&#39;</span><span class="p">},</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a>        <span class="c1">#p_gs=p_gs.append({&#39;country&#39;:&#39;Taiwan&#39;,&#39;iso2&#39;:&#39;TW&#39;,&#39;iso3&#39;:&#39;TWN&#39;,&#39;num&#39;:&#39;158&#39;,&#39;m49&#39;:&#39;030 &lt; 0142 &lt; 001&#39;},ignore_index=True)</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a>        <span class="n">idx</span><span class="o">=</span><span class="p">[]</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a>        <span class="n">reg</span><span class="o">=</span><span class="p">[]</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a>        <span class="n">cap</span><span class="o">=</span><span class="p">[]</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">p_gs</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a>            <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">iso3</span> <span class="o">!=</span> <span class="s1">&#39;–&#39;</span> <span class="p">:</span> <span class="c1"># meaning a non standard iso in wikipedia UN GeoScheme</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a>                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">m49</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&lt;&#39;</span><span class="p">):</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a>                    <span class="n">idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">iso3</span><span class="p">)</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a>                    <span class="n">reg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a>                    <span class="n">cap</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">capital</span><span class="p">)</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_p_gs</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;iso3&#39;</span><span class="p">:</span><span class="n">idx</span><span class="p">,</span><span class="s1">&#39;capital&#39;</span><span class="p">:</span><span class="n">cap</span><span class="p">,</span><span class="s1">&#39;region&#39;</span><span class="p">:</span><span class="n">reg</span><span class="p">})</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_p_gs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_p_gs</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">p_m49</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;region&#39;</span><span class="p">,</span>\
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a>                            <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;code&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;code&quot;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a>    <span class="k">def</span> <span class="nf">get_source</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_dict</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a>    <span class="k">def</span> <span class="nf">get_region_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_region_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a>    <span class="k">def</span> <span class="nf">is_region</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">region</span><span class="p">):</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; it returns either False or the correctly named region name</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">region</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s2">&quot;The given region is not a str type.&quot;</span><span class="p">)</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a>        <span class="n">region</span><span class="o">=</span><span class="n">region</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>  <span class="c1"># if not properly capitalized</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a>        <span class="k">if</span> <span class="n">region</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_region_list</span><span class="p">():</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a>        <span class="k">else</span> <span class="p">:</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a>            <span class="k">return</span> <span class="n">region</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a>    <span class="k">def</span> <span class="nf">get_countries_from_region</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">region</span><span class="p">):</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; it returns a list of countries for the given region name.</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a><span class="sd">        The standard used is iso3. To convert to another standard,</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a><span class="sd">        use the GeoManager class.</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a>        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_region</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">r</span><span class="p">:</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;The given region &quot;&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">region</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;&quot; is unknown.&#39;</span><span class="p">)</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a>        <span class="n">region</span><span class="o">=</span><span class="n">r</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a>        <span class="n">clist</span><span class="o">=</span><span class="p">[]</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a>        <span class="k">if</span> <span class="n">region</span><span class="o">==</span><span class="s1">&#39;European Union&#39;</span><span class="p">:</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a>            <span class="n">clist</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;AUT&#39;</span><span class="p">,</span><span class="s1">&#39;BEL&#39;</span><span class="p">,</span><span class="s1">&#39;BGR&#39;</span><span class="p">,</span><span class="s1">&#39;CYP&#39;</span><span class="p">,</span><span class="s1">&#39;CZE&#39;</span><span class="p">,</span><span class="s1">&#39;DEU&#39;</span><span class="p">,</span><span class="s1">&#39;DNK&#39;</span><span class="p">,</span><span class="s1">&#39;EST&#39;</span><span class="p">,</span>\
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a>                        <span class="s1">&#39;ESP&#39;</span><span class="p">,</span><span class="s1">&#39;FIN&#39;</span><span class="p">,</span><span class="s1">&#39;FRA&#39;</span><span class="p">,</span><span class="s1">&#39;GRC&#39;</span><span class="p">,</span><span class="s1">&#39;HRV&#39;</span><span class="p">,</span><span class="s1">&#39;HUN&#39;</span><span class="p">,</span><span class="s1">&#39;IRL&#39;</span><span class="p">,</span><span class="s1">&#39;ITA&#39;</span><span class="p">,</span>\
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a>                        <span class="s1">&#39;LTU&#39;</span><span class="p">,</span><span class="s1">&#39;LUX&#39;</span><span class="p">,</span><span class="s1">&#39;LVA&#39;</span><span class="p">,</span><span class="s1">&#39;MLT&#39;</span><span class="p">,</span><span class="s1">&#39;NLD&#39;</span><span class="p">,</span><span class="s1">&#39;POL&#39;</span><span class="p">,</span><span class="s1">&#39;PRT&#39;</span><span class="p">,</span><span class="s1">&#39;ROU&#39;</span><span class="p">,</span>\
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a>                        <span class="s1">&#39;SWE&#39;</span><span class="p">,</span><span class="s1">&#39;SVN&#39;</span><span class="p">,</span><span class="s1">&#39;SVK&#39;</span><span class="p">]</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a>        <span class="k">elif</span> <span class="n">region</span><span class="o">==</span><span class="s1">&#39;G7&#39;</span><span class="p">:</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a>            <span class="n">clist</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;DEU&#39;</span><span class="p">,</span><span class="s1">&#39;CAN&#39;</span><span class="p">,</span><span class="s1">&#39;USA&#39;</span><span class="p">,</span><span class="s1">&#39;FRA&#39;</span><span class="p">,</span><span class="s1">&#39;ITA&#39;</span><span class="p">,</span><span class="s1">&#39;JPN&#39;</span><span class="p">,</span><span class="s1">&#39;GBR&#39;</span><span class="p">]</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a>        <span class="k">elif</span> <span class="n">region</span><span class="o">==</span><span class="s1">&#39;G8&#39;</span><span class="p">:</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a>            <span class="n">clist</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;DEU&#39;</span><span class="p">,</span><span class="s1">&#39;CAN&#39;</span><span class="p">,</span><span class="s1">&#39;USA&#39;</span><span class="p">,</span><span class="s1">&#39;FRA&#39;</span><span class="p">,</span><span class="s1">&#39;ITA&#39;</span><span class="p">,</span><span class="s1">&#39;JPN&#39;</span><span class="p">,</span><span class="s1">&#39;GBR&#39;</span><span class="p">,</span><span class="s1">&#39;RUS&#39;</span><span class="p">]</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a>        <span class="k">elif</span> <span class="n">region</span><span class="o">==</span><span class="s1">&#39;G20&#39;</span><span class="p">:</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a>            <span class="n">clist</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ZAF&#39;</span><span class="p">,</span><span class="s1">&#39;SAU&#39;</span><span class="p">,</span><span class="s1">&#39;ARG&#39;</span><span class="p">,</span><span class="s1">&#39;AUS&#39;</span><span class="p">,</span><span class="s1">&#39;BRA&#39;</span><span class="p">,</span><span class="s1">&#39;CAN&#39;</span><span class="p">,</span><span class="s1">&#39;CHN&#39;</span><span class="p">,</span><span class="s1">&#39;KOR&#39;</span><span class="p">,</span><span class="s1">&#39;USA&#39;</span><span class="p">,</span>\
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a>                <span class="s1">&#39;IND&#39;</span><span class="p">,</span><span class="s1">&#39;IDN&#39;</span><span class="p">,</span><span class="s1">&#39;JPN&#39;</span><span class="p">,</span><span class="s1">&#39;MEX&#39;</span><span class="p">,</span><span class="s1">&#39;GBR&#39;</span><span class="p">,</span><span class="s1">&#39;DEU&#39;</span><span class="p">,</span><span class="s1">&#39;FRA&#39;</span><span class="p">,</span><span class="s1">&#39;ITA&#39;</span><span class="p">,</span><span class="s1">&#39;TUR&#39;</span><span class="p">,</span>\
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a>                <span class="s1">&#39;MEX&#39;</span><span class="p">,</span><span class="s1">&#39;RUS&#39;</span><span class="p">]</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a>        <span class="k">elif</span> <span class="n">region</span><span class="o">==</span><span class="s1">&#39;Oecd&#39;</span><span class="p">:</span> <span class="c1"># OCDE in french</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a>            <span class="n">clist</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;DEU&#39;</span><span class="p">,</span><span class="s1">&#39;AUS&#39;</span><span class="p">,</span><span class="s1">&#39;AUT&#39;</span><span class="p">,</span><span class="s1">&#39;BEL&#39;</span><span class="p">,</span><span class="s1">&#39;CAN&#39;</span><span class="p">,</span><span class="s1">&#39;CHL&#39;</span><span class="p">,</span><span class="s1">&#39;COL&#39;</span><span class="p">,</span><span class="s1">&#39;KOR&#39;</span><span class="p">,</span><span class="s1">&#39;DNK&#39;</span><span class="p">,</span>\
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a>                <span class="s1">&#39;ESP&#39;</span><span class="p">,</span><span class="s1">&#39;EST&#39;</span><span class="p">,</span><span class="s1">&#39;USA&#39;</span><span class="p">,</span><span class="s1">&#39;FIN&#39;</span><span class="p">,</span><span class="s1">&#39;FRA&#39;</span><span class="p">,</span><span class="s1">&#39;GRC&#39;</span><span class="p">,</span><span class="s1">&#39;HUN&#39;</span><span class="p">,</span><span class="s1">&#39;IRL&#39;</span><span class="p">,</span><span class="s1">&#39;ISL&#39;</span><span class="p">,</span><span class="s1">&#39;ISR&#39;</span><span class="p">,</span>\
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a>                <span class="s1">&#39;ITA&#39;</span><span class="p">,</span><span class="s1">&#39;JPN&#39;</span><span class="p">,</span><span class="s1">&#39;LVA&#39;</span><span class="p">,</span><span class="s1">&#39;LTU&#39;</span><span class="p">,</span><span class="s1">&#39;LUX&#39;</span><span class="p">,</span><span class="s1">&#39;MEX&#39;</span><span class="p">,</span><span class="s1">&#39;NOR&#39;</span><span class="p">,</span><span class="s1">&#39;NZL&#39;</span><span class="p">,</span><span class="s1">&#39;NLD&#39;</span><span class="p">,</span><span class="s1">&#39;POL&#39;</span><span class="p">,</span>\
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a>                <span class="s1">&#39;PRT&#39;</span><span class="p">,</span><span class="s1">&#39;SVK&#39;</span><span class="p">,</span><span class="s1">&#39;SVN&#39;</span><span class="p">,</span><span class="s1">&#39;SWE&#39;</span><span class="p">,</span><span class="s1">&#39;CHE&#39;</span><span class="p">,</span><span class="s1">&#39;GBR&#39;</span><span class="p">,</span><span class="s1">&#39;CZE&#39;</span><span class="p">,</span><span class="s1">&#39;TUR&#39;</span><span class="p">]</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a>        <span class="k">elif</span> <span class="n">region</span><span class="o">==</span><span class="s1">&#39;G77&#39;</span><span class="p">:</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a>            <span class="n">clist</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;AFG&#39;</span><span class="p">,</span><span class="s1">&#39;DZA&#39;</span><span class="p">,</span><span class="s1">&#39;AGO&#39;</span><span class="p">,</span><span class="s1">&#39;ATG&#39;</span><span class="p">,</span><span class="s1">&#39;ARG&#39;</span><span class="p">,</span><span class="s1">&#39;AZE&#39;</span><span class="p">,</span><span class="s1">&#39;BHS&#39;</span><span class="p">,</span><span class="s1">&#39;BHR&#39;</span><span class="p">,</span><span class="s1">&#39;BGD&#39;</span><span class="p">,</span><span class="s1">&#39;BRB&#39;</span><span class="p">,</span><span class="s1">&#39;BLZ&#39;</span><span class="p">,</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a>                <span class="s1">&#39;BEN&#39;</span><span class="p">,</span><span class="s1">&#39;BTN&#39;</span><span class="p">,</span><span class="s1">&#39;BOL&#39;</span><span class="p">,</span><span class="s1">&#39;BWA&#39;</span><span class="p">,</span><span class="s1">&#39;BRA&#39;</span><span class="p">,</span><span class="s1">&#39;BRN&#39;</span><span class="p">,</span><span class="s1">&#39;BFA&#39;</span><span class="p">,</span><span class="s1">&#39;BDI&#39;</span><span class="p">,</span><span class="s1">&#39;CPV&#39;</span><span class="p">,</span><span class="s1">&#39;KHM&#39;</span><span class="p">,</span><span class="s1">&#39;CMR&#39;</span><span class="p">,</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a>                <span class="s1">&#39;CAF&#39;</span><span class="p">,</span><span class="s1">&#39;TCD&#39;</span><span class="p">,</span><span class="s1">&#39;CHL&#39;</span><span class="p">,</span><span class="s1">&#39;CHN&#39;</span><span class="p">,</span><span class="s1">&#39;COL&#39;</span><span class="p">,</span><span class="s1">&#39;COM&#39;</span><span class="p">,</span><span class="s1">&#39;COG&#39;</span><span class="p">,</span><span class="s1">&#39;CRI&#39;</span><span class="p">,</span><span class="s1">&#39;CIV&#39;</span><span class="p">,</span><span class="s1">&#39;CUB&#39;</span><span class="p">,</span><span class="s1">&#39;PRK&#39;</span><span class="p">,</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a>                <span class="s1">&#39;COD&#39;</span><span class="p">,</span><span class="s1">&#39;DJI&#39;</span><span class="p">,</span><span class="s1">&#39;DMA&#39;</span><span class="p">,</span><span class="s1">&#39;DOM&#39;</span><span class="p">,</span><span class="s1">&#39;ECU&#39;</span><span class="p">,</span><span class="s1">&#39;EGY&#39;</span><span class="p">,</span><span class="s1">&#39;SLV&#39;</span><span class="p">,</span><span class="s1">&#39;GNQ&#39;</span><span class="p">,</span><span class="s1">&#39;ERI&#39;</span><span class="p">,</span><span class="s1">&#39;SWZ&#39;</span><span class="p">,</span><span class="s1">&#39;ETH&#39;</span><span class="p">,</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a>                <span class="s1">&#39;FJI&#39;</span><span class="p">,</span><span class="s1">&#39;GAB&#39;</span><span class="p">,</span><span class="s1">&#39;GMB&#39;</span><span class="p">,</span><span class="s1">&#39;GHA&#39;</span><span class="p">,</span><span class="s1">&#39;GRD&#39;</span><span class="p">,</span><span class="s1">&#39;GTM&#39;</span><span class="p">,</span><span class="s1">&#39;GIN&#39;</span><span class="p">,</span><span class="s1">&#39;GNB&#39;</span><span class="p">,</span><span class="s1">&#39;GUY&#39;</span><span class="p">,</span><span class="s1">&#39;HTI&#39;</span><span class="p">,</span><span class="s1">&#39;HND&#39;</span><span class="p">,</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a>                <span class="s1">&#39;IND&#39;</span><span class="p">,</span><span class="s1">&#39;IDN&#39;</span><span class="p">,</span><span class="s1">&#39;IRN&#39;</span><span class="p">,</span><span class="s1">&#39;IRQ&#39;</span><span class="p">,</span><span class="s1">&#39;JAM&#39;</span><span class="p">,</span><span class="s1">&#39;JOR&#39;</span><span class="p">,</span><span class="s1">&#39;KEN&#39;</span><span class="p">,</span><span class="s1">&#39;KIR&#39;</span><span class="p">,</span><span class="s1">&#39;KWT&#39;</span><span class="p">,</span><span class="s1">&#39;LAO&#39;</span><span class="p">,</span><span class="s1">&#39;LBN&#39;</span><span class="p">,</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a>                <span class="s1">&#39;LSO&#39;</span><span class="p">,</span><span class="s1">&#39;LBR&#39;</span><span class="p">,</span><span class="s1">&#39;LBY&#39;</span><span class="p">,</span><span class="s1">&#39;MDG&#39;</span><span class="p">,</span><span class="s1">&#39;MWI&#39;</span><span class="p">,</span><span class="s1">&#39;MYS&#39;</span><span class="p">,</span><span class="s1">&#39;MDV&#39;</span><span class="p">,</span><span class="s1">&#39;MLI&#39;</span><span class="p">,</span><span class="s1">&#39;MHL&#39;</span><span class="p">,</span><span class="s1">&#39;MRT&#39;</span><span class="p">,</span><span class="s1">&#39;MUS&#39;</span><span class="p">,</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a>                <span class="s1">&#39;FSM&#39;</span><span class="p">,</span><span class="s1">&#39;MNG&#39;</span><span class="p">,</span><span class="s1">&#39;MAR&#39;</span><span class="p">,</span><span class="s1">&#39;MOZ&#39;</span><span class="p">,</span><span class="s1">&#39;MMR&#39;</span><span class="p">,</span><span class="s1">&#39;NAM&#39;</span><span class="p">,</span><span class="s1">&#39;NRU&#39;</span><span class="p">,</span><span class="s1">&#39;NPL&#39;</span><span class="p">,</span><span class="s1">&#39;NIC&#39;</span><span class="p">,</span><span class="s1">&#39;NER&#39;</span><span class="p">,</span><span class="s1">&#39;NGA&#39;</span><span class="p">,</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a>                <span class="s1">&#39;OMN&#39;</span><span class="p">,</span><span class="s1">&#39;PAK&#39;</span><span class="p">,</span><span class="s1">&#39;PAN&#39;</span><span class="p">,</span><span class="s1">&#39;PNG&#39;</span><span class="p">,</span><span class="s1">&#39;PRY&#39;</span><span class="p">,</span><span class="s1">&#39;PER&#39;</span><span class="p">,</span><span class="s1">&#39;PHL&#39;</span><span class="p">,</span><span class="s1">&#39;QAT&#39;</span><span class="p">,</span><span class="s1">&#39;RWA&#39;</span><span class="p">,</span><span class="s1">&#39;KNA&#39;</span><span class="p">,</span><span class="s1">&#39;LCA&#39;</span><span class="p">,</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a>                <span class="s1">&#39;VCT&#39;</span><span class="p">,</span><span class="s1">&#39;WSM&#39;</span><span class="p">,</span><span class="s1">&#39;STP&#39;</span><span class="p">,</span><span class="s1">&#39;SAU&#39;</span><span class="p">,</span><span class="s1">&#39;SEN&#39;</span><span class="p">,</span><span class="s1">&#39;SYC&#39;</span><span class="p">,</span><span class="s1">&#39;SLE&#39;</span><span class="p">,</span><span class="s1">&#39;SGP&#39;</span><span class="p">,</span><span class="s1">&#39;SLB&#39;</span><span class="p">,</span><span class="s1">&#39;SOM&#39;</span><span class="p">,</span><span class="s1">&#39;ZAF&#39;</span><span class="p">,</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a>                <span class="s1">&#39;SSD&#39;</span><span class="p">,</span><span class="s1">&#39;LKA&#39;</span><span class="p">,</span><span class="s1">&#39;PSE&#39;</span><span class="p">,</span><span class="s1">&#39;SDN&#39;</span><span class="p">,</span><span class="s1">&#39;SUR&#39;</span><span class="p">,</span><span class="s1">&#39;SYR&#39;</span><span class="p">,</span><span class="s1">&#39;TJK&#39;</span><span class="p">,</span><span class="s1">&#39;THA&#39;</span><span class="p">,</span><span class="s1">&#39;TLS&#39;</span><span class="p">,</span><span class="s1">&#39;TGO&#39;</span><span class="p">,</span><span class="s1">&#39;TON&#39;</span><span class="p">,</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a>                <span class="s1">&#39;TTO&#39;</span><span class="p">,</span><span class="s1">&#39;TUN&#39;</span><span class="p">,</span><span class="s1">&#39;TKM&#39;</span><span class="p">,</span><span class="s1">&#39;UGA&#39;</span><span class="p">,</span><span class="s1">&#39;ARE&#39;</span><span class="p">,</span><span class="s1">&#39;TZA&#39;</span><span class="p">,</span><span class="s1">&#39;URY&#39;</span><span class="p">,</span><span class="s1">&#39;VUT&#39;</span><span class="p">,</span><span class="s1">&#39;VEN&#39;</span><span class="p">,</span><span class="s1">&#39;VNM&#39;</span><span class="p">,</span><span class="s1">&#39;YEM&#39;</span><span class="p">,</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a>                <span class="s1">&#39;ZMB&#39;</span><span class="p">,</span><span class="s1">&#39;ZWE&#39;</span><span class="p">]</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a>        <span class="k">elif</span> <span class="n">region</span><span class="o">==</span><span class="s1">&#39;Commonwealth&#39;</span><span class="p">:</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a>            <span class="n">clist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_cw</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a>        <span class="k">elif</span> <span class="n">region</span><span class="o">==</span><span class="s1">&#39;Celac&#39;</span><span class="p">:</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a>            <span class="n">clist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_celac</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a>        <span class="k">elif</span> <span class="n">region</span><span class="o">==</span><span class="s1">&#39;Cedeao&#39;</span><span class="p">:</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a>            <span class="n">clist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_cedeao</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a>        <span class="k">elif</span> <span class="n">region</span><span class="o">==</span><span class="s1">&#39;Sadc&#39;</span><span class="p">:</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a>            <span class="n">clist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sadc</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a>        <span class="k">elif</span> <span class="n">region</span><span class="o">==</span><span class="s1">&#39;Amu&#39;</span><span class="p">:</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a>            <span class="n">clist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_amu</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a>        <span class="k">elif</span> <span class="n">region</span><span class="o">==</span><span class="s1">&#39;Ceeac&#39;</span><span class="p">:</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a>            <span class="n">clist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ceeac</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a>        <span class="k">elif</span> <span class="n">region</span><span class="o">==</span><span class="s1">&#39;Eac&#39;</span><span class="p">:</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a>            <span class="n">clist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_eac</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a>        <span class="k">elif</span> <span class="n">region</span><span class="o">==</span><span class="s1">&#39;Censad&#39;</span><span class="p">:</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a>            <span class="n">clist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_censad</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a>        <span class="k">elif</span> <span class="n">region</span><span class="o">==</span><span class="s1">&#39;Comesa&#39;</span><span class="p">:</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a>            <span class="n">clist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_comesa</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a>        <span class="k">elif</span> <span class="n">region</span><span class="o">==</span><span class="s1">&#39;Brics&#39;</span><span class="p">:</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a>            <span class="n">clist</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;BRA&#39;</span><span class="p">,</span><span class="s1">&#39;RUS&#39;</span><span class="p">,</span><span class="s1">&#39;IND&#39;</span><span class="p">,</span><span class="s1">&#39;CHN&#39;</span><span class="p">,</span><span class="s1">&#39;ZAF&#39;</span><span class="p">]</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a>            <span class="n">clist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_p_gs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_p_gs</span><span class="p">[</span><span class="s1">&#39;region_name&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">region</span><span class="p">][</span><span class="s1">&#39;iso3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a>        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">clist</span><span class="p">)</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a>    <span class="k">def</span> <span class="nf">get_pandas</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_p_gs</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a><span class="c1"># ---------------------------------------------------------------------</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a><span class="c1"># --- GeoCountryclass -------------------------------------------------</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a><span class="c1"># ---------------------------------------------------------------------</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a><span class="k">class</span> <span class="nc">GeoCountry</span><span class="p">():</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;GeoCountry class definition.</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a><span class="sd">    This class provides functions for specific countries and their states / departments / regions,</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a><span class="sd">    and their geo properties (geometry, population if available, etc.)</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a><span class="sd">    The list of supported countries is given by get_list_countries() function. &quot;&quot;&quot;</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a>    <span class="c1"># Assuming zip file here</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a>    <span class="n">_country_info_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;FRA&#39;</span><span class="p">:</span><span class="s1">&#39;https://data.opendatasoft.com/explore/dataset/georef-france-departement@public/download/?format=geojson&amp;timezone=Europe/Berlin&amp;lang=fr&#39;</span><span class="p">,</span>\
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a>                    <span class="c1">#previously https://github.com/coa-project/coadata/raw/main/coastore/public.opendatasoft.com_912711563.zip&#39;,\</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a>                    <span class="s1">&#39;USA&#39;</span><span class="p">:</span><span class="s1">&#39;https://alicia.data.socrata.com/api/geospatial/jhnu-yfrj?method=export&amp;format=Original&#39;</span><span class="p">,</span>\
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a>                    <span class="s1">&#39;ITA&#39;</span><span class="p">:</span><span class="s1">&#39;https://raw.githubusercontent.com/openpolis/geojson-italy/master/geojson/limits_IT_provinces.geojson&#39;</span><span class="p">,</span>\
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a>                    <span class="s1">&#39;IND&#39;</span><span class="p">:</span><span class="s1">&#39;https://raw.githubusercontent.com/deldersveld/topojson/master/countries/india/india-states.json&#39;</span><span class="p">,</span>\
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a>                    <span class="s1">&#39;DEU&#39;</span><span class="p">:</span><span class="s1">&#39;https://github.com/jgehrcke/covid-19-germany-gae/raw/master/geodata/DE-counties.geojson&#39;</span><span class="p">,</span>\
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a>                    <span class="s1">&#39;ESP&#39;</span><span class="p">:</span><span class="s1">&#39;https://public.opendatasoft.com/explore/dataset/provincias-espanolas/download/?format=shp&amp;timezone=Europe/Berlin&amp;lang=en&#39;</span><span class="p">,</span>\
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a>                    <span class="c1"># missing some counties &#39;GBR&#39;:&#39;https://opendata.arcgis.com/datasets/69dc11c7386943b4ad8893c45648b1e1_0.zip?geometry=%7B%22xmin%22%3A-44.36%2C%22ymin%22%3A51.099%2C%22xmax%22%3A39.487%2C%22ymax%22%3A59.78%2C%22type%22%3A%22extent%22%2C%22spatialReference%22%3A%7B%22wkid%22%3A4326%7D%7D&amp;outSR=%7B%22latestWkid%22%3A27700%2C%22wkid%22%3A27700%7D&#39;,\</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a>                    <span class="s1">&#39;GBR&#39;</span><span class="p">:</span><span class="s1">&#39;https://github.com/coa-project/coadata/raw/main/coastore/opendata.arcgis.com_3256063640&#39;</span><span class="p">,</span>\
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a>                    <span class="c1"># previously (but broken) : https://opendata.arcgis.com/datasets/3a4fa2ce68f642e399b4de07643eeed3_0.geojson&#39;,\</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a>                    <span class="s1">&#39;BEL&#39;</span><span class="p">:</span><span class="s1">&#39;https://github.com/coa-project/coadata/raw/main/coacache/public.opendatasoft.com_537867990.zip&#39;</span><span class="p">,</span>\
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a><span class="c1"># previously (but not all regions now) &#39;https://public.opendatasoft.com/explore/dataset/arrondissements-belges-2019/download/?format=shp&amp;timezone=Europe/Berlin&amp;lang=en&#39;,\</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a>                    <span class="s1">&#39;PRT&#39;</span><span class="p">:</span><span class="s1">&#39;https://github.com/coa-project/coadata/raw/main/coastore/concelhos.zip&#39;</span><span class="p">,</span>\
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a>                    <span class="c1"># (simplification of &#39;https://github.com/coa-project/coadata/raw/main&#39;https://dados.gov.pt/en/datasets/r/59368d37-cbdb-426a-9472-5a04cf30fbe4&#39;,\</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a>                    <span class="s1">&#39;MYS&#39;</span><span class="p">:</span><span class="s1">&#39;https://stacks.stanford.edu/file/druid:zd362bc5680/data.zip&#39;</span><span class="p">,</span>\
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a>                    <span class="s1">&#39;CHL&#39;</span><span class="p">:</span><span class="s1">&#39;http://geonode.meteochile.gob.cl/geoserver/wfs?format_options=charset%3AUTF-8&amp;typename=geonode%3Adivision_comunal_geo_ide_1&amp;outputFormat=SHAPE-ZIP&amp;version=1.0.0&amp;service=WFS&amp;request=GetFeature&#39;</span><span class="p">,</span>\
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a>                    <span class="s1">&#39;EUR&#39;</span><span class="p">:</span><span class="s1">&#39;https://github.com/coa-project/coadata/raw/main/coastore/WHO_EUROsmall2.json&#39;</span><span class="p">,</span>\
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a>                    <span class="s1">&#39;GRC&#39;</span><span class="p">:</span><span class="s1">&#39;https://geodata.gov.gr/dataset/6deb6a12-1a54-41b4-b53b-6b36068b8348/resource/3e571f7f-42a4-4b49-8db0-311695d72fa3/download/nomoiokxe.zip&#39;</span><span class="p">,</span>\
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a>                    <span class="s1">&#39;JPN&#39;</span><span class="p">:</span><span class="s1">&#39;https://raw.githubusercontent.com/piuccio/open-data-jp-prefectures-geojson/master/output/prefectures.geojson&#39;</span><span class="p">,</span>\
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a>                    <span class="p">}</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a>    <span class="n">_source_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;FRA&#39;</span><span class="p">:{</span><span class="s1">&#39;Basics&#39;</span><span class="p">:</span><span class="n">_country_info_dict</span><span class="p">[</span><span class="s1">&#39;FRA&#39;</span><span class="p">],</span>\
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a>                    <span class="s1">&#39;Subregion Flags&#39;</span><span class="p">:</span><span class="s1">&#39;http://sticker-departement.com/&#39;</span><span class="p">,</span>\
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a>                    <span class="s1">&#39;Region Flags&#39;</span><span class="p">:</span><span class="s1">&#39;https://fr.wikipedia.org/w/index.php?title=R%C3%A9gion_fran%C3%A7aise&amp;oldid=177269957&#39;</span><span class="p">,</span>\
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a>                    <span class="s1">&#39;Population&#39;</span><span class="p">:</span><span class="s1">&#39;https://github.com/coa-project/coadata/raw/main/coastore/www.insee.fr_3658796960&#39;</span><span class="p">,</span>\
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a>                    <span class="c1"># previously (but sometimes broken : &#39;https://www.insee.fr/fr/statistiques/4989753?sommaire=4989761&#39;</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a>                    <span class="p">},</span>\
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a>                    <span class="s1">&#39;USA&#39;</span><span class="p">:{</span><span class="s1">&#39;Basics&#39;</span><span class="p">:</span><span class="n">_country_info_dict</span><span class="p">[</span><span class="s1">&#39;USA&#39;</span><span class="p">],</span>\
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a>                    <span class="s1">&#39;Subregion informations&#39;</span><span class="p">:</span><span class="s1">&#39;https://en.wikipedia.org/wiki/List_of_states_and_territories_of_the_United_States&#39;</span><span class="p">},</span>\
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a>                    <span class="s1">&#39;ITA&#39;</span><span class="p">:{</span><span class="s1">&#39;Basics&#39;</span><span class="p">:</span><span class="n">_country_info_dict</span><span class="p">[</span><span class="s1">&#39;ITA&#39;</span><span class="p">]},</span>\
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a>                    <span class="s1">&#39;IND&#39;</span><span class="p">:{</span><span class="s1">&#39;Basics&#39;</span><span class="p">:</span><span class="n">_country_info_dict</span><span class="p">[</span><span class="s1">&#39;IND&#39;</span><span class="p">]},</span>\
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a>                    <span class="s1">&#39;DEU&#39;</span><span class="p">:{</span><span class="s1">&#39;Basics&#39;</span><span class="p">:</span><span class="n">_country_info_dict</span><span class="p">[</span><span class="s1">&#39;DEU&#39;</span><span class="p">]},</span>\
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a>                    <span class="s1">&#39;ESP&#39;</span><span class="p">:{</span><span class="s1">&#39;Basics&#39;</span><span class="p">:</span><span class="n">_country_info_dict</span><span class="p">[</span><span class="s1">&#39;ESP&#39;</span><span class="p">]},</span>\
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a>                    <span class="s1">&#39;GBR&#39;</span><span class="p">:{</span><span class="s1">&#39;Basics&#39;</span><span class="p">:</span><span class="n">_country_info_dict</span><span class="p">[</span><span class="s1">&#39;GBR&#39;</span><span class="p">],</span><span class="s1">&#39;Regions&#39;</span><span class="p">:</span><span class="s1">&#39;http://geoportal1-ons.opendata.arcgis.com/datasets/0c3a9643cc7c4015bb80751aad1d2594_0.csv&#39;</span><span class="p">},</span>\
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a>                    <span class="s1">&#39;BEL&#39;</span><span class="p">:{</span><span class="s1">&#39;Basics&#39;</span><span class="p">:</span><span class="n">_country_info_dict</span><span class="p">[</span><span class="s1">&#39;BEL&#39;</span><span class="p">]},</span>\
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a>                    <span class="s1">&#39;PRT&#39;</span><span class="p">:{</span><span class="s1">&#39;Basics&#39;</span><span class="p">:</span><span class="n">_country_info_dict</span><span class="p">[</span><span class="s1">&#39;PRT&#39;</span><span class="p">]},</span>\
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a>                    <span class="c1">#,&#39;District&#39;:&#39;https://raw.githubusercontent.com/JoaoFOliveira/portuguese-municipalities/master/municipalities.json&#39;},\</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a>                    <span class="s1">&#39;MYS&#39;</span><span class="p">:{</span><span class="s1">&#39;Basics&#39;</span><span class="p">:</span><span class="n">_country_info_dict</span><span class="p">[</span><span class="s1">&#39;MYS&#39;</span><span class="p">]},</span>\
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a>                    <span class="s1">&#39;CHL&#39;</span><span class="p">:{</span><span class="s1">&#39;Basics&#39;</span><span class="p">:</span><span class="n">_country_info_dict</span><span class="p">[</span><span class="s1">&#39;CHL&#39;</span><span class="p">]},</span>\
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a>                    <span class="s1">&#39;EUR&#39;</span><span class="p">:{</span><span class="s1">&#39;Basics&#39;</span><span class="p">:</span><span class="n">_country_info_dict</span><span class="p">[</span><span class="s1">&#39;EUR&#39;</span><span class="p">]},</span>\
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a>                    <span class="s1">&#39;GRC&#39;</span><span class="p">:{</span><span class="s1">&#39;Basics&#39;</span><span class="p">:</span><span class="n">_country_info_dict</span><span class="p">[</span><span class="s1">&#39;GRC&#39;</span><span class="p">]},</span>\
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a>                    <span class="s1">&#39;JPN&#39;</span><span class="p">:{</span><span class="s1">&#39;Basics&#39;</span><span class="p">:</span><span class="n">_country_info_dict</span><span class="p">[</span><span class="s1">&#39;JPN&#39;</span><span class="p">]},</span>\
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a>                    <span class="p">}</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">country</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; __init__ member function.</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a><span class="sd">        Must give as arg the country to deal with, as a valid ISO3 string.</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_country</span><span class="o">=</span><span class="n">country</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a>        <span class="k">if</span> <span class="n">country</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">country</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list_countries</span><span class="p">():</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s2">&quot;Country &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">country</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; not supported. Please see get_list_countries() and help. &quot;</span><span class="p">)</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_country_data_region</span><span class="o">=</span><span class="kc">None</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_country_data_subregion</span><span class="o">=</span><span class="kc">None</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_municipality_region</span><span class="o">=</span><span class="kc">None</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_dense_geometry</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_exploded_geometry</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_main_geometry</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a>        <span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_info_dict</span><span class="p">[</span><span class="n">country</span><span class="p">]</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a>        <span class="c1"># country by country, adapt the read file informations</span>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a>        <span class="c1"># --- &#39;FRA&#39; case ---------------------------------------------------------------------------------------</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country</span><span class="o">==</span><span class="s1">&#39;FRA&#39;</span><span class="p">:</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a>            <span class="c1">#self._country_data = gpd.read_file(&#39;zip://&#39;+get_local_from_url(url,0,&#39;.zip&#39;))</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a>            <span class="c1"># adding a flag for subregion (departements)</span>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;flag_subregion&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_source_dict</span><span class="p">[</span><span class="s1">&#39;FRA&#39;</span><span class="p">][</span><span class="s1">&#39;Subregion Flags&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;img/dept/sticker_plaque_immat_&#39;</span><span class="o">+</span>\
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;dep_code&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span>\
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a>                <span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;dep_name&#39;</span><span class="p">]]</span><span class="o">+</span><span class="s1">&#39;_moto.png&#39;</span> <span class="c1"># picture of a sticker for motobikes, not so bad...</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a>            <span class="c1"># Reading information to get region flags and correct names of regions</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a>            <span class="n">f_reg_flag</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_source_dict</span><span class="p">[</span><span class="s1">&#39;FRA&#39;</span><span class="p">][</span><span class="s1">&#39;Region Flags&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a>            <span class="n">content_reg_flag</span> <span class="o">=</span> <span class="n">f_reg_flag</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a>            <span class="n">f_reg_flag</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a>            <span class="n">soup_reg_flag</span> <span class="o">=</span> <span class="n">bs4</span><span class="o">.</span><span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">content_reg_flag</span><span class="p">,</span><span class="s1">&#39;lxml&#39;</span><span class="p">)</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a>            <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">soup_reg_flag</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;img&#39;</span><span class="p">):</span>  <span class="c1"># need to convert &lt;img tags to src content for pandas_read</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a>                <span class="n">src</span><span class="o">=</span><span class="n">img</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">)</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a>                <span class="k">if</span> <span class="n">src</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a>                    <span class="n">src</span><span class="o">=</span><span class="s1">&#39;http:&#39;</span><span class="o">+</span><span class="n">src</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a>                <span class="n">img</span><span class="o">.</span><span class="n">replace_with</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a>            <span class="n">tabs_reg_flag</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">soup_reg_flag</span><span class="p">))</span> <span class="c1"># pandas read the modified html</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a>            <span class="n">metropole</span><span class="o">=</span><span class="n">tabs_reg_flag</span><span class="p">[</span><span class="mi">5</span><span class="p">][[</span><span class="s2">&quot;Logo&quot;</span><span class="p">,</span><span class="s2">&quot;Dénomination&quot;</span><span class="p">,</span><span class="s2">&quot;Code INSEE[5]&quot;</span><span class="p">]]</span>  <span class="c1"># getting 5th table, and only usefull columns</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a>            <span class="n">ultramarin</span><span class="o">=</span><span class="n">tabs_reg_flag</span><span class="p">[</span><span class="mi">6</span><span class="p">][[</span><span class="s2">&quot;Logo&quot;</span><span class="p">,</span><span class="s2">&quot;Dénomination&quot;</span><span class="p">,</span><span class="s2">&quot;Code INSEE[5]&quot;</span><span class="p">]]</span> <span class="c1"># getting 6th table</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a>            <span class="n">p_reg_flag</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">metropole</span><span class="p">,</span><span class="n">ultramarin</span><span class="p">])</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Code INSEE[5]&quot;</span><span class="p">:</span><span class="s2">&quot;code_region&quot;</span><span class="p">,</span>\
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a>                                                                        <span class="s2">&quot;Logo&quot;</span><span class="p">:</span><span class="s2">&quot;flag_region&quot;</span><span class="p">,</span>\
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a>                                                                        <span class="s2">&quot;Dénomination&quot;</span><span class="p">:</span><span class="s2">&quot;name_region&quot;</span><span class="p">})</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a>            <span class="n">p_reg_flag</span><span class="o">=</span><span class="n">p_reg_flag</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">notnull</span><span class="p">(</span><span class="n">p_reg_flag</span><span class="p">[</span><span class="s2">&quot;code_region&quot;</span><span class="p">])]</span>  <span class="c1"># select only valid rows</span>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a>            <span class="n">p_reg_flag</span><span class="p">[</span><span class="s2">&quot;name_region&quot;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span> <span class="n">n</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">p_reg_flag</span><span class="p">[</span><span class="s2">&quot;name_region&quot;</span><span class="p">]</span> <span class="p">]</span> <span class="c1"># remove footnote [k] index from wikipedia</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a>            <span class="n">p_reg_flag</span><span class="p">[</span><span class="s2">&quot;code_region&quot;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">))</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">p_reg_flag</span><span class="p">[</span><span class="s2">&quot;code_region&quot;</span><span class="p">]</span> <span class="p">]</span> <span class="c1"># convert to str for merge the code, adding 1 leading 0 if needed</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">p_reg_flag</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>\
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a>                    <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;reg_code&#39;</span><span class="p">,</span><span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;code_region&#39;</span><span class="p">)</span> <span class="c1"># merging with flag and correct names</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a>            <span class="c1"># standardize name for region, subregion</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>\
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a>                <span class="s1">&#39;dep_code&#39;</span><span class="p">:</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span>\
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a>                <span class="s1">&#39;dep_name&#39;</span><span class="p">:</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span>\
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a>                <span class="c1">#&#39;nom_chf&#39;:&#39;town_subregion&#39;,\</span>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a>                <span class="p">},</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a>            <span class="c1"># adding population information (departements)</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a>            <span class="n">pop_fra</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_source_dict</span><span class="p">[</span><span class="s1">&#39;FRA&#39;</span><span class="p">][</span><span class="s1">&#39;Population&#39;</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a>            <span class="n">pop_fra</span><span class="p">[</span><span class="s1">&#39;population_subregion&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">pop_fra</span><span class="p">[</span><span class="s1">&#39;Population municipale&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[ \xa0]&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a>            <span class="c1"># En l&#39;absence de Mayotte dans ce document, car le recensement n&#39;a pas eu lieu en phase, ajout à la main</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a>            <span class="c1"># En référence à la page pour Mayotte : https://www.insee.fr/fr/statistiques/3291775?sommaire=2120838</span>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a>            <span class="n">mayotte_df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([{</span><span class="s1">&#39;Code département&#39;</span><span class="p">:</span><span class="s1">&#39;976&#39;</span><span class="p">,</span><span class="s1">&#39;population_subregion&#39;</span><span class="p">:</span><span class="mi">256518</span><span class="p">}])</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a>            <span class="n">pop_fra</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pop_fra</span><span class="p">,</span><span class="n">mayotte_df</span><span class="p">])</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a>            <span class="c1">#pop_fra=pop_fra.append(mayotte_df)</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a>            <span class="c1"># Pour les collectivités d&#39;Outremer : https://www.insee.fr/fr/statistiques/4989739?sommaire=4989761</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a>            <span class="n">com_df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([{</span><span class="s1">&#39;Code département&#39;</span><span class="p">:</span><span class="s1">&#39;980&#39;</span><span class="p">,</span><span class="s1">&#39;population_subregion&#39;</span><span class="p">:(</span><span class="mi">5985</span><span class="o">+</span><span class="mi">10124</span><span class="o">+</span><span class="mi">34065</span><span class="o">+</span><span class="mi">281674</span><span class="o">+</span><span class="mi">12067</span><span class="p">)}])</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a>            <span class="n">pop_fra</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pop_fra</span><span class="p">,</span><span class="n">com_df</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a>            <span class="c1">#pop_fra=pop_fra.append(com_df).reset_index()</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a>            <span class="n">geo_com</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">code_subregion</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;975&#39;</span><span class="p">,</span><span class="s1">&#39;977&#39;</span><span class="p">,</span><span class="s1">&#39;978&#39;</span><span class="p">,</span><span class="s1">&#39;986&#39;</span><span class="p">,</span><span class="s1">&#39;987&#39;</span><span class="p">])][[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]]</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a>            <span class="n">geo_com</span><span class="p">[</span><span class="s1">&#39;smthing&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a>            <span class="n">geo_com</span><span class="o">=</span><span class="n">geo_com</span><span class="o">.</span><span class="n">dissolve</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;smthing&#39;</span><span class="p">)[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">,</span>\
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a>            <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([{</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">:</span><span class="s1">&#39;980&#39;</span><span class="p">,</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">:</span><span class="s1">&#39;Collectivités d</span><span class="se">\&#39;</span><span class="s1">outre-mer&#39;</span><span class="p">,</span><span class="s1">&#39;code_region&#39;</span><span class="p">:</span><span class="s1">&#39;09&#39;</span><span class="p">,</span><span class="s1">&#39;name_region&#39;</span><span class="p">:</span><span class="s1">&#39;Collectivités d</span><span class="se">\&#39;</span><span class="s1">outre-mer&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span><span class="n">geo_com</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]}])],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a>            <span class="c1">#self._country_data=self._country_data.append(</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a>            <span class="c1">#    pd.DataFrame([{&#39;code_subregion&#39;:&#39;980&#39;,&#39;name_subregion&#39;:&#39;Collectivités d\&#39;outre-mer&#39;,&#39;code_region&#39;:&#39;09&#39;,&#39;name_region&#39;:&#39;Collectivités d\&#39;outre-mer&#39;,&#39;geometry&#39;:geo_com.values[0]}])).reset_index()</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a>            <span class="c1"># Merging</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a>            <span class="c1">#self._country_data=self._country_data.append(</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a>            <span class="c1">#    pd.DataFrame([{&#39;code_subregion&#39;:&#39;980&#39;,&#39;name_subregion&#39;:&#39;Collectivités d\&#39;outre-mer&#39;,&#39;code_region&#39;:&#39;09&#39;,&#39;name_region&#39;:&#39;Collectivités d\&#39;outre-mer&#39;,&#39;geometry&#39;:geo_com.values[0]}])).reset_index()</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a>            <span class="c1"># Merging</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">pop_fra</span><span class="p">,</span><span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span><span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;Code département&#39;</span><span class="p">)</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[[</span><span class="s1">&#39;geometry&#39;</span><span class="p">,</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;flag_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;code_region&#39;</span><span class="p">,</span><span class="s1">&#39;name_region&#39;</span><span class="p">,</span><span class="s1">&#39;population_subregion&#39;</span><span class="p">]]</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a>            <span class="c1">#if needed, define translation for dense geometry</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_list_translation</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;971&#39;</span><span class="p">:(</span><span class="mi">63</span><span class="p">,</span><span class="mi">23</span><span class="p">),</span>   <span class="c1"># Guadeloupe</span>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a>                     <span class="s1">&#39;972&#39;</span><span class="p">:(</span><span class="mi">63</span><span class="p">,</span><span class="mi">23</span><span class="p">),</span> <span class="c1"># Martinique</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a>                     <span class="s1">&#39;973&#39;</span><span class="p">:(</span><span class="mi">50</span><span class="p">,</span><span class="mi">35</span><span class="p">),</span> <span class="c1"># Guyane</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a>                     <span class="s1">&#39;974&#39;</span><span class="p">:(</span><span class="o">-</span><span class="mi">51</span><span class="p">,</span><span class="mi">60</span><span class="p">),</span> <span class="c1"># Réunion</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a>                     <span class="s1">&#39;976&#39;</span><span class="p">:(</span><span class="o">-</span><span class="mi">38</span><span class="p">,</span><span class="mf">51.5</span><span class="p">)}</span>  <span class="c1"># Mayotte</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a>        <span class="c1"># --- &#39;USA&#39; case ---------------------------------------------------------------------------------------</span>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country</span> <span class="o">==</span> <span class="s1">&#39;USA&#39;</span><span class="p">:</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;zip://&#39;</span><span class="o">+</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;.zip&#39;</span><span class="p">))</span> <span class="c1"># under the hypothesis this is a zip file</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>\
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a>                <span class="s1">&#39;STATE_NAME&#39;</span><span class="p">:</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span>\
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a>                <span class="s1">&#39;STATE_ABBR&#39;</span><span class="p">:</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span>\
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a>                <span class="s1">&#39;SUB_REGION&#39;</span><span class="p">:</span><span class="s1">&#39;code_region&#39;</span><span class="p">},</span>\
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a>                <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;DRAWSEQ&#39;</span><span class="p">,</span><span class="s1">&#39;STATE_FIPS&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a>            <span class="c1"># Adding informations from wikipedia</span>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a>            <span class="n">f_us</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_source_dict</span><span class="p">[</span><span class="s1">&#39;USA&#39;</span><span class="p">][</span><span class="s1">&#39;Subregion informations&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a>            <span class="n">content_us</span> <span class="o">=</span> <span class="n">f_us</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a>            <span class="n">f_us</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a>            <span class="n">soup_us</span> <span class="o">=</span> <span class="n">bs4</span><span class="o">.</span><span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">content_us</span><span class="p">,</span><span class="s1">&#39;lxml&#39;</span><span class="p">)</span>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a>            <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">soup_us</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;img&#39;</span><span class="p">):</span>  <span class="c1"># need to convert &lt;img tags to src content for pandas_read</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a>                <span class="n">src</span><span class="o">=</span><span class="n">img</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">)</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a>                <span class="k">if</span> <span class="n">src</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a>                    <span class="n">src</span><span class="o">=</span><span class="s1">&#39;http:&#39;</span><span class="o">+</span><span class="n">src</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a>                <span class="n">img</span><span class="o">.</span><span class="n">replace_with</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a>            <span class="n">h_us</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">soup_us</span><span class="p">))</span> <span class="c1"># pandas read the modified html</span>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a>            <span class="n">h_us</span><span class="o">=</span><span class="n">h_us</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">h_us</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">]]]</span>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a>            <span class="n">h_us</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;flag_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;town_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;population_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;area_subregion&#39;</span><span class="p">]</span>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a>            <span class="n">h_us</span><span class="p">[</span><span class="s1">&#39;flag_subregion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="n">h</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\xa0</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">h_us</span><span class="p">[</span><span class="s1">&#39;flag_subregion&#39;</span><span class="p">]</span> <span class="p">]</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">h_us</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">)</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a>            <span class="c1"># if needed, define some variable for dense / main geometry</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_list_translation</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;AK&quot;</span><span class="p">:(</span><span class="mi">40</span><span class="p">,</span><span class="o">-</span><span class="mi">40</span><span class="p">),</span><span class="s2">&quot;HI&quot;</span><span class="p">:(</span><span class="mi">60</span><span class="p">,</span><span class="mi">0</span><span class="p">)}</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_list_scale</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;AK&quot;</span><span class="p">:</span><span class="mf">0.4</span><span class="p">,</span><span class="s2">&quot;HI&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_list_center</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;AK&quot;</span><span class="p">:(</span><span class="o">-</span><span class="mi">120</span><span class="p">,</span><span class="mi">25</span><span class="p">),</span><span class="s2">&quot;HI&quot;</span><span class="p">:(</span><span class="o">-</span><span class="mi">130</span><span class="p">,</span><span class="mi">25</span><span class="p">)}</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a>        <span class="c1"># --- &#39;ITA&#39; case ---------------------------------------------------------------------------------------</span>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country</span> <span class="o">==</span> <span class="s1">&#39;ITA&#39;</span><span class="p">:</span>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span> <span class="c1"># this is a geojson file</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>\
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a>                <span class="s1">&#39;prov_name&#39;</span><span class="p">:</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span>\
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a>                <span class="s1">&#39;prov_acr&#39;</span><span class="p">:</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span>\
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a>                <span class="s1">&#39;reg_name&#39;</span><span class="p">:</span><span class="s1">&#39;name_region&#39;</span><span class="p">,</span>\
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a>                <span class="s1">&#39;reg_istat_code&#39;</span><span class="p">:</span><span class="s1">&#39;code_region&#39;</span><span class="p">,</span>\
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a>                <span class="p">},</span>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a>                <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a>            <span class="s1">&#39;Valle d</span><span class="se">\&#39;</span><span class="s1">Aosta/Vallée d</span><span class="se">\&#39;</span><span class="s1">Aoste&#39;</span><span class="p">:</span><span class="s1">&#39;Valle d</span><span class="se">\&#39;</span><span class="s1">Aosta&#39;</span><span class="p">,</span>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a>            <span class="s1">&#39;Trentino-Alto Adige/Südtirol&#39;</span><span class="p">:</span><span class="s1">&#39;Trentino-Alto Adige&#39;</span><span class="p">,</span> <span class="s1">&#39;Friuli-Venezia Giulia&#39;</span><span class="p">:</span><span class="s1">&#39;Friuli Venezia Giulia&#39;</span><span class="p">})</span>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;prov_istat_code_num&#39;</span><span class="p">,</span><span class="s1">&#39;reg_istat_code_num&#39;</span><span class="p">,</span><span class="s1">&#39;prov_istat_code&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a>        <span class="c1"># --- &#39;IND&#39; case ---------------------------------------------------------------------------------------</span>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country</span> <span class="o">==</span> <span class="s1">&#39;IND&#39;</span><span class="p">:</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span> <span class="c1"># this is a geojson file</span>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>\
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a>                <span class="s1">&#39;NAME_1&#39;</span><span class="p">:</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span>\
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a>                <span class="s1">&#39;VARNAME_1&#39;</span><span class="p">:</span><span class="s1">&#39;variationname&#39;</span><span class="p">,</span>\
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a>                <span class="s1">&#39;HASC_1&#39;</span><span class="p">:</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span>\
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a>                <span class="p">},</span>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a>                <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">]</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Orissa&#39;</span><span class="p">,</span><span class="s1">&#39;Odisha&#39;</span><span class="p">)</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a>            <span class="n">variationname</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;variationname&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a>            <span class="n">name_subregion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a>            <span class="n">alllocationvariation</span><span class="o">=</span><span class="p">[</span> <span class="n">i</span><span class="o">+</span><span class="s1">&#39;|&#39;</span><span class="o">+</span><span class="n">j</span> <span class="k">if</span> <span class="n">j</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="k">else</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">name_subregion</span><span class="p">,</span><span class="n">variationname</span><span class="p">)]</span>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;variation_name_subregion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">]</span><span class="o">.</span>\
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a>                    <span class="n">replace</span><span class="p">(</span><span class="n">name_subregion</span><span class="p">,</span><span class="n">alllocationvariation</span><span class="p">)</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">]</span>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">]</span>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;ISO&#39;</span><span class="p">,</span><span class="s1">&#39;NAME_0&#39;</span><span class="p">,</span><span class="s1">&#39;ID_1&#39;</span><span class="p">,</span><span class="s1">&#39;TYPE_1&#39;</span><span class="p">,</span><span class="s1">&#39;ENGTYPE_1&#39;</span><span class="p">,</span><span class="s1">&#39;id&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a>        <span class="c1"># --- &#39;DEU&#39; case ---------------------------------------------------------------------------------------</span>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country</span> <span class="o">==</span> <span class="s1">&#39;DEU&#39;</span><span class="p">:</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span> <span class="c1"># this is a geojson file</span>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>\
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a>                <span class="s1">&#39;GEN&#39;</span><span class="p">:</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span>\
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a>                <span class="s1">&#39;AGS&#39;</span><span class="p">:</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span>\
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a>                <span class="p">},</span>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a>                <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a>            <span class="c1"># See https://www.ioer-monitor.de/en/methodology/glossary/o/official-municipality-key-ags/ for decoding information of region code</span>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">code_subregion</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">//</span><span class="mi">1000</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a>            <span class="n">h_deu</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="s1">&#39;https://de.zxc.wiki/wiki/Amtlicher_Gemeindeschl%C3%BCssel&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">))[</span><span class="mi">3</span><span class="p">]</span>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a>            <span class="n">h_deu</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">h_deu</span><span class="p">[</span><span class="s1">&#39;#&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">stop</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a>            <span class="n">h_deu</span><span class="p">[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">h_deu</span><span class="p">[</span><span class="s1">&#39;country&#39;</span><span class="p">]</span>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">h_deu</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;code_region&#39;</span><span class="p">,</span><span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">code_subregion</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;name_region&#39;</span><span class="p">,</span><span class="s1">&#39;code_region&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]]</span>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a>            <span class="n">disso</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">dissolve</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="s1">&#39;sum&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a>            <span class="c1"># aggregate geometry with the same subregion name # some code subregion is lost somehow</span>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">])</span>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]),</span><span class="n">disso</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">)</span>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a>        <span class="c1"># --- &#39;ESP&#39; case ---------------------------------------------------------------------------------------</span>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country</span> <span class="o">==</span> <span class="s1">&#39;ESP&#39;</span><span class="p">:</span>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;zip://&#39;</span><span class="o">+</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;.zip&#39;</span><span class="p">),</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="c1"># this is shapefile file</span>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>\
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a>                <span class="s1">&#39;ccaa&#39;</span><span class="p">:</span><span class="s1">&#39;name_region&#39;</span><span class="p">,</span>\
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a>                <span class="s1">&#39;cod_ccaa&#39;</span><span class="p">:</span><span class="s1">&#39;code_region&#39;</span><span class="p">,</span>\
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a>                <span class="s1">&#39;provincia&#39;</span><span class="p">:</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span>\
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a>                <span class="s1">&#39;codigo&#39;</span><span class="p">:</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">},</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;texto&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a>        <span class="c1"># --- &#39;GBR&#39; case ---------------------------------------------------------------------------------------</span>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country</span> <span class="o">==</span> <span class="s1">&#39;GBR&#39;</span><span class="p">:</span>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a>            <span class="n">reg_england</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_source_dict</span><span class="p">[</span><span class="s1">&#39;GBR&#39;</span><span class="p">][</span><span class="s1">&#39;Regions&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">))</span>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a>            <span class="n">reg_adding_dict</span><span class="o">=</span><span class="p">{</span>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a>                <span class="s1">&#39;E07000245&#39;</span><span class="p">:(</span><span class="s1">&#39;E12000006&#39;</span><span class="p">,</span><span class="s1">&#39;East of England&#39;</span><span class="p">),</span> <span class="c1"># West Suffolk in East of England</span>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a>                <span class="s1">&#39;E07000244&#39;</span><span class="p">:(</span><span class="s1">&#39;E12000006&#39;</span><span class="p">,</span><span class="s1">&#39;East of England&#39;</span><span class="p">),</span> <span class="c1"># East Suffolk in East of England</span>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a>                <span class="s1">&#39;E06000059&#39;</span><span class="p">:(</span><span class="s1">&#39;E12000009&#39;</span><span class="p">,</span><span class="s1">&#39;South West&#39;</span><span class="p">),</span> <span class="c1"># Dorset in South West</span>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a>                <span class="s1">&#39;E06000058&#39;</span><span class="p">:(</span><span class="s1">&#39;E12000009&#39;</span><span class="p">,</span><span class="s1">&#39;South West&#39;</span><span class="p">),</span> <span class="c1"># Bournemouth, Christchurch and Poole in South West</span>
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a>                <span class="s1">&#39;E07000246&#39;</span><span class="p">:(</span><span class="s1">&#39;E12000009&#39;</span><span class="p">,</span><span class="s1">&#39;South West&#39;</span><span class="p">),</span> <span class="c1"># Somerset West and Taunton in South West</span>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a>            <span class="p">}</span>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a>            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">reg_adding_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a>                <span class="n">reg_england</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">reg_england</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_records</span><span class="p">([{</span><span class="s1">&#39;LAD18CD&#39;</span><span class="p">:</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;RGN18CD&#39;</span><span class="p">:</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;RGN18NM&#39;</span><span class="p">:</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]}])],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">reg_england</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;lad19cd&#39;</span><span class="p">,</span><span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;LAD18CD&#39;</span><span class="p">)</span>
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>\
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a>                <span class="s1">&#39;lad19nm&#39;</span><span class="p">:</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span>\
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a>                <span class="s1">&#39;lad19cd&#39;</span><span class="p">:</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span>\
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a>                <span class="s1">&#39;RGN18CD&#39;</span><span class="p">:</span><span class="s1">&#39;code_region&#39;</span><span class="p">,</span>\
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a>                <span class="s1">&#39;RGN18NM&#39;</span><span class="p">:</span><span class="s1">&#39;name_region&#39;</span><span class="p">,</span>\
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a>                <span class="p">},</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">code_region</span><span class="o">.</span><span class="n">isnull</span><span class="p">(),</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span> <span class="o">=</span> \
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">code_region</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span><span class="o">.</span><span class="n">code_subregion</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">stop</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a>            <span class="n">dict_region</span><span class="o">=</span><span class="p">{</span>\
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a>                <span class="s1">&#39;E&#39;</span><span class="p">:</span><span class="s1">&#39;England&#39;</span><span class="p">,</span>\
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a>                <span class="s1">&#39;W&#39;</span><span class="p">:</span><span class="s1">&#39;Wales&#39;</span><span class="p">,</span>\
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a>                <span class="s1">&#39;S&#39;</span><span class="p">:</span><span class="s1">&#39;Scotland&#39;</span><span class="p">,</span>\
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a>                <span class="s1">&#39;N&#39;</span><span class="p">:</span><span class="s1">&#39;Northern Ireland&#39;</span>\
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a>                <span class="p">}</span>
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">code_region</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">dict_region</span><span class="o">.</span><span class="n">keys</span><span class="p">())),</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span> <span class="o">=</span> \
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a>                <span class="p">[</span><span class="n">dict_region</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">code_region</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">dict_region</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">,</span><span class="s1">&#39;code_region&#39;</span><span class="p">,</span><span class="s1">&#39;name_region&#39;</span><span class="p">]]</span>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a>            <span class="c1"># modifying projection</span>
</span><span id="L-1047"><a href="#L-1047"><span class="linenos">1047</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="s1">&#39;epsg:4326&#39;</span><span class="p">)</span>
</span><span id="L-1048"><a href="#L-1048"><span class="linenos">1048</span></a>        <span class="c1"># --- &#39;BEL&#39; case --------------------------------------------------------------------------------------------</span>
</span><span id="L-1049"><a href="#L-1049"><span class="linenos">1049</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country</span> <span class="o">==</span> <span class="s1">&#39;BEL&#39;</span><span class="p">:</span>
</span><span id="L-1050"><a href="#L-1050"><span class="linenos">1050</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;zip://&#39;</span><span class="o">+</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;.zip&#39;</span><span class="p">),</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="c1"># this is shapefile file</span>
</span><span id="L-1051"><a href="#L-1051"><span class="linenos">1051</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">notnull</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span> <span class="c1"># to solve the issue https://github.com/geopandas/geopandas/issues/2783</span>
</span><span id="L-1052"><a href="#L-1052"><span class="linenos">1052</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>\
</span><span id="L-1053"><a href="#L-1053"><span class="linenos">1053</span></a>                <span class="s1">&#39;nom_arrondi&#39;</span><span class="p">:</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span>\
</span><span id="L-1054"><a href="#L-1054"><span class="linenos">1054</span></a>                <span class="s1">&#39;niscode&#39;</span><span class="p">:</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span>\
</span><span id="L-1055"><a href="#L-1055"><span class="linenos">1055</span></a>                <span class="s1">&#39;prov_code&#39;</span><span class="p">:</span><span class="s1">&#39;code_region&#39;</span><span class="p">},</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1056"><a href="#L-1056"><span class="linenos">1056</span></a>            <span class="n">p</span><span class="o">=</span><span class="p">[]</span>
</span><span id="L-1057"><a href="#L-1057"><span class="linenos">1057</span></a>
</span><span id="L-1058"><a href="#L-1058"><span class="linenos">1058</span></a>            <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="L-1059"><a href="#L-1059"><span class="linenos">1059</span></a>                <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">prov_name_n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1060"><a href="#L-1060"><span class="linenos">1060</span></a>                    <span class="n">p0</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">prov_name_n</span>
</span><span id="L-1061"><a href="#L-1061"><span class="linenos">1061</span></a>                <span class="k">elif</span> <span class="n">row</span><span class="o">.</span><span class="n">prov_name_f</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1062"><a href="#L-1062"><span class="linenos">1062</span></a>                    <span class="n">p0</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">prov_name_f</span>
</span><span id="L-1063"><a href="#L-1063"><span class="linenos">1063</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1064"><a href="#L-1064"><span class="linenos">1064</span></a>                    <span class="n">p0</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">region</span>
</span><span id="L-1065"><a href="#L-1065"><span class="linenos">1065</span></a>                <span class="n">p0</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">p0</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;(Le)&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;(La)&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="L-1066"><a href="#L-1066"><span class="linenos">1066</span></a>                <span class="k">if</span> <span class="n">p0</span><span class="o">==</span><span class="s1">&#39;RégionDeBruxellesCapitale&#39;</span><span class="p">:</span>
</span><span id="L-1067"><a href="#L-1067"><span class="linenos">1067</span></a>                    <span class="n">p0</span><span class="o">=</span><span class="s1">&#39;Brussels&#39;</span>
</span><span id="L-1068"><a href="#L-1068"><span class="linenos">1068</span></a>                <span class="k">if</span> <span class="n">p0</span><span class="o">==</span><span class="s1">&#39;Henegouwen&#39;</span><span class="p">:</span>
</span><span id="L-1069"><a href="#L-1069"><span class="linenos">1069</span></a>                    <span class="n">p0</span><span class="o">=</span><span class="s1">&#39;Hainaut&#39;</span>
</span><span id="L-1070"><a href="#L-1070"><span class="linenos">1070</span></a>                <span class="n">p</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p0</span><span class="p">)</span>
</span><span id="L-1071"><a href="#L-1071"><span class="linenos">1071</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">p</span>
</span><span id="L-1072"><a href="#L-1072"><span class="linenos">1072</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">code_region</span><span class="o">.</span><span class="n">isnull</span><span class="p">(),</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;00000&#39;</span>
</span><span id="L-1073"><a href="#L-1073"><span class="linenos">1073</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;name_region&#39;</span><span class="p">,</span><span class="s1">&#39;code_region&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]]</span>
</span><span id="L-1074"><a href="#L-1074"><span class="linenos">1074</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="s1">&#39;epsg:4326&#39;</span><span class="p">)</span>
</span><span id="L-1075"><a href="#L-1075"><span class="linenos">1075</span></a>        <span class="c1"># --- &#39;PRT&#39; case --------------------------------------------------------------------------------------------</span>
</span><span id="L-1076"><a href="#L-1076"><span class="linenos">1076</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country</span> <span class="o">==</span> <span class="s1">&#39;PRT&#39;</span><span class="p">:</span>
</span><span id="L-1077"><a href="#L-1077"><span class="linenos">1077</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;zip://&#39;</span><span class="o">+</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;.zip&#39;</span><span class="p">),</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="L-1078"><a href="#L-1078"><span class="linenos">1078</span></a>            <span class="c1">#self._district=pd.read_json(self._source_dict[&#39;PRT&#39;][&#39;District&#39;])[[&#39;name&#39;,&#39;district&#39;]].dropna()</span>
</span><span id="L-1079"><a href="#L-1079"><span class="linenos">1079</span></a>
</span><span id="L-1080"><a href="#L-1080"><span class="linenos">1080</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>\
</span><span id="L-1081"><a href="#L-1081"><span class="linenos">1081</span></a>                <span class="s1">&#39;NAME_2&#39;</span><span class="p">:</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span>\
</span><span id="L-1082"><a href="#L-1082"><span class="linenos">1082</span></a>                <span class="s1">&#39;NAME_1&#39;</span><span class="p">:</span><span class="s1">&#39;name_region&#39;</span><span class="p">,</span>\
</span><span id="L-1083"><a href="#L-1083"><span class="linenos">1083</span></a>                <span class="s1">&#39;HASC_2&#39;</span><span class="p">:</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">},</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1084"><a href="#L-1084"><span class="linenos">1084</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">code_subregion</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">stop</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="L-1085"><a href="#L-1085"><span class="linenos">1085</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;name_region&#39;</span><span class="p">,</span><span class="s1">&#39;code_region&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]]</span>
</span><span id="L-1086"><a href="#L-1086"><span class="linenos">1086</span></a>        <span class="c1"># --- &#39;MYS&#39; case --------------------------------------------------------------------------------------------</span>
</span><span id="L-1087"><a href="#L-1087"><span class="linenos">1087</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country</span> <span class="o">==</span> <span class="s1">&#39;MYS&#39;</span><span class="p">:</span>
</span><span id="L-1088"><a href="#L-1088"><span class="linenos">1088</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;zip://&#39;</span><span class="o">+</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;.zip&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">dissolve</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;nam&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="L-1089"><a href="#L-1089"><span class="linenos">1089</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">title</span><span class="p">()</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">nam</span><span class="p">]</span>
</span><span id="L-1090"><a href="#L-1090"><span class="linenos">1090</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">name_subregion</span>
</span><span id="L-1091"><a href="#L-1091"><span class="linenos">1091</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;MYS&#39;</span>
</span><span id="L-1092"><a href="#L-1092"><span class="linenos">1092</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;Malaysia&#39;</span>
</span><span id="L-1093"><a href="#L-1093"><span class="linenos">1093</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">code_subregion</span>
</span><span id="L-1094"><a href="#L-1094"><span class="linenos">1094</span></a>            <span class="c1"># to help the join procedure with current covid data, some translation</span>
</span><span id="L-1095"><a href="#L-1095"><span class="linenos">1095</span></a>            <span class="n">dict_subregion</span><span class="o">=</span><span class="p">{</span>\
</span><span id="L-1096"><a href="#L-1096"><span class="linenos">1096</span></a>                <span class="s1">&#39;Wilayah Persekutuan Labuan&#39;</span><span class="p">:</span><span class="s1">&#39;W.P. Labuan&#39;</span><span class="p">,</span>\
</span><span id="L-1097"><a href="#L-1097"><span class="linenos">1097</span></a>                <span class="s1">&#39;Wilayah Persekutuan&#39;</span><span class="p">:</span><span class="s1">&#39;W.P. Kuala Lumpur&#39;</span><span class="p">,</span>\
</span><span id="L-1098"><a href="#L-1098"><span class="linenos">1098</span></a>                <span class="p">}</span>
</span><span id="L-1099"><a href="#L-1099"><span class="linenos">1099</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">code_subregion</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">dict_subregion</span><span class="o">.</span><span class="n">keys</span><span class="p">())),</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">]</span> <span class="o">=</span> \
</span><span id="L-1100"><a href="#L-1100"><span class="linenos">1100</span></a>                <span class="p">[</span><span class="n">dict_subregion</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">code_subregion</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">dict_subregion</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span>
</span><span id="L-1101"><a href="#L-1101"><span class="linenos">1101</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;name_region&#39;</span><span class="p">,</span><span class="s1">&#39;code_region&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]]</span>
</span><span id="L-1102"><a href="#L-1102"><span class="linenos">1102</span></a>        <span class="c1"># --- &#39;CHL&#39; case --------------------------------------------------------------------------------------------</span>
</span><span id="L-1103"><a href="#L-1103"><span class="linenos">1103</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country</span> <span class="o">==</span> <span class="s1">&#39;CHL&#39;</span><span class="p">:</span>
</span><span id="L-1104"><a href="#L-1104"><span class="linenos">1104</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;zip://&#39;</span><span class="o">+</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;.zip&#39;</span><span class="p">),</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="L-1105"><a href="#L-1105"><span class="linenos">1105</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>\
</span><span id="L-1106"><a href="#L-1106"><span class="linenos">1106</span></a>                <span class="s1">&#39;NOM_REG&#39;</span><span class="p">:</span><span class="s1">&#39;name_region&#39;</span><span class="p">,</span>\
</span><span id="L-1107"><a href="#L-1107"><span class="linenos">1107</span></a>                <span class="s1">&#39;NOM_COM&#39;</span><span class="p">:</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">},</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1108"><a href="#L-1108"><span class="linenos">1108</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">COD_COMUNA</span><span class="p">]</span>
</span><span id="L-1109"><a href="#L-1109"><span class="linenos">1109</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">code_subregion</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">stop</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-1110"><a href="#L-1110"><span class="linenos">1110</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;name_region&#39;</span><span class="p">,</span><span class="s1">&#39;code_region&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]]</span>
</span><span id="L-1111"><a href="#L-1111"><span class="linenos">1111</span></a>
</span><span id="L-1112"><a href="#L-1112"><span class="linenos">1112</span></a>        <span class="c1"># --- &#39;EUR&#39; case, which is a pseudo country for Europe ---------------------------------------------------------</span>
</span><span id="L-1113"><a href="#L-1113"><span class="linenos">1113</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country</span> <span class="o">==</span> <span class="s1">&#39;EUR&#39;</span><span class="p">:</span>
</span><span id="L-1114"><a href="#L-1114"><span class="linenos">1114</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
</span><span id="L-1115"><a href="#L-1115"><span class="linenos">1115</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>\
</span><span id="L-1116"><a href="#L-1116"><span class="linenos">1116</span></a>                <span class="s1">&#39;UID&#39;</span><span class="p">:</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span>\
</span><span id="L-1117"><a href="#L-1117"><span class="linenos">1117</span></a>                <span class="s1">&#39;RegionName&#39;</span><span class="p">:</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span>\
</span><span id="L-1118"><a href="#L-1118"><span class="linenos">1118</span></a>                <span class="s1">&#39;ADM0_ISO3&#39;</span><span class="p">:</span><span class="s1">&#39;code_region&#39;</span><span class="p">,</span>\
</span><span id="L-1119"><a href="#L-1119"><span class="linenos">1119</span></a>                <span class="s1">&#39;ADM0_NAME&#39;</span><span class="p">:</span><span class="s1">&#39;name_region&#39;</span><span class="p">,</span>\
</span><span id="L-1120"><a href="#L-1120"><span class="linenos">1120</span></a>                <span class="s1">&#39;Population&#39;</span><span class="p">:</span><span class="s1">&#39;population_subregion&#39;</span><span class="p">},</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1121"><a href="#L-1121"><span class="linenos">1121</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;population_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;name_region&#39;</span><span class="p">,</span><span class="s1">&#39;code_region&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]]</span>
</span><span id="L-1122"><a href="#L-1122"><span class="linenos">1122</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">is_empty</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span>
</span><span id="L-1123"><a href="#L-1123"><span class="linenos">1123</span></a>            <span class="c1"># self._country_data=self._country_data[self._country_data.geometry!=None] to remove subregion without geometry</span>
</span><span id="L-1124"><a href="#L-1124"><span class="linenos">1124</span></a>
</span><span id="L-1125"><a href="#L-1125"><span class="linenos">1125</span></a>        <span class="c1"># --- &#39;GRC&#39; case ------------------------------------------------------------------------------------------------</span>
</span><span id="L-1126"><a href="#L-1126"><span class="linenos">1126</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country</span> <span class="o">==</span> <span class="s1">&#39;GRC&#39;</span><span class="p">:</span>
</span><span id="L-1127"><a href="#L-1127"><span class="linenos">1127</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;zip://&#39;</span><span class="o">+</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;.zip&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;!nomoi_okxe&#39;</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;ISO-8859-7&#39;</span><span class="p">)</span>
</span><span id="L-1128"><a href="#L-1128"><span class="linenos">1128</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>\
</span><span id="L-1129"><a href="#L-1129"><span class="linenos">1129</span></a>                <span class="s1">&#39;POP&#39;</span><span class="p">:</span><span class="s1">&#39;population_subregion&#39;</span><span class="p">},</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1130"><a href="#L-1130"><span class="linenos">1130</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">NAME_GR</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span id="L-1131"><a href="#L-1131"><span class="linenos">1131</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">PARENT</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">stop</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-1132"><a href="#L-1132"><span class="linenos">1132</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">]</span>
</span><span id="L-1133"><a href="#L-1133"><span class="linenos">1133</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">]</span> <span class="c1"># no region info</span>
</span><span id="L-1134"><a href="#L-1134"><span class="linenos">1134</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;population_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;name_region&#39;</span><span class="p">,</span><span class="s1">&#39;code_region&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]]</span>
</span><span id="L-1135"><a href="#L-1135"><span class="linenos">1135</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">4326</span><span class="p">)</span>
</span><span id="L-1136"><a href="#L-1136"><span class="linenos">1136</span></a>            <span class="c1"># Merge region to fit with the CSV epidemiological data</span>
</span><span id="L-1137"><a href="#L-1137"><span class="linenos">1137</span></a>            <span class="n">ath</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ΔΥΤΙΚΗΣ ΑΤΤΙΚΗΣ&#39;</span><span class="p">,</span> <span class="s1">&#39;ΑΝΑΤΟΛΙΚΗΣ ΑΤΤΙΚΗΣ&#39;</span><span class="p">,</span> <span class="s1">&#39;ΠΕΙΡΑΙΩΣ ΚΑΙ ΝΗΣΩΝ&#39;</span><span class="p">,</span><span class="s1">&#39;ΑΘΗΝΩΝ&#39;</span><span class="p">]</span>
</span><span id="L-1138"><a href="#L-1138"><span class="linenos">1138</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">name_subregion</span><span class="o">==</span><span class="s1">&#39;ΑΘΗΝΩΝ&#39;</span><span class="p">),[</span><span class="s1">&#39;geometry&#39;</span><span class="p">,</span><span class="s1">&#39;population_subregion&#39;</span><span class="p">]]</span><span class="o">=</span>\
</span><span id="L-1139"><a href="#L-1139"><span class="linenos">1139</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">name_subregion</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">ath</span><span class="p">)]</span><span class="o">.</span><span class="n">dissolve</span><span class="p">(</span><span class="n">aggfunc</span><span class="o">=</span><span class="s1">&#39;sum&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
</span><span id="L-1140"><a href="#L-1140"><span class="linenos">1140</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">name_subregion</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">ath</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])]</span>
</span><span id="L-1141"><a href="#L-1141"><span class="linenos">1141</span></a>            <span class="n">changename</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Ο ΟΡΟΣ&#39;</span><span class="p">:</span><span class="s1">&#39;ΑΓΙΟ ΟΡΟΣ&#39;</span><span class="p">,</span><span class="s1">&#39;ΑΘΗΝΩΝ&#39;</span><span class="p">:</span><span class="s1">&#39;ΑΤΤΙΚΗΣ&#39;</span><span class="p">}</span>
</span><span id="L-1142"><a href="#L-1142"><span class="linenos">1142</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">changename</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1143"><a href="#L-1143"><span class="linenos">1143</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">changename</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1144"><a href="#L-1144"><span class="linenos">1144</span></a>
</span><span id="L-1145"><a href="#L-1145"><span class="linenos">1145</span></a>        <span class="c1">#--- &#39;JPN&#39; case ----------------------------------------------------------------------------------------</span>
</span><span id="L-1146"><a href="#L-1146"><span class="linenos">1146</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country</span> <span class="o">==</span> <span class="s1">&#39;JPN&#39;</span><span class="p">:</span>
</span><span id="L-1147"><a href="#L-1147"><span class="linenos">1147</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/dataofjapan/land/master/japan.geojson&#39;</span><span class="p">)</span>
</span><span id="L-1148"><a href="#L-1148"><span class="linenos">1148</span></a>            <span class="n">np_name_subregion_jpn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;Hokkaido&#39;</span><span class="p">,</span> <span class="s1">&#39;Aomori&#39;</span><span class="p">,</span> <span class="s1">&#39;Iwate&#39;</span><span class="p">,</span> <span class="s1">&#39;Miyagi&#39;</span><span class="p">,</span> <span class="s1">&#39;Akita&#39;</span><span class="p">,</span>\
</span><span id="L-1149"><a href="#L-1149"><span class="linenos">1149</span></a>                                              <span class="s1">&#39;Yamagata&#39;</span><span class="p">,</span> <span class="s1">&#39;Fukushima&#39;</span><span class="p">,</span> <span class="s1">&#39;Ibaraki&#39;</span><span class="p">,</span> <span class="s1">&#39;Tochigi&#39;</span><span class="p">,</span>\
</span><span id="L-1150"><a href="#L-1150"><span class="linenos">1150</span></a>                                              <span class="s1">&#39;Gunma&#39;</span><span class="p">,</span> <span class="s1">&#39;Saitama&#39;</span><span class="p">,</span><span class="s1">&#39;Chiba&#39;</span><span class="p">,</span> <span class="s1">&#39;Tokyo&#39;</span><span class="p">,</span> <span class="s1">&#39;Kanagawa&#39;</span><span class="p">,</span>\
</span><span id="L-1151"><a href="#L-1151"><span class="linenos">1151</span></a>                                              <span class="s1">&#39;Niigata&#39;</span><span class="p">,</span> <span class="s1">&#39;Toyama&#39;</span><span class="p">,</span> <span class="s1">&#39;Ishikawa&#39;</span><span class="p">,</span> <span class="s1">&#39;Fukui&#39;</span><span class="p">,</span><span class="s1">&#39;Yamanashi&#39;</span><span class="p">,</span>\
</span><span id="L-1152"><a href="#L-1152"><span class="linenos">1152</span></a>                                              <span class="s1">&#39;Nagano&#39;</span><span class="p">,</span> <span class="s1">&#39;Gifu&#39;</span><span class="p">,</span> <span class="s1">&#39;Shizuoka&#39;</span><span class="p">,</span> <span class="s1">&#39;Aichi&#39;</span><span class="p">,</span> <span class="s1">&#39;Mie&#39;</span><span class="p">,</span> <span class="s1">&#39;Shiga&#39;</span><span class="p">,</span>\
</span><span id="L-1153"><a href="#L-1153"><span class="linenos">1153</span></a>                                              <span class="s1">&#39;Kyoto&#39;</span><span class="p">,</span> <span class="s1">&#39;Osaka&#39;</span><span class="p">,</span> <span class="s1">&#39;Hyogo&#39;</span><span class="p">,</span> <span class="s1">&#39;Nara&#39;</span><span class="p">,</span> <span class="s1">&#39;Wakayama&#39;</span><span class="p">,</span> <span class="s1">&#39;Tottori&#39;</span><span class="p">,</span>\
</span><span id="L-1154"><a href="#L-1154"><span class="linenos">1154</span></a>                                              <span class="s1">&#39;Shimane&#39;</span><span class="p">,</span><span class="s1">&#39;Okayama&#39;</span><span class="p">,</span> <span class="s1">&#39;Hiroshima&#39;</span><span class="p">,</span> <span class="s1">&#39;Yamaguchi&#39;</span><span class="p">,</span> <span class="s1">&#39;Tokushima&#39;</span><span class="p">,</span>\
</span><span id="L-1155"><a href="#L-1155"><span class="linenos">1155</span></a>                                              <span class="s1">&#39;Kagawa&#39;</span><span class="p">,</span> <span class="s1">&#39;Ehime&#39;</span><span class="p">,</span><span class="s1">&#39;Kochi&#39;</span><span class="p">,</span> <span class="s1">&#39;Fukuoka&#39;</span><span class="p">,</span> <span class="s1">&#39;Saga&#39;</span><span class="p">,</span> <span class="s1">&#39;Nagasaki&#39;</span><span class="p">,</span>\
</span><span id="L-1156"><a href="#L-1156"><span class="linenos">1156</span></a>                                              <span class="s1">&#39;Kumamoto&#39;</span><span class="p">,</span> <span class="s1">&#39;Oita&#39;</span><span class="p">,</span> <span class="s1">&#39;Miyazaki&#39;</span><span class="p">,</span><span class="s1">&#39;Kagoshima&#39;</span><span class="p">,</span> <span class="s1">&#39;Okinawa&#39;</span><span class="p">])</span>
</span><span id="L-1157"><a href="#L-1157"><span class="linenos">1157</span></a>            <span class="n">np_town_subregion_jpn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;Sapporo&#39;</span><span class="p">,</span><span class="s1">&#39;Aomori&#39;</span><span class="p">,</span><span class="s1">&#39;Morioka&#39;</span><span class="p">,</span><span class="s1">&#39;Sendai&#39;</span><span class="p">,</span><span class="s1">&#39;Akita&#39;</span><span class="p">,</span>\
</span><span id="L-1158"><a href="#L-1158"><span class="linenos">1158</span></a>                                              <span class="s1">&#39;Yamagata&#39;</span><span class="p">,</span><span class="s1">&#39;Fukushima&#39;</span><span class="p">,</span><span class="s1">&#39;Mito&#39;</span><span class="p">,</span><span class="s1">&#39;Utsunomiya&#39;</span><span class="p">,</span><span class="s1">&#39;Maebashi&#39;</span><span class="p">,</span>\
</span><span id="L-1159"><a href="#L-1159"><span class="linenos">1159</span></a>                                              <span class="s1">&#39;Saitama&#39;</span><span class="p">,</span><span class="s1">&#39;Chiba&#39;</span><span class="p">,</span><span class="s1">&#39;Shinjuku&#39;</span><span class="p">,</span><span class="s1">&#39;Yokohama&#39;</span><span class="p">,</span><span class="s1">&#39;Niigata&#39;</span><span class="p">,</span><span class="s1">&#39;Toyama&#39;</span><span class="p">,</span>\
</span><span id="L-1160"><a href="#L-1160"><span class="linenos">1160</span></a>                                              <span class="s1">&#39;Kanazawa&#39;</span><span class="p">,</span><span class="s1">&#39;Fukui&#39;</span><span class="p">,</span><span class="s1">&#39;Kofu&#39;</span><span class="p">,</span><span class="s1">&#39;Nagano&#39;</span><span class="p">,</span><span class="s1">&#39;Gifu&#39;</span><span class="p">,</span><span class="s1">&#39;Shizuoka&#39;</span><span class="p">,</span>\
</span><span id="L-1161"><a href="#L-1161"><span class="linenos">1161</span></a>                                              <span class="s1">&#39;Nagoya&#39;</span><span class="p">,</span><span class="s1">&#39;Tsu&#39;</span><span class="p">,</span><span class="s1">&#39;Otsu&#39;</span><span class="p">,</span><span class="s1">&#39;Kyoto&#39;</span><span class="p">,</span><span class="s1">&#39;Osaka&#39;</span><span class="p">,</span><span class="s1">&#39;Kobe&#39;</span><span class="p">,</span><span class="s1">&#39;Nara&#39;</span><span class="p">,</span><span class="s1">&#39;Wakayama&#39;</span><span class="p">,</span><span class="s1">&#39;Tottori&#39;</span><span class="p">,</span>\
</span><span id="L-1162"><a href="#L-1162"><span class="linenos">1162</span></a>                                              <span class="s1">&#39;Matsue&#39;</span><span class="p">,</span><span class="s1">&#39;Okayama&#39;</span><span class="p">,</span><span class="s1">&#39;Hiroshima&#39;</span><span class="p">,</span><span class="s1">&#39;Yamaguchi&#39;</span><span class="p">,</span><span class="s1">&#39;Tokushima&#39;</span><span class="p">,</span><span class="s1">&#39;Takamatsu&#39;</span><span class="p">,</span>\
</span><span id="L-1163"><a href="#L-1163"><span class="linenos">1163</span></a>                                              <span class="s1">&#39;Matsuyama&#39;</span><span class="p">,</span><span class="s1">&#39;Kochi&#39;</span><span class="p">,</span><span class="s1">&#39;Fukuoka&#39;</span><span class="p">,</span><span class="s1">&#39;Saga&#39;</span><span class="p">,</span><span class="s1">&#39;Nagasaki&#39;</span><span class="p">,</span><span class="s1">&#39;Kumamoto&#39;</span><span class="p">,</span><span class="s1">&#39;Oita&#39;</span><span class="p">,</span>\
</span><span id="L-1164"><a href="#L-1164"><span class="linenos">1164</span></a>                                              <span class="s1">&#39;Miyazaki&#39;</span><span class="p">,</span><span class="s1">&#39;Kagoshima&#39;</span><span class="p">,</span><span class="s1">&#39;Naha&#39;</span><span class="p">])</span>
</span><span id="L-1165"><a href="#L-1165"><span class="linenos">1165</span></a>            <span class="n">np_name_region_jpn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;Hokkaido&#39;</span><span class="p">]</span><span class="o">+</span> <span class="mi">6</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;Tohoku&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">7</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;Kanto&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">9</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;Chubu&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">5</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;Chugoku&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;Shikoku&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">7</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;Kansai&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">8</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;Kyushu&#39;</span><span class="p">])</span>
</span><span id="L-1166"><a href="#L-1166"><span class="linenos">1166</span></a>            <span class="n">np_code_region_jpn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;Hokkaido&#39;</span><span class="p">]</span><span class="o">+</span> <span class="mi">6</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;Tohoku&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">7</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;Kanto&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">9</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;Chubu&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">5</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;Chugoku&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;Shikoku&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">7</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;Kansai&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">8</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;Kyushu&#39;</span><span class="p">])</span>
</span><span id="L-1167"><a href="#L-1167"><span class="linenos">1167</span></a>            <span class="n">np_code_subregion_jpn</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">48</span><span class="p">)</span>
</span><span id="L-1168"><a href="#L-1168"><span class="linenos">1168</span></a>            <span class="n">np_population_subregion_jpn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">5224614</span><span class="p">,</span><span class="mi">1237984</span><span class="p">,</span><span class="mi">1210534</span><span class="p">,</span><span class="mi">2301996</span><span class="p">,</span><span class="mi">959502</span><span class="p">,</span> <span class="mi">1068027</span><span class="p">,</span>
</span><span id="L-1169"><a href="#L-1169"><span class="linenos">1169</span></a>                                        <span class="mi">1833152</span><span class="p">,</span><span class="mi">2867009</span><span class="p">,</span><span class="mi">1933146</span><span class="p">,</span><span class="mi">1939110</span><span class="p">,</span><span class="mi">7344765</span><span class="p">,</span><span class="mi">6284480</span><span class="p">,</span><span class="mi">14047594</span><span class="p">,</span>
</span><span id="L-1170"><a href="#L-1170"><span class="linenos">1170</span></a>                                        <span class="mi">9237337</span><span class="p">,</span><span class="mi">2201272</span><span class="p">,</span><span class="mi">1034814</span><span class="p">,</span><span class="mi">1132852</span><span class="p">,</span><span class="mi">766863</span><span class="p">,</span><span class="mi">809974</span><span class="p">,</span><span class="mi">2048011</span><span class="p">,</span> <span class="mi">1978742</span><span class="p">,</span><span class="mi">3633202</span><span class="p">,</span><span class="mi">7542415</span><span class="p">,</span><span class="mi">1770254</span><span class="p">,</span><span class="mi">1413610</span><span class="p">,</span><span class="mi">2578087</span><span class="p">,</span>
</span><span id="L-1171"><a href="#L-1171"><span class="linenos">1171</span></a>                                        <span class="mi">8837685</span><span class="p">,</span> <span class="mi">5465002</span><span class="p">,</span> <span class="mi">1324473</span><span class="p">,</span> <span class="mi">922584</span><span class="p">,</span> <span class="mi">553407</span><span class="p">,</span> <span class="mi">671126</span><span class="p">,</span> <span class="mi">1888432</span><span class="p">,</span> <span class="mi">2799702</span><span class="p">,</span> <span class="mi">1342059</span><span class="p">,</span><span class="mi">719559</span><span class="p">,</span> <span class="mi">950244</span><span class="p">,</span> <span class="mi">1344841</span><span class="p">,</span> <span class="mi">691527</span><span class="p">,</span> <span class="mi">5135214</span><span class="p">,</span>
</span><span id="L-1172"><a href="#L-1172"><span class="linenos">1172</span></a>                                        <span class="mi">811442</span><span class="p">,</span> <span class="mi">1312317</span><span class="p">,</span> <span class="mi">1738301</span><span class="p">,</span> <span class="mi">1123852</span><span class="p">,</span> <span class="mi">1069576</span><span class="p">,</span> <span class="mi">1588256</span><span class="p">,</span> <span class="mi">1467480</span><span class="p">])</span>
</span><span id="L-1173"><a href="#L-1173"><span class="linenos">1173</span></a>            <span class="n">np_area_subregion_jpn</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">83457.00</span><span class="p">,</span><span class="mf">9644.55</span><span class="p">,</span><span class="mf">15278.89</span><span class="p">,</span><span class="mf">7285.77</span><span class="p">,</span> <span class="mf">11636.28</span><span class="p">,</span> <span class="mf">9323.46</span><span class="p">,</span> <span class="mf">13782.76</span><span class="p">,</span>  <span class="mf">6095.72</span><span class="p">,</span>
</span><span id="L-1174"><a href="#L-1174"><span class="linenos">1174</span></a>                                 <span class="mf">6408.28</span><span class="p">,</span><span class="mf">6362.33</span><span class="p">,</span> <span class="mf">3798.08</span><span class="p">,</span> <span class="mf">5156.61</span><span class="p">,</span> <span class="mf">2188.67</span><span class="p">,</span> <span class="mf">2415.86</span><span class="p">,</span> <span class="mf">12583.83</span><span class="p">,</span> <span class="mf">4247.61</span><span class="p">,</span><span class="mf">4185.67</span><span class="p">,</span> <span class="mf">4189.88</span><span class="p">,</span>
</span><span id="L-1175"><a href="#L-1175"><span class="linenos">1175</span></a>                                 <span class="mf">4465.37</span><span class="p">,</span>  <span class="mf">13562.23</span><span class="p">,</span> <span class="mf">10621.17</span><span class="p">,</span> <span class="mf">7780.50</span><span class="p">,</span>  <span class="mf">5165.12</span><span class="p">,</span> <span class="mf">5777.31</span><span class="p">,</span> <span class="mf">4017.36</span><span class="p">,</span> <span class="mf">4613.21</span><span class="p">,</span> <span class="mf">1899.28</span><span class="p">,</span> <span class="mf">8396.16</span><span class="p">,</span> <span class="mf">3691.09</span><span class="p">,</span> <span class="mf">4726.29</span><span class="p">,</span> <span class="mf">3507.28</span><span class="p">,</span> <span class="mf">6707.96</span><span class="p">,</span> <span class="mf">7113.23</span><span class="p">,</span> <span class="mf">8479.70</span>
</span><span id="L-1176"><a href="#L-1176"><span class="linenos">1176</span></a>                                 <span class="p">,</span><span class="mf">6114.09</span><span class="p">,</span> <span class="mf">4146.74</span><span class="p">,</span> <span class="mf">1876.55</span><span class="p">,</span> <span class="mf">5678.33</span><span class="p">,</span> <span class="mf">7105.16</span><span class="p">,</span> <span class="mf">4978.51</span><span class="p">,</span> <span class="mf">2439.65</span><span class="p">,</span> <span class="mf">4105.47</span><span class="p">,</span> <span class="mf">7404.79</span><span class="p">,</span> <span class="mf">6339.74</span><span class="p">,</span> <span class="mf">7735.99</span><span class="p">,</span> <span class="mf">9188.82</span><span class="p">,</span> <span class="mf">2276.49</span><span class="p">])</span>
</span><span id="L-1177"><a href="#L-1177"><span class="linenos">1177</span></a>            <span class="n">np_flag_subregion_jpn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="L-1178"><a href="#L-1178"><span class="linenos">1178</span></a>                            <span class="p">[</span><span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/2/22/Flag_of_Hokkaido_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="L-1179"><a href="#L-1179"><span class="linenos">1179</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/3/30/Flag_of_Aomori_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="L-1180"><a href="#L-1180"><span class="linenos">1180</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/a/a9/Flag_of_Iwate_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="L-1181"><a href="#L-1181"><span class="linenos">1181</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/c/c7/Flag_of_Miyagi_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="L-1182"><a href="#L-1182"><span class="linenos">1182</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/8/84/Flag_of_Akita_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="L-1183"><a href="#L-1183"><span class="linenos">1183</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/a/a1/Flag_of_Yamagata_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="L-1184"><a href="#L-1184"><span class="linenos">1184</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/4/4b/Flag_of_Fukushima_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="L-1185"><a href="#L-1185"><span class="linenos">1185</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/a/a8/Flag_of_Ibaraki_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="L-1186"><a href="#L-1186"><span class="linenos">1186</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/d/d5/Flag_of_Tochigi_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="L-1187"><a href="#L-1187"><span class="linenos">1187</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/b/ba/Flag_of_Gunma_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="L-1188"><a href="#L-1188"><span class="linenos">1188</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/c/cd/Flag_of_Saitama_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="L-1189"><a href="#L-1189"><span class="linenos">1189</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/0/0a/Flag_of_Chiba_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="L-1190"><a href="#L-1190"><span class="linenos">1190</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/1/15/Flag_of_Tokyo_Metropolis.svg&#39;</span><span class="p">,</span>
</span><span id="L-1191"><a href="#L-1191"><span class="linenos">1191</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/a/a7/Flag_of_Kanagawa_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="L-1192"><a href="#L-1192"><span class="linenos">1192</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/c/cb/Flag_of_Niigata_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="L-1193"><a href="#L-1193"><span class="linenos">1193</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/1/1d/Flag_of_Toyama_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="L-1194"><a href="#L-1194"><span class="linenos">1194</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/6/6a/Flag_of_Ishikawa_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="L-1195"><a href="#L-1195"><span class="linenos">1195</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/5/56/Flag_of_Fukui_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="L-1196"><a href="#L-1196"><span class="linenos">1196</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/0/00/Flag_of_Yamanashi_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="L-1197"><a href="#L-1197"><span class="linenos">1197</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/f/f0/Flag_of_Nagano_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="L-1198"><a href="#L-1198"><span class="linenos">1198</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/3/3e/Flag_of_Gifu_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="L-1199"><a href="#L-1199"><span class="linenos">1199</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/9/92/Flag_of_Shizuoka_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="L-1200"><a href="#L-1200"><span class="linenos">1200</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/0/02/Flag_of_Aichi_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="L-1201"><a href="#L-1201"><span class="linenos">1201</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/8/8c/Flag_of_Mie_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="L-1202"><a href="#L-1202"><span class="linenos">1202</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/9/99/Flag_of_Shiga_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="L-1203"><a href="#L-1203"><span class="linenos">1203</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/0/06/Flag_of_Kyoto_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="L-1204"><a href="#L-1204"><span class="linenos">1204</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/5/5a/Flag_of_Osaka_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="L-1205"><a href="#L-1205"><span class="linenos">1205</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/7/74/Flag_of_Hyogo_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="L-1206"><a href="#L-1206"><span class="linenos">1206</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/0/00/Flag_of_Nara_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="L-1207"><a href="#L-1207"><span class="linenos">1207</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/6/6e/Flag_of_Wakayama_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="L-1208"><a href="#L-1208"><span class="linenos">1208</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/1/1c/Flag_of_Tottori_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="L-1209"><a href="#L-1209"><span class="linenos">1209</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/e/e8/Flag_of_Shimane_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="L-1210"><a href="#L-1210"><span class="linenos">1210</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/3/33/Flag_of_Okayama_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="L-1211"><a href="#L-1211"><span class="linenos">1211</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/e/ed/Flag_of_Hiroshima_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="L-1212"><a href="#L-1212"><span class="linenos">1212</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/b/b9/Flag_of_Yamaguchi_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="L-1213"><a href="#L-1213"><span class="linenos">1213</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/a/ac/Flag_of_Tokushima_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="L-1214"><a href="#L-1214"><span class="linenos">1214</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/2/29/Flag_of_Kagawa_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="L-1215"><a href="#L-1215"><span class="linenos">1215</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/2/2d/Flag_of_Ehime_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="L-1216"><a href="#L-1216"><span class="linenos">1216</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/5/50/Flag_of_Kochi_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="L-1217"><a href="#L-1217"><span class="linenos">1217</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/7/71/Flag_of_Fukuoka_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="L-1218"><a href="#L-1218"><span class="linenos">1218</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/1/18/Flag_of_Saga_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="L-1219"><a href="#L-1219"><span class="linenos">1219</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/6/65/Flag_of_Nagasaki_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="L-1220"><a href="#L-1220"><span class="linenos">1220</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/f/f7/Flag_of_Kumamoto_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="L-1221"><a href="#L-1221"><span class="linenos">1221</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/c/c8/Flag_of_Oita_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="L-1222"><a href="#L-1222"><span class="linenos">1222</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/0/0b/Flag_of_Miyazaki_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="L-1223"><a href="#L-1223"><span class="linenos">1223</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/c/c5/Flag_of_Kagoshima_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="L-1224"><a href="#L-1224"><span class="linenos">1224</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/2/2f/Flag_of_Okinawa_Prefecture.svg&#39;</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="nb">object</span><span class="p">)</span>
</span><span id="L-1225"><a href="#L-1225"><span class="linenos">1225</span></a>            <span class="n">dic_japan</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name_subregion&#39;</span> <span class="p">:</span> <span class="n">np_name_subregion_jpn</span><span class="p">,</span><span class="s1">&#39;code_region&#39;</span> <span class="p">:</span> <span class="n">np_name_region_jpn</span><span class="p">,</span> <span class="s1">&#39;name_region&#39;</span><span class="p">:</span> <span class="n">np_name_region_jpn</span><span class="p">,</span>\
</span><span id="L-1226"><a href="#L-1226"><span class="linenos">1226</span></a>                         <span class="s1">&#39;code_subregion&#39;</span> <span class="p">:</span> <span class="n">np_code_subregion_jpn</span><span class="p">,</span> <span class="s1">&#39;flag_subregion&#39;</span> <span class="p">:</span> <span class="n">np_flag_subregion_jpn</span><span class="p">,</span> <span class="s1">&#39;town_subregion&#39;</span> <span class="p">:</span> <span class="n">np_town_subregion_jpn</span><span class="p">,</span>\
</span><span id="L-1227"><a href="#L-1227"><span class="linenos">1227</span></a>                         <span class="s1">&#39;population_subregion&#39;</span> <span class="p">:</span> <span class="n">np_population_subregion_jpn</span><span class="p">,</span> <span class="s1">&#39;area_subregion&#39;</span> <span class="p">:</span> <span class="n">np_area_subregion_jpn</span> <span class="p">}</span>
</span><span id="L-1228"><a href="#L-1228"><span class="linenos">1228</span></a>            <span class="n">df_japan</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">dic_japan</span><span class="p">)</span>
</span><span id="L-1229"><a href="#L-1229"><span class="linenos">1229</span></a>            <span class="n">df_japan</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">48</span><span class="p">)</span>
</span><span id="L-1230"><a href="#L-1230"><span class="linenos">1230</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span> <span class="p">:</span> <span class="s2">&quot;code_subregion&quot;</span><span class="p">})</span>  <span class="c1">#</span>
</span><span id="L-1231"><a href="#L-1231"><span class="linenos">1231</span></a>            <span class="n">df_final_japan</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_japan</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">])</span>
</span><span id="L-1232"><a href="#L-1232"><span class="linenos">1232</span></a>            <span class="n">df_final_japan</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;nam&#39;</span><span class="p">,</span> <span class="s1">&#39;nam_ja&#39;</span><span class="p">],</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="L-1233"><a href="#L-1233"><span class="linenos">1233</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">df_final_japan</span><span class="p">)</span>
</span><span id="L-1234"><a href="#L-1234"><span class="linenos">1234</span></a>            <span class="c1">#code_subregion as to be str to be able to be merged ...</span>
</span><span id="L-1235"><a href="#L-1235"><span class="linenos">1235</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
</span><span id="L-1236"><a href="#L-1236"><span class="linenos">1236</span></a>
</span><span id="L-1237"><a href="#L-1237"><span class="linenos">1237</span></a>    <span class="c1"># def get_region_from_municipality(self,lname):</span>
</span><span id="L-1238"><a href="#L-1238"><span class="linenos">1238</span></a>    <span class="c1">#     &quot;&quot;&quot;  Return region list from a municipality list</span>
</span><span id="L-1239"><a href="#L-1239"><span class="linenos">1239</span></a>    <span class="c1">#     &quot;&quot;&quot;</span>
</span><span id="L-1240"><a href="#L-1240"><span class="linenos">1240</span></a>    <span class="c1">#     if not isinstance(lname, list):</span>
</span><span id="L-1241"><a href="#L-1241"><span class="linenos">1241</span></a>    <span class="c1">#         lname=[lname]</span>
</span><span id="L-1242"><a href="#L-1242"><span class="linenos">1242</span></a>    <span class="c1">#     return self._municipality_region.loc[self._municipality_region.name.isin(lname)][&#39;district&#39;].to_list()</span>
</span><span id="L-1243"><a href="#L-1243"><span class="linenos">1243</span></a>
</span><span id="L-1244"><a href="#L-1244"><span class="linenos">1244</span></a>    <span class="k">def</span> <span class="nf">set_dense_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1245"><a href="#L-1245"><span class="linenos">1245</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;  If used, we&#39;re using for the current country a dense geometry forsubregions</span>
</span><span id="L-1246"><a href="#L-1246"><span class="linenos">1246</span></a><span class="sd">        and regions.</span>
</span><span id="L-1247"><a href="#L-1247"><span class="linenos">1247</span></a><span class="sd">        It&#39;s not possible to go back.</span>
</span><span id="L-1248"><a href="#L-1248"><span class="linenos">1248</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1249"><a href="#L-1249"><span class="linenos">1249</span></a>
</span><span id="L-1250"><a href="#L-1250"><span class="linenos">1250</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dense_geometry</span><span class="p">():</span>
</span><span id="L-1251"><a href="#L-1251"><span class="linenos">1251</span></a>            <span class="k">return</span>
</span><span id="L-1252"><a href="#L-1252"><span class="linenos">1252</span></a>
</span><span id="L-1253"><a href="#L-1253"><span class="linenos">1253</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_main_geometry</span><span class="p">():</span>
</span><span id="L-1254"><a href="#L-1254"><span class="linenos">1254</span></a>            <span class="k">raise</span> <span class="n">CoaError</span><span class="p">(</span><span class="s2">&quot;You already set the main geometry. Cannot set the dense geometry now.&quot;</span><span class="p">)</span>
</span><span id="L-1255"><a href="#L-1255"><span class="linenos">1255</span></a>
</span><span id="L-1256"><a href="#L-1256"><span class="linenos">1256</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_exploded_geometry</span><span class="p">():</span>
</span><span id="L-1257"><a href="#L-1257"><span class="linenos">1257</span></a>            <span class="k">raise</span> <span class="n">CoaError</span><span class="p">(</span><span class="s2">&quot;You already set the exploded geometry. Cannot set the dense geometry now.&quot;</span><span class="p">)</span>
</span><span id="L-1258"><a href="#L-1258"><span class="linenos">1258</span></a>
</span><span id="L-1259"><a href="#L-1259"><span class="linenos">1259</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;FRA&#39;</span><span class="p">:</span>
</span><span id="L-1260"><a href="#L-1260"><span class="linenos">1260</span></a>            <span class="c1">#.drop([&#39;id_geofla&#39;,&#39;code_reg&#39;,&#39;nom_reg&#39;,&#39;x_chf_lieu&#39;,&#39;y_chf_lieu&#39;,&#39;x_centroid&#39;,&#39;y_centroid&#39;,&#39;Code département&#39;,&#39;Nom du département&#39;,&#39;Population municipale&#39;],axis=1,inplace=True) # removing some column without interest</span>
</span><span id="L-1261"><a href="#L-1261"><span class="linenos">1261</span></a>            <span class="c1"># moving artificially (if needed) outre-mer area to be near to metropole for map representations</span>
</span><span id="L-1262"><a href="#L-1262"><span class="linenos">1262</span></a>
</span><span id="L-1263"><a href="#L-1263"><span class="linenos">1263</span></a>            <span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1264"><a href="#L-1264"><span class="linenos">1264</span></a>            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">poi</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="L-1265"><a href="#L-1265"><span class="linenos">1265</span></a>                <span class="n">x</span><span class="o">=</span><span class="mi">0</span>
</span><span id="L-1266"><a href="#L-1266"><span class="linenos">1266</span></a>                <span class="n">y</span><span class="o">=</span><span class="mi">0</span>
</span><span id="L-1267"><a href="#L-1267"><span class="linenos">1267</span></a>                <span class="n">w</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="s2">&quot;code_subregion&quot;</span><span class="p">]</span>
</span><span id="L-1268"><a href="#L-1268"><span class="linenos">1268</span></a>                <span class="k">if</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_list_translation</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-1269"><a href="#L-1269"><span class="linenos">1269</span></a>                    <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_list_translation</span><span class="p">[</span><span class="n">w</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1270"><a href="#L-1270"><span class="linenos">1270</span></a>                    <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_list_translation</span><span class="p">[</span><span class="n">w</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-1271"><a href="#L-1271"><span class="linenos">1271</span></a>                <span class="n">g</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">],</span> <span class="n">xoff</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">yoff</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
</span><span id="L-1272"><a href="#L-1272"><span class="linenos">1272</span></a>                <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</span><span id="L-1273"><a href="#L-1273"><span class="linenos">1273</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">tmp</span>
</span><span id="L-1274"><a href="#L-1274"><span class="linenos">1274</span></a>
</span><span id="L-1275"><a href="#L-1275"><span class="linenos">1275</span></a>            <span class="c1"># Remove COM with dense geometry true, too many islands to manage</span>
</span><span id="L-1276"><a href="#L-1276"><span class="linenos">1276</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">code_subregion</span><span class="o">!=</span><span class="s1">&#39;980&#39;</span><span class="p">]</span>
</span><span id="L-1277"><a href="#L-1277"><span class="linenos">1277</span></a>
</span><span id="L-1278"><a href="#L-1278"><span class="linenos">1278</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;USA&#39;</span><span class="p">:</span>
</span><span id="L-1279"><a href="#L-1279"><span class="linenos">1279</span></a>            <span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1280"><a href="#L-1280"><span class="linenos">1280</span></a>            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">poi</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="L-1281"><a href="#L-1281"><span class="linenos">1281</span></a>                <span class="n">x</span><span class="o">=</span><span class="mi">0</span>
</span><span id="L-1282"><a href="#L-1282"><span class="linenos">1282</span></a>                <span class="n">y</span><span class="o">=</span><span class="mi">0</span>
</span><span id="L-1283"><a href="#L-1283"><span class="linenos">1283</span></a>                <span class="n">w</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="s2">&quot;code_subregion&quot;</span><span class="p">]</span>
</span><span id="L-1284"><a href="#L-1284"><span class="linenos">1284</span></a>                <span class="k">if</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_list_translation</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-1285"><a href="#L-1285"><span class="linenos">1285</span></a>                    <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_list_translation</span><span class="p">[</span><span class="n">w</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1286"><a href="#L-1286"><span class="linenos">1286</span></a>                    <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_list_translation</span><span class="p">[</span><span class="n">w</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-1287"><a href="#L-1287"><span class="linenos">1287</span></a>                    <span class="n">g</span><span class="o">=</span><span class="n">sa</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">sa</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">],</span><span class="n">xoff</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">yoff</span><span class="o">=</span><span class="n">y</span><span class="p">),</span>\
</span><span id="L-1288"><a href="#L-1288"><span class="linenos">1288</span></a>                                            <span class="n">xfact</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_list_scale</span><span class="p">[</span><span class="n">w</span><span class="p">],</span><span class="n">yfact</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_list_scale</span><span class="p">[</span><span class="n">w</span><span class="p">],</span><span class="n">origin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_list_center</span><span class="p">[</span><span class="n">w</span><span class="p">])</span>
</span><span id="L-1289"><a href="#L-1289"><span class="linenos">1289</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1290"><a href="#L-1290"><span class="linenos">1290</span></a>                    <span class="n">g</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">]</span>
</span><span id="L-1291"><a href="#L-1291"><span class="linenos">1291</span></a>
</span><span id="L-1292"><a href="#L-1292"><span class="linenos">1292</span></a>                <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</span><span id="L-1293"><a href="#L-1293"><span class="linenos">1293</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">tmp</span>
</span><span id="L-1294"><a href="#L-1294"><span class="linenos">1294</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1295"><a href="#L-1295"><span class="linenos">1295</span></a>            <span class="k">raise</span> <span class="n">CoaError</span><span class="p">(</span><span class="s2">&quot;The current country does not have dense geometry support.&quot;</span><span class="p">)</span>
</span><span id="L-1296"><a href="#L-1296"><span class="linenos">1296</span></a>
</span><span id="L-1297"><a href="#L-1297"><span class="linenos">1297</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_country_data_region</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1298"><a href="#L-1298"><span class="linenos">1298</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_country_data_subregion</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1299"><a href="#L-1299"><span class="linenos">1299</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_dense_geometry</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1300"><a href="#L-1300"><span class="linenos">1300</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_main_geometry</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1301"><a href="#L-1301"><span class="linenos">1301</span></a>
</span><span id="L-1302"><a href="#L-1302"><span class="linenos">1302</span></a>    <span class="k">def</span> <span class="nf">set_exploded_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1303"><a href="#L-1303"><span class="linenos">1303</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;  If used, we&#39;re using for the current country a dense geometry forsubregions</span>
</span><span id="L-1304"><a href="#L-1304"><span class="linenos">1304</span></a><span class="sd">        and regions.</span>
</span><span id="L-1305"><a href="#L-1305"><span class="linenos">1305</span></a><span class="sd">        Moreover we&#39;re exploding internal dense geometry for some countries (currently IdF</span>
</span><span id="L-1306"><a href="#L-1306"><span class="linenos">1306</span></a><span class="sd">        for France, only).</span>
</span><span id="L-1307"><a href="#L-1307"><span class="linenos">1307</span></a>
</span><span id="L-1308"><a href="#L-1308"><span class="linenos">1308</span></a><span class="sd">        It&#39;s not possible to go back.</span>
</span><span id="L-1309"><a href="#L-1309"><span class="linenos">1309</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1310"><a href="#L-1310"><span class="linenos">1310</span></a>
</span><span id="L-1311"><a href="#L-1311"><span class="linenos">1311</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_main_geometry</span><span class="p">():</span>
</span><span id="L-1312"><a href="#L-1312"><span class="linenos">1312</span></a>            <span class="k">raise</span> <span class="n">CoaError</span><span class="p">(</span><span class="s2">&quot;You already set the main geometry. Cannot set the exploded geometry now.&quot;</span><span class="p">)</span>
</span><span id="L-1313"><a href="#L-1313"><span class="linenos">1313</span></a>
</span><span id="L-1314"><a href="#L-1314"><span class="linenos">1314</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dense_geometry</span><span class="p">():</span>
</span><span id="L-1315"><a href="#L-1315"><span class="linenos">1315</span></a>            <span class="k">raise</span> <span class="n">CoaError</span><span class="p">(</span><span class="s2">&quot;You already set the dense geometry. Cannot set the exploded geometry now.&quot;</span><span class="p">)</span>
</span><span id="L-1316"><a href="#L-1316"><span class="linenos">1316</span></a>
</span><span id="L-1317"><a href="#L-1317"><span class="linenos">1317</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_exploded_geometry</span><span class="p">():</span>
</span><span id="L-1318"><a href="#L-1318"><span class="linenos">1318</span></a>            <span class="k">return</span>
</span><span id="L-1319"><a href="#L-1319"><span class="linenos">1319</span></a>
</span><span id="L-1320"><a href="#L-1320"><span class="linenos">1320</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_dense_geometry</span><span class="p">()</span>
</span><span id="L-1321"><a href="#L-1321"><span class="linenos">1321</span></a>
</span><span id="L-1322"><a href="#L-1322"><span class="linenos">1322</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;FRA&#39;</span><span class="p">:</span>
</span><span id="L-1323"><a href="#L-1323"><span class="linenos">1323</span></a>            <span class="c1"># Add Ile de France zoom</span>
</span><span id="L-1324"><a href="#L-1324"><span class="linenos">1324</span></a>            <span class="n">idf_translation</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">6.5</span><span class="p">,</span><span class="o">-</span><span class="mi">5</span><span class="p">)</span>
</span><span id="L-1325"><a href="#L-1325"><span class="linenos">1325</span></a>            <span class="n">idf_scale</span><span class="o">=</span><span class="mi">3</span>
</span><span id="L-1326"><a href="#L-1326"><span class="linenos">1326</span></a>            <span class="n">idf_center</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span><span class="mi">43</span><span class="p">)</span>
</span><span id="L-1327"><a href="#L-1327"><span class="linenos">1327</span></a>            <span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1328"><a href="#L-1328"><span class="linenos">1328</span></a>            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">poi</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="L-1329"><a href="#L-1329"><span class="linenos">1329</span></a>                <span class="n">g</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">]</span>
</span><span id="L-1330"><a href="#L-1330"><span class="linenos">1330</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;75&#39;</span><span class="p">,</span><span class="s1">&#39;91&#39;</span><span class="p">,</span><span class="s1">&#39;92&#39;</span><span class="p">,</span><span class="s1">&#39;93&#39;</span><span class="p">,</span><span class="s1">&#39;94&#39;</span><span class="p">,</span><span class="s1">&#39;95&#39;</span><span class="p">,</span><span class="s1">&#39;77&#39;</span><span class="p">,</span><span class="s1">&#39;78&#39;</span><span class="p">]:</span>
</span><span id="L-1331"><a href="#L-1331"><span class="linenos">1331</span></a>                    <span class="n">g2</span><span class="o">=</span><span class="n">sa</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">sa</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="n">xoff</span><span class="o">=</span><span class="n">idf_translation</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">yoff</span><span class="o">=</span><span class="n">idf_translation</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>\
</span><span id="L-1332"><a href="#L-1332"><span class="linenos">1332</span></a>                                            <span class="n">xfact</span><span class="o">=</span><span class="n">idf_scale</span><span class="p">,</span><span class="n">yfact</span><span class="o">=</span><span class="n">idf_scale</span><span class="p">,</span><span class="n">origin</span><span class="o">=</span><span class="n">idf_center</span><span class="p">)</span>
</span><span id="L-1333"><a href="#L-1333"><span class="linenos">1333</span></a>                    <span class="n">g</span><span class="o">=</span><span class="n">g2</span> <span class="c1"># so.unary_union([g,g2]) # uncomment if you want a copy</span>
</span><span id="L-1334"><a href="#L-1334"><span class="linenos">1334</span></a>                <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</span><span id="L-1335"><a href="#L-1335"><span class="linenos">1335</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">tmp</span>
</span><span id="L-1336"><a href="#L-1336"><span class="linenos">1336</span></a>
</span><span id="L-1337"><a href="#L-1337"><span class="linenos">1337</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_dense_geometry</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1338"><a href="#L-1338"><span class="linenos">1338</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_main_geometry</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1339"><a href="#L-1339"><span class="linenos">1339</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_exploded_geometry</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1340"><a href="#L-1340"><span class="linenos">1340</span></a>
</span><span id="L-1341"><a href="#L-1341"><span class="linenos">1341</span></a>    <span class="k">def</span> <span class="nf">set_main_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1342"><a href="#L-1342"><span class="linenos">1342</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;  If used, we&#39;re using only for the current country the main</span>
</span><span id="L-1343"><a href="#L-1343"><span class="linenos">1343</span></a><span class="sd">        geometry for subregions and regions.</span>
</span><span id="L-1344"><a href="#L-1344"><span class="linenos">1344</span></a><span class="sd">        It&#39;s not possible to go back.</span>
</span><span id="L-1345"><a href="#L-1345"><span class="linenos">1345</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1346"><a href="#L-1346"><span class="linenos">1346</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_main_geometry</span><span class="p">():</span>
</span><span id="L-1347"><a href="#L-1347"><span class="linenos">1347</span></a>            <span class="k">return</span>
</span><span id="L-1348"><a href="#L-1348"><span class="linenos">1348</span></a>
</span><span id="L-1349"><a href="#L-1349"><span class="linenos">1349</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dense_geometry</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_exploded_geometry</span><span class="p">():</span>
</span><span id="L-1350"><a href="#L-1350"><span class="linenos">1350</span></a>            <span class="k">raise</span> <span class="n">CoaError</span><span class="p">(</span><span class="s2">&quot;You already set the dense or exploded geometry. Cannot set the main geometry now.&quot;</span><span class="p">)</span>
</span><span id="L-1351"><a href="#L-1351"><span class="linenos">1351</span></a>
</span><span id="L-1352"><a href="#L-1352"><span class="linenos">1352</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;FRA&#39;</span><span class="p">:</span>
</span><span id="L-1353"><a href="#L-1353"><span class="linenos">1353</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_list_translation</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span>
</span><span id="L-1354"><a href="#L-1354"><span class="linenos">1354</span></a>            <span class="c1"># Remove COM with main geometry true, too many islands to manage</span>
</span><span id="L-1355"><a href="#L-1355"><span class="linenos">1355</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">code_subregion</span><span class="o">!=</span><span class="s1">&#39;980&#39;</span><span class="p">]</span>
</span><span id="L-1356"><a href="#L-1356"><span class="linenos">1356</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;USA&#39;</span><span class="p">:</span>
</span><span id="L-1357"><a href="#L-1357"><span class="linenos">1357</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_list_translation</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span>
</span><span id="L-1358"><a href="#L-1358"><span class="linenos">1358</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1359"><a href="#L-1359"><span class="linenos">1359</span></a>            <span class="k">raise</span> <span class="n">CoaError</span><span class="p">(</span><span class="s2">&quot;The current country does not have dense geometry support.&quot;</span><span class="p">)</span>
</span><span id="L-1360"><a href="#L-1360"><span class="linenos">1360</span></a>
</span><span id="L-1361"><a href="#L-1361"><span class="linenos">1361</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_country_data_region</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1362"><a href="#L-1362"><span class="linenos">1362</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_country_data_subregion</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1363"><a href="#L-1363"><span class="linenos">1363</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_main_geometry</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1364"><a href="#L-1364"><span class="linenos">1364</span></a>
</span><span id="L-1365"><a href="#L-1365"><span class="linenos">1365</span></a>    <span class="k">def</span> <span class="nf">is_dense_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1366"><a href="#L-1366"><span class="linenos">1366</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the self._is_dense_geometry variable</span>
</span><span id="L-1367"><a href="#L-1367"><span class="linenos">1367</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1368"><a href="#L-1368"><span class="linenos">1368</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_dense_geometry</span>
</span><span id="L-1369"><a href="#L-1369"><span class="linenos">1369</span></a>
</span><span id="L-1370"><a href="#L-1370"><span class="linenos">1370</span></a>    <span class="k">def</span> <span class="nf">is_exploded_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1371"><a href="#L-1371"><span class="linenos">1371</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the self._is_exploded_geometry variable</span>
</span><span id="L-1372"><a href="#L-1372"><span class="linenos">1372</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1373"><a href="#L-1373"><span class="linenos">1373</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_exploded_geometry</span>
</span><span id="L-1374"><a href="#L-1374"><span class="linenos">1374</span></a>
</span><span id="L-1375"><a href="#L-1375"><span class="linenos">1375</span></a>    <span class="k">def</span> <span class="nf">is_main_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1376"><a href="#L-1376"><span class="linenos">1376</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the self._is_main_geometry variable</span>
</span><span id="L-1377"><a href="#L-1377"><span class="linenos">1377</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1378"><a href="#L-1378"><span class="linenos">1378</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_main_geometry</span>
</span><span id="L-1379"><a href="#L-1379"><span class="linenos">1379</span></a>
</span><span id="L-1380"><a href="#L-1380"><span class="linenos">1380</span></a>    <span class="k">def</span> <span class="nf">get_source</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1381"><a href="#L-1381"><span class="linenos">1381</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Return informations about URL sources</span>
</span><span id="L-1382"><a href="#L-1382"><span class="linenos">1382</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1383"><a href="#L-1383"><span class="linenos">1383</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1384"><a href="#L-1384"><span class="linenos">1384</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()]</span>
</span><span id="L-1385"><a href="#L-1385"><span class="linenos">1385</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1386"><a href="#L-1386"><span class="linenos">1386</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_dict</span>
</span><span id="L-1387"><a href="#L-1387"><span class="linenos">1387</span></a>
</span><span id="L-1388"><a href="#L-1388"><span class="linenos">1388</span></a>    <span class="k">def</span> <span class="nf">get_country</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1389"><a href="#L-1389"><span class="linenos">1389</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Return the current country used.</span>
</span><span id="L-1390"><a href="#L-1390"><span class="linenos">1390</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1391"><a href="#L-1391"><span class="linenos">1391</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country</span>
</span><span id="L-1392"><a href="#L-1392"><span class="linenos">1392</span></a>
</span><span id="L-1393"><a href="#L-1393"><span class="linenos">1393</span></a>    <span class="k">def</span> <span class="nf">get_list_countries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1394"><a href="#L-1394"><span class="linenos">1394</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; This function returns back the list of supported countries</span>
</span><span id="L-1395"><a href="#L-1395"><span class="linenos">1395</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1396"><a href="#L-1396"><span class="linenos">1396</span></a>        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_info_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
</span><span id="L-1397"><a href="#L-1397"><span class="linenos">1397</span></a>
</span><span id="L-1398"><a href="#L-1398"><span class="linenos">1398</span></a>    <span class="k">def</span> <span class="nf">is_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1399"><a href="#L-1399"><span class="linenos">1399</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Test if the country is initialized. Return True if it is. False if not.</span>
</span><span id="L-1400"><a href="#L-1400"><span class="linenos">1400</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1401"><a href="#L-1401"><span class="linenos">1401</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1402"><a href="#L-1402"><span class="linenos">1402</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-1403"><a href="#L-1403"><span class="linenos">1403</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1404"><a href="#L-1404"><span class="linenos">1404</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-1405"><a href="#L-1405"><span class="linenos">1405</span></a>
</span><span id="L-1406"><a href="#L-1406"><span class="linenos">1406</span></a>    <span class="k">def</span> <span class="nf">test_is_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1407"><a href="#L-1407"><span class="linenos">1407</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Test if the country is initialized. If not, raise a CoaDbError.</span>
</span><span id="L-1408"><a href="#L-1408"><span class="linenos">1408</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1409"><a href="#L-1409"><span class="linenos">1409</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_init</span><span class="p">():</span>
</span><span id="L-1410"><a href="#L-1410"><span class="linenos">1410</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-1411"><a href="#L-1411"><span class="linenos">1411</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1412"><a href="#L-1412"><span class="linenos">1412</span></a>            <span class="k">raise</span> <span class="n">CoaDbError</span><span class="p">(</span><span class="s2">&quot;The country is not set. Use a constructor with non empty country string.&quot;</span><span class="p">)</span>
</span><span id="L-1413"><a href="#L-1413"><span class="linenos">1413</span></a>
</span><span id="L-1414"><a href="#L-1414"><span class="linenos">1414</span></a>    <span class="k">def</span> <span class="nf">get_region_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1415"><a href="#L-1415"><span class="linenos">1415</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Return the list of available regions with code, name and geometry</span>
</span><span id="L-1416"><a href="#L-1416"><span class="linenos">1416</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1417"><a href="#L-1417"><span class="linenos">1417</span></a>        <span class="n">cols</span><span class="o">=</span><span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list_properties</span><span class="p">()</span> <span class="k">if</span> <span class="s1">&#39;_region&#39;</span> <span class="ow">in</span> <span class="n">c</span><span class="p">]</span>
</span><span id="L-1418"><a href="#L-1418"><span class="linenos">1418</span></a>        <span class="n">cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;geometry&#39;</span><span class="p">)</span>
</span><span id="L-1419"><a href="#L-1419"><span class="linenos">1419</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="kc">True</span><span class="p">)[</span><span class="n">cols</span><span class="p">]</span>
</span><span id="L-1420"><a href="#L-1420"><span class="linenos">1420</span></a>
</span><span id="L-1421"><a href="#L-1421"><span class="linenos">1421</span></a>    <span class="k">def</span> <span class="nf">is_region</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">r</span><span class="p">):</span>
</span><span id="L-1422"><a href="#L-1422"><span class="linenos">1422</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Return False if r is a not a known region, return the correctly capitalized name if ok</span>
</span><span id="L-1423"><a href="#L-1423"><span class="linenos">1423</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1424"><a href="#L-1424"><span class="linenos">1424</span></a>        <span class="n">r</span><span class="o">=</span><span class="n">tostdstring</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</span><span id="L-1425"><a href="#L-1425"><span class="linenos">1425</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_region_list</span><span class="p">()</span><span class="o">.</span><span class="n">name_region</span><span class="o">.</span><span class="n">to_list</span><span class="p">():</span>
</span><span id="L-1426"><a href="#L-1426"><span class="linenos">1426</span></a>            <span class="k">if</span> <span class="n">tostdstring</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="n">r</span><span class="p">:</span>
</span><span id="L-1427"><a href="#L-1427"><span class="linenos">1427</span></a>                <span class="k">return</span> <span class="n">i</span>
</span><span id="L-1428"><a href="#L-1428"><span class="linenos">1428</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-1429"><a href="#L-1429"><span class="linenos">1429</span></a>
</span><span id="L-1430"><a href="#L-1430"><span class="linenos">1430</span></a>    <span class="k">def</span> <span class="nf">get_subregion_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1431"><a href="#L-1431"><span class="linenos">1431</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Return the list of available subregions with code, name and geometry</span>
</span><span id="L-1432"><a href="#L-1432"><span class="linenos">1432</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1433"><a href="#L-1433"><span class="linenos">1433</span></a>        <span class="n">cols</span><span class="o">=</span><span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list_properties</span><span class="p">()</span> <span class="k">if</span> <span class="s1">&#39;_subregion&#39;</span> <span class="ow">in</span> <span class="n">c</span> <span class="p">]</span>
</span><span id="L-1434"><a href="#L-1434"><span class="linenos">1434</span></a>        <span class="n">cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;geometry&#39;</span><span class="p">)</span>
</span><span id="L-1435"><a href="#L-1435"><span class="linenos">1435</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">()[</span><span class="n">cols</span><span class="p">]</span>
</span><span id="L-1436"><a href="#L-1436"><span class="linenos">1436</span></a>
</span><span id="L-1437"><a href="#L-1437"><span class="linenos">1437</span></a>    <span class="k">def</span> <span class="nf">is_subregion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">r</span><span class="p">):</span>
</span><span id="L-1438"><a href="#L-1438"><span class="linenos">1438</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Return False if r is a not a known region, return the correctly capitalized name if ok</span>
</span><span id="L-1439"><a href="#L-1439"><span class="linenos">1439</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1440"><a href="#L-1440"><span class="linenos">1440</span></a>        <span class="n">r2</span><span class="o">=</span><span class="n">tostdstring</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</span><span id="L-1441"><a href="#L-1441"><span class="linenos">1441</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_subregion_list</span><span class="p">()</span><span class="o">.</span><span class="n">name_subregion</span><span class="o">.</span><span class="n">to_list</span><span class="p">():</span>
</span><span id="L-1442"><a href="#L-1442"><span class="linenos">1442</span></a>            <span class="k">if</span> <span class="n">tostdstring</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="n">r2</span><span class="p">:</span>
</span><span id="L-1443"><a href="#L-1443"><span class="linenos">1443</span></a>                <span class="k">return</span> <span class="n">i</span>
</span><span id="L-1444"><a href="#L-1444"><span class="linenos">1444</span></a>        <span class="n">a</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_subregion_list</span><span class="p">()[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_subregion_list</span><span class="p">()</span><span class="o">.</span><span class="n">code_subregion</span><span class="o">==</span><span class="n">r</span><span class="p">]</span><span class="o">.</span><span class="n">name_subregion</span><span class="o">.</span><span class="n">values</span>
</span><span id="L-1445"><a href="#L-1445"><span class="linenos">1445</span></a>        <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-1446"><a href="#L-1446"><span class="linenos">1446</span></a>            <span class="k">return</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1447"><a href="#L-1447"><span class="linenos">1447</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-1448"><a href="#L-1448"><span class="linenos">1448</span></a>
</span><span id="L-1449"><a href="#L-1449"><span class="linenos">1449</span></a>    <span class="k">def</span> <span class="nf">get_subregions_from_region</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-1450"><a href="#L-1450"><span class="linenos">1450</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Return the list of subregions within a specified region.</span>
</span><span id="L-1451"><a href="#L-1451"><span class="linenos">1451</span></a><span class="sd">        Should give either the code or the name of the region as strings in kwarg : code=# or name=#</span>
</span><span id="L-1452"><a href="#L-1452"><span class="linenos">1452</span></a><span class="sd">        Output default is &#39;code&#39; of subregions. Can be changed with output=&#39;name&#39;.</span>
</span><span id="L-1453"><a href="#L-1453"><span class="linenos">1453</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1454"><a href="#L-1454"><span class="linenos">1454</span></a>        <span class="n">kwargs_test</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;code&#39;</span><span class="p">,</span><span class="s1">&#39;output&#39;</span><span class="p">],</span><span class="s1">&#39;Should give either name or code of region. Output can be changed with the output option.&#39;</span><span class="p">)</span>
</span><span id="L-1455"><a href="#L-1455"><span class="linenos">1455</span></a>        <span class="n">code</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-1456"><a href="#L-1456"><span class="linenos">1456</span></a>        <span class="n">name</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-1457"><a href="#L-1457"><span class="linenos">1457</span></a>        <span class="n">out</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">,</span><span class="s1">&#39;code&#39;</span><span class="p">)</span>
</span><span id="L-1458"><a href="#L-1458"><span class="linenos">1458</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">code</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span> <span class="o">^</span> <span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-1459"><a href="#L-1459"><span class="linenos">1459</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s2">&quot;Should give either code or name of region, not both.&quot;</span><span class="p">)</span>
</span><span id="L-1460"><a href="#L-1460"><span class="linenos">1460</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">out</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span>
</span><span id="L-1461"><a href="#L-1461"><span class="linenos">1461</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s2">&quot;Should set output either as &#39;code&#39; or &#39;name&#39; for subregions.&quot;</span><span class="p">)</span>
</span><span id="L-1462"><a href="#L-1462"><span class="linenos">1462</span></a>
</span><span id="L-1463"><a href="#L-1463"><span class="linenos">1463</span></a>        <span class="k">if</span> <span class="n">name</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1464"><a href="#L-1464"><span class="linenos">1464</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
</span><span id="L-1465"><a href="#L-1465"><span class="linenos">1465</span></a>                <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s2">&quot;Name should be given as string.&quot;</span><span class="p">)</span>
</span><span id="L-1466"><a href="#L-1466"><span class="linenos">1466</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_region_list</span><span class="p">()[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">():</span>
</span><span id="L-1467"><a href="#L-1467"><span class="linenos">1467</span></a>                <span class="k">raise</span> <span class="n">CoaWhereError</span> <span class="p">(</span><span class="s2">&quot;The region &quot;</span><span class="o">+</span><span class="n">name</span><span class="o">+</span><span class="s2">&quot; does not exist for country &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()</span><span class="o">+</span><span class="s2">&quot;. See get_region_list().&quot;</span><span class="p">)</span>
</span><span id="L-1468"><a href="#L-1468"><span class="linenos">1468</span></a>            <span class="n">cut</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="kc">True</span><span class="p">)[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-1469"><a href="#L-1469"><span class="linenos">1469</span></a>
</span><span id="L-1470"><a href="#L-1470"><span class="linenos">1470</span></a>        <span class="k">if</span> <span class="n">code</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1471"><a href="#L-1471"><span class="linenos">1471</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">code</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
</span><span id="L-1472"><a href="#L-1472"><span class="linenos">1472</span></a>                <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s2">&quot;Name should be given as string.&quot;</span><span class="p">)</span>
</span><span id="L-1473"><a href="#L-1473"><span class="linenos">1473</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">code</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_region_list</span><span class="p">()[</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">():</span>
</span><span id="L-1474"><a href="#L-1474"><span class="linenos">1474</span></a>                <span class="k">raise</span> <span class="n">CoaWhereError</span><span class="p">(</span><span class="s2">&quot;The region &quot;</span><span class="o">+</span><span class="n">code</span><span class="o">+</span><span class="s2">&quot; does not exist for country &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()</span><span class="o">+</span><span class="s2">&quot;. See get_region_list().&quot;</span><span class="p">)</span>
</span><span id="L-1475"><a href="#L-1475"><span class="linenos">1475</span></a>            <span class="n">cut</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="kc">True</span><span class="p">)[</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">code</span><span class="p">)</span>
</span><span id="L-1476"><a href="#L-1476"><span class="linenos">1476</span></a>
</span><span id="L-1477"><a href="#L-1477"><span class="linenos">1477</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="kc">True</span><span class="p">)[</span><span class="n">cut</span><span class="p">][</span><span class="n">out</span><span class="o">+</span><span class="s1">&#39;_subregion&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="c1">#to_list()</span>
</span><span id="L-1478"><a href="#L-1478"><span class="linenos">1478</span></a>
</span><span id="L-1479"><a href="#L-1479"><span class="linenos">1479</span></a>    <span class="k">def</span> <span class="nf">get_subregions_from_list_of_region_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;code&#39;</span><span class="p">):</span>
</span><span id="L-1480"><a href="#L-1480"><span class="linenos">1480</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Return the list of subregions according to list of region names given.</span>
</span><span id="L-1481"><a href="#L-1481"><span class="linenos">1481</span></a><span class="sd">        The output argument (&#39;code&#39; as default) is given to the get_subregions_from_region function.</span>
</span><span id="L-1482"><a href="#L-1482"><span class="linenos">1482</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1483"><a href="#L-1483"><span class="linenos">1483</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
</span><span id="L-1484"><a href="#L-1484"><span class="linenos">1484</span></a>            <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s2">&quot;Should provide list as argument&quot;</span><span class="p">)</span>
</span><span id="L-1485"><a href="#L-1485"><span class="linenos">1485</span></a>        <span class="n">s</span><span class="o">=</span><span class="p">[]</span>
</span><span id="L-1486"><a href="#L-1486"><span class="linenos">1486</span></a>        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
</span><span id="L-1487"><a href="#L-1487"><span class="linenos">1487</span></a>            <span class="n">s</span><span class="o">=</span><span class="n">s</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">get_subregions_from_region</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">r</span><span class="p">,</span><span class="n">output</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
</span><span id="L-1488"><a href="#L-1488"><span class="linenos">1488</span></a>        <span class="k">return</span> <span class="n">s</span>
</span><span id="L-1489"><a href="#L-1489"><span class="linenos">1489</span></a>
</span><span id="L-1490"><a href="#L-1490"><span class="linenos">1490</span></a>    <span class="k">def</span> <span class="nf">get_regions_from_subregion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">code</span><span class="p">,</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;code&#39;</span><span class="p">):</span>
</span><span id="L-1491"><a href="#L-1491"><span class="linenos">1491</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Return the list of regions where the subregion, given by a code, is.</span>
</span><span id="L-1492"><a href="#L-1492"><span class="linenos">1492</span></a><span class="sd">        Output default is &#39;code&#39; of subregions. Can be changer with output=&#39;name&#39;.</span>
</span><span id="L-1493"><a href="#L-1493"><span class="linenos">1493</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1494"><a href="#L-1494"><span class="linenos">1494</span></a>
</span><span id="L-1495"><a href="#L-1495"><span class="linenos">1495</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">output</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span>
</span><span id="L-1496"><a href="#L-1496"><span class="linenos">1496</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;The output option should be &quot;code&quot; or &quot;name&quot; only&#39;</span><span class="p">)</span>
</span><span id="L-1497"><a href="#L-1497"><span class="linenos">1497</span></a>
</span><span id="L-1498"><a href="#L-1498"><span class="linenos">1498</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">code</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_subregion_list</span><span class="p">()[</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">():</span>
</span><span id="L-1499"><a href="#L-1499"><span class="linenos">1499</span></a>            <span class="k">raise</span> <span class="n">CoaWhereError</span><span class="p">(</span><span class="s2">&quot;The subregion &quot;</span><span class="o">+</span><span class="n">code</span><span class="o">+</span><span class="s2">&quot; does not exist for country &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()</span><span class="o">+</span><span class="s2">&quot;. See get_subregion_list().&quot;</span><span class="p">)</span>
</span><span id="L-1500"><a href="#L-1500"><span class="linenos">1500</span></a>
</span><span id="L-1501"><a href="#L-1501"><span class="linenos">1501</span></a>        <span class="n">l</span><span class="o">=</span><span class="p">[]</span>
</span><span id="L-1502"><a href="#L-1502"><span class="linenos">1502</span></a>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="L-1503"><a href="#L-1503"><span class="linenos">1503</span></a>            <span class="k">if</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">code_subregion</span><span class="p">:</span>
</span><span id="L-1504"><a href="#L-1504"><span class="linenos">1504</span></a>                <span class="k">if</span> <span class="n">output</span> <span class="o">==</span> <span class="s1">&#39;code&#39;</span><span class="p">:</span>
</span><span id="L-1505"><a href="#L-1505"><span class="linenos">1505</span></a>                    <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">code_region</span><span class="p">)</span>
</span><span id="L-1506"><a href="#L-1506"><span class="linenos">1506</span></a>                <span class="k">else</span><span class="p">:</span> <span class="c1"># due to first test, that&#39;s for sure name</span>
</span><span id="L-1507"><a href="#L-1507"><span class="linenos">1507</span></a>                    <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">name_region</span><span class="p">)</span>
</span><span id="L-1508"><a href="#L-1508"><span class="linenos">1508</span></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">l</span><span class="p">))</span>
</span><span id="L-1509"><a href="#L-1509"><span class="linenos">1509</span></a>
</span><span id="L-1510"><a href="#L-1510"><span class="linenos">1510</span></a>    <span class="k">def</span> <span class="nf">get_regions_from_list_of_subregion_codes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;code&#39;</span><span class="p">):</span>
</span><span id="L-1511"><a href="#L-1511"><span class="linenos">1511</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Return the list of regions according to list of subregion names given.</span>
</span><span id="L-1512"><a href="#L-1512"><span class="linenos">1512</span></a><span class="sd">        The output argument (&#39;code&#39; as default) is given to the get_regions_from_subregion function.</span>
</span><span id="L-1513"><a href="#L-1513"><span class="linenos">1513</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1514"><a href="#L-1514"><span class="linenos">1514</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
</span><span id="L-1515"><a href="#L-1515"><span class="linenos">1515</span></a>            <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s2">&quot;Should provide list as argument&quot;</span><span class="p">)</span>
</span><span id="L-1516"><a href="#L-1516"><span class="linenos">1516</span></a>        <span class="n">s</span><span class="o">=</span><span class="p">[]</span>
</span><span id="L-1517"><a href="#L-1517"><span class="linenos">1517</span></a>        <span class="k">for</span> <span class="n">sr</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
</span><span id="L-1518"><a href="#L-1518"><span class="linenos">1518</span></a>            <span class="n">s</span><span class="o">=</span><span class="n">s</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">get_regions_from_subregion</span><span class="p">(</span><span class="n">sr</span><span class="p">,</span><span class="n">output</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
</span><span id="L-1519"><a href="#L-1519"><span class="linenos">1519</span></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
</span><span id="L-1520"><a href="#L-1520"><span class="linenos">1520</span></a>
</span><span id="L-1521"><a href="#L-1521"><span class="linenos">1521</span></a>    <span class="k">def</span> <span class="nf">get_regions_from_macroregion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-1522"><a href="#L-1522"><span class="linenos">1522</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Return the list of regions included in another macroregion</span>
</span><span id="L-1523"><a href="#L-1523"><span class="linenos">1523</span></a><span class="sd">        Can provide input as code= or name=</span>
</span><span id="L-1524"><a href="#L-1524"><span class="linenos">1524</span></a><span class="sd">        Can provide output as &#39;name&#39; or &#39;code&#39; (default).</span>
</span><span id="L-1525"><a href="#L-1525"><span class="linenos">1525</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1526"><a href="#L-1526"><span class="linenos">1526</span></a>        <span class="n">kwargs_test</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;code&#39;</span><span class="p">,</span><span class="s1">&#39;output&#39;</span><span class="p">],</span><span class="s1">&#39;Should give either name or code of region. Output can be changed with the output option.&#39;</span><span class="p">)</span>
</span><span id="L-1527"><a href="#L-1527"><span class="linenos">1527</span></a>        <span class="n">code</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-1528"><a href="#L-1528"><span class="linenos">1528</span></a>        <span class="n">name</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-1529"><a href="#L-1529"><span class="linenos">1529</span></a>        <span class="n">out</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">,</span><span class="s1">&#39;code&#39;</span><span class="p">)</span>
</span><span id="L-1530"><a href="#L-1530"><span class="linenos">1530</span></a>
</span><span id="L-1531"><a href="#L-1531"><span class="linenos">1531</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">code</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span> <span class="o">^</span> <span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-1532"><a href="#L-1532"><span class="linenos">1532</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s2">&quot;Should give either code or name of region, not both.&quot;</span><span class="p">)</span>
</span><span id="L-1533"><a href="#L-1533"><span class="linenos">1533</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">out</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span>
</span><span id="L-1534"><a href="#L-1534"><span class="linenos">1534</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s2">&quot;Should set output either as &#39;code&#39; or &#39;name&#39; for subregions.&quot;</span><span class="p">)</span>
</span><span id="L-1535"><a href="#L-1535"><span class="linenos">1535</span></a>
</span><span id="L-1536"><a href="#L-1536"><span class="linenos">1536</span></a>        <span class="n">dict_input</span><span class="o">=</span><span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">]}</span>
</span><span id="L-1537"><a href="#L-1537"><span class="linenos">1537</span></a>        <span class="n">r_out</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_regions_from_list_of_subregion_codes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_subregions_from_region</span><span class="p">(</span><span class="o">**</span><span class="n">dict_input</span><span class="p">),</span><span class="n">output</span><span class="o">=</span><span class="n">out</span><span class="p">)</span>
</span><span id="L-1538"><a href="#L-1538"><span class="linenos">1538</span></a>
</span><span id="L-1539"><a href="#L-1539"><span class="linenos">1539</span></a>        <span class="c1"># remove the input</span>
</span><span id="L-1540"><a href="#L-1540"><span class="linenos">1540</span></a>        <span class="n">rl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_region_list</span><span class="p">()</span>
</span><span id="L-1541"><a href="#L-1541"><span class="linenos">1541</span></a>        <span class="k">if</span> <span class="n">code</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1542"><a href="#L-1542"><span class="linenos">1542</span></a>            <span class="k">if</span> <span class="n">out</span><span class="o">==</span><span class="s1">&#39;code&#39;</span><span class="p">:</span>
</span><span id="L-1543"><a href="#L-1543"><span class="linenos">1543</span></a>                <span class="nb">input</span><span class="o">=</span><span class="n">rl</span><span class="p">[</span><span class="n">rl</span><span class="o">.</span><span class="n">code_region</span><span class="o">==</span><span class="n">code</span><span class="p">]</span><span class="o">.</span><span class="n">name_region</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span><span id="L-1544"><a href="#L-1544"><span class="linenos">1544</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1545"><a href="#L-1545"><span class="linenos">1545</span></a>                <span class="nb">input</span><span class="o">=</span><span class="n">code</span>
</span><span id="L-1546"><a href="#L-1546"><span class="linenos">1546</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1547"><a href="#L-1547"><span class="linenos">1547</span></a>            <span class="k">if</span> <span class="n">out</span><span class="o">==</span><span class="s1">&#39;name&#39;</span><span class="p">:</span>
</span><span id="L-1548"><a href="#L-1548"><span class="linenos">1548</span></a>                <span class="nb">input</span><span class="o">=</span><span class="n">name</span>
</span><span id="L-1549"><a href="#L-1549"><span class="linenos">1549</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1550"><a href="#L-1550"><span class="linenos">1550</span></a>                <span class="nb">input</span><span class="o">=</span><span class="n">rl</span><span class="p">[</span><span class="n">rl</span><span class="o">.</span><span class="n">name_region</span><span class="o">==</span><span class="n">code</span><span class="p">]</span><span class="o">.</span><span class="n">code_region</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span><span id="L-1551"><a href="#L-1551"><span class="linenos">1551</span></a>
</span><span id="L-1552"><a href="#L-1552"><span class="linenos">1552</span></a>        <span class="k">if</span> <span class="nb">input</span> <span class="ow">in</span> <span class="n">r_out</span><span class="p">:</span>
</span><span id="L-1553"><a href="#L-1553"><span class="linenos">1553</span></a>            <span class="n">r_out</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
</span><span id="L-1554"><a href="#L-1554"><span class="linenos">1554</span></a>
</span><span id="L-1555"><a href="#L-1555"><span class="linenos">1555</span></a>        <span class="c1"># Append the input in the right position, the macro region should be at the end</span>
</span><span id="L-1556"><a href="#L-1556"><span class="linenos">1556</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">r_out</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># the input is not a macro region but just a region</span>
</span><span id="L-1557"><a href="#L-1557"><span class="linenos">1557</span></a>            <span class="n">r_out</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">input</span><span class="p">)</span>
</span><span id="L-1558"><a href="#L-1558"><span class="linenos">1558</span></a>        <span class="k">else</span><span class="p">:</span> <span class="c1"># the input is a real macro region</span>
</span><span id="L-1559"><a href="#L-1559"><span class="linenos">1559</span></a>            <span class="n">r_out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
</span><span id="L-1560"><a href="#L-1560"><span class="linenos">1560</span></a>
</span><span id="L-1561"><a href="#L-1561"><span class="linenos">1561</span></a>        <span class="k">return</span> <span class="n">r_out</span>
</span><span id="L-1562"><a href="#L-1562"><span class="linenos">1562</span></a>
</span><span id="L-1563"><a href="#L-1563"><span class="linenos">1563</span></a>    <span class="k">def</span> <span class="nf">get_list_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1564"><a href="#L-1564"><span class="linenos">1564</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the list of available properties for the current country</span>
</span><span id="L-1565"><a href="#L-1565"><span class="linenos">1565</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1566"><a href="#L-1566"><span class="linenos">1566</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_is_init</span><span class="p">():</span>
</span><span id="L-1567"><a href="#L-1567"><span class="linenos">1567</span></a>            <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span>
</span><span id="L-1568"><a href="#L-1568"><span class="linenos">1568</span></a>
</span><span id="L-1569"><a href="#L-1569"><span class="linenos">1569</span></a>    <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">region_version</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-1570"><a href="#L-1570"><span class="linenos">1570</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the whole geopandas data.</span>
</span><span id="L-1571"><a href="#L-1571"><span class="linenos">1571</span></a><span class="sd">        If region_version = True (not default), the pandas output is region based focalized.</span>
</span><span id="L-1572"><a href="#L-1572"><span class="linenos">1572</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1573"><a href="#L-1573"><span class="linenos">1573</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_is_init</span><span class="p">():</span>
</span><span id="L-1574"><a href="#L-1574"><span class="linenos">1574</span></a>            <span class="k">if</span> <span class="n">region_version</span><span class="p">:</span>
</span><span id="L-1575"><a href="#L-1575"><span class="linenos">1575</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data_region</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span> <span class="c1"># i.e. is None</span>
</span><span id="L-1576"><a href="#L-1576"><span class="linenos">1576</span></a>                    <span class="n">col_reg</span><span class="o">=</span><span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">if</span> <span class="s1">&#39;_region&#39;</span> <span class="ow">in</span> <span class="n">c</span><span class="p">]</span>
</span><span id="L-1577"><a href="#L-1577"><span class="linenos">1577</span></a>                    <span class="n">col</span><span class="o">=</span><span class="n">col_reg</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-1578"><a href="#L-1578"><span class="linenos">1578</span></a>                    <span class="n">col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;geometry&#39;</span><span class="p">)</span> <span class="c1"># to merge the geometry of subregions</span>
</span><span id="L-1579"><a href="#L-1579"><span class="linenos">1579</span></a>                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list_properties</span><span class="p">():</span>
</span><span id="L-1580"><a href="#L-1580"><span class="linenos">1580</span></a>                        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;_subregion&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">)</span> <span class="ow">and</span> <span class="n">pd</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_numeric_dtype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="n">p</span><span class="p">]):</span>
</span><span id="L-1581"><a href="#L-1581"><span class="linenos">1581</span></a>                            <span class="n">col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span><span id="L-1582"><a href="#L-1582"><span class="linenos">1582</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;code_subregion&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
</span><span id="L-1583"><a href="#L-1583"><span class="linenos">1583</span></a>                        <span class="n">col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">)</span> <span class="c1"># to get the list of subregion in region</span>
</span><span id="L-1584"><a href="#L-1584"><span class="linenos">1584</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;name_subregion&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
</span><span id="L-1585"><a href="#L-1585"><span class="linenos">1585</span></a>                        <span class="n">col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">)</span> <span class="c1"># to get the list of subregion name in region</span>
</span><span id="L-1586"><a href="#L-1586"><span class="linenos">1586</span></a>
</span><span id="L-1587"><a href="#L-1587"><span class="linenos">1587</span></a>                    <span class="n">pr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-1588"><a href="#L-1588"><span class="linenos">1588</span></a>
</span><span id="L-1589"><a href="#L-1589"><span class="linenos">1589</span></a>                    <span class="c1"># Country specific management</span>
</span><span id="L-1590"><a href="#L-1590"><span class="linenos">1590</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;FRA&#39;</span><span class="p">:</span> <span class="c1"># manage pseudo &#39;FRA&#39; regions &#39;Métropole&#39; and &#39;Outre-mer&#39;</span>
</span><span id="L-1591"><a href="#L-1591"><span class="linenos">1591</span></a>                        <span class="n">metropole_cut</span><span class="o">=</span><span class="n">pr</span><span class="o">.</span><span class="n">code_region</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">10</span>
</span><span id="L-1592"><a href="#L-1592"><span class="linenos">1592</span></a>                        <span class="n">pr_metropole</span><span class="o">=</span><span class="n">pr</span><span class="p">[</span><span class="n">metropole_cut</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-1593"><a href="#L-1593"><span class="linenos">1593</span></a>                        <span class="n">pr_metropole</span><span class="p">[</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;999&#39;</span>
</span><span id="L-1594"><a href="#L-1594"><span class="linenos">1594</span></a>                        <span class="n">pr_metropole</span><span class="p">[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;Métropole&#39;</span>
</span><span id="L-1595"><a href="#L-1595"><span class="linenos">1595</span></a>                        <span class="n">pr_metropole</span><span class="p">[</span><span class="s1">&#39;flag_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
</span><span id="L-1596"><a href="#L-1596"><span class="linenos">1596</span></a>                        <span class="n">pr_outremer</span><span class="o">=</span><span class="n">pr</span><span class="p">[</span><span class="o">~</span><span class="n">metropole_cut</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-1597"><a href="#L-1597"><span class="linenos">1597</span></a>                        <span class="n">pr_outremer</span><span class="p">[</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;000&#39;</span>
</span><span id="L-1598"><a href="#L-1598"><span class="linenos">1598</span></a>                        <span class="n">pr_outremer</span><span class="p">[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;Outre-mer&#39;</span>
</span><span id="L-1599"><a href="#L-1599"><span class="linenos">1599</span></a>                        <span class="n">pr_outremer</span><span class="p">[</span><span class="s1">&#39;flag_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
</span><span id="L-1600"><a href="#L-1600"><span class="linenos">1600</span></a>
</span><span id="L-1601"><a href="#L-1601"><span class="linenos">1601</span></a>                        <span class="n">pr</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pr</span><span class="p">,</span><span class="n">pr_metropole</span><span class="p">],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1602"><a href="#L-1602"><span class="linenos">1602</span></a>                        <span class="n">pr</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pr</span><span class="p">,</span><span class="n">pr_outremer</span><span class="p">],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1603"><a href="#L-1603"><span class="linenos">1603</span></a>                        <span class="c1">#pr=pr.append(pr_metropole,ignore_index=True).append(pr_outremer,ignore_index=True)</span>
</span><span id="L-1604"><a href="#L-1604"><span class="linenos">1604</span></a>
</span><span id="L-1605"><a href="#L-1605"><span class="linenos">1605</span></a>                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;ESP&#39;</span> <span class="p">:</span> <span class="c1"># manage pseudo &#39;ESP&#39; regions within and outside continent</span>
</span><span id="L-1606"><a href="#L-1606"><span class="linenos">1606</span></a>                        <span class="n">islands_cut</span><span class="o">=</span><span class="n">pr</span><span class="o">.</span><span class="n">code_region</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;05&#39;</span><span class="p">])</span>
</span><span id="L-1607"><a href="#L-1607"><span class="linenos">1607</span></a>                        <span class="n">pr_metropole</span><span class="o">=</span><span class="n">pr</span><span class="p">[</span><span class="o">~</span><span class="n">islands_cut</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-1608"><a href="#L-1608"><span class="linenos">1608</span></a>                        <span class="n">pr_metropole</span><span class="p">[</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;99&#39;</span>
</span><span id="L-1609"><a href="#L-1609"><span class="linenos">1609</span></a>                        <span class="n">pr_metropole</span><span class="p">[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;España peninsular&#39;</span>
</span><span id="L-1610"><a href="#L-1610"><span class="linenos">1610</span></a>                        <span class="n">pr_metropole</span><span class="p">[</span><span class="s1">&#39;flag_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
</span><span id="L-1611"><a href="#L-1611"><span class="linenos">1611</span></a>
</span><span id="L-1612"><a href="#L-1612"><span class="linenos">1612</span></a>                        <span class="n">pr_outremer</span><span class="o">=</span><span class="n">pr</span><span class="p">[</span><span class="n">islands_cut</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-1613"><a href="#L-1613"><span class="linenos">1613</span></a>                        <span class="n">pr_outremer</span><span class="p">[</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;00&#39;</span>
</span><span id="L-1614"><a href="#L-1614"><span class="linenos">1614</span></a>                        <span class="n">pr_outremer</span><span class="p">[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;Islas españolas&#39;</span>
</span><span id="L-1615"><a href="#L-1615"><span class="linenos">1615</span></a>                        <span class="n">pr_outremer</span><span class="p">[</span><span class="s1">&#39;flag_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
</span><span id="L-1616"><a href="#L-1616"><span class="linenos">1616</span></a>
</span><span id="L-1617"><a href="#L-1617"><span class="linenos">1617</span></a>                        <span class="n">pr</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pr</span><span class="p">,</span><span class="n">pr_metropole</span><span class="p">,</span><span class="n">pr_outremer</span><span class="p">],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1618"><a href="#L-1618"><span class="linenos">1618</span></a>
</span><span id="L-1619"><a href="#L-1619"><span class="linenos">1619</span></a>                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;PRT&#39;</span> <span class="p">:</span> <span class="c1"># manage pseudo &#39;PRT&#39; regions within and outside continent</span>
</span><span id="L-1620"><a href="#L-1620"><span class="linenos">1620</span></a>                        <span class="n">islands_cut</span><span class="o">=</span><span class="n">pr</span><span class="o">.</span><span class="n">code_region</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;PT.AC&#39;</span><span class="p">,</span><span class="s1">&#39;PT.MA&#39;</span><span class="p">])</span>
</span><span id="L-1621"><a href="#L-1621"><span class="linenos">1621</span></a>                        <span class="n">pr_metropole</span><span class="o">=</span><span class="n">pr</span><span class="p">[</span><span class="o">~</span><span class="n">islands_cut</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-1622"><a href="#L-1622"><span class="linenos">1622</span></a>                        <span class="n">pr_metropole</span><span class="p">[</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;PT.99&#39;</span>
</span><span id="L-1623"><a href="#L-1623"><span class="linenos">1623</span></a>                        <span class="n">pr_metropole</span><span class="p">[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;Portugal continental&#39;</span>
</span><span id="L-1624"><a href="#L-1624"><span class="linenos">1624</span></a>                        <span class="n">pr_metropole</span><span class="p">[</span><span class="s1">&#39;flag_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
</span><span id="L-1625"><a href="#L-1625"><span class="linenos">1625</span></a>
</span><span id="L-1626"><a href="#L-1626"><span class="linenos">1626</span></a>                        <span class="n">pr_outremer</span><span class="o">=</span><span class="n">pr</span><span class="p">[</span><span class="n">islands_cut</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-1627"><a href="#L-1627"><span class="linenos">1627</span></a>                        <span class="n">pr_outremer</span><span class="p">[</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;PT.00&#39;</span>
</span><span id="L-1628"><a href="#L-1628"><span class="linenos">1628</span></a>                        <span class="n">pr_outremer</span><span class="p">[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;Ilhas portuguesas&#39;</span>
</span><span id="L-1629"><a href="#L-1629"><span class="linenos">1629</span></a>                        <span class="n">pr_outremer</span><span class="p">[</span><span class="s1">&#39;flag_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
</span><span id="L-1630"><a href="#L-1630"><span class="linenos">1630</span></a>
</span><span id="L-1631"><a href="#L-1631"><span class="linenos">1631</span></a>                        <span class="n">pr</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pr</span><span class="p">,</span><span class="n">pr_metropole</span><span class="p">],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1632"><a href="#L-1632"><span class="linenos">1632</span></a>                        <span class="n">pr</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pr</span><span class="p">,</span><span class="n">pr_outremer</span><span class="p">],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1633"><a href="#L-1633"><span class="linenos">1633</span></a>                        <span class="c1">#pr=pr.append(pr_metropole,ignore_index=True).append(pr_outremer,ignore_index=True)</span>
</span><span id="L-1634"><a href="#L-1634"><span class="linenos">1634</span></a>
</span><span id="L-1635"><a href="#L-1635"><span class="linenos">1635</span></a>                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;USA&#39;</span><span class="p">:</span>
</span><span id="L-1636"><a href="#L-1636"><span class="linenos">1636</span></a>                        <span class="n">usa_col</span><span class="o">=</span><span class="n">pr</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="L-1637"><a href="#L-1637"><span class="linenos">1637</span></a>                        <span class="c1">#usa_col.remove(&#39;_subregion&#39;) # Remove numeric column, if not, the dissolve does not work properly</span>
</span><span id="L-1638"><a href="#L-1638"><span class="linenos">1638</span></a>                        <span class="c1">#usa_col.remove(&#39;area_subregion&#39;) # idem</span>
</span><span id="L-1639"><a href="#L-1639"><span class="linenos">1639</span></a>                        <span class="n">pr</span><span class="o">=</span><span class="n">pr</span><span class="p">[</span><span class="n">usa_col</span><span class="p">]</span>
</span><span id="L-1640"><a href="#L-1640"><span class="linenos">1640</span></a>
</span><span id="L-1641"><a href="#L-1641"><span class="linenos">1641</span></a>                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;EUR&#39;</span><span class="p">:</span>
</span><span id="L-1642"><a href="#L-1642"><span class="linenos">1642</span></a>                        <span class="n">pr</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pr</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">isnull</span><span class="p">(),</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sg</span><span class="o">.</span><span class="n">Point</span><span class="p">()</span>  <span class="c1"># For correct geometry merge</span>
</span><span id="L-1643"><a href="#L-1643"><span class="linenos">1643</span></a>                        <span class="n">pr</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pr</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span> <span class="c1"># needed with geopandas 0.10.2&#39; for EUR data only (apparently)</span>
</span><span id="L-1644"><a href="#L-1644"><span class="linenos">1644</span></a>
</span><span id="L-1645"><a href="#L-1645"><span class="linenos">1645</span></a>                    <span class="n">pr</span><span class="p">[</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">pr</span><span class="o">.</span><span class="n">code_subregion</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span><span class="n">x</span><span class="p">])</span>
</span><span id="L-1646"><a href="#L-1646"><span class="linenos">1646</span></a>                    <span class="n">pr</span><span class="p">[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">pr</span><span class="o">.</span><span class="n">name_subregion</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span><span class="n">x</span><span class="p">])</span>
</span><span id="L-1647"><a href="#L-1647"><span class="linenos">1647</span></a>
</span><span id="L-1648"><a href="#L-1648"><span class="linenos">1648</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_country_data_region</span><span class="o">=</span><span class="n">pr</span><span class="o">.</span><span class="n">dissolve</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="n">col_reg</span><span class="p">,</span><span class="n">aggfunc</span><span class="o">=</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">()))</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;code_region&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="L-1649"><a href="#L-1649"><span class="linenos">1649</span></a>                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;population&#39;</span><span class="p">,</span><span class="s1">&#39;area&#39;</span><span class="p">]:</span>
</span><span id="L-1650"><a href="#L-1650"><span class="linenos">1650</span></a>                        <span class="k">if</span> <span class="n">x</span><span class="o">+</span><span class="s1">&#39;_subregion&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data_region</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-1651"><a href="#L-1651"><span class="linenos">1651</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data_region</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">x</span><span class="o">+</span><span class="s1">&#39;_subregion&#39;</span><span class="p">:</span><span class="n">x</span><span class="o">+</span><span class="s1">&#39;_region&#39;</span><span class="p">},</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1652"><a href="#L-1652"><span class="linenos">1652</span></a>
</span><span id="L-1653"><a href="#L-1653"><span class="linenos">1653</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data_region</span>
</span><span id="L-1654"><a href="#L-1654"><span class="linenos">1654</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1655"><a href="#L-1655"><span class="linenos">1655</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data_subregion</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span> <span class="c1">#i.e. is None</span>
</span><span id="L-1656"><a href="#L-1656"><span class="linenos">1656</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_country_data_subregion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">)</span>
</span><span id="L-1657"><a href="#L-1657"><span class="linenos">1657</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data_subregion</span>
</span><span id="L-1658"><a href="#L-1658"><span class="linenos">1658</span></a>
</span><span id="L-1659"><a href="#L-1659"><span class="linenos">1659</span></a>    <span class="k">def</span> <span class="nf">add_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-1660"><a href="#L-1660"><span class="linenos">1660</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a the data pandas.Dataframe with an additionnal column with property prop.</span>
</span><span id="L-1661"><a href="#L-1661"><span class="linenos">1661</span></a>
</span><span id="L-1662"><a href="#L-1662"><span class="linenos">1662</span></a><span class="sd">        Arguments :</span>
</span><span id="L-1663"><a href="#L-1663"><span class="linenos">1663</span></a><span class="sd">        input        : pandas.Dataframe object. Mandatory.</span>
</span><span id="L-1664"><a href="#L-1664"><span class="linenos">1664</span></a><span class="sd">        field        : field of properties to add. Should be within the get_list_prop() list. Mandatory.</span>
</span><span id="L-1665"><a href="#L-1665"><span class="linenos">1665</span></a><span class="sd">        input_key    : input geo key of the input pandas dataframe. Default  &#39;where&#39;</span>
</span><span id="L-1666"><a href="#L-1666"><span class="linenos">1666</span></a><span class="sd">        geofield     : internal geo field to make the merge. Default &#39;code_subregion&#39;</span>
</span><span id="L-1667"><a href="#L-1667"><span class="linenos">1667</span></a><span class="sd">        region_merging : Boolean value. Default False, except if the geofield contains &#39;_region&#39;.</span>
</span><span id="L-1668"><a href="#L-1668"><span class="linenos">1668</span></a><span class="sd">                       If True, the merge between input dans GeoCountry data is done within the</span>
</span><span id="L-1669"><a href="#L-1669"><span class="linenos">1669</span></a><span class="sd">                       region version of the data, not the subregion data which is the default</span>
</span><span id="L-1670"><a href="#L-1670"><span class="linenos">1670</span></a><span class="sd">                       behavious.</span>
</span><span id="L-1671"><a href="#L-1671"><span class="linenos">1671</span></a><span class="sd">        overload   : Allow to overload a field. Boolean value. Default : False</span>
</span><span id="L-1672"><a href="#L-1672"><span class="linenos">1672</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1673"><a href="#L-1673"><span class="linenos">1673</span></a>
</span><span id="L-1674"><a href="#L-1674"><span class="linenos">1674</span></a>        <span class="c1"># Test of args</span>
</span><span id="L-1675"><a href="#L-1675"><span class="linenos">1675</span></a>        <span class="n">kwargs_test</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;input&#39;</span><span class="p">,</span><span class="s1">&#39;field&#39;</span><span class="p">,</span><span class="s1">&#39;input_key&#39;</span><span class="p">,</span><span class="s1">&#39;geofield&#39;</span><span class="p">,</span><span class="s1">&#39;geotype&#39;</span><span class="p">,</span><span class="s1">&#39;overload&#39;</span><span class="p">],</span>
</span><span id="L-1676"><a href="#L-1676"><span class="linenos">1676</span></a>            <span class="s1">&#39;Bad args used in the add_field() function.&#39;</span><span class="p">)</span>
</span><span id="L-1677"><a href="#L-1677"><span class="linenos">1677</span></a>
</span><span id="L-1678"><a href="#L-1678"><span class="linenos">1678</span></a>        <span class="c1"># Testing input</span>
</span><span id="L-1679"><a href="#L-1679"><span class="linenos">1679</span></a>        <span class="n">data</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span> <span class="c1"># the panda</span>
</span><span id="L-1680"><a href="#L-1680"><span class="linenos">1680</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
</span><span id="L-1681"><a href="#L-1681"><span class="linenos">1681</span></a>            <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s1">&#39;You should provide a valid input pandas&#39;</span>
</span><span id="L-1682"><a href="#L-1682"><span class="linenos">1682</span></a>                <span class="s1">&#39; DataFrame as input. See help.&#39;</span><span class="p">)</span>
</span><span id="L-1683"><a href="#L-1683"><span class="linenos">1683</span></a>        <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-1684"><a href="#L-1684"><span class="linenos">1684</span></a>
</span><span id="L-1685"><a href="#L-1685"><span class="linenos">1685</span></a>        <span class="c1"># Testing input_key</span>
</span><span id="L-1686"><a href="#L-1686"><span class="linenos">1686</span></a>        <span class="n">input_key</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;input_key&#39;</span><span class="p">,</span><span class="s1">&#39;where&#39;</span><span class="p">)</span>
</span><span id="L-1687"><a href="#L-1687"><span class="linenos">1687</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_key</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
</span><span id="L-1688"><a href="#L-1688"><span class="linenos">1688</span></a>            <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s1">&#39;The input_key should be given as a string.&#39;</span><span class="p">)</span>
</span><span id="L-1689"><a href="#L-1689"><span class="linenos">1689</span></a>        <span class="k">if</span> <span class="n">input_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
</span><span id="L-1690"><a href="#L-1690"><span class="linenos">1690</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;The input_key &quot;&#39;</span><span class="o">+</span><span class="n">input_key</span><span class="o">+</span><span class="s1">&#39;&quot; given is &#39;</span>
</span><span id="L-1691"><a href="#L-1691"><span class="linenos">1691</span></a>                <span class="s1">&#39;not a valid column name of the input pandas dataframe.&#39;</span><span class="p">)</span>
</span><span id="L-1692"><a href="#L-1692"><span class="linenos">1692</span></a>
</span><span id="L-1693"><a href="#L-1693"><span class="linenos">1693</span></a>        <span class="c1"># Testing geofield</span>
</span><span id="L-1694"><a href="#L-1694"><span class="linenos">1694</span></a>        <span class="n">geofield</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;geofield&#39;</span><span class="p">,</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">)</span>
</span><span id="L-1695"><a href="#L-1695"><span class="linenos">1695</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geofield</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
</span><span id="L-1696"><a href="#L-1696"><span class="linenos">1696</span></a>            <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s1">&#39;The geofield should be given as a string.&#39;</span><span class="p">)</span>
</span><span id="L-1697"><a href="#L-1697"><span class="linenos">1697</span></a>        <span class="k">if</span> <span class="n">geofield</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
</span><span id="L-1698"><a href="#L-1698"><span class="linenos">1698</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;The geofield &quot;&#39;</span><span class="o">+</span><span class="n">geofield</span><span class="o">+</span><span class="s1">&#39;&quot; given is &#39;</span>
</span><span id="L-1699"><a href="#L-1699"><span class="linenos">1699</span></a>                <span class="s1">&#39;not a valid column name of the available data. &#39;</span>
</span><span id="L-1700"><a href="#L-1700"><span class="linenos">1700</span></a>                <span class="s1">&#39;See get_list_properties() for valid fields.&#39;</span><span class="p">)</span>
</span><span id="L-1701"><a href="#L-1701"><span class="linenos">1701</span></a>
</span><span id="L-1702"><a href="#L-1702"><span class="linenos">1702</span></a>        <span class="n">region_merging</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;region_merging&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-1703"><a href="#L-1703"><span class="linenos">1703</span></a>        <span class="k">if</span> <span class="n">region_merging</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1704"><a href="#L-1704"><span class="linenos">1704</span></a>            <span class="k">if</span> <span class="s1">&#39;_region&#39;</span> <span class="ow">in</span> <span class="n">geofield</span><span class="p">:</span>
</span><span id="L-1705"><a href="#L-1705"><span class="linenos">1705</span></a>                <span class="n">region_merging</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-1706"><a href="#L-1706"><span class="linenos">1706</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1707"><a href="#L-1707"><span class="linenos">1707</span></a>                <span class="n">region_merging</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-1708"><a href="#L-1708"><span class="linenos">1708</span></a>
</span><span id="L-1709"><a href="#L-1709"><span class="linenos">1709</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">region_merging</span><span class="p">,</span><span class="nb">bool</span><span class="p">):</span>
</span><span id="L-1710"><a href="#L-1710"><span class="linenos">1710</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;The region_mergin key should be boolean. See help.&#39;</span><span class="p">)</span>
</span><span id="L-1711"><a href="#L-1711"><span class="linenos">1711</span></a>
</span><span id="L-1712"><a href="#L-1712"><span class="linenos">1712</span></a>        <span class="c1"># Testing fields</span>
</span><span id="L-1713"><a href="#L-1713"><span class="linenos">1713</span></a>        <span class="n">prop</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;field&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span> <span class="c1"># field list</span>
</span><span id="L-1714"><a href="#L-1714"><span class="linenos">1714</span></a>        <span class="k">if</span> <span class="n">prop</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1715"><a href="#L-1715"><span class="linenos">1715</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;No field given. See help.&#39;</span><span class="p">)</span>
</span><span id="L-1716"><a href="#L-1716"><span class="linenos">1716</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
</span><span id="L-1717"><a href="#L-1717"><span class="linenos">1717</span></a>            <span class="n">prop</span><span class="o">=</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span> <span class="c1"># make the prop input a list if needed</span>
</span><span id="L-1718"><a href="#L-1718"><span class="linenos">1718</span></a>
</span><span id="L-1719"><a href="#L-1719"><span class="linenos">1719</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">):</span>
</span><span id="L-1720"><a href="#L-1720"><span class="linenos">1720</span></a>            <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s2">&quot;Each property should be a string whereas &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; is not a list of string.&quot;</span><span class="p">)</span>
</span><span id="L-1721"><a href="#L-1721"><span class="linenos">1721</span></a>
</span><span id="L-1722"><a href="#L-1722"><span class="linenos">1722</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list_properties</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">):</span>
</span><span id="L-1723"><a href="#L-1723"><span class="linenos">1723</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s2">&quot;The property &quot;</span><span class="o">+</span><span class="n">prop</span><span class="o">+</span><span class="s2">&quot; is not available for country &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()</span><span class="o">+</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
</span><span id="L-1724"><a href="#L-1724"><span class="linenos">1724</span></a>
</span><span id="L-1725"><a href="#L-1725"><span class="linenos">1725</span></a>        <span class="c1"># Testing overload</span>
</span><span id="L-1726"><a href="#L-1726"><span class="linenos">1726</span></a>        <span class="n">overload</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;overload&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-1727"><a href="#L-1727"><span class="linenos">1727</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">overload</span><span class="p">,</span><span class="nb">bool</span><span class="p">):</span>
</span><span id="L-1728"><a href="#L-1728"><span class="linenos">1728</span></a>            <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s1">&#39;The overload option should be a boolean.&#39;</span><span class="p">)</span>
</span><span id="L-1729"><a href="#L-1729"><span class="linenos">1729</span></a>
</span><span id="L-1730"><a href="#L-1730"><span class="linenos">1730</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">overload</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">):</span>
</span><span id="L-1731"><a href="#L-1731"><span class="linenos">1731</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;Some fields already exist in you panda &#39;</span>
</span><span id="L-1732"><a href="#L-1732"><span class="linenos">1732</span></a>                <span class="s1">&#39;dataframe columns. You may set overload to True.&#39;</span><span class="p">)</span>
</span><span id="L-1733"><a href="#L-1733"><span class="linenos">1733</span></a>
</span><span id="L-1734"><a href="#L-1734"><span class="linenos">1734</span></a>        <span class="c1"># Is the oject properly initialized ?</span>
</span><span id="L-1735"><a href="#L-1735"><span class="linenos">1735</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">test_is_init</span><span class="p">()</span>
</span><span id="L-1736"><a href="#L-1736"><span class="linenos">1736</span></a>
</span><span id="L-1737"><a href="#L-1737"><span class="linenos">1737</span></a>        <span class="c1"># Now let&#39;s go for merging</span>
</span><span id="L-1738"><a href="#L-1738"><span class="linenos">1738</span></a>        <span class="n">prop</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">)</span>
</span><span id="L-1739"><a href="#L-1739"><span class="linenos">1739</span></a>        <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">region_merging</span><span class="p">)[</span><span class="n">prop</span><span class="p">],</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">left_on</span><span class="o">=</span><span class="n">input_key</span><span class="p">,</span>\
</span><span id="L-1740"><a href="#L-1740"><span class="linenos">1740</span></a>                            <span class="n">right_on</span><span class="o">=</span><span class="n">geofield</span><span class="p">)</span>
</span></pre></div>


            </section>
                <section id="GeoManager">
                            <input id="GeoManager-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">GeoManager</span>:

                <label class="view-source-button" for="GeoManager-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GeoManager"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GeoManager-48"><a href="#GeoManager-48"><span class="linenos"> 48</span></a><span class="k">class</span> <span class="nc">GeoManager</span><span class="p">():</span>
</span><span id="GeoManager-49"><a href="#GeoManager-49"><span class="linenos"> 49</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;GeoManager class definition. No inheritance from any other class.</span>
</span><span id="GeoManager-50"><a href="#GeoManager-50"><span class="linenos"> 50</span></a>
</span><span id="GeoManager-51"><a href="#GeoManager-51"><span class="linenos"> 51</span></a><span class="sd">    It should raise only CoaError and derived exceptions in case</span>
</span><span id="GeoManager-52"><a href="#GeoManager-52"><span class="linenos"> 52</span></a><span class="sd">    of errors (see pycoa.error)</span>
</span><span id="GeoManager-53"><a href="#GeoManager-53"><span class="linenos"> 53</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="GeoManager-54"><a href="#GeoManager-54"><span class="linenos"> 54</span></a>
</span><span id="GeoManager-55"><a href="#GeoManager-55"><span class="linenos"> 55</span></a>    <span class="n">_list_standard</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;iso2&#39;</span><span class="p">,</span>   <span class="c1"># Iso2 standard, default</span>
</span><span id="GeoManager-56"><a href="#GeoManager-56"><span class="linenos"> 56</span></a>            <span class="s1">&#39;iso3&#39;</span><span class="p">,</span>           <span class="c1"># Iso3 standard</span>
</span><span id="GeoManager-57"><a href="#GeoManager-57"><span class="linenos"> 57</span></a>            <span class="s1">&#39;name&#39;</span><span class="p">,</span>           <span class="c1"># Standard name ( != Official, caution )</span>
</span><span id="GeoManager-58"><a href="#GeoManager-58"><span class="linenos"> 58</span></a>            <span class="s1">&#39;num&#39;</span><span class="p">]</span>            <span class="c1"># Numeric standard</span>
</span><span id="GeoManager-59"><a href="#GeoManager-59"><span class="linenos"> 59</span></a>
</span><span id="GeoManager-60"><a href="#GeoManager-60"><span class="linenos"> 60</span></a>    <span class="n">_list_db</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;jhu&#39;</span><span class="p">,</span><span class="s1">&#39;worldometers&#39;</span><span class="p">,</span><span class="s1">&#39;owid&#39;</span><span class="p">,</span><span class="s1">&#39;opencovid19national&#39;</span><span class="p">,</span><span class="s1">&#39;spfnational&#39;</span><span class="p">,</span><span class="s1">&#39;mpoxgh&#39;</span><span class="p">]</span> <span class="c1"># first is default</span>
</span><span id="GeoManager-61"><a href="#GeoManager-61"><span class="linenos"> 61</span></a>    <span class="n">_list_output</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;list&#39;</span><span class="p">,</span><span class="s1">&#39;dict&#39;</span><span class="p">,</span><span class="s1">&#39;pandas&#39;</span><span class="p">]</span> <span class="c1"># first is default</span>
</span><span id="GeoManager-62"><a href="#GeoManager-62"><span class="linenos"> 62</span></a>
</span><span id="GeoManager-63"><a href="#GeoManager-63"><span class="linenos"> 63</span></a>    <span class="n">_standard</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># currently used normalisation standard</span>
</span><span id="GeoManager-64"><a href="#GeoManager-64"><span class="linenos"> 64</span></a>
</span><span id="GeoManager-65"><a href="#GeoManager-65"><span class="linenos"> 65</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">standard</span><span class="o">=</span><span class="n">_list_standard</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="GeoManager-66"><a href="#GeoManager-66"><span class="linenos"> 66</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; __init__ member function, with default definition of</span>
</span><span id="GeoManager-67"><a href="#GeoManager-67"><span class="linenos"> 67</span></a><span class="sd">        the used standard. To get the current default standard,</span>
</span><span id="GeoManager-68"><a href="#GeoManager-68"><span class="linenos"> 68</span></a><span class="sd">        see get_list_standard()[0].</span>
</span><span id="GeoManager-69"><a href="#GeoManager-69"><span class="linenos"> 69</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoManager-70"><a href="#GeoManager-70"><span class="linenos"> 70</span></a>        <span class="n">verb</span><span class="p">(</span><span class="s2">&quot;Init of GeoManager() from &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="GeoManager-71"><a href="#GeoManager-71"><span class="linenos"> 71</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_standard</span><span class="p">(</span><span class="n">standard</span><span class="p">)</span>
</span><span id="GeoManager-72"><a href="#GeoManager-72"><span class="linenos"> 72</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_gr</span><span class="o">=</span><span class="n">GeoRegion</span><span class="p">()</span>
</span><span id="GeoManager-73"><a href="#GeoManager-73"><span class="linenos"> 73</span></a>
</span><span id="GeoManager-74"><a href="#GeoManager-74"><span class="linenos"> 74</span></a>    <span class="k">def</span> <span class="nf">get_GeoRegion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GeoManager-75"><a href="#GeoManager-75"><span class="linenos"> 75</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; return the GeoRegion local instance</span>
</span><span id="GeoManager-76"><a href="#GeoManager-76"><span class="linenos"> 76</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoManager-77"><a href="#GeoManager-77"><span class="linenos"> 77</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gr</span>
</span><span id="GeoManager-78"><a href="#GeoManager-78"><span class="linenos"> 78</span></a>
</span><span id="GeoManager-79"><a href="#GeoManager-79"><span class="linenos"> 79</span></a>    <span class="k">def</span> <span class="nf">get_region_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GeoManager-80"><a href="#GeoManager-80"><span class="linenos"> 80</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; return the list of region via the GeoRegion instance</span>
</span><span id="GeoManager-81"><a href="#GeoManager-81"><span class="linenos"> 81</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoManager-82"><a href="#GeoManager-82"><span class="linenos"> 82</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gr</span><span class="o">.</span><span class="n">get_region_list</span><span class="p">()</span>
</span><span id="GeoManager-83"><a href="#GeoManager-83"><span class="linenos"> 83</span></a>
</span><span id="GeoManager-84"><a href="#GeoManager-84"><span class="linenos"> 84</span></a>    <span class="k">def</span> <span class="nf">get_list_standard</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GeoManager-85"><a href="#GeoManager-85"><span class="linenos"> 85</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; return the list of supported standard name of countries.</span>
</span><span id="GeoManager-86"><a href="#GeoManager-86"><span class="linenos"> 86</span></a><span class="sd">        First one is default for the class</span>
</span><span id="GeoManager-87"><a href="#GeoManager-87"><span class="linenos"> 87</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoManager-88"><a href="#GeoManager-88"><span class="linenos"> 88</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_list_standard</span>
</span><span id="GeoManager-89"><a href="#GeoManager-89"><span class="linenos"> 89</span></a>
</span><span id="GeoManager-90"><a href="#GeoManager-90"><span class="linenos"> 90</span></a>    <span class="k">def</span> <span class="nf">get_list_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GeoManager-91"><a href="#GeoManager-91"><span class="linenos"> 91</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; return supported list of output type. First one is default</span>
</span><span id="GeoManager-92"><a href="#GeoManager-92"><span class="linenos"> 92</span></a><span class="sd">        for the class</span>
</span><span id="GeoManager-93"><a href="#GeoManager-93"><span class="linenos"> 93</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoManager-94"><a href="#GeoManager-94"><span class="linenos"> 94</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_list_output</span>
</span><span id="GeoManager-95"><a href="#GeoManager-95"><span class="linenos"> 95</span></a>
</span><span id="GeoManager-96"><a href="#GeoManager-96"><span class="linenos"> 96</span></a>    <span class="k">def</span> <span class="nf">get_list_db</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GeoManager-97"><a href="#GeoManager-97"><span class="linenos"> 97</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; return supported list of database name for translation of</span>
</span><span id="GeoManager-98"><a href="#GeoManager-98"><span class="linenos"> 98</span></a><span class="sd">        country names to standard.</span>
</span><span id="GeoManager-99"><a href="#GeoManager-99"><span class="linenos"> 99</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoManager-100"><a href="#GeoManager-100"><span class="linenos">100</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_list_db</span>
</span><span id="GeoManager-101"><a href="#GeoManager-101"><span class="linenos">101</span></a>
</span><span id="GeoManager-102"><a href="#GeoManager-102"><span class="linenos">102</span></a>    <span class="k">def</span> <span class="nf">get_standard</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GeoManager-103"><a href="#GeoManager-103"><span class="linenos">103</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; return current standard use within the GeoManager class</span>
</span><span id="GeoManager-104"><a href="#GeoManager-104"><span class="linenos">104</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoManager-105"><a href="#GeoManager-105"><span class="linenos">105</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_standard</span>
</span><span id="GeoManager-106"><a href="#GeoManager-106"><span class="linenos">106</span></a>
</span><span id="GeoManager-107"><a href="#GeoManager-107"><span class="linenos">107</span></a>    <span class="k">def</span> <span class="nf">set_standard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">standard</span><span class="p">):</span>
</span><span id="GeoManager-108"><a href="#GeoManager-108"><span class="linenos">108</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GeoManager-109"><a href="#GeoManager-109"><span class="linenos">109</span></a><span class="sd">        set the working standard type within the GeoManager class.</span>
</span><span id="GeoManager-110"><a href="#GeoManager-110"><span class="linenos">110</span></a><span class="sd">        The standard should meet the get_list_standard() requirement</span>
</span><span id="GeoManager-111"><a href="#GeoManager-111"><span class="linenos">111</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoManager-112"><a href="#GeoManager-112"><span class="linenos">112</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">standard</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
</span><span id="GeoManager-113"><a href="#GeoManager-113"><span class="linenos">113</span></a>            <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s1">&#39;GeoManager error, the standard argument&#39;</span>
</span><span id="GeoManager-114"><a href="#GeoManager-114"><span class="linenos">114</span></a>                <span class="s1">&#39; must be a string&#39;</span><span class="p">)</span>
</span><span id="GeoManager-115"><a href="#GeoManager-115"><span class="linenos">115</span></a>        <span class="k">if</span> <span class="n">standard</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list_standard</span><span class="p">():</span>
</span><span id="GeoManager-116"><a href="#GeoManager-116"><span class="linenos">116</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;GeoManager.set_standard error, &quot;&#39;</span><span class="o">+</span>\
</span><span id="GeoManager-117"><a href="#GeoManager-117"><span class="linenos">117</span></a>                                    <span class="n">standard</span><span class="o">+</span><span class="s1">&#39; not managed. Please see &#39;</span>\
</span><span id="GeoManager-118"><a href="#GeoManager-118"><span class="linenos">118</span></a>                                    <span class="s1">&#39;get_list_standard() function&#39;</span><span class="p">)</span>
</span><span id="GeoManager-119"><a href="#GeoManager-119"><span class="linenos">119</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_standard</span><span class="o">=</span><span class="n">standard</span>
</span><span id="GeoManager-120"><a href="#GeoManager-120"><span class="linenos">120</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_standard</span><span class="p">()</span>
</span><span id="GeoManager-121"><a href="#GeoManager-121"><span class="linenos">121</span></a>
</span><span id="GeoManager-122"><a href="#GeoManager-122"><span class="linenos">122</span></a>    <span class="k">def</span> <span class="nf">to_standard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="GeoManager-123"><a href="#GeoManager-123"><span class="linenos">123</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Given a list of string of locations (countries), returns a</span>
</span><span id="GeoManager-124"><a href="#GeoManager-124"><span class="linenos">124</span></a><span class="sd">        normalised list according to the used standard (defined</span>
</span><span id="GeoManager-125"><a href="#GeoManager-125"><span class="linenos">125</span></a><span class="sd">        via the setStandard() or __init__ function. Current default is iso2.</span>
</span><span id="GeoManager-126"><a href="#GeoManager-126"><span class="linenos">126</span></a>
</span><span id="GeoManager-127"><a href="#GeoManager-127"><span class="linenos">127</span></a><span class="sd">        Arguments</span>
</span><span id="GeoManager-128"><a href="#GeoManager-128"><span class="linenos">128</span></a><span class="sd">        -----------------</span>
</span><span id="GeoManager-129"><a href="#GeoManager-129"><span class="linenos">129</span></a><span class="sd">        first arg        --  w, list of string of locations (or single string)</span>
</span><span id="GeoManager-130"><a href="#GeoManager-130"><span class="linenos">130</span></a><span class="sd">                             to convert to standard one</span>
</span><span id="GeoManager-131"><a href="#GeoManager-131"><span class="linenos">131</span></a>
</span><span id="GeoManager-132"><a href="#GeoManager-132"><span class="linenos">132</span></a><span class="sd">        output           -- &#39;list&#39; (default), &#39;dict&#39; or &#39;pandas&#39;</span>
</span><span id="GeoManager-133"><a href="#GeoManager-133"><span class="linenos">133</span></a><span class="sd">        db               -- database name to help conversion.</span>
</span><span id="GeoManager-134"><a href="#GeoManager-134"><span class="linenos">134</span></a><span class="sd">                            Default : None, meaning best effort to convert.</span>
</span><span id="GeoManager-135"><a href="#GeoManager-135"><span class="linenos">135</span></a><span class="sd">                            Known database : jhu, wordometer...</span>
</span><span id="GeoManager-136"><a href="#GeoManager-136"><span class="linenos">136</span></a><span class="sd">                            See get_list_db() for full list of known db for</span>
</span><span id="GeoManager-137"><a href="#GeoManager-137"><span class="linenos">137</span></a><span class="sd">                            standardization</span>
</span><span id="GeoManager-138"><a href="#GeoManager-138"><span class="linenos">138</span></a><span class="sd">        interpret_region -- Boolean, default=False. If yes, the output should</span>
</span><span id="GeoManager-139"><a href="#GeoManager-139"><span class="linenos">139</span></a><span class="sd">                            be only &#39;list&#39;.</span>
</span><span id="GeoManager-140"><a href="#GeoManager-140"><span class="linenos">140</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoManager-141"><a href="#GeoManager-141"><span class="linenos">141</span></a>
</span><span id="GeoManager-142"><a href="#GeoManager-142"><span class="linenos">142</span></a>        <span class="n">kwargs_test</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;output&#39;</span><span class="p">,</span><span class="s1">&#39;db&#39;</span><span class="p">,</span><span class="s1">&#39;interpret_region&#39;</span><span class="p">],</span><span class="s1">&#39;Bad args used in the to_standard() function.&#39;</span><span class="p">)</span>
</span><span id="GeoManager-143"><a href="#GeoManager-143"><span class="linenos">143</span></a>
</span><span id="GeoManager-144"><a href="#GeoManager-144"><span class="linenos">144</span></a>        <span class="n">output</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;output&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">get_list_output</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="GeoManager-145"><a href="#GeoManager-145"><span class="linenos">145</span></a>        <span class="k">if</span> <span class="n">output</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list_output</span><span class="p">():</span>
</span><span id="GeoManager-146"><a href="#GeoManager-146"><span class="linenos">146</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;Incorrect output type. See get_list_output()&#39;</span>
</span><span id="GeoManager-147"><a href="#GeoManager-147"><span class="linenos">147</span></a>                <span class="s1">&#39; or help.&#39;</span><span class="p">)</span>
</span><span id="GeoManager-148"><a href="#GeoManager-148"><span class="linenos">148</span></a>
</span><span id="GeoManager-149"><a href="#GeoManager-149"><span class="linenos">149</span></a>        <span class="n">db</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;db&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">get_list_db</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="GeoManager-150"><a href="#GeoManager-150"><span class="linenos">150</span></a>        <span class="k">if</span> <span class="n">db</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list_db</span><span class="p">():</span>
</span><span id="GeoManager-151"><a href="#GeoManager-151"><span class="linenos">151</span></a>            <span class="k">raise</span> <span class="n">CoaDbError</span><span class="p">(</span><span class="s1">&#39;Unknown database &quot;&#39;</span><span class="o">+</span><span class="n">db</span><span class="o">+</span><span class="s1">&#39;&quot; for translation to &#39;</span>
</span><span id="GeoManager-152"><a href="#GeoManager-152"><span class="linenos">152</span></a>                <span class="s1">&#39;standardized location names. See get_list_db() or help.&#39;</span><span class="p">)</span>
</span><span id="GeoManager-153"><a href="#GeoManager-153"><span class="linenos">153</span></a>
</span><span id="GeoManager-154"><a href="#GeoManager-154"><span class="linenos">154</span></a>        <span class="n">interpret_region</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;interpret_region&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
</span><span id="GeoManager-155"><a href="#GeoManager-155"><span class="linenos">155</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">interpret_region</span><span class="p">,</span><span class="nb">bool</span><span class="p">):</span>
</span><span id="GeoManager-156"><a href="#GeoManager-156"><span class="linenos">156</span></a>            <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s1">&#39;The interpret_region argument is a boolean, &#39;</span>
</span><span id="GeoManager-157"><a href="#GeoManager-157"><span class="linenos">157</span></a>                <span class="s1">&#39;not a &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">interpret_region</span><span class="p">)))</span>
</span><span id="GeoManager-158"><a href="#GeoManager-158"><span class="linenos">158</span></a>
</span><span id="GeoManager-159"><a href="#GeoManager-159"><span class="linenos">159</span></a>        <span class="k">if</span> <span class="n">interpret_region</span><span class="o">==</span><span class="kc">True</span> <span class="ow">and</span> <span class="n">output</span><span class="o">!=</span><span class="s1">&#39;list&#39;</span><span class="p">:</span>
</span><span id="GeoManager-160"><a href="#GeoManager-160"><span class="linenos">160</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;The interpret_region True argument is incompatible &#39;</span>
</span><span id="GeoManager-161"><a href="#GeoManager-161"><span class="linenos">161</span></a>                <span class="s1">&#39;with non list output option.&#39;</span><span class="p">)</span>
</span><span id="GeoManager-162"><a href="#GeoManager-162"><span class="linenos">162</span></a>
</span><span id="GeoManager-163"><a href="#GeoManager-163"><span class="linenos">163</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
</span><span id="GeoManager-164"><a href="#GeoManager-164"><span class="linenos">164</span></a>            <span class="n">w</span><span class="o">=</span><span class="p">[</span><span class="n">w</span><span class="p">]</span>
</span><span id="GeoManager-165"><a href="#GeoManager-165"><span class="linenos">165</span></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
</span><span id="GeoManager-166"><a href="#GeoManager-166"><span class="linenos">166</span></a>            <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s1">&#39;Waiting for str, list of str or pandas&#39;</span>
</span><span id="GeoManager-167"><a href="#GeoManager-167"><span class="linenos">167</span></a>                <span class="s1">&#39;as input of get_standard function member of GeoManager&#39;</span><span class="p">)</span>
</span><span id="GeoManager-168"><a href="#GeoManager-168"><span class="linenos">168</span></a>
</span><span id="GeoManager-169"><a href="#GeoManager-169"><span class="linenos">169</span></a>        <span class="n">w</span><span class="o">=</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">title</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">w</span><span class="p">]</span> <span class="c1"># capitalize first letter of each name</span>
</span><span id="GeoManager-170"><a href="#GeoManager-170"><span class="linenos">170</span></a>
</span><span id="GeoManager-171"><a href="#GeoManager-171"><span class="linenos">171</span></a>        <span class="n">w0</span><span class="o">=</span><span class="n">w</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="GeoManager-172"><a href="#GeoManager-172"><span class="linenos">172</span></a>
</span><span id="GeoManager-173"><a href="#GeoManager-173"><span class="linenos">173</span></a>        <span class="k">if</span> <span class="n">db</span><span class="p">:</span>
</span><span id="GeoManager-174"><a href="#GeoManager-174"><span class="linenos">174</span></a>            <span class="n">w</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">first_db_translation</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">db</span><span class="p">)</span>
</span><span id="GeoManager-175"><a href="#GeoManager-175"><span class="linenos">175</span></a>        <span class="n">n</span><span class="o">=</span><span class="p">[]</span> <span class="c1"># will contain standardized name of countries (if possible)</span>
</span><span id="GeoManager-176"><a href="#GeoManager-176"><span class="linenos">176</span></a>
</span><span id="GeoManager-177"><a href="#GeoManager-177"><span class="linenos">177</span></a>        <span class="c1">#for c in w:</span>
</span><span id="GeoManager-178"><a href="#GeoManager-178"><span class="linenos">178</span></a>        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
</span><span id="GeoManager-179"><a href="#GeoManager-179"><span class="linenos">179</span></a>            <span class="n">c</span><span class="o">=</span><span class="n">w</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="GeoManager-180"><a href="#GeoManager-180"><span class="linenos">180</span></a>            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">==</span><span class="nb">int</span><span class="p">:</span>
</span><span id="GeoManager-181"><a href="#GeoManager-181"><span class="linenos">181</span></a>                <span class="n">c</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</span><span id="GeoManager-182"><a href="#GeoManager-182"><span class="linenos">182</span></a>            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">!=</span><span class="nb">str</span><span class="p">:</span>
</span><span id="GeoManager-183"><a href="#GeoManager-183"><span class="linenos">183</span></a>                <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s1">&#39;Locations should be given as &#39;</span>
</span><span id="GeoManager-184"><a href="#GeoManager-184"><span class="linenos">184</span></a>                    <span class="s1">&#39;strings or integers only&#39;</span><span class="p">)</span>
</span><span id="GeoManager-185"><a href="#GeoManager-185"><span class="linenos">185</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gr</span><span class="o">.</span><span class="n">get_region_list</span><span class="p">())</span> <span class="ow">and</span> <span class="n">interpret_region</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="GeoManager-186"><a href="#GeoManager-186"><span class="linenos">186</span></a>                <span class="n">w</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_gr</span><span class="o">.</span><span class="n">get_countries_from_region</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">+</span><span class="n">w</span>
</span><span id="GeoManager-187"><a href="#GeoManager-187"><span class="linenos">187</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="GeoManager-188"><a href="#GeoManager-188"><span class="linenos">188</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
</span><span id="GeoManager-189"><a href="#GeoManager-189"><span class="linenos">189</span></a>                    <span class="n">n1</span><span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="c1">#None</span>
</span><span id="GeoManager-190"><a href="#GeoManager-190"><span class="linenos">190</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="GeoManager-191"><a href="#GeoManager-191"><span class="linenos">191</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="GeoManager-192"><a href="#GeoManager-192"><span class="linenos">192</span></a>                        <span class="n">n0</span><span class="o">=</span><span class="n">pc</span><span class="o">.</span><span class="n">countries</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</span><span id="GeoManager-193"><a href="#GeoManager-193"><span class="linenos">193</span></a>                    <span class="k">except</span> <span class="ne">LookupError</span><span class="p">:</span>
</span><span id="GeoManager-194"><a href="#GeoManager-194"><span class="linenos">194</span></a>                        <span class="k">try</span><span class="p">:</span>
</span><span id="GeoManager-195"><a href="#GeoManager-195"><span class="linenos">195</span></a>                            <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Owid_&#39;</span><span class="p">):</span>
</span><span id="GeoManager-196"><a href="#GeoManager-196"><span class="linenos">196</span></a>                                <span class="n">nf</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;owid_*&#39;</span><span class="p">]</span>
</span><span id="GeoManager-197"><a href="#GeoManager-197"><span class="linenos">197</span></a>                                <span class="n">n1</span><span class="o">=</span><span class="s1">&#39;OWID_*&#39;</span>
</span><span id="GeoManager-198"><a href="#GeoManager-198"><span class="linenos">198</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="GeoManager-199"><a href="#GeoManager-199"><span class="linenos">199</span></a>                                <span class="n">nf</span><span class="o">=</span><span class="n">pc</span><span class="o">.</span><span class="n">countries</span><span class="o">.</span><span class="n">search_fuzzy</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</span><span id="GeoManager-200"><a href="#GeoManager-200"><span class="linenos">200</span></a>                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nf</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
</span><span id="GeoManager-201"><a href="#GeoManager-201"><span class="linenos">201</span></a>                                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Caution. More than one country match the key &quot;&#39;</span><span class="o">+</span>\
</span><span id="GeoManager-202"><a href="#GeoManager-202"><span class="linenos">202</span></a>                                <span class="n">c</span><span class="o">+</span><span class="s1">&#39;&quot; : &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">([</span> <span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;, &#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">nf</span><span class="p">])</span><span class="o">+</span>\
</span><span id="GeoManager-203"><a href="#GeoManager-203"><span class="linenos">203</span></a>                                <span class="s1">&#39;, using first one.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="GeoManager-204"><a href="#GeoManager-204"><span class="linenos">204</span></a>                            <span class="n">n0</span><span class="o">=</span><span class="n">nf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GeoManager-205"><a href="#GeoManager-205"><span class="linenos">205</span></a>                        <span class="k">except</span> <span class="ne">LookupError</span><span class="p">:</span>
</span><span id="GeoManager-206"><a href="#GeoManager-206"><span class="linenos">206</span></a>                            <span class="k">raise</span> <span class="n">CoaLookupError</span><span class="p">(</span><span class="s1">&#39;No country match the key &quot;&#39;</span><span class="o">+</span><span class="n">c</span><span class="o">+</span><span class="s1">&#39;&quot;. Error.&#39;</span><span class="p">)</span>
</span><span id="GeoManager-207"><a href="#GeoManager-207"><span class="linenos">207</span></a>                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e1</span><span class="p">:</span>
</span><span id="GeoManager-208"><a href="#GeoManager-208"><span class="linenos">208</span></a>                            <span class="k">raise</span> <span class="n">CoaNotManagedError</span><span class="p">(</span><span class="s1">&#39;Not managed error &#39;</span><span class="o">+</span><span class="nb">type</span><span class="p">(</span><span class="n">e1</span><span class="p">))</span>
</span><span id="GeoManager-209"><a href="#GeoManager-209"><span class="linenos">209</span></a>                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e2</span><span class="p">:</span>
</span><span id="GeoManager-210"><a href="#GeoManager-210"><span class="linenos">210</span></a>                        <span class="k">raise</span> <span class="n">CoaNotManagedError</span><span class="p">(</span><span class="s1">&#39;Not managed error&#39;</span><span class="o">+</span><span class="nb">type</span><span class="p">(</span><span class="n">e1</span><span class="p">))</span>
</span><span id="GeoManager-211"><a href="#GeoManager-211"><span class="linenos">211</span></a>
</span><span id="GeoManager-212"><a href="#GeoManager-212"><span class="linenos">212</span></a>                    <span class="k">if</span> <span class="n">n0</span> <span class="o">!=</span> <span class="s1">&#39;owid_*&#39;</span><span class="p">:</span>
</span><span id="GeoManager-213"><a href="#GeoManager-213"><span class="linenos">213</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_standard</span><span class="o">==</span><span class="s1">&#39;iso2&#39;</span><span class="p">:</span>
</span><span id="GeoManager-214"><a href="#GeoManager-214"><span class="linenos">214</span></a>                            <span class="n">n1</span><span class="o">=</span><span class="n">n0</span><span class="o">.</span><span class="n">alpha_2</span>
</span><span id="GeoManager-215"><a href="#GeoManager-215"><span class="linenos">215</span></a>                        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_standard</span><span class="o">==</span><span class="s1">&#39;iso3&#39;</span><span class="p">:</span>
</span><span id="GeoManager-216"><a href="#GeoManager-216"><span class="linenos">216</span></a>                            <span class="n">n1</span><span class="o">=</span><span class="n">n0</span><span class="o">.</span><span class="n">alpha_3</span>
</span><span id="GeoManager-217"><a href="#GeoManager-217"><span class="linenos">217</span></a>                        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_standard</span><span class="o">==</span><span class="s1">&#39;name&#39;</span><span class="p">:</span>
</span><span id="GeoManager-218"><a href="#GeoManager-218"><span class="linenos">218</span></a>                            <span class="n">n1</span><span class="o">=</span><span class="n">n0</span><span class="o">.</span><span class="n">name</span>
</span><span id="GeoManager-219"><a href="#GeoManager-219"><span class="linenos">219</span></a>                        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_standard</span><span class="o">==</span><span class="s1">&#39;num&#39;</span><span class="p">:</span>
</span><span id="GeoManager-220"><a href="#GeoManager-220"><span class="linenos">220</span></a>                            <span class="n">n1</span><span class="o">=</span><span class="n">n0</span><span class="o">.</span><span class="n">numeric</span>
</span><span id="GeoManager-221"><a href="#GeoManager-221"><span class="linenos">221</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="GeoManager-222"><a href="#GeoManager-222"><span class="linenos">222</span></a>                            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;Current standard is &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_standard</span><span class="o">+</span>\
</span><span id="GeoManager-223"><a href="#GeoManager-223"><span class="linenos">223</span></a>                                <span class="s1">&#39; which is not managed. Error.&#39;</span><span class="p">)</span>
</span><span id="GeoManager-224"><a href="#GeoManager-224"><span class="linenos">224</span></a>
</span><span id="GeoManager-225"><a href="#GeoManager-225"><span class="linenos">225</span></a>                <span class="n">n</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n1</span><span class="p">)</span>
</span><span id="GeoManager-226"><a href="#GeoManager-226"><span class="linenos">226</span></a>
</span><span id="GeoManager-227"><a href="#GeoManager-227"><span class="linenos">227</span></a>        <span class="k">if</span> <span class="n">output</span><span class="o">==</span><span class="s1">&#39;list&#39;</span><span class="p">:</span>
</span><span id="GeoManager-228"><a href="#GeoManager-228"><span class="linenos">228</span></a>            <span class="k">return</span> <span class="n">n</span>
</span><span id="GeoManager-229"><a href="#GeoManager-229"><span class="linenos">229</span></a>        <span class="k">elif</span> <span class="n">output</span><span class="o">==</span><span class="s1">&#39;dict&#39;</span><span class="p">:</span>
</span><span id="GeoManager-230"><a href="#GeoManager-230"><span class="linenos">230</span></a>            <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">w0</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
</span><span id="GeoManager-231"><a href="#GeoManager-231"><span class="linenos">231</span></a>        <span class="k">elif</span> <span class="n">output</span><span class="o">==</span><span class="s1">&#39;pandas&#39;</span><span class="p">:</span>
</span><span id="GeoManager-232"><a href="#GeoManager-232"><span class="linenos">232</span></a>            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([{</span><span class="s1">&#39;inputname&#39;</span><span class="p">:</span><span class="n">w0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_standard</span><span class="p">:</span><span class="n">n</span><span class="p">}])</span>
</span><span id="GeoManager-233"><a href="#GeoManager-233"><span class="linenos">233</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GeoManager-234"><a href="#GeoManager-234"><span class="linenos">234</span></a>            <span class="k">return</span> <span class="kc">None</span> <span class="c1"># should not be here</span>
</span><span id="GeoManager-235"><a href="#GeoManager-235"><span class="linenos">235</span></a>
</span><span id="GeoManager-236"><a href="#GeoManager-236"><span class="linenos">236</span></a>    <span class="k">def</span> <span class="nf">first_db_translation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">db</span><span class="p">):</span>
</span><span id="GeoManager-237"><a href="#GeoManager-237"><span class="linenos">237</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; This function helps to translate from country name to</span>
</span><span id="GeoManager-238"><a href="#GeoManager-238"><span class="linenos">238</span></a><span class="sd">        standard for specific databases. It&#39;s the first step</span>
</span><span id="GeoManager-239"><a href="#GeoManager-239"><span class="linenos">239</span></a><span class="sd">        before final translation.</span>
</span><span id="GeoManager-240"><a href="#GeoManager-240"><span class="linenos">240</span></a>
</span><span id="GeoManager-241"><a href="#GeoManager-241"><span class="linenos">241</span></a><span class="sd">        One can easily add some database support adding some new rules</span>
</span><span id="GeoManager-242"><a href="#GeoManager-242"><span class="linenos">242</span></a><span class="sd">        for specific databases</span>
</span><span id="GeoManager-243"><a href="#GeoManager-243"><span class="linenos">243</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoManager-244"><a href="#GeoManager-244"><span class="linenos">244</span></a>        <span class="n">translation_dict</span><span class="o">=</span><span class="p">{}</span>
</span><span id="GeoManager-245"><a href="#GeoManager-245"><span class="linenos">245</span></a>        <span class="c1"># Caution : keys need to be in title mode, i.e. first letter capitalized</span>
</span><span id="GeoManager-246"><a href="#GeoManager-246"><span class="linenos">246</span></a>        <span class="k">if</span> <span class="n">db</span><span class="o">==</span><span class="s1">&#39;jhu&#39;</span><span class="p">:</span>
</span><span id="GeoManager-247"><a href="#GeoManager-247"><span class="linenos">247</span></a>            <span class="n">translation_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>\
</span><span id="GeoManager-248"><a href="#GeoManager-248"><span class="linenos">248</span></a>                <span class="s2">&quot;Congo (Brazzaville)&quot;</span><span class="p">:</span><span class="s2">&quot;Republic of the Congo&quot;</span><span class="p">,</span>\
</span><span id="GeoManager-249"><a href="#GeoManager-249"><span class="linenos">249</span></a>                <span class="s2">&quot;Congo (Kinshasa)&quot;</span><span class="p">:</span><span class="s2">&quot;COD&quot;</span><span class="p">,</span>\
</span><span id="GeoManager-250"><a href="#GeoManager-250"><span class="linenos">250</span></a>                <span class="s2">&quot;Korea, South&quot;</span><span class="p">:</span><span class="s2">&quot;KOR&quot;</span><span class="p">,</span>\
</span><span id="GeoManager-251"><a href="#GeoManager-251"><span class="linenos">251</span></a>                <span class="s2">&quot;Taiwan*&quot;</span><span class="p">:</span><span class="s2">&quot;Taiwan&quot;</span><span class="p">,</span>\
</span><span id="GeoManager-252"><a href="#GeoManager-252"><span class="linenos">252</span></a>                <span class="s2">&quot;Laos&quot;</span><span class="p">:</span><span class="s2">&quot;LAO&quot;</span><span class="p">,</span>\
</span><span id="GeoManager-253"><a href="#GeoManager-253"><span class="linenos">253</span></a>                <span class="s2">&quot;West Bank And Gaza&quot;</span><span class="p">:</span><span class="s2">&quot;PSE&quot;</span><span class="p">,</span>\
</span><span id="GeoManager-254"><a href="#GeoManager-254"><span class="linenos">254</span></a>                <span class="s2">&quot;Burma&quot;</span><span class="p">:</span><span class="s2">&quot;Myanmar&quot;</span><span class="p">,</span>\
</span><span id="GeoManager-255"><a href="#GeoManager-255"><span class="linenos">255</span></a>                <span class="s2">&quot;Iran&quot;</span><span class="p">:</span><span class="s2">&quot;IRN&quot;</span><span class="p">,</span>\
</span><span id="GeoManager-256"><a href="#GeoManager-256"><span class="linenos">256</span></a>                <span class="s2">&quot;Diamond Princess&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span>\
</span><span id="GeoManager-257"><a href="#GeoManager-257"><span class="linenos">257</span></a>                <span class="s2">&quot;Ms Zaandam&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span>\
</span><span id="GeoManager-258"><a href="#GeoManager-258"><span class="linenos">258</span></a>                <span class="s2">&quot;Summer Olympics 2020&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span>\
</span><span id="GeoManager-259"><a href="#GeoManager-259"><span class="linenos">259</span></a>                <span class="s2">&quot;Micronesia&quot;</span><span class="p">:</span><span class="s2">&quot;FSM&quot;</span><span class="p">,</span>\
</span><span id="GeoManager-260"><a href="#GeoManager-260"><span class="linenos">260</span></a>                <span class="s2">&quot;Winter Olympics 2022&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span>\
</span><span id="GeoManager-261"><a href="#GeoManager-261"><span class="linenos">261</span></a>                <span class="s2">&quot;Antarctica&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span>\
</span><span id="GeoManager-262"><a href="#GeoManager-262"><span class="linenos">262</span></a>                <span class="s2">&quot;Korea, North&quot;</span><span class="p">:</span><span class="s2">&quot;PRK&quot;</span><span class="p">,</span>\
</span><span id="GeoManager-263"><a href="#GeoManager-263"><span class="linenos">263</span></a>                    <span class="p">})</span>  <span class="c1"># last two are names of boats</span>
</span><span id="GeoManager-264"><a href="#GeoManager-264"><span class="linenos">264</span></a>        <span class="k">elif</span> <span class="n">db</span><span class="o">==</span><span class="s1">&#39;worldometers&#39;</span><span class="p">:</span>
</span><span id="GeoManager-265"><a href="#GeoManager-265"><span class="linenos">265</span></a>            <span class="n">translation_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>\
</span><span id="GeoManager-266"><a href="#GeoManager-266"><span class="linenos">266</span></a>                <span class="s2">&quot;Dr Congo&quot;</span><span class="p">:</span><span class="s2">&quot;COD&quot;</span><span class="p">,</span>\
</span><span id="GeoManager-267"><a href="#GeoManager-267"><span class="linenos">267</span></a>                <span class="s2">&quot;Congo&quot;</span><span class="p">:</span><span class="s2">&quot;COG&quot;</span><span class="p">,</span>\
</span><span id="GeoManager-268"><a href="#GeoManager-268"><span class="linenos">268</span></a>                <span class="s2">&quot;Iran&quot;</span><span class="p">:</span><span class="s2">&quot;IRN&quot;</span><span class="p">,</span>\
</span><span id="GeoManager-269"><a href="#GeoManager-269"><span class="linenos">269</span></a>                <span class="s2">&quot;South Korea&quot;</span><span class="p">:</span><span class="s2">&quot;KOR&quot;</span><span class="p">,</span>\
</span><span id="GeoManager-270"><a href="#GeoManager-270"><span class="linenos">270</span></a>                <span class="s2">&quot;North Korea&quot;</span><span class="p">:</span><span class="s2">&quot;PRK&quot;</span><span class="p">,</span>\
</span><span id="GeoManager-271"><a href="#GeoManager-271"><span class="linenos">271</span></a>                <span class="s2">&quot;Czech Republic (Czechia)&quot;</span><span class="p">:</span><span class="s2">&quot;CZE&quot;</span><span class="p">,</span>\
</span><span id="GeoManager-272"><a href="#GeoManager-272"><span class="linenos">272</span></a>                <span class="s2">&quot;Laos&quot;</span><span class="p">:</span><span class="s2">&quot;LAO&quot;</span><span class="p">,</span>\
</span><span id="GeoManager-273"><a href="#GeoManager-273"><span class="linenos">273</span></a>                <span class="s2">&quot;Sao Tome &amp; Principe&quot;</span><span class="p">:</span><span class="s2">&quot;STP&quot;</span><span class="p">,</span>\
</span><span id="GeoManager-274"><a href="#GeoManager-274"><span class="linenos">274</span></a>                <span class="s2">&quot;Channel Islands&quot;</span><span class="p">:</span><span class="s2">&quot;JEY&quot;</span><span class="p">,</span>\
</span><span id="GeoManager-275"><a href="#GeoManager-275"><span class="linenos">275</span></a>                <span class="s2">&quot;St. Vincent &amp; Grenadines&quot;</span><span class="p">:</span><span class="s2">&quot;VCT&quot;</span><span class="p">,</span>\
</span><span id="GeoManager-276"><a href="#GeoManager-276"><span class="linenos">276</span></a>                <span class="s2">&quot;U.S. Virgin Islands&quot;</span><span class="p">:</span><span class="s2">&quot;VIR&quot;</span><span class="p">,</span>\
</span><span id="GeoManager-277"><a href="#GeoManager-277"><span class="linenos">277</span></a>                <span class="s2">&quot;Saint Kitts &amp; Nevis&quot;</span><span class="p">:</span><span class="s2">&quot;KNA&quot;</span><span class="p">,</span>\
</span><span id="GeoManager-278"><a href="#GeoManager-278"><span class="linenos">278</span></a>                <span class="s2">&quot;Faeroe Islands&quot;</span><span class="p">:</span><span class="s2">&quot;FRO&quot;</span><span class="p">,</span>\
</span><span id="GeoManager-279"><a href="#GeoManager-279"><span class="linenos">279</span></a>                <span class="s2">&quot;Caribbean Netherlands&quot;</span><span class="p">:</span><span class="s2">&quot;BES&quot;</span><span class="p">,</span>\
</span><span id="GeoManager-280"><a href="#GeoManager-280"><span class="linenos">280</span></a>                <span class="s2">&quot;Wallis &amp; Futuna&quot;</span><span class="p">:</span><span class="s2">&quot;WLF&quot;</span><span class="p">,</span>\
</span><span id="GeoManager-281"><a href="#GeoManager-281"><span class="linenos">281</span></a>                <span class="s2">&quot;Saint Pierre &amp; Miquelon&quot;</span><span class="p">:</span><span class="s2">&quot;SPM&quot;</span><span class="p">,</span>\
</span><span id="GeoManager-282"><a href="#GeoManager-282"><span class="linenos">282</span></a>                <span class="s2">&quot;Sint Maarten&quot;</span><span class="p">:</span><span class="s2">&quot;SXM&quot;</span><span class="p">,</span>\
</span><span id="GeoManager-283"><a href="#GeoManager-283"><span class="linenos">283</span></a>                <span class="p">}</span> <span class="p">)</span>
</span><span id="GeoManager-284"><a href="#GeoManager-284"><span class="linenos">284</span></a>        <span class="k">elif</span> <span class="n">db</span><span class="o">==</span><span class="s1">&#39;owid&#39;</span><span class="p">:</span>
</span><span id="GeoManager-285"><a href="#GeoManager-285"><span class="linenos">285</span></a>            <span class="n">translation_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>\
</span><span id="GeoManager-286"><a href="#GeoManager-286"><span class="linenos">286</span></a>                    <span class="s2">&quot;Bonaire Sint Eustatius And Saba&quot;</span><span class="p">:</span><span class="s2">&quot;BES&quot;</span><span class="p">,</span>\
</span><span id="GeoManager-287"><a href="#GeoManager-287"><span class="linenos">287</span></a>                    <span class="s2">&quot;Cape Verde&quot;</span><span class="p">:</span><span class="s2">&quot;CPV&quot;</span><span class="p">,</span>\
</span><span id="GeoManager-288"><a href="#GeoManager-288"><span class="linenos">288</span></a>                    <span class="s2">&quot;Democratic Republic Of Congo&quot;</span><span class="p">:</span><span class="s2">&quot;COD&quot;</span><span class="p">,</span>\
</span><span id="GeoManager-289"><a href="#GeoManager-289"><span class="linenos">289</span></a>                    <span class="s2">&quot;Faeroe Islands&quot;</span><span class="p">:</span><span class="s2">&quot;FRO&quot;</span><span class="p">,</span>\
</span><span id="GeoManager-290"><a href="#GeoManager-290"><span class="linenos">290</span></a>                    <span class="s2">&quot;Laos&quot;</span><span class="p">:</span><span class="s2">&quot;LAO&quot;</span><span class="p">,</span>\
</span><span id="GeoManager-291"><a href="#GeoManager-291"><span class="linenos">291</span></a>                    <span class="s2">&quot;South Korea&quot;</span><span class="p">:</span><span class="s2">&quot;KOR&quot;</span><span class="p">,</span>\
</span><span id="GeoManager-292"><a href="#GeoManager-292"><span class="linenos">292</span></a>                    <span class="s2">&quot;Swaziland&quot;</span><span class="p">:</span><span class="s2">&quot;SWZ&quot;</span><span class="p">,</span>\
</span><span id="GeoManager-293"><a href="#GeoManager-293"><span class="linenos">293</span></a>                    <span class="s2">&quot;United States Virgin Islands&quot;</span><span class="p">:</span><span class="s2">&quot;VIR&quot;</span><span class="p">,</span>\
</span><span id="GeoManager-294"><a href="#GeoManager-294"><span class="linenos">294</span></a>                    <span class="s2">&quot;Iran&quot;</span><span class="p">:</span><span class="s2">&quot;IRN&quot;</span><span class="p">,</span>\
</span><span id="GeoManager-295"><a href="#GeoManager-295"><span class="linenos">295</span></a>                    <span class="s2">&quot;Micronesia (Country)&quot;</span><span class="p">:</span><span class="s2">&quot;FSM&quot;</span><span class="p">,</span>\
</span><span id="GeoManager-296"><a href="#GeoManager-296"><span class="linenos">296</span></a>                    <span class="s2">&quot;Northern Cyprus&quot;</span><span class="p">:</span><span class="s2">&quot;CYP&quot;</span><span class="p">,</span>\
</span><span id="GeoManager-297"><a href="#GeoManager-297"><span class="linenos">297</span></a>                    <span class="s2">&quot;Curacao&quot;</span><span class="p">:</span><span class="s2">&quot;CUW&quot;</span><span class="p">,</span>\
</span><span id="GeoManager-298"><a href="#GeoManager-298"><span class="linenos">298</span></a>                    <span class="s2">&quot;Faeroe Islands&quot;</span><span class="p">:</span><span class="s2">&quot;FRO&quot;</span><span class="p">,</span>\
</span><span id="GeoManager-299"><a href="#GeoManager-299"><span class="linenos">299</span></a>                    <span class="s2">&quot;Vatican&quot;</span><span class="p">:</span><span class="s2">&quot;VAT&quot;</span>
</span><span id="GeoManager-300"><a href="#GeoManager-300"><span class="linenos">300</span></a>                <span class="p">})</span>
</span><span id="GeoManager-301"><a href="#GeoManager-301"><span class="linenos">301</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">translation_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">w</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>GeoManager class definition. No inheritance from any other class.</p>

<p>It should raise only CoaError and derived exceptions in case
of errors (see pycoa.error)</p>
</div>


                            <div id="GeoManager.__init__" class="classattr">
                                        <input id="GeoManager.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">GeoManager</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">standard</span><span class="o">=</span><span class="s1">&#39;iso2&#39;</span></span>)</span>

                <label class="view-source-button" for="GeoManager.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GeoManager.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GeoManager.__init__-65"><a href="#GeoManager.__init__-65"><span class="linenos">65</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">standard</span><span class="o">=</span><span class="n">_list_standard</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="GeoManager.__init__-66"><a href="#GeoManager.__init__-66"><span class="linenos">66</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; __init__ member function, with default definition of</span>
</span><span id="GeoManager.__init__-67"><a href="#GeoManager.__init__-67"><span class="linenos">67</span></a><span class="sd">        the used standard. To get the current default standard,</span>
</span><span id="GeoManager.__init__-68"><a href="#GeoManager.__init__-68"><span class="linenos">68</span></a><span class="sd">        see get_list_standard()[0].</span>
</span><span id="GeoManager.__init__-69"><a href="#GeoManager.__init__-69"><span class="linenos">69</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoManager.__init__-70"><a href="#GeoManager.__init__-70"><span class="linenos">70</span></a>        <span class="n">verb</span><span class="p">(</span><span class="s2">&quot;Init of GeoManager() from &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="GeoManager.__init__-71"><a href="#GeoManager.__init__-71"><span class="linenos">71</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_standard</span><span class="p">(</span><span class="n">standard</span><span class="p">)</span>
</span><span id="GeoManager.__init__-72"><a href="#GeoManager.__init__-72"><span class="linenos">72</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_gr</span><span class="o">=</span><span class="n">GeoRegion</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>__init__ member function, with default definition of
the used standard. To get the current default standard,
see get_list_standard()[0].</p>
</div>


                            </div>
                            <div id="GeoManager.get_GeoRegion" class="classattr">
                                        <input id="GeoManager.get_GeoRegion-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_GeoRegion</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GeoManager.get_GeoRegion-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GeoManager.get_GeoRegion"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GeoManager.get_GeoRegion-74"><a href="#GeoManager.get_GeoRegion-74"><span class="linenos">74</span></a>    <span class="k">def</span> <span class="nf">get_GeoRegion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GeoManager.get_GeoRegion-75"><a href="#GeoManager.get_GeoRegion-75"><span class="linenos">75</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; return the GeoRegion local instance</span>
</span><span id="GeoManager.get_GeoRegion-76"><a href="#GeoManager.get_GeoRegion-76"><span class="linenos">76</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoManager.get_GeoRegion-77"><a href="#GeoManager.get_GeoRegion-77"><span class="linenos">77</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gr</span>
</span></pre></div>


            <div class="docstring"><p>return the GeoRegion local instance</p>
</div>


                            </div>
                            <div id="GeoManager.get_region_list" class="classattr">
                                        <input id="GeoManager.get_region_list-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_region_list</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GeoManager.get_region_list-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GeoManager.get_region_list"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GeoManager.get_region_list-79"><a href="#GeoManager.get_region_list-79"><span class="linenos">79</span></a>    <span class="k">def</span> <span class="nf">get_region_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GeoManager.get_region_list-80"><a href="#GeoManager.get_region_list-80"><span class="linenos">80</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; return the list of region via the GeoRegion instance</span>
</span><span id="GeoManager.get_region_list-81"><a href="#GeoManager.get_region_list-81"><span class="linenos">81</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoManager.get_region_list-82"><a href="#GeoManager.get_region_list-82"><span class="linenos">82</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gr</span><span class="o">.</span><span class="n">get_region_list</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>return the list of region via the GeoRegion instance</p>
</div>


                            </div>
                            <div id="GeoManager.get_list_standard" class="classattr">
                                        <input id="GeoManager.get_list_standard-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_list_standard</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GeoManager.get_list_standard-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GeoManager.get_list_standard"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GeoManager.get_list_standard-84"><a href="#GeoManager.get_list_standard-84"><span class="linenos">84</span></a>    <span class="k">def</span> <span class="nf">get_list_standard</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GeoManager.get_list_standard-85"><a href="#GeoManager.get_list_standard-85"><span class="linenos">85</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; return the list of supported standard name of countries.</span>
</span><span id="GeoManager.get_list_standard-86"><a href="#GeoManager.get_list_standard-86"><span class="linenos">86</span></a><span class="sd">        First one is default for the class</span>
</span><span id="GeoManager.get_list_standard-87"><a href="#GeoManager.get_list_standard-87"><span class="linenos">87</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoManager.get_list_standard-88"><a href="#GeoManager.get_list_standard-88"><span class="linenos">88</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_list_standard</span>
</span></pre></div>


            <div class="docstring"><p>return the list of supported standard name of countries.
First one is default for the class</p>
</div>


                            </div>
                            <div id="GeoManager.get_list_output" class="classattr">
                                        <input id="GeoManager.get_list_output-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_list_output</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GeoManager.get_list_output-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GeoManager.get_list_output"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GeoManager.get_list_output-90"><a href="#GeoManager.get_list_output-90"><span class="linenos">90</span></a>    <span class="k">def</span> <span class="nf">get_list_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GeoManager.get_list_output-91"><a href="#GeoManager.get_list_output-91"><span class="linenos">91</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; return supported list of output type. First one is default</span>
</span><span id="GeoManager.get_list_output-92"><a href="#GeoManager.get_list_output-92"><span class="linenos">92</span></a><span class="sd">        for the class</span>
</span><span id="GeoManager.get_list_output-93"><a href="#GeoManager.get_list_output-93"><span class="linenos">93</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoManager.get_list_output-94"><a href="#GeoManager.get_list_output-94"><span class="linenos">94</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_list_output</span>
</span></pre></div>


            <div class="docstring"><p>return supported list of output type. First one is default
for the class</p>
</div>


                            </div>
                            <div id="GeoManager.get_list_db" class="classattr">
                                        <input id="GeoManager.get_list_db-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_list_db</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GeoManager.get_list_db-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GeoManager.get_list_db"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GeoManager.get_list_db-96"><a href="#GeoManager.get_list_db-96"><span class="linenos"> 96</span></a>    <span class="k">def</span> <span class="nf">get_list_db</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GeoManager.get_list_db-97"><a href="#GeoManager.get_list_db-97"><span class="linenos"> 97</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; return supported list of database name for translation of</span>
</span><span id="GeoManager.get_list_db-98"><a href="#GeoManager.get_list_db-98"><span class="linenos"> 98</span></a><span class="sd">        country names to standard.</span>
</span><span id="GeoManager.get_list_db-99"><a href="#GeoManager.get_list_db-99"><span class="linenos"> 99</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoManager.get_list_db-100"><a href="#GeoManager.get_list_db-100"><span class="linenos">100</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_list_db</span>
</span></pre></div>


            <div class="docstring"><p>return supported list of database name for translation of
country names to standard.</p>
</div>


                            </div>
                            <div id="GeoManager.get_standard" class="classattr">
                                        <input id="GeoManager.get_standard-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_standard</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GeoManager.get_standard-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GeoManager.get_standard"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GeoManager.get_standard-102"><a href="#GeoManager.get_standard-102"><span class="linenos">102</span></a>    <span class="k">def</span> <span class="nf">get_standard</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GeoManager.get_standard-103"><a href="#GeoManager.get_standard-103"><span class="linenos">103</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; return current standard use within the GeoManager class</span>
</span><span id="GeoManager.get_standard-104"><a href="#GeoManager.get_standard-104"><span class="linenos">104</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoManager.get_standard-105"><a href="#GeoManager.get_standard-105"><span class="linenos">105</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_standard</span>
</span></pre></div>


            <div class="docstring"><p>return current standard use within the GeoManager class</p>
</div>


                            </div>
                            <div id="GeoManager.set_standard" class="classattr">
                                        <input id="GeoManager.set_standard-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_standard</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">standard</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GeoManager.set_standard-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GeoManager.set_standard"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GeoManager.set_standard-107"><a href="#GeoManager.set_standard-107"><span class="linenos">107</span></a>    <span class="k">def</span> <span class="nf">set_standard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">standard</span><span class="p">):</span>
</span><span id="GeoManager.set_standard-108"><a href="#GeoManager.set_standard-108"><span class="linenos">108</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GeoManager.set_standard-109"><a href="#GeoManager.set_standard-109"><span class="linenos">109</span></a><span class="sd">        set the working standard type within the GeoManager class.</span>
</span><span id="GeoManager.set_standard-110"><a href="#GeoManager.set_standard-110"><span class="linenos">110</span></a><span class="sd">        The standard should meet the get_list_standard() requirement</span>
</span><span id="GeoManager.set_standard-111"><a href="#GeoManager.set_standard-111"><span class="linenos">111</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoManager.set_standard-112"><a href="#GeoManager.set_standard-112"><span class="linenos">112</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">standard</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
</span><span id="GeoManager.set_standard-113"><a href="#GeoManager.set_standard-113"><span class="linenos">113</span></a>            <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s1">&#39;GeoManager error, the standard argument&#39;</span>
</span><span id="GeoManager.set_standard-114"><a href="#GeoManager.set_standard-114"><span class="linenos">114</span></a>                <span class="s1">&#39; must be a string&#39;</span><span class="p">)</span>
</span><span id="GeoManager.set_standard-115"><a href="#GeoManager.set_standard-115"><span class="linenos">115</span></a>        <span class="k">if</span> <span class="n">standard</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list_standard</span><span class="p">():</span>
</span><span id="GeoManager.set_standard-116"><a href="#GeoManager.set_standard-116"><span class="linenos">116</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;GeoManager.set_standard error, &quot;&#39;</span><span class="o">+</span>\
</span><span id="GeoManager.set_standard-117"><a href="#GeoManager.set_standard-117"><span class="linenos">117</span></a>                                    <span class="n">standard</span><span class="o">+</span><span class="s1">&#39; not managed. Please see &#39;</span>\
</span><span id="GeoManager.set_standard-118"><a href="#GeoManager.set_standard-118"><span class="linenos">118</span></a>                                    <span class="s1">&#39;get_list_standard() function&#39;</span><span class="p">)</span>
</span><span id="GeoManager.set_standard-119"><a href="#GeoManager.set_standard-119"><span class="linenos">119</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_standard</span><span class="o">=</span><span class="n">standard</span>
</span><span id="GeoManager.set_standard-120"><a href="#GeoManager.set_standard-120"><span class="linenos">120</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_standard</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>set the working standard type within the GeoManager class.
The standard should meet the get_list_standard() requirement</p>
</div>


                            </div>
                            <div id="GeoManager.to_standard" class="classattr">
                                        <input id="GeoManager.to_standard-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">to_standard</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">w</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GeoManager.to_standard-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GeoManager.to_standard"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GeoManager.to_standard-122"><a href="#GeoManager.to_standard-122"><span class="linenos">122</span></a>    <span class="k">def</span> <span class="nf">to_standard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="GeoManager.to_standard-123"><a href="#GeoManager.to_standard-123"><span class="linenos">123</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Given a list of string of locations (countries), returns a</span>
</span><span id="GeoManager.to_standard-124"><a href="#GeoManager.to_standard-124"><span class="linenos">124</span></a><span class="sd">        normalised list according to the used standard (defined</span>
</span><span id="GeoManager.to_standard-125"><a href="#GeoManager.to_standard-125"><span class="linenos">125</span></a><span class="sd">        via the setStandard() or __init__ function. Current default is iso2.</span>
</span><span id="GeoManager.to_standard-126"><a href="#GeoManager.to_standard-126"><span class="linenos">126</span></a>
</span><span id="GeoManager.to_standard-127"><a href="#GeoManager.to_standard-127"><span class="linenos">127</span></a><span class="sd">        Arguments</span>
</span><span id="GeoManager.to_standard-128"><a href="#GeoManager.to_standard-128"><span class="linenos">128</span></a><span class="sd">        -----------------</span>
</span><span id="GeoManager.to_standard-129"><a href="#GeoManager.to_standard-129"><span class="linenos">129</span></a><span class="sd">        first arg        --  w, list of string of locations (or single string)</span>
</span><span id="GeoManager.to_standard-130"><a href="#GeoManager.to_standard-130"><span class="linenos">130</span></a><span class="sd">                             to convert to standard one</span>
</span><span id="GeoManager.to_standard-131"><a href="#GeoManager.to_standard-131"><span class="linenos">131</span></a>
</span><span id="GeoManager.to_standard-132"><a href="#GeoManager.to_standard-132"><span class="linenos">132</span></a><span class="sd">        output           -- &#39;list&#39; (default), &#39;dict&#39; or &#39;pandas&#39;</span>
</span><span id="GeoManager.to_standard-133"><a href="#GeoManager.to_standard-133"><span class="linenos">133</span></a><span class="sd">        db               -- database name to help conversion.</span>
</span><span id="GeoManager.to_standard-134"><a href="#GeoManager.to_standard-134"><span class="linenos">134</span></a><span class="sd">                            Default : None, meaning best effort to convert.</span>
</span><span id="GeoManager.to_standard-135"><a href="#GeoManager.to_standard-135"><span class="linenos">135</span></a><span class="sd">                            Known database : jhu, wordometer...</span>
</span><span id="GeoManager.to_standard-136"><a href="#GeoManager.to_standard-136"><span class="linenos">136</span></a><span class="sd">                            See get_list_db() for full list of known db for</span>
</span><span id="GeoManager.to_standard-137"><a href="#GeoManager.to_standard-137"><span class="linenos">137</span></a><span class="sd">                            standardization</span>
</span><span id="GeoManager.to_standard-138"><a href="#GeoManager.to_standard-138"><span class="linenos">138</span></a><span class="sd">        interpret_region -- Boolean, default=False. If yes, the output should</span>
</span><span id="GeoManager.to_standard-139"><a href="#GeoManager.to_standard-139"><span class="linenos">139</span></a><span class="sd">                            be only &#39;list&#39;.</span>
</span><span id="GeoManager.to_standard-140"><a href="#GeoManager.to_standard-140"><span class="linenos">140</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoManager.to_standard-141"><a href="#GeoManager.to_standard-141"><span class="linenos">141</span></a>
</span><span id="GeoManager.to_standard-142"><a href="#GeoManager.to_standard-142"><span class="linenos">142</span></a>        <span class="n">kwargs_test</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;output&#39;</span><span class="p">,</span><span class="s1">&#39;db&#39;</span><span class="p">,</span><span class="s1">&#39;interpret_region&#39;</span><span class="p">],</span><span class="s1">&#39;Bad args used in the to_standard() function.&#39;</span><span class="p">)</span>
</span><span id="GeoManager.to_standard-143"><a href="#GeoManager.to_standard-143"><span class="linenos">143</span></a>
</span><span id="GeoManager.to_standard-144"><a href="#GeoManager.to_standard-144"><span class="linenos">144</span></a>        <span class="n">output</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;output&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">get_list_output</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="GeoManager.to_standard-145"><a href="#GeoManager.to_standard-145"><span class="linenos">145</span></a>        <span class="k">if</span> <span class="n">output</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list_output</span><span class="p">():</span>
</span><span id="GeoManager.to_standard-146"><a href="#GeoManager.to_standard-146"><span class="linenos">146</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;Incorrect output type. See get_list_output()&#39;</span>
</span><span id="GeoManager.to_standard-147"><a href="#GeoManager.to_standard-147"><span class="linenos">147</span></a>                <span class="s1">&#39; or help.&#39;</span><span class="p">)</span>
</span><span id="GeoManager.to_standard-148"><a href="#GeoManager.to_standard-148"><span class="linenos">148</span></a>
</span><span id="GeoManager.to_standard-149"><a href="#GeoManager.to_standard-149"><span class="linenos">149</span></a>        <span class="n">db</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;db&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">get_list_db</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="GeoManager.to_standard-150"><a href="#GeoManager.to_standard-150"><span class="linenos">150</span></a>        <span class="k">if</span> <span class="n">db</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list_db</span><span class="p">():</span>
</span><span id="GeoManager.to_standard-151"><a href="#GeoManager.to_standard-151"><span class="linenos">151</span></a>            <span class="k">raise</span> <span class="n">CoaDbError</span><span class="p">(</span><span class="s1">&#39;Unknown database &quot;&#39;</span><span class="o">+</span><span class="n">db</span><span class="o">+</span><span class="s1">&#39;&quot; for translation to &#39;</span>
</span><span id="GeoManager.to_standard-152"><a href="#GeoManager.to_standard-152"><span class="linenos">152</span></a>                <span class="s1">&#39;standardized location names. See get_list_db() or help.&#39;</span><span class="p">)</span>
</span><span id="GeoManager.to_standard-153"><a href="#GeoManager.to_standard-153"><span class="linenos">153</span></a>
</span><span id="GeoManager.to_standard-154"><a href="#GeoManager.to_standard-154"><span class="linenos">154</span></a>        <span class="n">interpret_region</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;interpret_region&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
</span><span id="GeoManager.to_standard-155"><a href="#GeoManager.to_standard-155"><span class="linenos">155</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">interpret_region</span><span class="p">,</span><span class="nb">bool</span><span class="p">):</span>
</span><span id="GeoManager.to_standard-156"><a href="#GeoManager.to_standard-156"><span class="linenos">156</span></a>            <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s1">&#39;The interpret_region argument is a boolean, &#39;</span>
</span><span id="GeoManager.to_standard-157"><a href="#GeoManager.to_standard-157"><span class="linenos">157</span></a>                <span class="s1">&#39;not a &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">interpret_region</span><span class="p">)))</span>
</span><span id="GeoManager.to_standard-158"><a href="#GeoManager.to_standard-158"><span class="linenos">158</span></a>
</span><span id="GeoManager.to_standard-159"><a href="#GeoManager.to_standard-159"><span class="linenos">159</span></a>        <span class="k">if</span> <span class="n">interpret_region</span><span class="o">==</span><span class="kc">True</span> <span class="ow">and</span> <span class="n">output</span><span class="o">!=</span><span class="s1">&#39;list&#39;</span><span class="p">:</span>
</span><span id="GeoManager.to_standard-160"><a href="#GeoManager.to_standard-160"><span class="linenos">160</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;The interpret_region True argument is incompatible &#39;</span>
</span><span id="GeoManager.to_standard-161"><a href="#GeoManager.to_standard-161"><span class="linenos">161</span></a>                <span class="s1">&#39;with non list output option.&#39;</span><span class="p">)</span>
</span><span id="GeoManager.to_standard-162"><a href="#GeoManager.to_standard-162"><span class="linenos">162</span></a>
</span><span id="GeoManager.to_standard-163"><a href="#GeoManager.to_standard-163"><span class="linenos">163</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
</span><span id="GeoManager.to_standard-164"><a href="#GeoManager.to_standard-164"><span class="linenos">164</span></a>            <span class="n">w</span><span class="o">=</span><span class="p">[</span><span class="n">w</span><span class="p">]</span>
</span><span id="GeoManager.to_standard-165"><a href="#GeoManager.to_standard-165"><span class="linenos">165</span></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
</span><span id="GeoManager.to_standard-166"><a href="#GeoManager.to_standard-166"><span class="linenos">166</span></a>            <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s1">&#39;Waiting for str, list of str or pandas&#39;</span>
</span><span id="GeoManager.to_standard-167"><a href="#GeoManager.to_standard-167"><span class="linenos">167</span></a>                <span class="s1">&#39;as input of get_standard function member of GeoManager&#39;</span><span class="p">)</span>
</span><span id="GeoManager.to_standard-168"><a href="#GeoManager.to_standard-168"><span class="linenos">168</span></a>
</span><span id="GeoManager.to_standard-169"><a href="#GeoManager.to_standard-169"><span class="linenos">169</span></a>        <span class="n">w</span><span class="o">=</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">title</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">w</span><span class="p">]</span> <span class="c1"># capitalize first letter of each name</span>
</span><span id="GeoManager.to_standard-170"><a href="#GeoManager.to_standard-170"><span class="linenos">170</span></a>
</span><span id="GeoManager.to_standard-171"><a href="#GeoManager.to_standard-171"><span class="linenos">171</span></a>        <span class="n">w0</span><span class="o">=</span><span class="n">w</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="GeoManager.to_standard-172"><a href="#GeoManager.to_standard-172"><span class="linenos">172</span></a>
</span><span id="GeoManager.to_standard-173"><a href="#GeoManager.to_standard-173"><span class="linenos">173</span></a>        <span class="k">if</span> <span class="n">db</span><span class="p">:</span>
</span><span id="GeoManager.to_standard-174"><a href="#GeoManager.to_standard-174"><span class="linenos">174</span></a>            <span class="n">w</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">first_db_translation</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">db</span><span class="p">)</span>
</span><span id="GeoManager.to_standard-175"><a href="#GeoManager.to_standard-175"><span class="linenos">175</span></a>        <span class="n">n</span><span class="o">=</span><span class="p">[]</span> <span class="c1"># will contain standardized name of countries (if possible)</span>
</span><span id="GeoManager.to_standard-176"><a href="#GeoManager.to_standard-176"><span class="linenos">176</span></a>
</span><span id="GeoManager.to_standard-177"><a href="#GeoManager.to_standard-177"><span class="linenos">177</span></a>        <span class="c1">#for c in w:</span>
</span><span id="GeoManager.to_standard-178"><a href="#GeoManager.to_standard-178"><span class="linenos">178</span></a>        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
</span><span id="GeoManager.to_standard-179"><a href="#GeoManager.to_standard-179"><span class="linenos">179</span></a>            <span class="n">c</span><span class="o">=</span><span class="n">w</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="GeoManager.to_standard-180"><a href="#GeoManager.to_standard-180"><span class="linenos">180</span></a>            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">==</span><span class="nb">int</span><span class="p">:</span>
</span><span id="GeoManager.to_standard-181"><a href="#GeoManager.to_standard-181"><span class="linenos">181</span></a>                <span class="n">c</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</span><span id="GeoManager.to_standard-182"><a href="#GeoManager.to_standard-182"><span class="linenos">182</span></a>            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">!=</span><span class="nb">str</span><span class="p">:</span>
</span><span id="GeoManager.to_standard-183"><a href="#GeoManager.to_standard-183"><span class="linenos">183</span></a>                <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s1">&#39;Locations should be given as &#39;</span>
</span><span id="GeoManager.to_standard-184"><a href="#GeoManager.to_standard-184"><span class="linenos">184</span></a>                    <span class="s1">&#39;strings or integers only&#39;</span><span class="p">)</span>
</span><span id="GeoManager.to_standard-185"><a href="#GeoManager.to_standard-185"><span class="linenos">185</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gr</span><span class="o">.</span><span class="n">get_region_list</span><span class="p">())</span> <span class="ow">and</span> <span class="n">interpret_region</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="GeoManager.to_standard-186"><a href="#GeoManager.to_standard-186"><span class="linenos">186</span></a>                <span class="n">w</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_gr</span><span class="o">.</span><span class="n">get_countries_from_region</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">+</span><span class="n">w</span>
</span><span id="GeoManager.to_standard-187"><a href="#GeoManager.to_standard-187"><span class="linenos">187</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="GeoManager.to_standard-188"><a href="#GeoManager.to_standard-188"><span class="linenos">188</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
</span><span id="GeoManager.to_standard-189"><a href="#GeoManager.to_standard-189"><span class="linenos">189</span></a>                    <span class="n">n1</span><span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="c1">#None</span>
</span><span id="GeoManager.to_standard-190"><a href="#GeoManager.to_standard-190"><span class="linenos">190</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="GeoManager.to_standard-191"><a href="#GeoManager.to_standard-191"><span class="linenos">191</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="GeoManager.to_standard-192"><a href="#GeoManager.to_standard-192"><span class="linenos">192</span></a>                        <span class="n">n0</span><span class="o">=</span><span class="n">pc</span><span class="o">.</span><span class="n">countries</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</span><span id="GeoManager.to_standard-193"><a href="#GeoManager.to_standard-193"><span class="linenos">193</span></a>                    <span class="k">except</span> <span class="ne">LookupError</span><span class="p">:</span>
</span><span id="GeoManager.to_standard-194"><a href="#GeoManager.to_standard-194"><span class="linenos">194</span></a>                        <span class="k">try</span><span class="p">:</span>
</span><span id="GeoManager.to_standard-195"><a href="#GeoManager.to_standard-195"><span class="linenos">195</span></a>                            <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Owid_&#39;</span><span class="p">):</span>
</span><span id="GeoManager.to_standard-196"><a href="#GeoManager.to_standard-196"><span class="linenos">196</span></a>                                <span class="n">nf</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;owid_*&#39;</span><span class="p">]</span>
</span><span id="GeoManager.to_standard-197"><a href="#GeoManager.to_standard-197"><span class="linenos">197</span></a>                                <span class="n">n1</span><span class="o">=</span><span class="s1">&#39;OWID_*&#39;</span>
</span><span id="GeoManager.to_standard-198"><a href="#GeoManager.to_standard-198"><span class="linenos">198</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="GeoManager.to_standard-199"><a href="#GeoManager.to_standard-199"><span class="linenos">199</span></a>                                <span class="n">nf</span><span class="o">=</span><span class="n">pc</span><span class="o">.</span><span class="n">countries</span><span class="o">.</span><span class="n">search_fuzzy</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</span><span id="GeoManager.to_standard-200"><a href="#GeoManager.to_standard-200"><span class="linenos">200</span></a>                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nf</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
</span><span id="GeoManager.to_standard-201"><a href="#GeoManager.to_standard-201"><span class="linenos">201</span></a>                                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Caution. More than one country match the key &quot;&#39;</span><span class="o">+</span>\
</span><span id="GeoManager.to_standard-202"><a href="#GeoManager.to_standard-202"><span class="linenos">202</span></a>                                <span class="n">c</span><span class="o">+</span><span class="s1">&#39;&quot; : &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">([</span> <span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;, &#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">nf</span><span class="p">])</span><span class="o">+</span>\
</span><span id="GeoManager.to_standard-203"><a href="#GeoManager.to_standard-203"><span class="linenos">203</span></a>                                <span class="s1">&#39;, using first one.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="GeoManager.to_standard-204"><a href="#GeoManager.to_standard-204"><span class="linenos">204</span></a>                            <span class="n">n0</span><span class="o">=</span><span class="n">nf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GeoManager.to_standard-205"><a href="#GeoManager.to_standard-205"><span class="linenos">205</span></a>                        <span class="k">except</span> <span class="ne">LookupError</span><span class="p">:</span>
</span><span id="GeoManager.to_standard-206"><a href="#GeoManager.to_standard-206"><span class="linenos">206</span></a>                            <span class="k">raise</span> <span class="n">CoaLookupError</span><span class="p">(</span><span class="s1">&#39;No country match the key &quot;&#39;</span><span class="o">+</span><span class="n">c</span><span class="o">+</span><span class="s1">&#39;&quot;. Error.&#39;</span><span class="p">)</span>
</span><span id="GeoManager.to_standard-207"><a href="#GeoManager.to_standard-207"><span class="linenos">207</span></a>                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e1</span><span class="p">:</span>
</span><span id="GeoManager.to_standard-208"><a href="#GeoManager.to_standard-208"><span class="linenos">208</span></a>                            <span class="k">raise</span> <span class="n">CoaNotManagedError</span><span class="p">(</span><span class="s1">&#39;Not managed error &#39;</span><span class="o">+</span><span class="nb">type</span><span class="p">(</span><span class="n">e1</span><span class="p">))</span>
</span><span id="GeoManager.to_standard-209"><a href="#GeoManager.to_standard-209"><span class="linenos">209</span></a>                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e2</span><span class="p">:</span>
</span><span id="GeoManager.to_standard-210"><a href="#GeoManager.to_standard-210"><span class="linenos">210</span></a>                        <span class="k">raise</span> <span class="n">CoaNotManagedError</span><span class="p">(</span><span class="s1">&#39;Not managed error&#39;</span><span class="o">+</span><span class="nb">type</span><span class="p">(</span><span class="n">e1</span><span class="p">))</span>
</span><span id="GeoManager.to_standard-211"><a href="#GeoManager.to_standard-211"><span class="linenos">211</span></a>
</span><span id="GeoManager.to_standard-212"><a href="#GeoManager.to_standard-212"><span class="linenos">212</span></a>                    <span class="k">if</span> <span class="n">n0</span> <span class="o">!=</span> <span class="s1">&#39;owid_*&#39;</span><span class="p">:</span>
</span><span id="GeoManager.to_standard-213"><a href="#GeoManager.to_standard-213"><span class="linenos">213</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_standard</span><span class="o">==</span><span class="s1">&#39;iso2&#39;</span><span class="p">:</span>
</span><span id="GeoManager.to_standard-214"><a href="#GeoManager.to_standard-214"><span class="linenos">214</span></a>                            <span class="n">n1</span><span class="o">=</span><span class="n">n0</span><span class="o">.</span><span class="n">alpha_2</span>
</span><span id="GeoManager.to_standard-215"><a href="#GeoManager.to_standard-215"><span class="linenos">215</span></a>                        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_standard</span><span class="o">==</span><span class="s1">&#39;iso3&#39;</span><span class="p">:</span>
</span><span id="GeoManager.to_standard-216"><a href="#GeoManager.to_standard-216"><span class="linenos">216</span></a>                            <span class="n">n1</span><span class="o">=</span><span class="n">n0</span><span class="o">.</span><span class="n">alpha_3</span>
</span><span id="GeoManager.to_standard-217"><a href="#GeoManager.to_standard-217"><span class="linenos">217</span></a>                        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_standard</span><span class="o">==</span><span class="s1">&#39;name&#39;</span><span class="p">:</span>
</span><span id="GeoManager.to_standard-218"><a href="#GeoManager.to_standard-218"><span class="linenos">218</span></a>                            <span class="n">n1</span><span class="o">=</span><span class="n">n0</span><span class="o">.</span><span class="n">name</span>
</span><span id="GeoManager.to_standard-219"><a href="#GeoManager.to_standard-219"><span class="linenos">219</span></a>                        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_standard</span><span class="o">==</span><span class="s1">&#39;num&#39;</span><span class="p">:</span>
</span><span id="GeoManager.to_standard-220"><a href="#GeoManager.to_standard-220"><span class="linenos">220</span></a>                            <span class="n">n1</span><span class="o">=</span><span class="n">n0</span><span class="o">.</span><span class="n">numeric</span>
</span><span id="GeoManager.to_standard-221"><a href="#GeoManager.to_standard-221"><span class="linenos">221</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="GeoManager.to_standard-222"><a href="#GeoManager.to_standard-222"><span class="linenos">222</span></a>                            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;Current standard is &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_standard</span><span class="o">+</span>\
</span><span id="GeoManager.to_standard-223"><a href="#GeoManager.to_standard-223"><span class="linenos">223</span></a>                                <span class="s1">&#39; which is not managed. Error.&#39;</span><span class="p">)</span>
</span><span id="GeoManager.to_standard-224"><a href="#GeoManager.to_standard-224"><span class="linenos">224</span></a>
</span><span id="GeoManager.to_standard-225"><a href="#GeoManager.to_standard-225"><span class="linenos">225</span></a>                <span class="n">n</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n1</span><span class="p">)</span>
</span><span id="GeoManager.to_standard-226"><a href="#GeoManager.to_standard-226"><span class="linenos">226</span></a>
</span><span id="GeoManager.to_standard-227"><a href="#GeoManager.to_standard-227"><span class="linenos">227</span></a>        <span class="k">if</span> <span class="n">output</span><span class="o">==</span><span class="s1">&#39;list&#39;</span><span class="p">:</span>
</span><span id="GeoManager.to_standard-228"><a href="#GeoManager.to_standard-228"><span class="linenos">228</span></a>            <span class="k">return</span> <span class="n">n</span>
</span><span id="GeoManager.to_standard-229"><a href="#GeoManager.to_standard-229"><span class="linenos">229</span></a>        <span class="k">elif</span> <span class="n">output</span><span class="o">==</span><span class="s1">&#39;dict&#39;</span><span class="p">:</span>
</span><span id="GeoManager.to_standard-230"><a href="#GeoManager.to_standard-230"><span class="linenos">230</span></a>            <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">w0</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
</span><span id="GeoManager.to_standard-231"><a href="#GeoManager.to_standard-231"><span class="linenos">231</span></a>        <span class="k">elif</span> <span class="n">output</span><span class="o">==</span><span class="s1">&#39;pandas&#39;</span><span class="p">:</span>
</span><span id="GeoManager.to_standard-232"><a href="#GeoManager.to_standard-232"><span class="linenos">232</span></a>            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([{</span><span class="s1">&#39;inputname&#39;</span><span class="p">:</span><span class="n">w0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_standard</span><span class="p">:</span><span class="n">n</span><span class="p">}])</span>
</span><span id="GeoManager.to_standard-233"><a href="#GeoManager.to_standard-233"><span class="linenos">233</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GeoManager.to_standard-234"><a href="#GeoManager.to_standard-234"><span class="linenos">234</span></a>            <span class="k">return</span> <span class="kc">None</span> <span class="c1"># should not be here</span>
</span></pre></div>


            <div class="docstring"><p>Given a list of string of locations (countries), returns a
normalised list according to the used standard (defined
via the setStandard() or __init__ function. Current default is iso2.</p>

<h2 id="arguments">Arguments</h2>

<p>first arg        --  w, list of string of locations (or single string)
                     to convert to standard one</p>

<p>output           -- 'list' (default), 'dict' or 'pandas'
db               -- database name to help conversion.
                    Default : None, meaning best effort to convert.
                    Known database : jhu, wordometer...
                    See get_list_db() for full list of known db for
                    standardization
interpret_region -- Boolean, default=False. If yes, the output should
                    be only 'list'.</p>
</div>


                            </div>
                            <div id="GeoManager.first_db_translation" class="classattr">
                                        <input id="GeoManager.first_db_translation-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">first_db_translation</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">w</span>, </span><span class="param"><span class="n">db</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GeoManager.first_db_translation-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GeoManager.first_db_translation"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GeoManager.first_db_translation-236"><a href="#GeoManager.first_db_translation-236"><span class="linenos">236</span></a>    <span class="k">def</span> <span class="nf">first_db_translation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">db</span><span class="p">):</span>
</span><span id="GeoManager.first_db_translation-237"><a href="#GeoManager.first_db_translation-237"><span class="linenos">237</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; This function helps to translate from country name to</span>
</span><span id="GeoManager.first_db_translation-238"><a href="#GeoManager.first_db_translation-238"><span class="linenos">238</span></a><span class="sd">        standard for specific databases. It&#39;s the first step</span>
</span><span id="GeoManager.first_db_translation-239"><a href="#GeoManager.first_db_translation-239"><span class="linenos">239</span></a><span class="sd">        before final translation.</span>
</span><span id="GeoManager.first_db_translation-240"><a href="#GeoManager.first_db_translation-240"><span class="linenos">240</span></a>
</span><span id="GeoManager.first_db_translation-241"><a href="#GeoManager.first_db_translation-241"><span class="linenos">241</span></a><span class="sd">        One can easily add some database support adding some new rules</span>
</span><span id="GeoManager.first_db_translation-242"><a href="#GeoManager.first_db_translation-242"><span class="linenos">242</span></a><span class="sd">        for specific databases</span>
</span><span id="GeoManager.first_db_translation-243"><a href="#GeoManager.first_db_translation-243"><span class="linenos">243</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoManager.first_db_translation-244"><a href="#GeoManager.first_db_translation-244"><span class="linenos">244</span></a>        <span class="n">translation_dict</span><span class="o">=</span><span class="p">{}</span>
</span><span id="GeoManager.first_db_translation-245"><a href="#GeoManager.first_db_translation-245"><span class="linenos">245</span></a>        <span class="c1"># Caution : keys need to be in title mode, i.e. first letter capitalized</span>
</span><span id="GeoManager.first_db_translation-246"><a href="#GeoManager.first_db_translation-246"><span class="linenos">246</span></a>        <span class="k">if</span> <span class="n">db</span><span class="o">==</span><span class="s1">&#39;jhu&#39;</span><span class="p">:</span>
</span><span id="GeoManager.first_db_translation-247"><a href="#GeoManager.first_db_translation-247"><span class="linenos">247</span></a>            <span class="n">translation_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>\
</span><span id="GeoManager.first_db_translation-248"><a href="#GeoManager.first_db_translation-248"><span class="linenos">248</span></a>                <span class="s2">&quot;Congo (Brazzaville)&quot;</span><span class="p">:</span><span class="s2">&quot;Republic of the Congo&quot;</span><span class="p">,</span>\
</span><span id="GeoManager.first_db_translation-249"><a href="#GeoManager.first_db_translation-249"><span class="linenos">249</span></a>                <span class="s2">&quot;Congo (Kinshasa)&quot;</span><span class="p">:</span><span class="s2">&quot;COD&quot;</span><span class="p">,</span>\
</span><span id="GeoManager.first_db_translation-250"><a href="#GeoManager.first_db_translation-250"><span class="linenos">250</span></a>                <span class="s2">&quot;Korea, South&quot;</span><span class="p">:</span><span class="s2">&quot;KOR&quot;</span><span class="p">,</span>\
</span><span id="GeoManager.first_db_translation-251"><a href="#GeoManager.first_db_translation-251"><span class="linenos">251</span></a>                <span class="s2">&quot;Taiwan*&quot;</span><span class="p">:</span><span class="s2">&quot;Taiwan&quot;</span><span class="p">,</span>\
</span><span id="GeoManager.first_db_translation-252"><a href="#GeoManager.first_db_translation-252"><span class="linenos">252</span></a>                <span class="s2">&quot;Laos&quot;</span><span class="p">:</span><span class="s2">&quot;LAO&quot;</span><span class="p">,</span>\
</span><span id="GeoManager.first_db_translation-253"><a href="#GeoManager.first_db_translation-253"><span class="linenos">253</span></a>                <span class="s2">&quot;West Bank And Gaza&quot;</span><span class="p">:</span><span class="s2">&quot;PSE&quot;</span><span class="p">,</span>\
</span><span id="GeoManager.first_db_translation-254"><a href="#GeoManager.first_db_translation-254"><span class="linenos">254</span></a>                <span class="s2">&quot;Burma&quot;</span><span class="p">:</span><span class="s2">&quot;Myanmar&quot;</span><span class="p">,</span>\
</span><span id="GeoManager.first_db_translation-255"><a href="#GeoManager.first_db_translation-255"><span class="linenos">255</span></a>                <span class="s2">&quot;Iran&quot;</span><span class="p">:</span><span class="s2">&quot;IRN&quot;</span><span class="p">,</span>\
</span><span id="GeoManager.first_db_translation-256"><a href="#GeoManager.first_db_translation-256"><span class="linenos">256</span></a>                <span class="s2">&quot;Diamond Princess&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span>\
</span><span id="GeoManager.first_db_translation-257"><a href="#GeoManager.first_db_translation-257"><span class="linenos">257</span></a>                <span class="s2">&quot;Ms Zaandam&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span>\
</span><span id="GeoManager.first_db_translation-258"><a href="#GeoManager.first_db_translation-258"><span class="linenos">258</span></a>                <span class="s2">&quot;Summer Olympics 2020&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span>\
</span><span id="GeoManager.first_db_translation-259"><a href="#GeoManager.first_db_translation-259"><span class="linenos">259</span></a>                <span class="s2">&quot;Micronesia&quot;</span><span class="p">:</span><span class="s2">&quot;FSM&quot;</span><span class="p">,</span>\
</span><span id="GeoManager.first_db_translation-260"><a href="#GeoManager.first_db_translation-260"><span class="linenos">260</span></a>                <span class="s2">&quot;Winter Olympics 2022&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span>\
</span><span id="GeoManager.first_db_translation-261"><a href="#GeoManager.first_db_translation-261"><span class="linenos">261</span></a>                <span class="s2">&quot;Antarctica&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span>\
</span><span id="GeoManager.first_db_translation-262"><a href="#GeoManager.first_db_translation-262"><span class="linenos">262</span></a>                <span class="s2">&quot;Korea, North&quot;</span><span class="p">:</span><span class="s2">&quot;PRK&quot;</span><span class="p">,</span>\
</span><span id="GeoManager.first_db_translation-263"><a href="#GeoManager.first_db_translation-263"><span class="linenos">263</span></a>                    <span class="p">})</span>  <span class="c1"># last two are names of boats</span>
</span><span id="GeoManager.first_db_translation-264"><a href="#GeoManager.first_db_translation-264"><span class="linenos">264</span></a>        <span class="k">elif</span> <span class="n">db</span><span class="o">==</span><span class="s1">&#39;worldometers&#39;</span><span class="p">:</span>
</span><span id="GeoManager.first_db_translation-265"><a href="#GeoManager.first_db_translation-265"><span class="linenos">265</span></a>            <span class="n">translation_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>\
</span><span id="GeoManager.first_db_translation-266"><a href="#GeoManager.first_db_translation-266"><span class="linenos">266</span></a>                <span class="s2">&quot;Dr Congo&quot;</span><span class="p">:</span><span class="s2">&quot;COD&quot;</span><span class="p">,</span>\
</span><span id="GeoManager.first_db_translation-267"><a href="#GeoManager.first_db_translation-267"><span class="linenos">267</span></a>                <span class="s2">&quot;Congo&quot;</span><span class="p">:</span><span class="s2">&quot;COG&quot;</span><span class="p">,</span>\
</span><span id="GeoManager.first_db_translation-268"><a href="#GeoManager.first_db_translation-268"><span class="linenos">268</span></a>                <span class="s2">&quot;Iran&quot;</span><span class="p">:</span><span class="s2">&quot;IRN&quot;</span><span class="p">,</span>\
</span><span id="GeoManager.first_db_translation-269"><a href="#GeoManager.first_db_translation-269"><span class="linenos">269</span></a>                <span class="s2">&quot;South Korea&quot;</span><span class="p">:</span><span class="s2">&quot;KOR&quot;</span><span class="p">,</span>\
</span><span id="GeoManager.first_db_translation-270"><a href="#GeoManager.first_db_translation-270"><span class="linenos">270</span></a>                <span class="s2">&quot;North Korea&quot;</span><span class="p">:</span><span class="s2">&quot;PRK&quot;</span><span class="p">,</span>\
</span><span id="GeoManager.first_db_translation-271"><a href="#GeoManager.first_db_translation-271"><span class="linenos">271</span></a>                <span class="s2">&quot;Czech Republic (Czechia)&quot;</span><span class="p">:</span><span class="s2">&quot;CZE&quot;</span><span class="p">,</span>\
</span><span id="GeoManager.first_db_translation-272"><a href="#GeoManager.first_db_translation-272"><span class="linenos">272</span></a>                <span class="s2">&quot;Laos&quot;</span><span class="p">:</span><span class="s2">&quot;LAO&quot;</span><span class="p">,</span>\
</span><span id="GeoManager.first_db_translation-273"><a href="#GeoManager.first_db_translation-273"><span class="linenos">273</span></a>                <span class="s2">&quot;Sao Tome &amp; Principe&quot;</span><span class="p">:</span><span class="s2">&quot;STP&quot;</span><span class="p">,</span>\
</span><span id="GeoManager.first_db_translation-274"><a href="#GeoManager.first_db_translation-274"><span class="linenos">274</span></a>                <span class="s2">&quot;Channel Islands&quot;</span><span class="p">:</span><span class="s2">&quot;JEY&quot;</span><span class="p">,</span>\
</span><span id="GeoManager.first_db_translation-275"><a href="#GeoManager.first_db_translation-275"><span class="linenos">275</span></a>                <span class="s2">&quot;St. Vincent &amp; Grenadines&quot;</span><span class="p">:</span><span class="s2">&quot;VCT&quot;</span><span class="p">,</span>\
</span><span id="GeoManager.first_db_translation-276"><a href="#GeoManager.first_db_translation-276"><span class="linenos">276</span></a>                <span class="s2">&quot;U.S. Virgin Islands&quot;</span><span class="p">:</span><span class="s2">&quot;VIR&quot;</span><span class="p">,</span>\
</span><span id="GeoManager.first_db_translation-277"><a href="#GeoManager.first_db_translation-277"><span class="linenos">277</span></a>                <span class="s2">&quot;Saint Kitts &amp; Nevis&quot;</span><span class="p">:</span><span class="s2">&quot;KNA&quot;</span><span class="p">,</span>\
</span><span id="GeoManager.first_db_translation-278"><a href="#GeoManager.first_db_translation-278"><span class="linenos">278</span></a>                <span class="s2">&quot;Faeroe Islands&quot;</span><span class="p">:</span><span class="s2">&quot;FRO&quot;</span><span class="p">,</span>\
</span><span id="GeoManager.first_db_translation-279"><a href="#GeoManager.first_db_translation-279"><span class="linenos">279</span></a>                <span class="s2">&quot;Caribbean Netherlands&quot;</span><span class="p">:</span><span class="s2">&quot;BES&quot;</span><span class="p">,</span>\
</span><span id="GeoManager.first_db_translation-280"><a href="#GeoManager.first_db_translation-280"><span class="linenos">280</span></a>                <span class="s2">&quot;Wallis &amp; Futuna&quot;</span><span class="p">:</span><span class="s2">&quot;WLF&quot;</span><span class="p">,</span>\
</span><span id="GeoManager.first_db_translation-281"><a href="#GeoManager.first_db_translation-281"><span class="linenos">281</span></a>                <span class="s2">&quot;Saint Pierre &amp; Miquelon&quot;</span><span class="p">:</span><span class="s2">&quot;SPM&quot;</span><span class="p">,</span>\
</span><span id="GeoManager.first_db_translation-282"><a href="#GeoManager.first_db_translation-282"><span class="linenos">282</span></a>                <span class="s2">&quot;Sint Maarten&quot;</span><span class="p">:</span><span class="s2">&quot;SXM&quot;</span><span class="p">,</span>\
</span><span id="GeoManager.first_db_translation-283"><a href="#GeoManager.first_db_translation-283"><span class="linenos">283</span></a>                <span class="p">}</span> <span class="p">)</span>
</span><span id="GeoManager.first_db_translation-284"><a href="#GeoManager.first_db_translation-284"><span class="linenos">284</span></a>        <span class="k">elif</span> <span class="n">db</span><span class="o">==</span><span class="s1">&#39;owid&#39;</span><span class="p">:</span>
</span><span id="GeoManager.first_db_translation-285"><a href="#GeoManager.first_db_translation-285"><span class="linenos">285</span></a>            <span class="n">translation_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>\
</span><span id="GeoManager.first_db_translation-286"><a href="#GeoManager.first_db_translation-286"><span class="linenos">286</span></a>                    <span class="s2">&quot;Bonaire Sint Eustatius And Saba&quot;</span><span class="p">:</span><span class="s2">&quot;BES&quot;</span><span class="p">,</span>\
</span><span id="GeoManager.first_db_translation-287"><a href="#GeoManager.first_db_translation-287"><span class="linenos">287</span></a>                    <span class="s2">&quot;Cape Verde&quot;</span><span class="p">:</span><span class="s2">&quot;CPV&quot;</span><span class="p">,</span>\
</span><span id="GeoManager.first_db_translation-288"><a href="#GeoManager.first_db_translation-288"><span class="linenos">288</span></a>                    <span class="s2">&quot;Democratic Republic Of Congo&quot;</span><span class="p">:</span><span class="s2">&quot;COD&quot;</span><span class="p">,</span>\
</span><span id="GeoManager.first_db_translation-289"><a href="#GeoManager.first_db_translation-289"><span class="linenos">289</span></a>                    <span class="s2">&quot;Faeroe Islands&quot;</span><span class="p">:</span><span class="s2">&quot;FRO&quot;</span><span class="p">,</span>\
</span><span id="GeoManager.first_db_translation-290"><a href="#GeoManager.first_db_translation-290"><span class="linenos">290</span></a>                    <span class="s2">&quot;Laos&quot;</span><span class="p">:</span><span class="s2">&quot;LAO&quot;</span><span class="p">,</span>\
</span><span id="GeoManager.first_db_translation-291"><a href="#GeoManager.first_db_translation-291"><span class="linenos">291</span></a>                    <span class="s2">&quot;South Korea&quot;</span><span class="p">:</span><span class="s2">&quot;KOR&quot;</span><span class="p">,</span>\
</span><span id="GeoManager.first_db_translation-292"><a href="#GeoManager.first_db_translation-292"><span class="linenos">292</span></a>                    <span class="s2">&quot;Swaziland&quot;</span><span class="p">:</span><span class="s2">&quot;SWZ&quot;</span><span class="p">,</span>\
</span><span id="GeoManager.first_db_translation-293"><a href="#GeoManager.first_db_translation-293"><span class="linenos">293</span></a>                    <span class="s2">&quot;United States Virgin Islands&quot;</span><span class="p">:</span><span class="s2">&quot;VIR&quot;</span><span class="p">,</span>\
</span><span id="GeoManager.first_db_translation-294"><a href="#GeoManager.first_db_translation-294"><span class="linenos">294</span></a>                    <span class="s2">&quot;Iran&quot;</span><span class="p">:</span><span class="s2">&quot;IRN&quot;</span><span class="p">,</span>\
</span><span id="GeoManager.first_db_translation-295"><a href="#GeoManager.first_db_translation-295"><span class="linenos">295</span></a>                    <span class="s2">&quot;Micronesia (Country)&quot;</span><span class="p">:</span><span class="s2">&quot;FSM&quot;</span><span class="p">,</span>\
</span><span id="GeoManager.first_db_translation-296"><a href="#GeoManager.first_db_translation-296"><span class="linenos">296</span></a>                    <span class="s2">&quot;Northern Cyprus&quot;</span><span class="p">:</span><span class="s2">&quot;CYP&quot;</span><span class="p">,</span>\
</span><span id="GeoManager.first_db_translation-297"><a href="#GeoManager.first_db_translation-297"><span class="linenos">297</span></a>                    <span class="s2">&quot;Curacao&quot;</span><span class="p">:</span><span class="s2">&quot;CUW&quot;</span><span class="p">,</span>\
</span><span id="GeoManager.first_db_translation-298"><a href="#GeoManager.first_db_translation-298"><span class="linenos">298</span></a>                    <span class="s2">&quot;Faeroe Islands&quot;</span><span class="p">:</span><span class="s2">&quot;FRO&quot;</span><span class="p">,</span>\
</span><span id="GeoManager.first_db_translation-299"><a href="#GeoManager.first_db_translation-299"><span class="linenos">299</span></a>                    <span class="s2">&quot;Vatican&quot;</span><span class="p">:</span><span class="s2">&quot;VAT&quot;</span>
</span><span id="GeoManager.first_db_translation-300"><a href="#GeoManager.first_db_translation-300"><span class="linenos">300</span></a>                <span class="p">})</span>
</span><span id="GeoManager.first_db_translation-301"><a href="#GeoManager.first_db_translation-301"><span class="linenos">301</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">translation_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">w</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>This function helps to translate from country name to
standard for specific databases. It's the first step
before final translation.</p>

<p>One can easily add some database support adding some new rules
for specific databases</p>
</div>


                            </div>
                </section>
                <section id="GeoInfo">
                            <input id="GeoInfo-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">GeoInfo</span>:

                <label class="view-source-button" for="GeoInfo-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GeoInfo"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GeoInfo-307"><a href="#GeoInfo-307"><span class="linenos">307</span></a><span class="k">class</span> <span class="nc">GeoInfo</span><span class="p">():</span>
</span><span id="GeoInfo-308"><a href="#GeoInfo-308"><span class="linenos">308</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;GeoInfo class definition. No inheritance from any other class.</span>
</span><span id="GeoInfo-309"><a href="#GeoInfo-309"><span class="linenos">309</span></a>
</span><span id="GeoInfo-310"><a href="#GeoInfo-310"><span class="linenos">310</span></a><span class="sd">    It should raise only CoaError and derived exceptions in case</span>
</span><span id="GeoInfo-311"><a href="#GeoInfo-311"><span class="linenos">311</span></a><span class="sd">    of errors (see pycoa.error)</span>
</span><span id="GeoInfo-312"><a href="#GeoInfo-312"><span class="linenos">312</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="GeoInfo-313"><a href="#GeoInfo-313"><span class="linenos">313</span></a>
</span><span id="GeoInfo-314"><a href="#GeoInfo-314"><span class="linenos">314</span></a>    <span class="n">_list_field</span><span class="o">=</span><span class="p">{</span>\
</span><span id="GeoInfo-315"><a href="#GeoInfo-315"><span class="linenos">315</span></a>        <span class="s1">&#39;continent_code&#39;</span><span class="p">:</span><span class="s1">&#39;pycountry_convert (https://pypi.org/project/pycountry-convert/)&#39;</span><span class="p">,</span>\
</span><span id="GeoInfo-316"><a href="#GeoInfo-316"><span class="linenos">316</span></a>        <span class="s1">&#39;continent_name&#39;</span><span class="p">:</span><span class="s1">&#39;pycountry_convert (https://pypi.org/project/pycountry-convert/)&#39;</span> <span class="p">,</span>\
</span><span id="GeoInfo-317"><a href="#GeoInfo-317"><span class="linenos">317</span></a>        <span class="s1">&#39;country_name&#39;</span><span class="p">:</span><span class="s1">&#39;pycountry_convert (https://pypi.org/project/pycountry-convert/)&#39;</span> <span class="p">,</span>\
</span><span id="GeoInfo-318"><a href="#GeoInfo-318"><span class="linenos">318</span></a>        <span class="s1">&#39;population&#39;</span><span class="p">:</span><span class="s1">&#39;https://www.worldometers.info/world-population/population-by-country/&#39;</span><span class="p">,</span>\
</span><span id="GeoInfo-319"><a href="#GeoInfo-319"><span class="linenos">319</span></a>        <span class="s1">&#39;area&#39;</span><span class="p">:</span><span class="s1">&#39;https://www.worldometers.info/world-population/population-by-country/&#39;</span><span class="p">,</span>\
</span><span id="GeoInfo-320"><a href="#GeoInfo-320"><span class="linenos">320</span></a>        <span class="s1">&#39;fertility&#39;</span><span class="p">:</span><span class="s1">&#39;https://www.worldometers.info/world-population/population-by-country/&#39;</span><span class="p">,</span>\
</span><span id="GeoInfo-321"><a href="#GeoInfo-321"><span class="linenos">321</span></a>        <span class="s1">&#39;median_age&#39;</span><span class="p">:</span><span class="s1">&#39;https://www.worldometers.info/world-population/population-by-country/&#39;</span><span class="p">,</span>\
</span><span id="GeoInfo-322"><a href="#GeoInfo-322"><span class="linenos">322</span></a>        <span class="s1">&#39;urban_rate&#39;</span><span class="p">:</span><span class="s1">&#39;https://www.worldometers.info/world-population/population-by-country/&#39;</span><span class="p">,</span>\
</span><span id="GeoInfo-323"><a href="#GeoInfo-323"><span class="linenos">323</span></a>        <span class="c1">#&#39;geometry&#39;:&#39;https://github.com/johan/world.geo.json/&#39;,\</span>
</span><span id="GeoInfo-324"><a href="#GeoInfo-324"><span class="linenos">324</span></a>        <span class="s1">&#39;geometry&#39;</span><span class="p">:</span><span class="s1">&#39;http://thematicmapping.org/downloads/world_borders.php and https://github.com/johan/world.geo.json/&#39;</span><span class="p">,</span>\
</span><span id="GeoInfo-325"><a href="#GeoInfo-325"><span class="linenos">325</span></a>        <span class="s1">&#39;region_code_list&#39;</span><span class="p">:</span><span class="s1">&#39;https://en.wikipedia.org/w/index.php?title=List_of_countries_by_United_Nations_geoscheme&amp;oldid=1008989486&#39;</span><span class="p">,</span>\
</span><span id="GeoInfo-326"><a href="#GeoInfo-326"><span class="linenos">326</span></a>        <span class="c1">#https://en.wikipedia.org/wiki/List_of_countries_by_United_Nations_geoscheme&#39;,\</span>
</span><span id="GeoInfo-327"><a href="#GeoInfo-327"><span class="linenos">327</span></a>        <span class="s1">&#39;region_name_list&#39;</span><span class="p">:</span><span class="s1">&#39;https://en.wikipedia.org/w/index.php?title=List_of_countries_by_United_Nations_geoscheme&amp;oldid=1008989486&#39;</span><span class="p">,</span>\
</span><span id="GeoInfo-328"><a href="#GeoInfo-328"><span class="linenos">328</span></a>        <span class="c1">#https://en.wikipedia.org/wiki/List_of_countries_by_United_Nations_geoscheme&#39;,\</span>
</span><span id="GeoInfo-329"><a href="#GeoInfo-329"><span class="linenos">329</span></a>        <span class="s1">&#39;capital&#39;</span><span class="p">:</span><span class="s1">&#39;https://en.wikipedia.org/w/index.php?title=List_of_countries_by_United_Nations_geoscheme&amp;oldid=1008989486&#39;</span><span class="p">,</span>\
</span><span id="GeoInfo-330"><a href="#GeoInfo-330"><span class="linenos">330</span></a>        <span class="c1">#https://en.wikipedia.org/wiki/List_of_countries_by_United_Nations_geoscheme&#39;,\</span>
</span><span id="GeoInfo-331"><a href="#GeoInfo-331"><span class="linenos">331</span></a>        <span class="s1">&#39;flag&#39;</span><span class="p">:</span><span class="s1">&#39;https://github.com/linssen/country-flag-icons/blob/master/countries.json&#39;</span><span class="p">,</span>\
</span><span id="GeoInfo-332"><a href="#GeoInfo-332"><span class="linenos">332</span></a>        <span class="p">}</span>
</span><span id="GeoInfo-333"><a href="#GeoInfo-333"><span class="linenos">333</span></a>
</span><span id="GeoInfo-334"><a href="#GeoInfo-334"><span class="linenos">334</span></a>    <span class="n">_data_geometry</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="GeoInfo-335"><a href="#GeoInfo-335"><span class="linenos">335</span></a>    <span class="n">_data_population</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="GeoInfo-336"><a href="#GeoInfo-336"><span class="linenos">336</span></a>    <span class="n">_data_flag</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="GeoInfo-337"><a href="#GeoInfo-337"><span class="linenos">337</span></a>
</span><span id="GeoInfo-338"><a href="#GeoInfo-338"><span class="linenos">338</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">gm</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span id="GeoInfo-339"><a href="#GeoInfo-339"><span class="linenos">339</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; __init__ member function.</span>
</span><span id="GeoInfo-340"><a href="#GeoInfo-340"><span class="linenos">340</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoInfo-341"><a href="#GeoInfo-341"><span class="linenos">341</span></a>        <span class="n">verb</span><span class="p">(</span><span class="s2">&quot;Init of GeoInfo() from &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="GeoInfo-342"><a href="#GeoInfo-342"><span class="linenos">342</span></a>        <span class="k">if</span> <span class="n">gm</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="GeoInfo-343"><a href="#GeoInfo-343"><span class="linenos">343</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_gm</span><span class="o">=</span><span class="n">gm</span>
</span><span id="GeoInfo-344"><a href="#GeoInfo-344"><span class="linenos">344</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GeoInfo-345"><a href="#GeoInfo-345"><span class="linenos">345</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_gm</span><span class="o">=</span><span class="n">GeoManager</span><span class="p">()</span>
</span><span id="GeoInfo-346"><a href="#GeoInfo-346"><span class="linenos">346</span></a>
</span><span id="GeoInfo-347"><a href="#GeoInfo-347"><span class="linenos">347</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_grp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_gm</span><span class="o">.</span><span class="n">_gr</span><span class="o">.</span><span class="n">get_pandas</span><span class="p">()</span>
</span><span id="GeoInfo-348"><a href="#GeoInfo-348"><span class="linenos">348</span></a>
</span><span id="GeoInfo-349"><a href="#GeoInfo-349"><span class="linenos">349</span></a>    <span class="k">def</span> <span class="nf">get_GeoManager</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GeoInfo-350"><a href="#GeoInfo-350"><span class="linenos">350</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; return the local instance of used GeoManager()</span>
</span><span id="GeoInfo-351"><a href="#GeoInfo-351"><span class="linenos">351</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoInfo-352"><a href="#GeoInfo-352"><span class="linenos">352</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gm</span>
</span><span id="GeoInfo-353"><a href="#GeoInfo-353"><span class="linenos">353</span></a>
</span><span id="GeoInfo-354"><a href="#GeoInfo-354"><span class="linenos">354</span></a>    <span class="k">def</span> <span class="nf">get_list_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GeoInfo-355"><a href="#GeoInfo-355"><span class="linenos">355</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; return the list of supported additionnal fields available</span>
</span><span id="GeoInfo-356"><a href="#GeoInfo-356"><span class="linenos">356</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoInfo-357"><a href="#GeoInfo-357"><span class="linenos">357</span></a>        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_list_field</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
</span><span id="GeoInfo-358"><a href="#GeoInfo-358"><span class="linenos">358</span></a>
</span><span id="GeoInfo-359"><a href="#GeoInfo-359"><span class="linenos">359</span></a>    <span class="k">def</span> <span class="nf">get_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">field</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="GeoInfo-360"><a href="#GeoInfo-360"><span class="linenos">360</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; return the source of the information provided for a given</span>
</span><span id="GeoInfo-361"><a href="#GeoInfo-361"><span class="linenos">361</span></a><span class="sd">        field.</span>
</span><span id="GeoInfo-362"><a href="#GeoInfo-362"><span class="linenos">362</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoInfo-363"><a href="#GeoInfo-363"><span class="linenos">363</span></a>        <span class="k">if</span> <span class="n">field</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
</span><span id="GeoInfo-364"><a href="#GeoInfo-364"><span class="linenos">364</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_list_field</span>
</span><span id="GeoInfo-365"><a href="#GeoInfo-365"><span class="linenos">365</span></a>        <span class="k">elif</span> <span class="n">field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list_field</span><span class="p">():</span>
</span><span id="GeoInfo-366"><a href="#GeoInfo-366"><span class="linenos">366</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;The field &quot;&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">field</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;&quot; is not &#39;</span>
</span><span id="GeoInfo-367"><a href="#GeoInfo-367"><span class="linenos">367</span></a>                <span class="s1">&#39;a supported field of GeoInfo(). Please see help or &#39;</span>
</span><span id="GeoInfo-368"><a href="#GeoInfo-368"><span class="linenos">368</span></a>                <span class="s1">&#39;the get_list_field() output.&#39;</span><span class="p">)</span>
</span><span id="GeoInfo-369"><a href="#GeoInfo-369"><span class="linenos">369</span></a>        <span class="k">return</span> <span class="n">field</span><span class="o">+</span><span class="s1">&#39; : &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_list_field</span><span class="p">[</span><span class="n">field</span><span class="p">]</span>
</span><span id="GeoInfo-370"><a href="#GeoInfo-370"><span class="linenos">370</span></a>
</span><span id="GeoInfo-371"><a href="#GeoInfo-371"><span class="linenos">371</span></a>
</span><span id="GeoInfo-372"><a href="#GeoInfo-372"><span class="linenos">372</span></a>    <span class="k">def</span> <span class="nf">add_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="GeoInfo-373"><a href="#GeoInfo-373"><span class="linenos">373</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; this is the main function of the GeoInfo class. It adds to</span>
</span><span id="GeoInfo-374"><a href="#GeoInfo-374"><span class="linenos">374</span></a><span class="sd">        the input pandas dataframe some fields according to</span>
</span><span id="GeoInfo-375"><a href="#GeoInfo-375"><span class="linenos">375</span></a><span class="sd">        the geofield field of input.</span>
</span><span id="GeoInfo-376"><a href="#GeoInfo-376"><span class="linenos">376</span></a><span class="sd">        The return value is the pandas dataframe.</span>
</span><span id="GeoInfo-377"><a href="#GeoInfo-377"><span class="linenos">377</span></a>
</span><span id="GeoInfo-378"><a href="#GeoInfo-378"><span class="linenos">378</span></a><span class="sd">        Arguments :</span>
</span><span id="GeoInfo-379"><a href="#GeoInfo-379"><span class="linenos">379</span></a><span class="sd">        field    -- should be given as a string of list of strings and</span>
</span><span id="GeoInfo-380"><a href="#GeoInfo-380"><span class="linenos">380</span></a><span class="sd">                    should be valid fields (see get_list_field() )</span>
</span><span id="GeoInfo-381"><a href="#GeoInfo-381"><span class="linenos">381</span></a><span class="sd">                    Mandatory.</span>
</span><span id="GeoInfo-382"><a href="#GeoInfo-382"><span class="linenos">382</span></a><span class="sd">        input    -- provide the input pandas dataframe. Mandatory.</span>
</span><span id="GeoInfo-383"><a href="#GeoInfo-383"><span class="linenos">383</span></a><span class="sd">        geofield -- provide the field name in the pandas where the</span>
</span><span id="GeoInfo-384"><a href="#GeoInfo-384"><span class="linenos">384</span></a><span class="sd">                    location is stored. Default : &#39;where&#39;</span>
</span><span id="GeoInfo-385"><a href="#GeoInfo-385"><span class="linenos">385</span></a><span class="sd">        overload -- Allow to overload a field. Boolean value.</span>
</span><span id="GeoInfo-386"><a href="#GeoInfo-386"><span class="linenos">386</span></a><span class="sd">                    Default : False</span>
</span><span id="GeoInfo-387"><a href="#GeoInfo-387"><span class="linenos">387</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoInfo-388"><a href="#GeoInfo-388"><span class="linenos">388</span></a>
</span><span id="GeoInfo-389"><a href="#GeoInfo-389"><span class="linenos">389</span></a>        <span class="c1"># --- kwargs analysis ---</span>
</span><span id="GeoInfo-390"><a href="#GeoInfo-390"><span class="linenos">390</span></a>
</span><span id="GeoInfo-391"><a href="#GeoInfo-391"><span class="linenos">391</span></a>        <span class="n">kwargs_test</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;field&#39;</span><span class="p">,</span><span class="s1">&#39;input&#39;</span><span class="p">,</span><span class="s1">&#39;geofield&#39;</span><span class="p">,</span><span class="s1">&#39;overload&#39;</span><span class="p">],</span>
</span><span id="GeoInfo-392"><a href="#GeoInfo-392"><span class="linenos">392</span></a>            <span class="s1">&#39;Bad args used in the add_field() function.&#39;</span><span class="p">)</span>
</span><span id="GeoInfo-393"><a href="#GeoInfo-393"><span class="linenos">393</span></a>
</span><span id="GeoInfo-394"><a href="#GeoInfo-394"><span class="linenos">394</span></a>        <span class="n">p</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span> <span class="c1"># the panda</span>
</span><span id="GeoInfo-395"><a href="#GeoInfo-395"><span class="linenos">395</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
</span><span id="GeoInfo-396"><a href="#GeoInfo-396"><span class="linenos">396</span></a>            <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s1">&#39;You should provide a valid input pandas&#39;</span>
</span><span id="GeoInfo-397"><a href="#GeoInfo-397"><span class="linenos">397</span></a>                <span class="s1">&#39; DataFrame as input. See help.&#39;</span><span class="p">)</span>
</span><span id="GeoInfo-398"><a href="#GeoInfo-398"><span class="linenos">398</span></a>        <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="GeoInfo-399"><a href="#GeoInfo-399"><span class="linenos">399</span></a>
</span><span id="GeoInfo-400"><a href="#GeoInfo-400"><span class="linenos">400</span></a>        <span class="n">overload</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;overload&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
</span><span id="GeoInfo-401"><a href="#GeoInfo-401"><span class="linenos">401</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">overload</span><span class="p">,</span><span class="nb">bool</span><span class="p">):</span>
</span><span id="GeoInfo-402"><a href="#GeoInfo-402"><span class="linenos">402</span></a>            <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s1">&#39;The overload option should be a boolean.&#39;</span><span class="p">)</span>
</span><span id="GeoInfo-403"><a href="#GeoInfo-403"><span class="linenos">403</span></a>
</span><span id="GeoInfo-404"><a href="#GeoInfo-404"><span class="linenos">404</span></a>        <span class="n">fl</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;field&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span> <span class="c1"># field list</span>
</span><span id="GeoInfo-405"><a href="#GeoInfo-405"><span class="linenos">405</span></a>        <span class="k">if</span> <span class="n">fl</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GeoInfo-406"><a href="#GeoInfo-406"><span class="linenos">406</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;No field given. See help.&#39;</span><span class="p">)</span>
</span><span id="GeoInfo-407"><a href="#GeoInfo-407"><span class="linenos">407</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
</span><span id="GeoInfo-408"><a href="#GeoInfo-408"><span class="linenos">408</span></a>            <span class="n">fl</span><span class="o">=</span><span class="p">[</span><span class="n">fl</span><span class="p">]</span>
</span><span id="GeoInfo-409"><a href="#GeoInfo-409"><span class="linenos">409</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list_field</span><span class="p">()</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fl</span><span class="p">):</span>
</span><span id="GeoInfo-410"><a href="#GeoInfo-410"><span class="linenos">410</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;All fields are not valid or supported &#39;</span>
</span><span id="GeoInfo-411"><a href="#GeoInfo-411"><span class="linenos">411</span></a>                <span class="s1">&#39;ones. Please see help of get_list_field()&#39;</span><span class="p">)</span>
</span><span id="GeoInfo-412"><a href="#GeoInfo-412"><span class="linenos">412</span></a>
</span><span id="GeoInfo-413"><a href="#GeoInfo-413"><span class="linenos">413</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">overload</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">f</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fl</span><span class="p">):</span>
</span><span id="GeoInfo-414"><a href="#GeoInfo-414"><span class="linenos">414</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;Some fields already exist in you panda &#39;</span>
</span><span id="GeoInfo-415"><a href="#GeoInfo-415"><span class="linenos">415</span></a>                <span class="s1">&#39;dataframe columns. You may set overload to True.&#39;</span><span class="p">)</span>
</span><span id="GeoInfo-416"><a href="#GeoInfo-416"><span class="linenos">416</span></a>
</span><span id="GeoInfo-417"><a href="#GeoInfo-417"><span class="linenos">417</span></a>        <span class="n">geofield</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;geofield&#39;</span><span class="p">,</span><span class="s1">&#39;where&#39;</span><span class="p">)</span>
</span><span id="GeoInfo-418"><a href="#GeoInfo-418"><span class="linenos">418</span></a>
</span><span id="GeoInfo-419"><a href="#GeoInfo-419"><span class="linenos">419</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geofield</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
</span><span id="GeoInfo-420"><a href="#GeoInfo-420"><span class="linenos">420</span></a>            <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s1">&#39;The geofield should be given as a &#39;</span>
</span><span id="GeoInfo-421"><a href="#GeoInfo-421"><span class="linenos">421</span></a>                <span class="s1">&#39;string.&#39;</span><span class="p">)</span>
</span><span id="GeoInfo-422"><a href="#GeoInfo-422"><span class="linenos">422</span></a>        <span class="k">if</span> <span class="n">geofield</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
</span><span id="GeoInfo-423"><a href="#GeoInfo-423"><span class="linenos">423</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;The geofield &quot;&#39;</span><span class="o">+</span><span class="n">geofield</span><span class="o">+</span><span class="s1">&#39;&quot; given is &#39;</span>
</span><span id="GeoInfo-424"><a href="#GeoInfo-424"><span class="linenos">424</span></a>                <span class="s1">&#39;not a valid column name of the input pandas dataframe.&#39;</span><span class="p">)</span>
</span><span id="GeoInfo-425"><a href="#GeoInfo-425"><span class="linenos">425</span></a>
</span><span id="GeoInfo-426"><a href="#GeoInfo-426"><span class="linenos">426</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_gm</span><span class="o">.</span><span class="n">set_standard</span><span class="p">(</span><span class="s1">&#39;iso2&#39;</span><span class="p">)</span>
</span><span id="GeoInfo-427"><a href="#GeoInfo-427"><span class="linenos">427</span></a>        <span class="n">countries_iso2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_gm</span><span class="o">.</span><span class="n">to_standard</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">geofield</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</span><span id="GeoInfo-428"><a href="#GeoInfo-428"><span class="linenos">428</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_gm</span><span class="o">.</span><span class="n">set_standard</span><span class="p">(</span><span class="s1">&#39;iso3&#39;</span><span class="p">)</span>
</span><span id="GeoInfo-429"><a href="#GeoInfo-429"><span class="linenos">429</span></a>        <span class="n">countries_iso3</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_gm</span><span class="o">.</span><span class="n">to_standard</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">geofield</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</span><span id="GeoInfo-430"><a href="#GeoInfo-430"><span class="linenos">430</span></a>
</span><span id="GeoInfo-431"><a href="#GeoInfo-431"><span class="linenos">431</span></a>        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;iso2_tmp&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">countries_iso2</span>
</span><span id="GeoInfo-432"><a href="#GeoInfo-432"><span class="linenos">432</span></a>        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;iso3_tmp&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">countries_iso3</span>
</span><span id="GeoInfo-433"><a href="#GeoInfo-433"><span class="linenos">433</span></a>
</span><span id="GeoInfo-434"><a href="#GeoInfo-434"><span class="linenos">434</span></a>        <span class="c1"># --- loop over all needed fields ---</span>
</span><span id="GeoInfo-435"><a href="#GeoInfo-435"><span class="linenos">435</span></a>        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fl</span><span class="p">:</span>
</span><span id="GeoInfo-436"><a href="#GeoInfo-436"><span class="linenos">436</span></a>            <span class="k">if</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
</span><span id="GeoInfo-437"><a href="#GeoInfo-437"><span class="linenos">437</span></a>                <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="GeoInfo-438"><a href="#GeoInfo-438"><span class="linenos">438</span></a>            <span class="c1"># ----------------------------------------------------------</span>
</span><span id="GeoInfo-439"><a href="#GeoInfo-439"><span class="linenos">439</span></a>            <span class="k">if</span> <span class="n">f</span> <span class="o">==</span> <span class="s1">&#39;continent_code&#39;</span><span class="p">:</span>
</span><span id="GeoInfo-440"><a href="#GeoInfo-440"><span class="linenos">440</span></a>                <span class="n">p</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">pcc</span><span class="o">.</span><span class="n">country_alpha2_to_continent_code</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">countries_iso2</span><span class="p">]</span>
</span><span id="GeoInfo-441"><a href="#GeoInfo-441"><span class="linenos">441</span></a>            <span class="c1"># ----------------------------------------------------------</span>
</span><span id="GeoInfo-442"><a href="#GeoInfo-442"><span class="linenos">442</span></a>            <span class="k">elif</span> <span class="n">f</span> <span class="o">==</span> <span class="s1">&#39;continent_name&#39;</span><span class="p">:</span>
</span><span id="GeoInfo-443"><a href="#GeoInfo-443"><span class="linenos">443</span></a>                <span class="n">p</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">pcc</span><span class="o">.</span><span class="n">convert_continent_code_to_continent_name</span><span class="p">(</span> \
</span><span id="GeoInfo-444"><a href="#GeoInfo-444"><span class="linenos">444</span></a>                    <span class="n">pcc</span><span class="o">.</span><span class="n">country_alpha2_to_continent_code</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">countries_iso2</span> <span class="p">]</span>
</span><span id="GeoInfo-445"><a href="#GeoInfo-445"><span class="linenos">445</span></a>            <span class="c1"># ----------------------------------------------------------</span>
</span><span id="GeoInfo-446"><a href="#GeoInfo-446"><span class="linenos">446</span></a>            <span class="k">elif</span> <span class="n">f</span> <span class="o">==</span> <span class="s1">&#39;country_name&#39;</span><span class="p">:</span>
</span><span id="GeoInfo-447"><a href="#GeoInfo-447"><span class="linenos">447</span></a>                <span class="n">p</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">pcc</span><span class="o">.</span><span class="n">country_alpha2_to_country_name</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">countries_iso2</span><span class="p">]</span>
</span><span id="GeoInfo-448"><a href="#GeoInfo-448"><span class="linenos">448</span></a>            <span class="c1"># ----------------------------------------------------------</span>
</span><span id="GeoInfo-449"><a href="#GeoInfo-449"><span class="linenos">449</span></a>            <span class="k">elif</span> <span class="n">f</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;population&#39;</span><span class="p">,</span><span class="s1">&#39;area&#39;</span><span class="p">,</span><span class="s1">&#39;fertility&#39;</span><span class="p">,</span><span class="s1">&#39;median_age&#39;</span><span class="p">,</span><span class="s1">&#39;urban_rate&#39;</span><span class="p">]:</span>
</span><span id="GeoInfo-450"><a href="#GeoInfo-450"><span class="linenos">450</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_population</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="GeoInfo-451"><a href="#GeoInfo-451"><span class="linenos">451</span></a>
</span><span id="GeoInfo-452"><a href="#GeoInfo-452"><span class="linenos">452</span></a>                    <span class="n">field_descr</span><span class="o">=</span><span class="p">(</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;idx&#39;</span><span class="p">),</span>
</span><span id="GeoInfo-453"><a href="#GeoInfo-453"><span class="linenos">453</span></a>                        <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;Country&#39;</span><span class="p">,</span><span class="s1">&#39;country&#39;</span><span class="p">),</span>
</span><span id="GeoInfo-454"><a href="#GeoInfo-454"><span class="linenos">454</span></a>                        <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;Population&#39;</span><span class="p">,</span><span class="s1">&#39;population&#39;</span><span class="p">),</span>
</span><span id="GeoInfo-455"><a href="#GeoInfo-455"><span class="linenos">455</span></a>                        <span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;Land Area&#39;</span><span class="p">,</span><span class="s1">&#39;area&#39;</span><span class="p">),</span>
</span><span id="GeoInfo-456"><a href="#GeoInfo-456"><span class="linenos">456</span></a>                        <span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="s1">&#39;Fert&#39;</span><span class="p">,</span><span class="s1">&#39;fertility&#39;</span><span class="p">),</span>
</span><span id="GeoInfo-457"><a href="#GeoInfo-457"><span class="linenos">457</span></a>                        <span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="s1">&#39;Med&#39;</span><span class="p">,</span><span class="s1">&#39;median_age&#39;</span><span class="p">),</span>
</span><span id="GeoInfo-458"><a href="#GeoInfo-458"><span class="linenos">458</span></a>                        <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="s1">&#39;Urban&#39;</span><span class="p">,</span><span class="s1">&#39;urban_rate&#39;</span><span class="p">),</span>
</span><span id="GeoInfo-459"><a href="#GeoInfo-459"><span class="linenos">459</span></a>                        <span class="p">)</span> <span class="c1"># containts tuples with position in table, name of column, new name of field</span>
</span><span id="GeoInfo-460"><a href="#GeoInfo-460"><span class="linenos">460</span></a>
</span><span id="GeoInfo-461"><a href="#GeoInfo-461"><span class="linenos">461</span></a>                    <span class="c1"># get data with cache ok for about 1 month</span>
</span><span id="GeoInfo-462"><a href="#GeoInfo-462"><span class="linenos">462</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_data_population</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="s1">&#39;https://www.worldometers.info/world-population/population-by-country/&#39;</span><span class="p">,</span><span class="mf">30e5</span><span class="p">)</span> <span class="p">)</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">field_descr</span><span class="p">]]</span>
</span><span id="GeoInfo-463"><a href="#GeoInfo-463"><span class="linenos">463</span></a>
</span><span id="GeoInfo-464"><a href="#GeoInfo-464"><span class="linenos">464</span></a>                    <span class="c1"># test that field order hasn&#39;t changed in the db</span>
</span><span id="GeoInfo-465"><a href="#GeoInfo-465"><span class="linenos">465</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span> <span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">field_descr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_population</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="p">):</span>
</span><span id="GeoInfo-466"><a href="#GeoInfo-466"><span class="linenos">466</span></a>                        <span class="k">raise</span> <span class="n">CoaDbError</span><span class="p">(</span><span class="s1">&#39;The worldometers database changed its field names. &#39;</span>
</span><span id="GeoInfo-467"><a href="#GeoInfo-467"><span class="linenos">467</span></a>                            <span class="s1">&#39;The GeoInfo should be updated. Please contact developers.&#39;</span><span class="p">)</span>
</span><span id="GeoInfo-468"><a href="#GeoInfo-468"><span class="linenos">468</span></a>
</span><span id="GeoInfo-469"><a href="#GeoInfo-469"><span class="linenos">469</span></a>                    <span class="c1"># change field name</span>
</span><span id="GeoInfo-470"><a href="#GeoInfo-470"><span class="linenos">470</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_data_population</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">field_descr</span><span class="p">]</span>
</span><span id="GeoInfo-471"><a href="#GeoInfo-471"><span class="linenos">471</span></a>
</span><span id="GeoInfo-472"><a href="#GeoInfo-472"><span class="linenos">472</span></a>                    <span class="c1"># standardization of country name</span>
</span><span id="GeoInfo-473"><a href="#GeoInfo-473"><span class="linenos">473</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_data_population</span><span class="p">[</span><span class="s1">&#39;iso3_tmp2&#39;</span><span class="p">]</span><span class="o">=</span>\
</span><span id="GeoInfo-474"><a href="#GeoInfo-474"><span class="linenos">474</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_gm</span><span class="o">.</span><span class="n">to_standard</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_population</span><span class="p">[</span><span class="s1">&#39;country&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>\
</span><span id="GeoInfo-475"><a href="#GeoInfo-475"><span class="linenos">475</span></a>                        <span class="n">db</span><span class="o">=</span><span class="s1">&#39;worldometers&#39;</span><span class="p">)</span>
</span><span id="GeoInfo-476"><a href="#GeoInfo-476"><span class="linenos">476</span></a>
</span><span id="GeoInfo-477"><a href="#GeoInfo-477"><span class="linenos">477</span></a>                <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_population</span><span class="p">[[</span><span class="s2">&quot;iso3_tmp2&quot;</span><span class="p">,</span><span class="n">f</span><span class="p">]],</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>\
</span><span id="GeoInfo-478"><a href="#GeoInfo-478"><span class="linenos">478</span></a>                        <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;iso3_tmp&#39;</span><span class="p">,</span><span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;iso3_tmp2&#39;</span><span class="p">,</span>\
</span><span id="GeoInfo-479"><a href="#GeoInfo-479"><span class="linenos">479</span></a>                        <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;_tmp&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;iso3_tmp2&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="GeoInfo-480"><a href="#GeoInfo-480"><span class="linenos">480</span></a>            <span class="c1"># ----------------------------------------------------------</span>
</span><span id="GeoInfo-481"><a href="#GeoInfo-481"><span class="linenos">481</span></a>            <span class="k">elif</span> <span class="n">f</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;region_code_list&#39;</span><span class="p">,</span><span class="s1">&#39;region_name_list&#39;</span><span class="p">]:</span>
</span><span id="GeoInfo-482"><a href="#GeoInfo-482"><span class="linenos">482</span></a>
</span><span id="GeoInfo-483"><a href="#GeoInfo-483"><span class="linenos">483</span></a>                <span class="k">if</span> <span class="n">f</span> <span class="o">==</span> <span class="s1">&#39;region_code_list&#39;</span><span class="p">:</span>
</span><span id="GeoInfo-484"><a href="#GeoInfo-484"><span class="linenos">484</span></a>                    <span class="n">ff</span> <span class="o">=</span> <span class="s1">&#39;region&#39;</span>
</span><span id="GeoInfo-485"><a href="#GeoInfo-485"><span class="linenos">485</span></a>                <span class="k">elif</span> <span class="n">f</span> <span class="o">==</span> <span class="s1">&#39;region_name_list&#39;</span><span class="p">:</span>
</span><span id="GeoInfo-486"><a href="#GeoInfo-486"><span class="linenos">486</span></a>                    <span class="n">ff</span> <span class="o">=</span> <span class="s1">&#39;region_name&#39;</span>
</span><span id="GeoInfo-487"><a href="#GeoInfo-487"><span class="linenos">487</span></a>
</span><span id="GeoInfo-488"><a href="#GeoInfo-488"><span class="linenos">488</span></a>                <span class="n">p</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_grp</span><span class="p">[[</span><span class="s1">&#39;iso3&#39;</span><span class="p">,</span><span class="n">ff</span><span class="p">]],</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>\
</span><span id="GeoInfo-489"><a href="#GeoInfo-489"><span class="linenos">489</span></a>                    <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;iso3_tmp&#39;</span><span class="p">,</span><span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;iso3&#39;</span><span class="p">,</span>\
</span><span id="GeoInfo-490"><a href="#GeoInfo-490"><span class="linenos">490</span></a>                    <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;_tmp&#39;</span><span class="p">))</span> \
</span><span id="GeoInfo-491"><a href="#GeoInfo-491"><span class="linenos">491</span></a>                    <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;iso3_tmp&#39;</span><span class="p">)[</span><span class="n">ff</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
</span><span id="GeoInfo-492"><a href="#GeoInfo-492"><span class="linenos">492</span></a>            <span class="c1"># ----------------------------------------------------------</span>
</span><span id="GeoInfo-493"><a href="#GeoInfo-493"><span class="linenos">493</span></a>            <span class="k">elif</span> <span class="n">f</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;capital&#39;</span><span class="p">]:</span>
</span><span id="GeoInfo-494"><a href="#GeoInfo-494"><span class="linenos">494</span></a>                <span class="n">p</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_grp</span><span class="p">[[</span><span class="s1">&#39;iso3&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(),</span> \
</span><span id="GeoInfo-495"><a href="#GeoInfo-495"><span class="linenos">495</span></a>                    <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;iso3_tmp&#39;</span><span class="p">,</span><span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;iso3&#39;</span><span class="p">,</span>\
</span><span id="GeoInfo-496"><a href="#GeoInfo-496"><span class="linenos">496</span></a>                    <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;_tmp&#39;</span><span class="p">))[</span><span class="n">f</span><span class="p">]</span>
</span><span id="GeoInfo-497"><a href="#GeoInfo-497"><span class="linenos">497</span></a>
</span><span id="GeoInfo-498"><a href="#GeoInfo-498"><span class="linenos">498</span></a>            <span class="c1"># ----------------------------------------------------------</span>
</span><span id="GeoInfo-499"><a href="#GeoInfo-499"><span class="linenos">499</span></a>            <span class="k">elif</span> <span class="n">f</span> <span class="o">==</span> <span class="s1">&#39;geometry&#39;</span><span class="p">:</span>
</span><span id="GeoInfo-500"><a href="#GeoInfo-500"><span class="linenos">500</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_geometry</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="GeoInfo-501"><a href="#GeoInfo-501"><span class="linenos">501</span></a>                    <span class="c1">#geojsondatafile = &#39;https://raw.githubusercontent.com/johan/world.geo.json/master/countries.geo.json&#39;</span>
</span><span id="GeoInfo-502"><a href="#GeoInfo-502"><span class="linenos">502</span></a>                    <span class="c1">#self._data_geometry = gpd.read_file(get_local_from_url(geojsondatafile,0,&#39;.json&#39;))[[&quot;id&quot;,&quot;geometry&quot;]]</span>
</span><span id="GeoInfo-503"><a href="#GeoInfo-503"><span class="linenos">503</span></a>                    <span class="n">world_geometry_url_zipfile</span><span class="o">=</span><span class="s1">&#39;http://thematicmapping.org/downloads/TM_WORLD_BORDERS_SIMPL-0.3.zip&#39;</span> <span class="c1"># too much simplified version ?</span>
</span><span id="GeoInfo-504"><a href="#GeoInfo-504"><span class="linenos">504</span></a>                    <span class="c1"># world_geometry_url_zipfile=&#39;http://thematicmapping.org/downloads/TM_WORLD_BORDERS-0.3.zip&#39; # too precize version ?</span>
</span><span id="GeoInfo-505"><a href="#GeoInfo-505"><span class="linenos">505</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_data_geometry</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;zip://&#39;</span><span class="o">+</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="n">world_geometry_url_zipfile</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;.zip&#39;</span><span class="p">))[[</span><span class="s1">&#39;ISO3&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]]</span>
</span><span id="GeoInfo-506"><a href="#GeoInfo-506"><span class="linenos">506</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_data_geometry</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;id_tmp&quot;</span><span class="p">,</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span>
</span><span id="GeoInfo-507"><a href="#GeoInfo-507"><span class="linenos">507</span></a>
</span><span id="GeoInfo-508"><a href="#GeoInfo-508"><span class="linenos">508</span></a>                    <span class="c1"># About some countries not properly managed by this database (south and north soudan)</span>
</span><span id="GeoInfo-509"><a href="#GeoInfo-509"><span class="linenos">509</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_data_geometry</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_geometry</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;id_tmp&#39;</span><span class="p">:</span><span class="s1">&#39;SSD&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">},</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoInfo-510"><a href="#GeoInfo-510"><span class="linenos">510</span></a>                    <span class="c1">#self._data_geometry=self._data_geometry.append({&#39;id_tmp&#39;:&#39;SSD&#39;,&#39;geometry&#39;:None},ignore_index=True) # adding the SSD row</span>
</span><span id="GeoInfo-511"><a href="#GeoInfo-511"><span class="linenos">511</span></a>                    <span class="c1">#self._data_geometry=pd.concat([self._data_geometry,pd.DataFrame({&#39;id_tmp&#39;:&#39;SSD&#39;,&#39;geometry&#39;:None})])</span>
</span><span id="GeoInfo-512"><a href="#GeoInfo-512"><span class="linenos">512</span></a>                    <span class="k">for</span> <span class="n">newc</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;SSD&#39;</span><span class="p">,</span><span class="s1">&#39;SDN&#39;</span><span class="p">]:</span>
</span><span id="GeoInfo-513"><a href="#GeoInfo-513"><span class="linenos">513</span></a>                        <span class="n">newgeo</span><span class="o">=</span><span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="s1">&#39;https://github.com/johan/world.geo.json/raw/master/countries/&#39;</span><span class="o">+</span><span class="n">newc</span><span class="o">+</span><span class="s1">&#39;.geo.json&#39;</span><span class="p">))</span>
</span><span id="GeoInfo-514"><a href="#GeoInfo-514"><span class="linenos">514</span></a>                        <span class="n">poly</span><span class="o">=</span><span class="n">newgeo</span><span class="p">[</span><span class="n">newgeo</span><span class="o">.</span><span class="n">id</span><span class="o">==</span><span class="n">newc</span><span class="p">]</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GeoInfo-515"><a href="#GeoInfo-515"><span class="linenos">515</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_data_geometry</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_geometry</span><span class="o">.</span><span class="n">id_tmp</span><span class="o">==</span><span class="n">newc</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
</span><span id="GeoInfo-516"><a href="#GeoInfo-516"><span class="linenos">516</span></a>
</span><span id="GeoInfo-517"><a href="#GeoInfo-517"><span class="linenos">517</span></a>                    <span class="c1"># About countries that we artificially put on the east of the map</span>
</span><span id="GeoInfo-518"><a href="#GeoInfo-518"><span class="linenos">518</span></a>                    <span class="k">for</span> <span class="n">newc</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;RUS&#39;</span><span class="p">,</span><span class="s1">&#39;FJI&#39;</span><span class="p">,</span><span class="s1">&#39;NZL&#39;</span><span class="p">,</span><span class="s1">&#39;WSM&#39;</span><span class="p">]:</span>
</span><span id="GeoInfo-519"><a href="#GeoInfo-519"><span class="linenos">519</span></a>                        <span class="n">poly</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_geometry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_geometry</span><span class="o">.</span><span class="n">id_tmp</span><span class="o">==</span><span class="n">newc</span><span class="p">]</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GeoInfo-520"><a href="#GeoInfo-520"><span class="linenos">520</span></a>                        <span class="n">poly</span><span class="o">=</span><span class="n">so</span><span class="o">.</span><span class="n">unary_union</span><span class="p">(</span><span class="n">sg</span><span class="o">.</span><span class="n">MultiPolygon</span><span class="p">([</span><span class="n">sg</span><span class="o">.</span><span class="n">Polygon</span><span class="p">([(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="k">else</span> <span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mi">360</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">coords</span><span class="p">])</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">poly</span><span class="o">.</span><span class="n">geoms</span><span class="p">]))</span>
</span><span id="GeoInfo-521"><a href="#GeoInfo-521"><span class="linenos">521</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_data_geometry</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_geometry</span><span class="o">.</span><span class="n">id_tmp</span><span class="o">==</span><span class="n">newc</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
</span><span id="GeoInfo-522"><a href="#GeoInfo-522"><span class="linenos">522</span></a>
</span><span id="GeoInfo-523"><a href="#GeoInfo-523"><span class="linenos">523</span></a>                    <span class="c1"># About countries that we artificially put on the west of the map</span>
</span><span id="GeoInfo-524"><a href="#GeoInfo-524"><span class="linenos">524</span></a>                    <span class="k">for</span> <span class="n">newc</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;USA&#39;</span><span class="p">]:</span>
</span><span id="GeoInfo-525"><a href="#GeoInfo-525"><span class="linenos">525</span></a>                        <span class="n">poly</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_geometry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_geometry</span><span class="o">.</span><span class="n">id_tmp</span><span class="o">==</span><span class="n">newc</span><span class="p">]</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GeoInfo-526"><a href="#GeoInfo-526"><span class="linenos">526</span></a>                        <span class="n">poly</span><span class="o">=</span><span class="n">so</span><span class="o">.</span><span class="n">unary_union</span><span class="p">(</span><span class="n">sg</span><span class="o">.</span><span class="n">MultiPolygon</span><span class="p">([</span><span class="n">sg</span><span class="o">.</span><span class="n">Polygon</span><span class="p">([(</span><span class="n">x</span><span class="o">-</span><span class="mi">360</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="k">else</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">coords</span><span class="p">])</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">poly</span><span class="o">.</span><span class="n">geoms</span><span class="p">]))</span>
</span><span id="GeoInfo-527"><a href="#GeoInfo-527"><span class="linenos">527</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_data_geometry</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_geometry</span><span class="o">.</span><span class="n">id_tmp</span><span class="o">==</span><span class="n">newc</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
</span><span id="GeoInfo-528"><a href="#GeoInfo-528"><span class="linenos">528</span></a>
</span><span id="GeoInfo-529"><a href="#GeoInfo-529"><span class="linenos">529</span></a>                <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_geometry</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>\
</span><span id="GeoInfo-530"><a href="#GeoInfo-530"><span class="linenos">530</span></a>                    <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;iso3_tmp&#39;</span><span class="p">,</span><span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;id_tmp&#39;</span><span class="p">,</span>\
</span><span id="GeoInfo-531"><a href="#GeoInfo-531"><span class="linenos">531</span></a>                    <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;_tmp&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;id_tmp&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="GeoInfo-532"><a href="#GeoInfo-532"><span class="linenos">532</span></a>
</span><span id="GeoInfo-533"><a href="#GeoInfo-533"><span class="linenos">533</span></a>            <span class="c1"># -----------------------------------------------------------</span>
</span><span id="GeoInfo-534"><a href="#GeoInfo-534"><span class="linenos">534</span></a>            <span class="k">elif</span> <span class="n">f</span> <span class="o">==</span> <span class="s1">&#39;flag&#39;</span><span class="p">:</span>
</span><span id="GeoInfo-535"><a href="#GeoInfo-535"><span class="linenos">535</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_flag</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="GeoInfo-536"><a href="#GeoInfo-536"><span class="linenos">536</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_data_flag</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="s1">&#39;https://github.com/linssen/country-flag-icons/raw/master/countries.json&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
</span><span id="GeoInfo-537"><a href="#GeoInfo-537"><span class="linenos">537</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_data_flag</span><span class="p">[</span><span class="s1">&#39;flag_url&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;http:&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_flag</span><span class="p">[</span><span class="s1">&#39;file_url&#39;</span><span class="p">]</span>
</span><span id="GeoInfo-538"><a href="#GeoInfo-538"><span class="linenos">538</span></a>
</span><span id="GeoInfo-539"><a href="#GeoInfo-539"><span class="linenos">539</span></a>                <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_flag</span><span class="p">[[</span><span class="s1">&#39;alpha3&#39;</span><span class="p">,</span><span class="s1">&#39;flag_url&#39;</span><span class="p">]],</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>\
</span><span id="GeoInfo-540"><a href="#GeoInfo-540"><span class="linenos">540</span></a>                    <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;iso3_tmp&#39;</span><span class="p">,</span><span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;alpha3&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;alpha3&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="GeoInfo-541"><a href="#GeoInfo-541"><span class="linenos">541</span></a>
</span><span id="GeoInfo-542"><a href="#GeoInfo-542"><span class="linenos">542</span></a>        <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;iso2_tmp&#39;</span><span class="p">,</span><span class="s1">&#39;iso3_tmp&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>GeoInfo class definition. No inheritance from any other class.</p>

<p>It should raise only CoaError and derived exceptions in case
of errors (see pycoa.error)</p>
</div>


                            <div id="GeoInfo.__init__" class="classattr">
                                        <input id="GeoInfo.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">GeoInfo</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">gm</span><span class="o">=</span><span class="mi">0</span></span>)</span>

                <label class="view-source-button" for="GeoInfo.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GeoInfo.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GeoInfo.__init__-338"><a href="#GeoInfo.__init__-338"><span class="linenos">338</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">gm</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span id="GeoInfo.__init__-339"><a href="#GeoInfo.__init__-339"><span class="linenos">339</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; __init__ member function.</span>
</span><span id="GeoInfo.__init__-340"><a href="#GeoInfo.__init__-340"><span class="linenos">340</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoInfo.__init__-341"><a href="#GeoInfo.__init__-341"><span class="linenos">341</span></a>        <span class="n">verb</span><span class="p">(</span><span class="s2">&quot;Init of GeoInfo() from &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="GeoInfo.__init__-342"><a href="#GeoInfo.__init__-342"><span class="linenos">342</span></a>        <span class="k">if</span> <span class="n">gm</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="GeoInfo.__init__-343"><a href="#GeoInfo.__init__-343"><span class="linenos">343</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_gm</span><span class="o">=</span><span class="n">gm</span>
</span><span id="GeoInfo.__init__-344"><a href="#GeoInfo.__init__-344"><span class="linenos">344</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GeoInfo.__init__-345"><a href="#GeoInfo.__init__-345"><span class="linenos">345</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_gm</span><span class="o">=</span><span class="n">GeoManager</span><span class="p">()</span>
</span><span id="GeoInfo.__init__-346"><a href="#GeoInfo.__init__-346"><span class="linenos">346</span></a>
</span><span id="GeoInfo.__init__-347"><a href="#GeoInfo.__init__-347"><span class="linenos">347</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_grp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_gm</span><span class="o">.</span><span class="n">_gr</span><span class="o">.</span><span class="n">get_pandas</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>__init__ member function.</p>
</div>


                            </div>
                            <div id="GeoInfo.get_GeoManager" class="classattr">
                                        <input id="GeoInfo.get_GeoManager-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_GeoManager</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GeoInfo.get_GeoManager-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GeoInfo.get_GeoManager"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GeoInfo.get_GeoManager-349"><a href="#GeoInfo.get_GeoManager-349"><span class="linenos">349</span></a>    <span class="k">def</span> <span class="nf">get_GeoManager</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GeoInfo.get_GeoManager-350"><a href="#GeoInfo.get_GeoManager-350"><span class="linenos">350</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; return the local instance of used GeoManager()</span>
</span><span id="GeoInfo.get_GeoManager-351"><a href="#GeoInfo.get_GeoManager-351"><span class="linenos">351</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoInfo.get_GeoManager-352"><a href="#GeoInfo.get_GeoManager-352"><span class="linenos">352</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gm</span>
</span></pre></div>


            <div class="docstring"><p>return the local instance of used GeoManager()</p>
</div>


                            </div>
                            <div id="GeoInfo.get_list_field" class="classattr">
                                        <input id="GeoInfo.get_list_field-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_list_field</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GeoInfo.get_list_field-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GeoInfo.get_list_field"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GeoInfo.get_list_field-354"><a href="#GeoInfo.get_list_field-354"><span class="linenos">354</span></a>    <span class="k">def</span> <span class="nf">get_list_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GeoInfo.get_list_field-355"><a href="#GeoInfo.get_list_field-355"><span class="linenos">355</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; return the list of supported additionnal fields available</span>
</span><span id="GeoInfo.get_list_field-356"><a href="#GeoInfo.get_list_field-356"><span class="linenos">356</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoInfo.get_list_field-357"><a href="#GeoInfo.get_list_field-357"><span class="linenos">357</span></a>        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_list_field</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
</span></pre></div>


            <div class="docstring"><p>return the list of supported additionnal fields available</p>
</div>


                            </div>
                            <div id="GeoInfo.get_source" class="classattr">
                                        <input id="GeoInfo.get_source-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_source</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">field</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GeoInfo.get_source-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GeoInfo.get_source"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GeoInfo.get_source-359"><a href="#GeoInfo.get_source-359"><span class="linenos">359</span></a>    <span class="k">def</span> <span class="nf">get_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">field</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="GeoInfo.get_source-360"><a href="#GeoInfo.get_source-360"><span class="linenos">360</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; return the source of the information provided for a given</span>
</span><span id="GeoInfo.get_source-361"><a href="#GeoInfo.get_source-361"><span class="linenos">361</span></a><span class="sd">        field.</span>
</span><span id="GeoInfo.get_source-362"><a href="#GeoInfo.get_source-362"><span class="linenos">362</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoInfo.get_source-363"><a href="#GeoInfo.get_source-363"><span class="linenos">363</span></a>        <span class="k">if</span> <span class="n">field</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
</span><span id="GeoInfo.get_source-364"><a href="#GeoInfo.get_source-364"><span class="linenos">364</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_list_field</span>
</span><span id="GeoInfo.get_source-365"><a href="#GeoInfo.get_source-365"><span class="linenos">365</span></a>        <span class="k">elif</span> <span class="n">field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list_field</span><span class="p">():</span>
</span><span id="GeoInfo.get_source-366"><a href="#GeoInfo.get_source-366"><span class="linenos">366</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;The field &quot;&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">field</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;&quot; is not &#39;</span>
</span><span id="GeoInfo.get_source-367"><a href="#GeoInfo.get_source-367"><span class="linenos">367</span></a>                <span class="s1">&#39;a supported field of GeoInfo(). Please see help or &#39;</span>
</span><span id="GeoInfo.get_source-368"><a href="#GeoInfo.get_source-368"><span class="linenos">368</span></a>                <span class="s1">&#39;the get_list_field() output.&#39;</span><span class="p">)</span>
</span><span id="GeoInfo.get_source-369"><a href="#GeoInfo.get_source-369"><span class="linenos">369</span></a>        <span class="k">return</span> <span class="n">field</span><span class="o">+</span><span class="s1">&#39; : &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_list_field</span><span class="p">[</span><span class="n">field</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>return the source of the information provided for a given
field.</p>
</div>


                            </div>
                            <div id="GeoInfo.add_field" class="classattr">
                                        <input id="GeoInfo.add_field-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_field</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GeoInfo.add_field-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GeoInfo.add_field"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GeoInfo.add_field-372"><a href="#GeoInfo.add_field-372"><span class="linenos">372</span></a>    <span class="k">def</span> <span class="nf">add_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="GeoInfo.add_field-373"><a href="#GeoInfo.add_field-373"><span class="linenos">373</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; this is the main function of the GeoInfo class. It adds to</span>
</span><span id="GeoInfo.add_field-374"><a href="#GeoInfo.add_field-374"><span class="linenos">374</span></a><span class="sd">        the input pandas dataframe some fields according to</span>
</span><span id="GeoInfo.add_field-375"><a href="#GeoInfo.add_field-375"><span class="linenos">375</span></a><span class="sd">        the geofield field of input.</span>
</span><span id="GeoInfo.add_field-376"><a href="#GeoInfo.add_field-376"><span class="linenos">376</span></a><span class="sd">        The return value is the pandas dataframe.</span>
</span><span id="GeoInfo.add_field-377"><a href="#GeoInfo.add_field-377"><span class="linenos">377</span></a>
</span><span id="GeoInfo.add_field-378"><a href="#GeoInfo.add_field-378"><span class="linenos">378</span></a><span class="sd">        Arguments :</span>
</span><span id="GeoInfo.add_field-379"><a href="#GeoInfo.add_field-379"><span class="linenos">379</span></a><span class="sd">        field    -- should be given as a string of list of strings and</span>
</span><span id="GeoInfo.add_field-380"><a href="#GeoInfo.add_field-380"><span class="linenos">380</span></a><span class="sd">                    should be valid fields (see get_list_field() )</span>
</span><span id="GeoInfo.add_field-381"><a href="#GeoInfo.add_field-381"><span class="linenos">381</span></a><span class="sd">                    Mandatory.</span>
</span><span id="GeoInfo.add_field-382"><a href="#GeoInfo.add_field-382"><span class="linenos">382</span></a><span class="sd">        input    -- provide the input pandas dataframe. Mandatory.</span>
</span><span id="GeoInfo.add_field-383"><a href="#GeoInfo.add_field-383"><span class="linenos">383</span></a><span class="sd">        geofield -- provide the field name in the pandas where the</span>
</span><span id="GeoInfo.add_field-384"><a href="#GeoInfo.add_field-384"><span class="linenos">384</span></a><span class="sd">                    location is stored. Default : &#39;where&#39;</span>
</span><span id="GeoInfo.add_field-385"><a href="#GeoInfo.add_field-385"><span class="linenos">385</span></a><span class="sd">        overload -- Allow to overload a field. Boolean value.</span>
</span><span id="GeoInfo.add_field-386"><a href="#GeoInfo.add_field-386"><span class="linenos">386</span></a><span class="sd">                    Default : False</span>
</span><span id="GeoInfo.add_field-387"><a href="#GeoInfo.add_field-387"><span class="linenos">387</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoInfo.add_field-388"><a href="#GeoInfo.add_field-388"><span class="linenos">388</span></a>
</span><span id="GeoInfo.add_field-389"><a href="#GeoInfo.add_field-389"><span class="linenos">389</span></a>        <span class="c1"># --- kwargs analysis ---</span>
</span><span id="GeoInfo.add_field-390"><a href="#GeoInfo.add_field-390"><span class="linenos">390</span></a>
</span><span id="GeoInfo.add_field-391"><a href="#GeoInfo.add_field-391"><span class="linenos">391</span></a>        <span class="n">kwargs_test</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;field&#39;</span><span class="p">,</span><span class="s1">&#39;input&#39;</span><span class="p">,</span><span class="s1">&#39;geofield&#39;</span><span class="p">,</span><span class="s1">&#39;overload&#39;</span><span class="p">],</span>
</span><span id="GeoInfo.add_field-392"><a href="#GeoInfo.add_field-392"><span class="linenos">392</span></a>            <span class="s1">&#39;Bad args used in the add_field() function.&#39;</span><span class="p">)</span>
</span><span id="GeoInfo.add_field-393"><a href="#GeoInfo.add_field-393"><span class="linenos">393</span></a>
</span><span id="GeoInfo.add_field-394"><a href="#GeoInfo.add_field-394"><span class="linenos">394</span></a>        <span class="n">p</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span> <span class="c1"># the panda</span>
</span><span id="GeoInfo.add_field-395"><a href="#GeoInfo.add_field-395"><span class="linenos">395</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
</span><span id="GeoInfo.add_field-396"><a href="#GeoInfo.add_field-396"><span class="linenos">396</span></a>            <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s1">&#39;You should provide a valid input pandas&#39;</span>
</span><span id="GeoInfo.add_field-397"><a href="#GeoInfo.add_field-397"><span class="linenos">397</span></a>                <span class="s1">&#39; DataFrame as input. See help.&#39;</span><span class="p">)</span>
</span><span id="GeoInfo.add_field-398"><a href="#GeoInfo.add_field-398"><span class="linenos">398</span></a>        <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="GeoInfo.add_field-399"><a href="#GeoInfo.add_field-399"><span class="linenos">399</span></a>
</span><span id="GeoInfo.add_field-400"><a href="#GeoInfo.add_field-400"><span class="linenos">400</span></a>        <span class="n">overload</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;overload&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
</span><span id="GeoInfo.add_field-401"><a href="#GeoInfo.add_field-401"><span class="linenos">401</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">overload</span><span class="p">,</span><span class="nb">bool</span><span class="p">):</span>
</span><span id="GeoInfo.add_field-402"><a href="#GeoInfo.add_field-402"><span class="linenos">402</span></a>            <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s1">&#39;The overload option should be a boolean.&#39;</span><span class="p">)</span>
</span><span id="GeoInfo.add_field-403"><a href="#GeoInfo.add_field-403"><span class="linenos">403</span></a>
</span><span id="GeoInfo.add_field-404"><a href="#GeoInfo.add_field-404"><span class="linenos">404</span></a>        <span class="n">fl</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;field&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span> <span class="c1"># field list</span>
</span><span id="GeoInfo.add_field-405"><a href="#GeoInfo.add_field-405"><span class="linenos">405</span></a>        <span class="k">if</span> <span class="n">fl</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GeoInfo.add_field-406"><a href="#GeoInfo.add_field-406"><span class="linenos">406</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;No field given. See help.&#39;</span><span class="p">)</span>
</span><span id="GeoInfo.add_field-407"><a href="#GeoInfo.add_field-407"><span class="linenos">407</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
</span><span id="GeoInfo.add_field-408"><a href="#GeoInfo.add_field-408"><span class="linenos">408</span></a>            <span class="n">fl</span><span class="o">=</span><span class="p">[</span><span class="n">fl</span><span class="p">]</span>
</span><span id="GeoInfo.add_field-409"><a href="#GeoInfo.add_field-409"><span class="linenos">409</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list_field</span><span class="p">()</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fl</span><span class="p">):</span>
</span><span id="GeoInfo.add_field-410"><a href="#GeoInfo.add_field-410"><span class="linenos">410</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;All fields are not valid or supported &#39;</span>
</span><span id="GeoInfo.add_field-411"><a href="#GeoInfo.add_field-411"><span class="linenos">411</span></a>                <span class="s1">&#39;ones. Please see help of get_list_field()&#39;</span><span class="p">)</span>
</span><span id="GeoInfo.add_field-412"><a href="#GeoInfo.add_field-412"><span class="linenos">412</span></a>
</span><span id="GeoInfo.add_field-413"><a href="#GeoInfo.add_field-413"><span class="linenos">413</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">overload</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">f</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fl</span><span class="p">):</span>
</span><span id="GeoInfo.add_field-414"><a href="#GeoInfo.add_field-414"><span class="linenos">414</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;Some fields already exist in you panda &#39;</span>
</span><span id="GeoInfo.add_field-415"><a href="#GeoInfo.add_field-415"><span class="linenos">415</span></a>                <span class="s1">&#39;dataframe columns. You may set overload to True.&#39;</span><span class="p">)</span>
</span><span id="GeoInfo.add_field-416"><a href="#GeoInfo.add_field-416"><span class="linenos">416</span></a>
</span><span id="GeoInfo.add_field-417"><a href="#GeoInfo.add_field-417"><span class="linenos">417</span></a>        <span class="n">geofield</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;geofield&#39;</span><span class="p">,</span><span class="s1">&#39;where&#39;</span><span class="p">)</span>
</span><span id="GeoInfo.add_field-418"><a href="#GeoInfo.add_field-418"><span class="linenos">418</span></a>
</span><span id="GeoInfo.add_field-419"><a href="#GeoInfo.add_field-419"><span class="linenos">419</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geofield</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
</span><span id="GeoInfo.add_field-420"><a href="#GeoInfo.add_field-420"><span class="linenos">420</span></a>            <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s1">&#39;The geofield should be given as a &#39;</span>
</span><span id="GeoInfo.add_field-421"><a href="#GeoInfo.add_field-421"><span class="linenos">421</span></a>                <span class="s1">&#39;string.&#39;</span><span class="p">)</span>
</span><span id="GeoInfo.add_field-422"><a href="#GeoInfo.add_field-422"><span class="linenos">422</span></a>        <span class="k">if</span> <span class="n">geofield</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
</span><span id="GeoInfo.add_field-423"><a href="#GeoInfo.add_field-423"><span class="linenos">423</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;The geofield &quot;&#39;</span><span class="o">+</span><span class="n">geofield</span><span class="o">+</span><span class="s1">&#39;&quot; given is &#39;</span>
</span><span id="GeoInfo.add_field-424"><a href="#GeoInfo.add_field-424"><span class="linenos">424</span></a>                <span class="s1">&#39;not a valid column name of the input pandas dataframe.&#39;</span><span class="p">)</span>
</span><span id="GeoInfo.add_field-425"><a href="#GeoInfo.add_field-425"><span class="linenos">425</span></a>
</span><span id="GeoInfo.add_field-426"><a href="#GeoInfo.add_field-426"><span class="linenos">426</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_gm</span><span class="o">.</span><span class="n">set_standard</span><span class="p">(</span><span class="s1">&#39;iso2&#39;</span><span class="p">)</span>
</span><span id="GeoInfo.add_field-427"><a href="#GeoInfo.add_field-427"><span class="linenos">427</span></a>        <span class="n">countries_iso2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_gm</span><span class="o">.</span><span class="n">to_standard</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">geofield</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</span><span id="GeoInfo.add_field-428"><a href="#GeoInfo.add_field-428"><span class="linenos">428</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_gm</span><span class="o">.</span><span class="n">set_standard</span><span class="p">(</span><span class="s1">&#39;iso3&#39;</span><span class="p">)</span>
</span><span id="GeoInfo.add_field-429"><a href="#GeoInfo.add_field-429"><span class="linenos">429</span></a>        <span class="n">countries_iso3</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_gm</span><span class="o">.</span><span class="n">to_standard</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">geofield</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</span><span id="GeoInfo.add_field-430"><a href="#GeoInfo.add_field-430"><span class="linenos">430</span></a>
</span><span id="GeoInfo.add_field-431"><a href="#GeoInfo.add_field-431"><span class="linenos">431</span></a>        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;iso2_tmp&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">countries_iso2</span>
</span><span id="GeoInfo.add_field-432"><a href="#GeoInfo.add_field-432"><span class="linenos">432</span></a>        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;iso3_tmp&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">countries_iso3</span>
</span><span id="GeoInfo.add_field-433"><a href="#GeoInfo.add_field-433"><span class="linenos">433</span></a>
</span><span id="GeoInfo.add_field-434"><a href="#GeoInfo.add_field-434"><span class="linenos">434</span></a>        <span class="c1"># --- loop over all needed fields ---</span>
</span><span id="GeoInfo.add_field-435"><a href="#GeoInfo.add_field-435"><span class="linenos">435</span></a>        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fl</span><span class="p">:</span>
</span><span id="GeoInfo.add_field-436"><a href="#GeoInfo.add_field-436"><span class="linenos">436</span></a>            <span class="k">if</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
</span><span id="GeoInfo.add_field-437"><a href="#GeoInfo.add_field-437"><span class="linenos">437</span></a>                <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="GeoInfo.add_field-438"><a href="#GeoInfo.add_field-438"><span class="linenos">438</span></a>            <span class="c1"># ----------------------------------------------------------</span>
</span><span id="GeoInfo.add_field-439"><a href="#GeoInfo.add_field-439"><span class="linenos">439</span></a>            <span class="k">if</span> <span class="n">f</span> <span class="o">==</span> <span class="s1">&#39;continent_code&#39;</span><span class="p">:</span>
</span><span id="GeoInfo.add_field-440"><a href="#GeoInfo.add_field-440"><span class="linenos">440</span></a>                <span class="n">p</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">pcc</span><span class="o">.</span><span class="n">country_alpha2_to_continent_code</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">countries_iso2</span><span class="p">]</span>
</span><span id="GeoInfo.add_field-441"><a href="#GeoInfo.add_field-441"><span class="linenos">441</span></a>            <span class="c1"># ----------------------------------------------------------</span>
</span><span id="GeoInfo.add_field-442"><a href="#GeoInfo.add_field-442"><span class="linenos">442</span></a>            <span class="k">elif</span> <span class="n">f</span> <span class="o">==</span> <span class="s1">&#39;continent_name&#39;</span><span class="p">:</span>
</span><span id="GeoInfo.add_field-443"><a href="#GeoInfo.add_field-443"><span class="linenos">443</span></a>                <span class="n">p</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">pcc</span><span class="o">.</span><span class="n">convert_continent_code_to_continent_name</span><span class="p">(</span> \
</span><span id="GeoInfo.add_field-444"><a href="#GeoInfo.add_field-444"><span class="linenos">444</span></a>                    <span class="n">pcc</span><span class="o">.</span><span class="n">country_alpha2_to_continent_code</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">countries_iso2</span> <span class="p">]</span>
</span><span id="GeoInfo.add_field-445"><a href="#GeoInfo.add_field-445"><span class="linenos">445</span></a>            <span class="c1"># ----------------------------------------------------------</span>
</span><span id="GeoInfo.add_field-446"><a href="#GeoInfo.add_field-446"><span class="linenos">446</span></a>            <span class="k">elif</span> <span class="n">f</span> <span class="o">==</span> <span class="s1">&#39;country_name&#39;</span><span class="p">:</span>
</span><span id="GeoInfo.add_field-447"><a href="#GeoInfo.add_field-447"><span class="linenos">447</span></a>                <span class="n">p</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">pcc</span><span class="o">.</span><span class="n">country_alpha2_to_country_name</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">countries_iso2</span><span class="p">]</span>
</span><span id="GeoInfo.add_field-448"><a href="#GeoInfo.add_field-448"><span class="linenos">448</span></a>            <span class="c1"># ----------------------------------------------------------</span>
</span><span id="GeoInfo.add_field-449"><a href="#GeoInfo.add_field-449"><span class="linenos">449</span></a>            <span class="k">elif</span> <span class="n">f</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;population&#39;</span><span class="p">,</span><span class="s1">&#39;area&#39;</span><span class="p">,</span><span class="s1">&#39;fertility&#39;</span><span class="p">,</span><span class="s1">&#39;median_age&#39;</span><span class="p">,</span><span class="s1">&#39;urban_rate&#39;</span><span class="p">]:</span>
</span><span id="GeoInfo.add_field-450"><a href="#GeoInfo.add_field-450"><span class="linenos">450</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_population</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="GeoInfo.add_field-451"><a href="#GeoInfo.add_field-451"><span class="linenos">451</span></a>
</span><span id="GeoInfo.add_field-452"><a href="#GeoInfo.add_field-452"><span class="linenos">452</span></a>                    <span class="n">field_descr</span><span class="o">=</span><span class="p">(</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;idx&#39;</span><span class="p">),</span>
</span><span id="GeoInfo.add_field-453"><a href="#GeoInfo.add_field-453"><span class="linenos">453</span></a>                        <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;Country&#39;</span><span class="p">,</span><span class="s1">&#39;country&#39;</span><span class="p">),</span>
</span><span id="GeoInfo.add_field-454"><a href="#GeoInfo.add_field-454"><span class="linenos">454</span></a>                        <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;Population&#39;</span><span class="p">,</span><span class="s1">&#39;population&#39;</span><span class="p">),</span>
</span><span id="GeoInfo.add_field-455"><a href="#GeoInfo.add_field-455"><span class="linenos">455</span></a>                        <span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;Land Area&#39;</span><span class="p">,</span><span class="s1">&#39;area&#39;</span><span class="p">),</span>
</span><span id="GeoInfo.add_field-456"><a href="#GeoInfo.add_field-456"><span class="linenos">456</span></a>                        <span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="s1">&#39;Fert&#39;</span><span class="p">,</span><span class="s1">&#39;fertility&#39;</span><span class="p">),</span>
</span><span id="GeoInfo.add_field-457"><a href="#GeoInfo.add_field-457"><span class="linenos">457</span></a>                        <span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="s1">&#39;Med&#39;</span><span class="p">,</span><span class="s1">&#39;median_age&#39;</span><span class="p">),</span>
</span><span id="GeoInfo.add_field-458"><a href="#GeoInfo.add_field-458"><span class="linenos">458</span></a>                        <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="s1">&#39;Urban&#39;</span><span class="p">,</span><span class="s1">&#39;urban_rate&#39;</span><span class="p">),</span>
</span><span id="GeoInfo.add_field-459"><a href="#GeoInfo.add_field-459"><span class="linenos">459</span></a>                        <span class="p">)</span> <span class="c1"># containts tuples with position in table, name of column, new name of field</span>
</span><span id="GeoInfo.add_field-460"><a href="#GeoInfo.add_field-460"><span class="linenos">460</span></a>
</span><span id="GeoInfo.add_field-461"><a href="#GeoInfo.add_field-461"><span class="linenos">461</span></a>                    <span class="c1"># get data with cache ok for about 1 month</span>
</span><span id="GeoInfo.add_field-462"><a href="#GeoInfo.add_field-462"><span class="linenos">462</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_data_population</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="s1">&#39;https://www.worldometers.info/world-population/population-by-country/&#39;</span><span class="p">,</span><span class="mf">30e5</span><span class="p">)</span> <span class="p">)</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">field_descr</span><span class="p">]]</span>
</span><span id="GeoInfo.add_field-463"><a href="#GeoInfo.add_field-463"><span class="linenos">463</span></a>
</span><span id="GeoInfo.add_field-464"><a href="#GeoInfo.add_field-464"><span class="linenos">464</span></a>                    <span class="c1"># test that field order hasn&#39;t changed in the db</span>
</span><span id="GeoInfo.add_field-465"><a href="#GeoInfo.add_field-465"><span class="linenos">465</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span> <span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">field_descr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_population</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="p">):</span>
</span><span id="GeoInfo.add_field-466"><a href="#GeoInfo.add_field-466"><span class="linenos">466</span></a>                        <span class="k">raise</span> <span class="n">CoaDbError</span><span class="p">(</span><span class="s1">&#39;The worldometers database changed its field names. &#39;</span>
</span><span id="GeoInfo.add_field-467"><a href="#GeoInfo.add_field-467"><span class="linenos">467</span></a>                            <span class="s1">&#39;The GeoInfo should be updated. Please contact developers.&#39;</span><span class="p">)</span>
</span><span id="GeoInfo.add_field-468"><a href="#GeoInfo.add_field-468"><span class="linenos">468</span></a>
</span><span id="GeoInfo.add_field-469"><a href="#GeoInfo.add_field-469"><span class="linenos">469</span></a>                    <span class="c1"># change field name</span>
</span><span id="GeoInfo.add_field-470"><a href="#GeoInfo.add_field-470"><span class="linenos">470</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_data_population</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">field_descr</span><span class="p">]</span>
</span><span id="GeoInfo.add_field-471"><a href="#GeoInfo.add_field-471"><span class="linenos">471</span></a>
</span><span id="GeoInfo.add_field-472"><a href="#GeoInfo.add_field-472"><span class="linenos">472</span></a>                    <span class="c1"># standardization of country name</span>
</span><span id="GeoInfo.add_field-473"><a href="#GeoInfo.add_field-473"><span class="linenos">473</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_data_population</span><span class="p">[</span><span class="s1">&#39;iso3_tmp2&#39;</span><span class="p">]</span><span class="o">=</span>\
</span><span id="GeoInfo.add_field-474"><a href="#GeoInfo.add_field-474"><span class="linenos">474</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_gm</span><span class="o">.</span><span class="n">to_standard</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_population</span><span class="p">[</span><span class="s1">&#39;country&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>\
</span><span id="GeoInfo.add_field-475"><a href="#GeoInfo.add_field-475"><span class="linenos">475</span></a>                        <span class="n">db</span><span class="o">=</span><span class="s1">&#39;worldometers&#39;</span><span class="p">)</span>
</span><span id="GeoInfo.add_field-476"><a href="#GeoInfo.add_field-476"><span class="linenos">476</span></a>
</span><span id="GeoInfo.add_field-477"><a href="#GeoInfo.add_field-477"><span class="linenos">477</span></a>                <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_population</span><span class="p">[[</span><span class="s2">&quot;iso3_tmp2&quot;</span><span class="p">,</span><span class="n">f</span><span class="p">]],</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>\
</span><span id="GeoInfo.add_field-478"><a href="#GeoInfo.add_field-478"><span class="linenos">478</span></a>                        <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;iso3_tmp&#39;</span><span class="p">,</span><span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;iso3_tmp2&#39;</span><span class="p">,</span>\
</span><span id="GeoInfo.add_field-479"><a href="#GeoInfo.add_field-479"><span class="linenos">479</span></a>                        <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;_tmp&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;iso3_tmp2&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="GeoInfo.add_field-480"><a href="#GeoInfo.add_field-480"><span class="linenos">480</span></a>            <span class="c1"># ----------------------------------------------------------</span>
</span><span id="GeoInfo.add_field-481"><a href="#GeoInfo.add_field-481"><span class="linenos">481</span></a>            <span class="k">elif</span> <span class="n">f</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;region_code_list&#39;</span><span class="p">,</span><span class="s1">&#39;region_name_list&#39;</span><span class="p">]:</span>
</span><span id="GeoInfo.add_field-482"><a href="#GeoInfo.add_field-482"><span class="linenos">482</span></a>
</span><span id="GeoInfo.add_field-483"><a href="#GeoInfo.add_field-483"><span class="linenos">483</span></a>                <span class="k">if</span> <span class="n">f</span> <span class="o">==</span> <span class="s1">&#39;region_code_list&#39;</span><span class="p">:</span>
</span><span id="GeoInfo.add_field-484"><a href="#GeoInfo.add_field-484"><span class="linenos">484</span></a>                    <span class="n">ff</span> <span class="o">=</span> <span class="s1">&#39;region&#39;</span>
</span><span id="GeoInfo.add_field-485"><a href="#GeoInfo.add_field-485"><span class="linenos">485</span></a>                <span class="k">elif</span> <span class="n">f</span> <span class="o">==</span> <span class="s1">&#39;region_name_list&#39;</span><span class="p">:</span>
</span><span id="GeoInfo.add_field-486"><a href="#GeoInfo.add_field-486"><span class="linenos">486</span></a>                    <span class="n">ff</span> <span class="o">=</span> <span class="s1">&#39;region_name&#39;</span>
</span><span id="GeoInfo.add_field-487"><a href="#GeoInfo.add_field-487"><span class="linenos">487</span></a>
</span><span id="GeoInfo.add_field-488"><a href="#GeoInfo.add_field-488"><span class="linenos">488</span></a>                <span class="n">p</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_grp</span><span class="p">[[</span><span class="s1">&#39;iso3&#39;</span><span class="p">,</span><span class="n">ff</span><span class="p">]],</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>\
</span><span id="GeoInfo.add_field-489"><a href="#GeoInfo.add_field-489"><span class="linenos">489</span></a>                    <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;iso3_tmp&#39;</span><span class="p">,</span><span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;iso3&#39;</span><span class="p">,</span>\
</span><span id="GeoInfo.add_field-490"><a href="#GeoInfo.add_field-490"><span class="linenos">490</span></a>                    <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;_tmp&#39;</span><span class="p">))</span> \
</span><span id="GeoInfo.add_field-491"><a href="#GeoInfo.add_field-491"><span class="linenos">491</span></a>                    <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;iso3_tmp&#39;</span><span class="p">)[</span><span class="n">ff</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
</span><span id="GeoInfo.add_field-492"><a href="#GeoInfo.add_field-492"><span class="linenos">492</span></a>            <span class="c1"># ----------------------------------------------------------</span>
</span><span id="GeoInfo.add_field-493"><a href="#GeoInfo.add_field-493"><span class="linenos">493</span></a>            <span class="k">elif</span> <span class="n">f</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;capital&#39;</span><span class="p">]:</span>
</span><span id="GeoInfo.add_field-494"><a href="#GeoInfo.add_field-494"><span class="linenos">494</span></a>                <span class="n">p</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_grp</span><span class="p">[[</span><span class="s1">&#39;iso3&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(),</span> \
</span><span id="GeoInfo.add_field-495"><a href="#GeoInfo.add_field-495"><span class="linenos">495</span></a>                    <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;iso3_tmp&#39;</span><span class="p">,</span><span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;iso3&#39;</span><span class="p">,</span>\
</span><span id="GeoInfo.add_field-496"><a href="#GeoInfo.add_field-496"><span class="linenos">496</span></a>                    <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;_tmp&#39;</span><span class="p">))[</span><span class="n">f</span><span class="p">]</span>
</span><span id="GeoInfo.add_field-497"><a href="#GeoInfo.add_field-497"><span class="linenos">497</span></a>
</span><span id="GeoInfo.add_field-498"><a href="#GeoInfo.add_field-498"><span class="linenos">498</span></a>            <span class="c1"># ----------------------------------------------------------</span>
</span><span id="GeoInfo.add_field-499"><a href="#GeoInfo.add_field-499"><span class="linenos">499</span></a>            <span class="k">elif</span> <span class="n">f</span> <span class="o">==</span> <span class="s1">&#39;geometry&#39;</span><span class="p">:</span>
</span><span id="GeoInfo.add_field-500"><a href="#GeoInfo.add_field-500"><span class="linenos">500</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_geometry</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="GeoInfo.add_field-501"><a href="#GeoInfo.add_field-501"><span class="linenos">501</span></a>                    <span class="c1">#geojsondatafile = &#39;https://raw.githubusercontent.com/johan/world.geo.json/master/countries.geo.json&#39;</span>
</span><span id="GeoInfo.add_field-502"><a href="#GeoInfo.add_field-502"><span class="linenos">502</span></a>                    <span class="c1">#self._data_geometry = gpd.read_file(get_local_from_url(geojsondatafile,0,&#39;.json&#39;))[[&quot;id&quot;,&quot;geometry&quot;]]</span>
</span><span id="GeoInfo.add_field-503"><a href="#GeoInfo.add_field-503"><span class="linenos">503</span></a>                    <span class="n">world_geometry_url_zipfile</span><span class="o">=</span><span class="s1">&#39;http://thematicmapping.org/downloads/TM_WORLD_BORDERS_SIMPL-0.3.zip&#39;</span> <span class="c1"># too much simplified version ?</span>
</span><span id="GeoInfo.add_field-504"><a href="#GeoInfo.add_field-504"><span class="linenos">504</span></a>                    <span class="c1"># world_geometry_url_zipfile=&#39;http://thematicmapping.org/downloads/TM_WORLD_BORDERS-0.3.zip&#39; # too precize version ?</span>
</span><span id="GeoInfo.add_field-505"><a href="#GeoInfo.add_field-505"><span class="linenos">505</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_data_geometry</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;zip://&#39;</span><span class="o">+</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="n">world_geometry_url_zipfile</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;.zip&#39;</span><span class="p">))[[</span><span class="s1">&#39;ISO3&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]]</span>
</span><span id="GeoInfo.add_field-506"><a href="#GeoInfo.add_field-506"><span class="linenos">506</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_data_geometry</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;id_tmp&quot;</span><span class="p">,</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span>
</span><span id="GeoInfo.add_field-507"><a href="#GeoInfo.add_field-507"><span class="linenos">507</span></a>
</span><span id="GeoInfo.add_field-508"><a href="#GeoInfo.add_field-508"><span class="linenos">508</span></a>                    <span class="c1"># About some countries not properly managed by this database (south and north soudan)</span>
</span><span id="GeoInfo.add_field-509"><a href="#GeoInfo.add_field-509"><span class="linenos">509</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_data_geometry</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_geometry</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;id_tmp&#39;</span><span class="p">:</span><span class="s1">&#39;SSD&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">},</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoInfo.add_field-510"><a href="#GeoInfo.add_field-510"><span class="linenos">510</span></a>                    <span class="c1">#self._data_geometry=self._data_geometry.append({&#39;id_tmp&#39;:&#39;SSD&#39;,&#39;geometry&#39;:None},ignore_index=True) # adding the SSD row</span>
</span><span id="GeoInfo.add_field-511"><a href="#GeoInfo.add_field-511"><span class="linenos">511</span></a>                    <span class="c1">#self._data_geometry=pd.concat([self._data_geometry,pd.DataFrame({&#39;id_tmp&#39;:&#39;SSD&#39;,&#39;geometry&#39;:None})])</span>
</span><span id="GeoInfo.add_field-512"><a href="#GeoInfo.add_field-512"><span class="linenos">512</span></a>                    <span class="k">for</span> <span class="n">newc</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;SSD&#39;</span><span class="p">,</span><span class="s1">&#39;SDN&#39;</span><span class="p">]:</span>
</span><span id="GeoInfo.add_field-513"><a href="#GeoInfo.add_field-513"><span class="linenos">513</span></a>                        <span class="n">newgeo</span><span class="o">=</span><span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="s1">&#39;https://github.com/johan/world.geo.json/raw/master/countries/&#39;</span><span class="o">+</span><span class="n">newc</span><span class="o">+</span><span class="s1">&#39;.geo.json&#39;</span><span class="p">))</span>
</span><span id="GeoInfo.add_field-514"><a href="#GeoInfo.add_field-514"><span class="linenos">514</span></a>                        <span class="n">poly</span><span class="o">=</span><span class="n">newgeo</span><span class="p">[</span><span class="n">newgeo</span><span class="o">.</span><span class="n">id</span><span class="o">==</span><span class="n">newc</span><span class="p">]</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GeoInfo.add_field-515"><a href="#GeoInfo.add_field-515"><span class="linenos">515</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_data_geometry</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_geometry</span><span class="o">.</span><span class="n">id_tmp</span><span class="o">==</span><span class="n">newc</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
</span><span id="GeoInfo.add_field-516"><a href="#GeoInfo.add_field-516"><span class="linenos">516</span></a>
</span><span id="GeoInfo.add_field-517"><a href="#GeoInfo.add_field-517"><span class="linenos">517</span></a>                    <span class="c1"># About countries that we artificially put on the east of the map</span>
</span><span id="GeoInfo.add_field-518"><a href="#GeoInfo.add_field-518"><span class="linenos">518</span></a>                    <span class="k">for</span> <span class="n">newc</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;RUS&#39;</span><span class="p">,</span><span class="s1">&#39;FJI&#39;</span><span class="p">,</span><span class="s1">&#39;NZL&#39;</span><span class="p">,</span><span class="s1">&#39;WSM&#39;</span><span class="p">]:</span>
</span><span id="GeoInfo.add_field-519"><a href="#GeoInfo.add_field-519"><span class="linenos">519</span></a>                        <span class="n">poly</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_geometry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_geometry</span><span class="o">.</span><span class="n">id_tmp</span><span class="o">==</span><span class="n">newc</span><span class="p">]</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GeoInfo.add_field-520"><a href="#GeoInfo.add_field-520"><span class="linenos">520</span></a>                        <span class="n">poly</span><span class="o">=</span><span class="n">so</span><span class="o">.</span><span class="n">unary_union</span><span class="p">(</span><span class="n">sg</span><span class="o">.</span><span class="n">MultiPolygon</span><span class="p">([</span><span class="n">sg</span><span class="o">.</span><span class="n">Polygon</span><span class="p">([(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="k">else</span> <span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mi">360</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">coords</span><span class="p">])</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">poly</span><span class="o">.</span><span class="n">geoms</span><span class="p">]))</span>
</span><span id="GeoInfo.add_field-521"><a href="#GeoInfo.add_field-521"><span class="linenos">521</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_data_geometry</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_geometry</span><span class="o">.</span><span class="n">id_tmp</span><span class="o">==</span><span class="n">newc</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
</span><span id="GeoInfo.add_field-522"><a href="#GeoInfo.add_field-522"><span class="linenos">522</span></a>
</span><span id="GeoInfo.add_field-523"><a href="#GeoInfo.add_field-523"><span class="linenos">523</span></a>                    <span class="c1"># About countries that we artificially put on the west of the map</span>
</span><span id="GeoInfo.add_field-524"><a href="#GeoInfo.add_field-524"><span class="linenos">524</span></a>                    <span class="k">for</span> <span class="n">newc</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;USA&#39;</span><span class="p">]:</span>
</span><span id="GeoInfo.add_field-525"><a href="#GeoInfo.add_field-525"><span class="linenos">525</span></a>                        <span class="n">poly</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_geometry</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_geometry</span><span class="o">.</span><span class="n">id_tmp</span><span class="o">==</span><span class="n">newc</span><span class="p">]</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GeoInfo.add_field-526"><a href="#GeoInfo.add_field-526"><span class="linenos">526</span></a>                        <span class="n">poly</span><span class="o">=</span><span class="n">so</span><span class="o">.</span><span class="n">unary_union</span><span class="p">(</span><span class="n">sg</span><span class="o">.</span><span class="n">MultiPolygon</span><span class="p">([</span><span class="n">sg</span><span class="o">.</span><span class="n">Polygon</span><span class="p">([(</span><span class="n">x</span><span class="o">-</span><span class="mi">360</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="k">else</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">coords</span><span class="p">])</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">poly</span><span class="o">.</span><span class="n">geoms</span><span class="p">]))</span>
</span><span id="GeoInfo.add_field-527"><a href="#GeoInfo.add_field-527"><span class="linenos">527</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_data_geometry</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_geometry</span><span class="o">.</span><span class="n">id_tmp</span><span class="o">==</span><span class="n">newc</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
</span><span id="GeoInfo.add_field-528"><a href="#GeoInfo.add_field-528"><span class="linenos">528</span></a>
</span><span id="GeoInfo.add_field-529"><a href="#GeoInfo.add_field-529"><span class="linenos">529</span></a>                <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_geometry</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>\
</span><span id="GeoInfo.add_field-530"><a href="#GeoInfo.add_field-530"><span class="linenos">530</span></a>                    <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;iso3_tmp&#39;</span><span class="p">,</span><span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;id_tmp&#39;</span><span class="p">,</span>\
</span><span id="GeoInfo.add_field-531"><a href="#GeoInfo.add_field-531"><span class="linenos">531</span></a>                    <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;_tmp&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;id_tmp&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="GeoInfo.add_field-532"><a href="#GeoInfo.add_field-532"><span class="linenos">532</span></a>
</span><span id="GeoInfo.add_field-533"><a href="#GeoInfo.add_field-533"><span class="linenos">533</span></a>            <span class="c1"># -----------------------------------------------------------</span>
</span><span id="GeoInfo.add_field-534"><a href="#GeoInfo.add_field-534"><span class="linenos">534</span></a>            <span class="k">elif</span> <span class="n">f</span> <span class="o">==</span> <span class="s1">&#39;flag&#39;</span><span class="p">:</span>
</span><span id="GeoInfo.add_field-535"><a href="#GeoInfo.add_field-535"><span class="linenos">535</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_flag</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="GeoInfo.add_field-536"><a href="#GeoInfo.add_field-536"><span class="linenos">536</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_data_flag</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="s1">&#39;https://github.com/linssen/country-flag-icons/raw/master/countries.json&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
</span><span id="GeoInfo.add_field-537"><a href="#GeoInfo.add_field-537"><span class="linenos">537</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_data_flag</span><span class="p">[</span><span class="s1">&#39;flag_url&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;http:&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_flag</span><span class="p">[</span><span class="s1">&#39;file_url&#39;</span><span class="p">]</span>
</span><span id="GeoInfo.add_field-538"><a href="#GeoInfo.add_field-538"><span class="linenos">538</span></a>
</span><span id="GeoInfo.add_field-539"><a href="#GeoInfo.add_field-539"><span class="linenos">539</span></a>                <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_flag</span><span class="p">[[</span><span class="s1">&#39;alpha3&#39;</span><span class="p">,</span><span class="s1">&#39;flag_url&#39;</span><span class="p">]],</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>\
</span><span id="GeoInfo.add_field-540"><a href="#GeoInfo.add_field-540"><span class="linenos">540</span></a>                    <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;iso3_tmp&#39;</span><span class="p">,</span><span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;alpha3&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;alpha3&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="GeoInfo.add_field-541"><a href="#GeoInfo.add_field-541"><span class="linenos">541</span></a>
</span><span id="GeoInfo.add_field-542"><a href="#GeoInfo.add_field-542"><span class="linenos">542</span></a>        <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;iso2_tmp&#39;</span><span class="p">,</span><span class="s1">&#39;iso3_tmp&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>this is the main function of the GeoInfo class. It adds to
the input pandas dataframe some fields according to
the geofield field of input.
The return value is the pandas dataframe.</p>

<p>Arguments :
field    -- should be given as a string of list of strings and
            should be valid fields (see get_list_field() )
            Mandatory.
input    -- provide the input pandas dataframe. Mandatory.
geofield -- provide the field name in the pandas where the
            location is stored. Default : 'where'
overload -- Allow to overload a field. Boolean value.
            Default : False</p>
</div>


                            </div>
                </section>
                <section id="GeoRegion">
                            <input id="GeoRegion-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">GeoRegion</span>:

                <label class="view-source-button" for="GeoRegion-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GeoRegion"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GeoRegion-548"><a href="#GeoRegion-548"><span class="linenos">548</span></a><span class="k">class</span> <span class="nc">GeoRegion</span><span class="p">():</span>
</span><span id="GeoRegion-549"><a href="#GeoRegion-549"><span class="linenos">549</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;GeoRegion class definition. Does not inheritate from any other</span>
</span><span id="GeoRegion-550"><a href="#GeoRegion-550"><span class="linenos">550</span></a><span class="sd">    class.</span>
</span><span id="GeoRegion-551"><a href="#GeoRegion-551"><span class="linenos">551</span></a>
</span><span id="GeoRegion-552"><a href="#GeoRegion-552"><span class="linenos">552</span></a><span class="sd">    It should raise only CoaError and derived exceptions in case</span>
</span><span id="GeoRegion-553"><a href="#GeoRegion-553"><span class="linenos">553</span></a><span class="sd">    of errors (see pycoa.error)</span>
</span><span id="GeoRegion-554"><a href="#GeoRegion-554"><span class="linenos">554</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="GeoRegion-555"><a href="#GeoRegion-555"><span class="linenos">555</span></a>
</span><span id="GeoRegion-556"><a href="#GeoRegion-556"><span class="linenos">556</span></a>    <span class="n">_source_dict</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;UN_M49&quot;</span><span class="p">:</span><span class="s2">&quot;https://en.wikipedia.org/w/index.php?title=UN_M49&amp;oldid=986603718&quot;</span><span class="p">,</span> <span class="c1"># pointing the previous correct ref . https://en.wikipedia.org/wiki/UN_M49&quot;,\</span>
</span><span id="GeoRegion-557"><a href="#GeoRegion-557"><span class="linenos">557</span></a>        <span class="s2">&quot;GeoScheme&quot;</span><span class="p">:</span><span class="s2">&quot;https://en.wikipedia.org/w/index.php?title=List_of_countries_by_United_Nations_geoscheme&amp;oldid=1008989486&quot;</span><span class="p">,</span> <span class="c1">#pointing the previous correct ref. https://en.wikipedia.org/wiki/List_of_countries_by_United_Nations_geoscheme&quot;,</span>
</span><span id="GeoRegion-558"><a href="#GeoRegion-558"><span class="linenos">558</span></a>        <span class="s2">&quot;European Union&quot;</span><span class="p">:</span><span class="s2">&quot;https://europa.eu/european-union/about-eu/countries/member-countries_en&quot;</span><span class="p">,</span>
</span><span id="GeoRegion-559"><a href="#GeoRegion-559"><span class="linenos">559</span></a>        <span class="s2">&quot;G7&quot;</span><span class="p">:</span><span class="s2">&quot;https://en.wikipedia.org/wiki/Group_of_Seven&quot;</span><span class="p">,</span>
</span><span id="GeoRegion-560"><a href="#GeoRegion-560"><span class="linenos">560</span></a>        <span class="s2">&quot;G8&quot;</span><span class="p">:</span><span class="s2">&quot;https://en.wikipedia.org/wiki/Group_of_Eight&quot;</span><span class="p">,</span>
</span><span id="GeoRegion-561"><a href="#GeoRegion-561"><span class="linenos">561</span></a>        <span class="s2">&quot;G20&quot;</span><span class="p">:</span><span class="s2">&quot;https://en.wikipedia.org/wiki/G20&quot;</span><span class="p">,</span>
</span><span id="GeoRegion-562"><a href="#GeoRegion-562"><span class="linenos">562</span></a>        <span class="s2">&quot;G77&quot;</span><span class="p">:</span><span class="s2">&quot;https://www.g77.org/doc/members.html&quot;</span><span class="p">,</span>
</span><span id="GeoRegion-563"><a href="#GeoRegion-563"><span class="linenos">563</span></a>        <span class="s2">&quot;OECD&quot;</span><span class="p">:</span><span class="s2">&quot;https://en.wikipedia.org/wiki/OECD&quot;</span><span class="p">,</span>
</span><span id="GeoRegion-564"><a href="#GeoRegion-564"><span class="linenos">564</span></a>        <span class="s2">&quot;BRICS&quot;</span><span class="p">:</span><span class="s2">&quot;https://en.wikipedia.org/wiki/BRICS&quot;</span><span class="p">,</span>
</span><span id="GeoRegion-565"><a href="#GeoRegion-565"><span class="linenos">565</span></a>        <span class="s2">&quot;CELAC&quot;</span><span class="p">:</span><span class="s2">&quot;https://en.wikipedia.org/wiki/Community_of_Latin_American_and_Caribbean_States&quot;</span><span class="p">,</span>
</span><span id="GeoRegion-566"><a href="#GeoRegion-566"><span class="linenos">566</span></a>        <span class="s2">&quot;CEDEAO&quot;</span><span class="p">:</span><span class="s2">&quot;https://fr.wikipedia.org/wiki/Communaut%C3%A9_%C3%A9conomique_des_%C3%89tats_de_l%27Afrique_de_l%27Ouest&quot;</span><span class="p">,</span>
</span><span id="GeoRegion-567"><a href="#GeoRegion-567"><span class="linenos">567</span></a>        <span class="s2">&quot;SADC&quot;</span><span class="p">:</span><span class="s2">&quot;https://en.wikipedia.org/wiki/Southern_African_Development_Community&quot;</span><span class="p">,</span>
</span><span id="GeoRegion-568"><a href="#GeoRegion-568"><span class="linenos">568</span></a>        <span class="s2">&quot;AMU&quot;</span><span class="p">:</span><span class="s2">&quot;https://en.wikipedia.org/wiki/Arab_Maghreb_Union&quot;</span><span class="p">,</span>
</span><span id="GeoRegion-569"><a href="#GeoRegion-569"><span class="linenos">569</span></a>        <span class="s2">&quot;CEEAC&quot;</span><span class="p">:</span><span class="s2">&quot;https://fr.wikipedia.org/wiki/Communaut%C3%A9_%C3%A9conomique_des_%C3%89tats_de_l%27Afrique_centrale&quot;</span><span class="p">,</span>
</span><span id="GeoRegion-570"><a href="#GeoRegion-570"><span class="linenos">570</span></a>        <span class="s2">&quot;EAC&quot;</span><span class="p">:</span><span class="s2">&quot;https://en.wikipedia.org/wiki/East_African_Community&quot;</span><span class="p">,</span>
</span><span id="GeoRegion-571"><a href="#GeoRegion-571"><span class="linenos">571</span></a>        <span class="s2">&quot;CENSAD&quot;</span><span class="p">:</span><span class="s2">&quot;https://en.wikipedia.org/wiki/Community_of_Sahel</span><span class="si">%E</span><span class="s2">2</span><span class="si">%80%</span><span class="s2">93Saharan_States&quot;</span><span class="p">,</span>
</span><span id="GeoRegion-572"><a href="#GeoRegion-572"><span class="linenos">572</span></a>        <span class="s2">&quot;COMESA&quot;</span><span class="p">:</span><span class="s2">&quot;https://www.worlddata.info/trade-agreements/comesa.php&quot;</span><span class="p">,</span>
</span><span id="GeoRegion-573"><a href="#GeoRegion-573"><span class="linenos">573</span></a>        <span class="s2">&quot;Commonwealth&quot;</span><span class="p">:</span><span class="s2">&quot;https://en.wikipedia.org/wiki/Member_states_of_the_Commonwealth_of_Nations&quot;</span><span class="p">,</span>
</span><span id="GeoRegion-574"><a href="#GeoRegion-574"><span class="linenos">574</span></a>        <span class="p">}</span>
</span><span id="GeoRegion-575"><a href="#GeoRegion-575"><span class="linenos">575</span></a>
</span><span id="GeoRegion-576"><a href="#GeoRegion-576"><span class="linenos">576</span></a>    <span class="n">_region_dict</span><span class="o">=</span><span class="p">{}</span>
</span><span id="GeoRegion-577"><a href="#GeoRegion-577"><span class="linenos">577</span></a>    <span class="n">_p_gs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="GeoRegion-578"><a href="#GeoRegion-578"><span class="linenos">578</span></a>
</span><span id="GeoRegion-579"><a href="#GeoRegion-579"><span class="linenos">579</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,):</span>
</span><span id="GeoRegion-580"><a href="#GeoRegion-580"><span class="linenos">580</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; __init__ member function.</span>
</span><span id="GeoRegion-581"><a href="#GeoRegion-581"><span class="linenos">581</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoRegion-582"><a href="#GeoRegion-582"><span class="linenos">582</span></a>        <span class="c1">#if &#39;XK&#39; in self._country_list:</span>
</span><span id="GeoRegion-583"><a href="#GeoRegion-583"><span class="linenos">583</span></a>        <span class="c1">#    del self._country_list[&#39;XK&#39;] # creates bugs in pycountry and is currently a contested country as country</span>
</span><span id="GeoRegion-584"><a href="#GeoRegion-584"><span class="linenos">584</span></a>
</span><span id="GeoRegion-585"><a href="#GeoRegion-585"><span class="linenos">585</span></a>
</span><span id="GeoRegion-586"><a href="#GeoRegion-586"><span class="linenos">586</span></a>        <span class="c1"># --- get the UN M49 information and organize the data in the _region_dict</span>
</span><span id="GeoRegion-587"><a href="#GeoRegion-587"><span class="linenos">587</span></a>
</span><span id="GeoRegion-588"><a href="#GeoRegion-588"><span class="linenos">588</span></a>        <span class="n">verb</span><span class="p">(</span><span class="s2">&quot;Init of GeoRegion() from &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="GeoRegion-589"><a href="#GeoRegion-589"><span class="linenos">589</span></a>
</span><span id="GeoRegion-590"><a href="#GeoRegion-590"><span class="linenos">590</span></a>        <span class="n">p_m49</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_source_dict</span><span class="p">[</span><span class="s2">&quot;UN_M49&quot;</span><span class="p">],</span><span class="mi">0</span><span class="p">))[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="GeoRegion-591"><a href="#GeoRegion-591"><span class="linenos">591</span></a>
</span><span id="GeoRegion-592"><a href="#GeoRegion-592"><span class="linenos">592</span></a>        <span class="n">p_m49</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">,</span><span class="s1">&#39;region_name&#39;</span><span class="p">]</span>
</span><span id="GeoRegion-593"><a href="#GeoRegion-593"><span class="linenos">593</span></a>        <span class="n">p_m49</span><span class="p">[</span><span class="s1">&#39;region_name&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">title</span><span class="p">()</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">p_m49</span><span class="o">.</span><span class="n">region_name</span><span class="p">]</span>  <span class="c1"># suppress information in parenthesis in region name</span>
</span><span id="GeoRegion-594"><a href="#GeoRegion-594"><span class="linenos">594</span></a>        <span class="n">p_m49</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;code&#39;</span><span class="p">)</span>
</span><span id="GeoRegion-595"><a href="#GeoRegion-595"><span class="linenos">595</span></a>
</span><span id="GeoRegion-596"><a href="#GeoRegion-596"><span class="linenos">596</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_region_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">p_m49</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s1">&#39;split&#39;</span><span class="p">)[</span><span class="s1">&#39;data&#39;</span><span class="p">])</span>
</span><span id="GeoRegion-597"><a href="#GeoRegion-597"><span class="linenos">597</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_region_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>  <span class="s2">&quot;UE&quot;</span><span class="p">:</span><span class="s2">&quot;European Union&quot;</span><span class="p">,</span>
</span><span id="GeoRegion-598"><a href="#GeoRegion-598"><span class="linenos">598</span></a>                                    <span class="s2">&quot;G7&quot;</span><span class="p">:</span><span class="s2">&quot;G7&quot;</span><span class="p">,</span>
</span><span id="GeoRegion-599"><a href="#GeoRegion-599"><span class="linenos">599</span></a>                                    <span class="s2">&quot;G8&quot;</span><span class="p">:</span><span class="s2">&quot;G8&quot;</span><span class="p">,</span>
</span><span id="GeoRegion-600"><a href="#GeoRegion-600"><span class="linenos">600</span></a>                                    <span class="s2">&quot;G20&quot;</span><span class="p">:</span><span class="s2">&quot;G20&quot;</span><span class="p">,</span>
</span><span id="GeoRegion-601"><a href="#GeoRegion-601"><span class="linenos">601</span></a>                                    <span class="s2">&quot;OECD&quot;</span><span class="p">:</span><span class="s2">&quot;Oecd&quot;</span><span class="p">,</span>
</span><span id="GeoRegion-602"><a href="#GeoRegion-602"><span class="linenos">602</span></a>                                    <span class="s2">&quot;BRICS&quot;</span><span class="p">:</span><span class="s2">&quot;Brics&quot;</span><span class="p">,</span>
</span><span id="GeoRegion-603"><a href="#GeoRegion-603"><span class="linenos">603</span></a>                                    <span class="s2">&quot;CELAC&quot;</span><span class="p">:</span><span class="s2">&quot;Celac&quot;</span><span class="p">,</span>
</span><span id="GeoRegion-604"><a href="#GeoRegion-604"><span class="linenos">604</span></a>                                    <span class="s2">&quot;CEDEAO&quot;</span><span class="p">:</span><span class="s2">&quot;Cedeao&quot;</span><span class="p">,</span>
</span><span id="GeoRegion-605"><a href="#GeoRegion-605"><span class="linenos">605</span></a>                                    <span class="s2">&quot;AMU&quot;</span><span class="p">:</span><span class="s2">&quot;Amu&quot;</span><span class="p">,</span>
</span><span id="GeoRegion-606"><a href="#GeoRegion-606"><span class="linenos">606</span></a>                                    <span class="s2">&quot;CEEAC&quot;</span><span class="p">:</span><span class="s2">&quot;Ceeac&quot;</span><span class="p">,</span>
</span><span id="GeoRegion-607"><a href="#GeoRegion-607"><span class="linenos">607</span></a>                                    <span class="s2">&quot;EAC&quot;</span><span class="p">:</span><span class="s2">&quot;Eac&quot;</span><span class="p">,</span>
</span><span id="GeoRegion-608"><a href="#GeoRegion-608"><span class="linenos">608</span></a>                                    <span class="s2">&quot;SADC&quot;</span><span class="p">:</span><span class="s2">&quot;Sadc&quot;</span><span class="p">,</span>
</span><span id="GeoRegion-609"><a href="#GeoRegion-609"><span class="linenos">609</span></a>                                    <span class="s2">&quot;CENSAD&quot;</span><span class="p">:</span><span class="s2">&quot;Censad&quot;</span><span class="p">,</span>
</span><span id="GeoRegion-610"><a href="#GeoRegion-610"><span class="linenos">610</span></a>                                    <span class="s2">&quot;COMESA&quot;</span><span class="p">:</span><span class="s2">&quot;Comesa&quot;</span><span class="p">,</span>
</span><span id="GeoRegion-611"><a href="#GeoRegion-611"><span class="linenos">611</span></a>                                    <span class="s2">&quot;G77&quot;</span><span class="p">:</span><span class="s2">&quot;G77&quot;</span><span class="p">,</span>
</span><span id="GeoRegion-612"><a href="#GeoRegion-612"><span class="linenos">612</span></a>                                    <span class="s2">&quot;CW&quot;</span><span class="p">:</span><span class="s2">&quot;Commonwealth&quot;</span>
</span><span id="GeoRegion-613"><a href="#GeoRegion-613"><span class="linenos">613</span></a>                                    <span class="p">})</span>  <span class="c1"># add UE for other analysis</span>
</span><span id="GeoRegion-614"><a href="#GeoRegion-614"><span class="linenos">614</span></a>
</span><span id="GeoRegion-615"><a href="#GeoRegion-615"><span class="linenos">615</span></a>        <span class="c1"># --- filling cw information</span>
</span><span id="GeoRegion-616"><a href="#GeoRegion-616"><span class="linenos">616</span></a>        <span class="n">p_cw</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="s1">&#39;https://en.wikipedia.org/w/index.php?title=Member_states_of_the_Commonwealth_of_Nations&amp;oldid=1090420488&#39;</span><span class="p">))</span>
</span><span id="GeoRegion-617"><a href="#GeoRegion-617"><span class="linenos">617</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_cw</span><span class="o">=</span><span class="p">[</span><span class="n">w</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">p_cw</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Country&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()]</span>   <span class="c1"># removing wikipedia notes</span>
</span><span id="GeoRegion-618"><a href="#GeoRegion-618"><span class="linenos">618</span></a>
</span><span id="GeoRegion-619"><a href="#GeoRegion-619"><span class="linenos">619</span></a>        <span class="c1"># --- filling celac information</span>
</span><span id="GeoRegion-620"><a href="#GeoRegion-620"><span class="linenos">620</span></a>        <span class="n">p_celac</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="s1">&#39;https://en.wikipedia.org/wiki/Community_of_Latin_American_and_Caribbean_States&#39;</span><span class="p">))</span>
</span><span id="GeoRegion-621"><a href="#GeoRegion-621"><span class="linenos">621</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_celac</span><span class="o">=</span><span class="p">[</span><span class="n">w</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">p_celac</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="n">p_celac</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">&lt;</span><span class="mi">33</span><span class="p">][</span><span class="s2">&quot;Country&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()]</span>
</span><span id="GeoRegion-622"><a href="#GeoRegion-622"><span class="linenos">622</span></a>
</span><span id="GeoRegion-623"><a href="#GeoRegion-623"><span class="linenos">623</span></a>        <span class="c1"># --- filling cedeao information</span>
</span><span id="GeoRegion-624"><a href="#GeoRegion-624"><span class="linenos">624</span></a>        <span class="n">p_cedeao</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="s1">&#39;https://en.wikipedia.org/wiki/Economic_Community_of_West_African_States&#39;</span><span class="p">))</span>
</span><span id="GeoRegion-625"><a href="#GeoRegion-625"><span class="linenos">625</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_cedeao</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Cabo Verde&quot;</span> <span class="k">if</span> <span class="n">x</span><span class="o">==</span><span class="s2">&quot;Cape Verde&quot;</span> <span class="k">else</span> <span class="s2">&quot;CIV&quot;</span> <span class="k">if</span> <span class="n">x</span><span class="o">==</span><span class="s2">&quot;Ivory Coast&quot;</span> <span class="k">else</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">p_cedeao</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">p_cedeao</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span><span class="o">.</span><span class="n">Country</span><span class="o">.</span><span class="n">to_list</span><span class="p">()]</span>
</span><span id="GeoRegion-626"><a href="#GeoRegion-626"><span class="linenos">626</span></a>
</span><span id="GeoRegion-627"><a href="#GeoRegion-627"><span class="linenos">627</span></a>        <span class="c1"># --- filling sadc information</span>
</span><span id="GeoRegion-628"><a href="#GeoRegion-628"><span class="linenos">628</span></a>        <span class="n">p_sadc</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="s1">&#39;https://en.wikipedia.org/wiki/Southern_African_Development_Community&#39;</span><span class="p">))</span>
</span><span id="GeoRegion-629"><a href="#GeoRegion-629"><span class="linenos">629</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_sadc</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;COD&quot;</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">&quot;Democratic Republic of the Congo&quot;</span> <span class="k">else</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="n">w</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">p_sadc</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">p_sadc</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()]]</span>
</span><span id="GeoRegion-630"><a href="#GeoRegion-630"><span class="linenos">630</span></a>
</span><span id="GeoRegion-631"><a href="#GeoRegion-631"><span class="linenos">631</span></a>        <span class="c1"># --- filling amu information</span>
</span><span id="GeoRegion-632"><a href="#GeoRegion-632"><span class="linenos">632</span></a>        <span class="n">p_amu</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="s1">&#39;https://en.wikipedia.org/wiki/Arab_Maghreb_Union&#39;</span><span class="p">))</span>
</span><span id="GeoRegion-633"><a href="#GeoRegion-633"><span class="linenos">633</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_amu</span><span class="o">=</span><span class="n">p_amu</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">Country</span><span class="o">.</span><span class="n">to_list</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="GeoRegion-634"><a href="#GeoRegion-634"><span class="linenos">634</span></a>
</span><span id="GeoRegion-635"><a href="#GeoRegion-635"><span class="linenos">635</span></a>        <span class="c1"># --- filling ceeac information</span>
</span><span id="GeoRegion-636"><a href="#GeoRegion-636"><span class="linenos">636</span></a>        <span class="n">p_ceeac</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="s1">&#39;https://en.wikipedia.org/wiki/Economic_Community_of_Central_African_States&#39;</span><span class="p">))</span>
</span><span id="GeoRegion-637"><a href="#GeoRegion-637"><span class="linenos">637</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ceeac</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;COD&quot;</span> <span class="k">if</span> <span class="n">w</span> <span class="o">==</span> <span class="s2">&quot;Democratic Republic of the Congo&quot;</span> <span class="k">else</span> <span class="n">w</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">p_ceeac</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">Country</span><span class="o">.</span><span class="n">to_list</span><span class="p">()]]</span>
</span><span id="GeoRegion-638"><a href="#GeoRegion-638"><span class="linenos">638</span></a>
</span><span id="GeoRegion-639"><a href="#GeoRegion-639"><span class="linenos">639</span></a>        <span class="c1"># --- filling eac information</span>
</span><span id="GeoRegion-640"><a href="#GeoRegion-640"><span class="linenos">640</span></a>        <span class="n">p_eac</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="s1">&#39;https://en.wikipedia.org/wiki/East_African_Community&#39;</span><span class="p">))</span>
</span><span id="GeoRegion-641"><a href="#GeoRegion-641"><span class="linenos">641</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_eac</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;COD&quot;</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">&quot;DR Congo&quot;</span> <span class="k">else</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">p_eac</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">Country</span><span class="o">.</span><span class="n">to_list</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="GeoRegion-642"><a href="#GeoRegion-642"><span class="linenos">642</span></a>
</span><span id="GeoRegion-643"><a href="#GeoRegion-643"><span class="linenos">643</span></a>        <span class="c1"># --- filling censad information</span>
</span><span id="GeoRegion-644"><a href="#GeoRegion-644"><span class="linenos">644</span></a>        <span class="n">p_censad</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="s1">&#39;https://en.wikipedia.org/wiki/Community_of_Sahel</span><span class="si">%E</span><span class="s1">2</span><span class="si">%80%</span><span class="s1">93Saharan_States&#39;</span><span class="p">))</span>
</span><span id="GeoRegion-645"><a href="#GeoRegion-645"><span class="linenos">645</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_censad</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Cabo Verde&quot;</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">&quot;Cape Verde&quot;</span> <span class="k">else</span> <span class="s2">&quot;CIV&quot;</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">&quot;Ivory Coast&quot;</span> <span class="k">else</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">p_censad</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">p_censad</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="GeoRegion-646"><a href="#GeoRegion-646"><span class="linenos">646</span></a>
</span><span id="GeoRegion-647"><a href="#GeoRegion-647"><span class="linenos">647</span></a>        <span class="c1"># --- filing comesa information</span>
</span><span id="GeoRegion-648"><a href="#GeoRegion-648"><span class="linenos">648</span></a>        <span class="n">p_comesa</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="s1">&#39;https://www.worlddata.info/trade-agreements/comesa.php&#39;</span><span class="p">))</span>
</span><span id="GeoRegion-649"><a href="#GeoRegion-649"><span class="linenos">649</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_comesa</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;COD&quot;</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">&quot;Congo (Dem. Republic)&quot;</span> <span class="k">else</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">p_comesa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">Country</span><span class="o">.</span><span class="n">to_list</span><span class="p">()]</span>
</span><span id="GeoRegion-650"><a href="#GeoRegion-650"><span class="linenos">650</span></a>
</span><span id="GeoRegion-651"><a href="#GeoRegion-651"><span class="linenos">651</span></a>        <span class="c1"># --- get the UnitedNation GeoScheme and organize the data</span>
</span><span id="GeoRegion-652"><a href="#GeoRegion-652"><span class="linenos">652</span></a>        <span class="n">p_gs</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_source_dict</span><span class="p">[</span><span class="s2">&quot;GeoScheme&quot;</span><span class="p">],</span><span class="mi">0</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GeoRegion-653"><a href="#GeoRegion-653"><span class="linenos">653</span></a>        <span class="n">p_gs</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;country&#39;</span><span class="p">,</span><span class="s1">&#39;capital&#39;</span><span class="p">,</span><span class="s1">&#39;iso2&#39;</span><span class="p">,</span><span class="s1">&#39;iso3&#39;</span><span class="p">,</span><span class="s1">&#39;num&#39;</span><span class="p">,</span><span class="s1">&#39;m49&#39;</span><span class="p">]</span>
</span><span id="GeoRegion-654"><a href="#GeoRegion-654"><span class="linenos">654</span></a>        <span class="n">p_gs</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">p_gs</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;country&#39;</span><span class="p">:</span><span class="s1">&#39;Taiwan&#39;</span><span class="p">,</span><span class="s1">&#39;iso2&#39;</span><span class="p">:</span><span class="s1">&#39;TW&#39;</span><span class="p">,</span><span class="s1">&#39;iso3&#39;</span><span class="p">:</span><span class="s1">&#39;TWN&#39;</span><span class="p">,</span><span class="s1">&#39;num&#39;</span><span class="p">:</span><span class="s1">&#39;158&#39;</span><span class="p">,</span><span class="s1">&#39;m49&#39;</span><span class="p">:</span><span class="s1">&#39;030 &lt; 0142 &lt; 001&#39;</span><span class="p">},</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoRegion-655"><a href="#GeoRegion-655"><span class="linenos">655</span></a>        <span class="c1">#p_gs=p_gs.append({&#39;country&#39;:&#39;Taiwan&#39;,&#39;iso2&#39;:&#39;TW&#39;,&#39;iso3&#39;:&#39;TWN&#39;,&#39;num&#39;:&#39;158&#39;,&#39;m49&#39;:&#39;030 &lt; 0142 &lt; 001&#39;},ignore_index=True)</span>
</span><span id="GeoRegion-656"><a href="#GeoRegion-656"><span class="linenos">656</span></a>
</span><span id="GeoRegion-657"><a href="#GeoRegion-657"><span class="linenos">657</span></a>        <span class="n">idx</span><span class="o">=</span><span class="p">[]</span>
</span><span id="GeoRegion-658"><a href="#GeoRegion-658"><span class="linenos">658</span></a>        <span class="n">reg</span><span class="o">=</span><span class="p">[]</span>
</span><span id="GeoRegion-659"><a href="#GeoRegion-659"><span class="linenos">659</span></a>        <span class="n">cap</span><span class="o">=</span><span class="p">[]</span>
</span><span id="GeoRegion-660"><a href="#GeoRegion-660"><span class="linenos">660</span></a>
</span><span id="GeoRegion-661"><a href="#GeoRegion-661"><span class="linenos">661</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">p_gs</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="GeoRegion-662"><a href="#GeoRegion-662"><span class="linenos">662</span></a>            <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">iso3</span> <span class="o">!=</span> <span class="s1">&#39;–&#39;</span> <span class="p">:</span> <span class="c1"># meaning a non standard iso in wikipedia UN GeoScheme</span>
</span><span id="GeoRegion-663"><a href="#GeoRegion-663"><span class="linenos">663</span></a>                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">m49</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&lt;&#39;</span><span class="p">):</span>
</span><span id="GeoRegion-664"><a href="#GeoRegion-664"><span class="linenos">664</span></a>                    <span class="n">idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">iso3</span><span class="p">)</span>
</span><span id="GeoRegion-665"><a href="#GeoRegion-665"><span class="linenos">665</span></a>                    <span class="n">reg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
</span><span id="GeoRegion-666"><a href="#GeoRegion-666"><span class="linenos">666</span></a>                    <span class="n">cap</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">capital</span><span class="p">)</span>
</span><span id="GeoRegion-667"><a href="#GeoRegion-667"><span class="linenos">667</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_p_gs</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;iso3&#39;</span><span class="p">:</span><span class="n">idx</span><span class="p">,</span><span class="s1">&#39;capital&#39;</span><span class="p">:</span><span class="n">cap</span><span class="p">,</span><span class="s1">&#39;region&#39;</span><span class="p">:</span><span class="n">reg</span><span class="p">})</span>
</span><span id="GeoRegion-668"><a href="#GeoRegion-668"><span class="linenos">668</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_p_gs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_p_gs</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">p_m49</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;region&#39;</span><span class="p">,</span>\
</span><span id="GeoRegion-669"><a href="#GeoRegion-669"><span class="linenos">669</span></a>                            <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;code&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;code&quot;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="GeoRegion-670"><a href="#GeoRegion-670"><span class="linenos">670</span></a>
</span><span id="GeoRegion-671"><a href="#GeoRegion-671"><span class="linenos">671</span></a>    <span class="k">def</span> <span class="nf">get_source</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GeoRegion-672"><a href="#GeoRegion-672"><span class="linenos">672</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_dict</span>
</span><span id="GeoRegion-673"><a href="#GeoRegion-673"><span class="linenos">673</span></a>
</span><span id="GeoRegion-674"><a href="#GeoRegion-674"><span class="linenos">674</span></a>    <span class="k">def</span> <span class="nf">get_region_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GeoRegion-675"><a href="#GeoRegion-675"><span class="linenos">675</span></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_region_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="GeoRegion-676"><a href="#GeoRegion-676"><span class="linenos">676</span></a>
</span><span id="GeoRegion-677"><a href="#GeoRegion-677"><span class="linenos">677</span></a>    <span class="k">def</span> <span class="nf">is_region</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">region</span><span class="p">):</span>
</span><span id="GeoRegion-678"><a href="#GeoRegion-678"><span class="linenos">678</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; it returns either False or the correctly named region name</span>
</span><span id="GeoRegion-679"><a href="#GeoRegion-679"><span class="linenos">679</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoRegion-680"><a href="#GeoRegion-680"><span class="linenos">680</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">region</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="GeoRegion-681"><a href="#GeoRegion-681"><span class="linenos">681</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s2">&quot;The given region is not a str type.&quot;</span><span class="p">)</span>
</span><span id="GeoRegion-682"><a href="#GeoRegion-682"><span class="linenos">682</span></a>
</span><span id="GeoRegion-683"><a href="#GeoRegion-683"><span class="linenos">683</span></a>        <span class="n">region</span><span class="o">=</span><span class="n">region</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>  <span class="c1"># if not properly capitalized</span>
</span><span id="GeoRegion-684"><a href="#GeoRegion-684"><span class="linenos">684</span></a>
</span><span id="GeoRegion-685"><a href="#GeoRegion-685"><span class="linenos">685</span></a>        <span class="k">if</span> <span class="n">region</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_region_list</span><span class="p">():</span>
</span><span id="GeoRegion-686"><a href="#GeoRegion-686"><span class="linenos">686</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="GeoRegion-687"><a href="#GeoRegion-687"><span class="linenos">687</span></a>        <span class="k">else</span> <span class="p">:</span>
</span><span id="GeoRegion-688"><a href="#GeoRegion-688"><span class="linenos">688</span></a>            <span class="k">return</span> <span class="n">region</span>
</span><span id="GeoRegion-689"><a href="#GeoRegion-689"><span class="linenos">689</span></a>
</span><span id="GeoRegion-690"><a href="#GeoRegion-690"><span class="linenos">690</span></a>    <span class="k">def</span> <span class="nf">get_countries_from_region</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">region</span><span class="p">):</span>
</span><span id="GeoRegion-691"><a href="#GeoRegion-691"><span class="linenos">691</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; it returns a list of countries for the given region name.</span>
</span><span id="GeoRegion-692"><a href="#GeoRegion-692"><span class="linenos">692</span></a><span class="sd">        The standard used is iso3. To convert to another standard,</span>
</span><span id="GeoRegion-693"><a href="#GeoRegion-693"><span class="linenos">693</span></a><span class="sd">        use the GeoManager class.</span>
</span><span id="GeoRegion-694"><a href="#GeoRegion-694"><span class="linenos">694</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoRegion-695"><a href="#GeoRegion-695"><span class="linenos">695</span></a>        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_region</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>
</span><span id="GeoRegion-696"><a href="#GeoRegion-696"><span class="linenos">696</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">r</span><span class="p">:</span>
</span><span id="GeoRegion-697"><a href="#GeoRegion-697"><span class="linenos">697</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;The given region &quot;&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">region</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;&quot; is unknown.&#39;</span><span class="p">)</span>
</span><span id="GeoRegion-698"><a href="#GeoRegion-698"><span class="linenos">698</span></a>        <span class="n">region</span><span class="o">=</span><span class="n">r</span>
</span><span id="GeoRegion-699"><a href="#GeoRegion-699"><span class="linenos">699</span></a>
</span><span id="GeoRegion-700"><a href="#GeoRegion-700"><span class="linenos">700</span></a>        <span class="n">clist</span><span class="o">=</span><span class="p">[]</span>
</span><span id="GeoRegion-701"><a href="#GeoRegion-701"><span class="linenos">701</span></a>
</span><span id="GeoRegion-702"><a href="#GeoRegion-702"><span class="linenos">702</span></a>        <span class="k">if</span> <span class="n">region</span><span class="o">==</span><span class="s1">&#39;European Union&#39;</span><span class="p">:</span>
</span><span id="GeoRegion-703"><a href="#GeoRegion-703"><span class="linenos">703</span></a>            <span class="n">clist</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;AUT&#39;</span><span class="p">,</span><span class="s1">&#39;BEL&#39;</span><span class="p">,</span><span class="s1">&#39;BGR&#39;</span><span class="p">,</span><span class="s1">&#39;CYP&#39;</span><span class="p">,</span><span class="s1">&#39;CZE&#39;</span><span class="p">,</span><span class="s1">&#39;DEU&#39;</span><span class="p">,</span><span class="s1">&#39;DNK&#39;</span><span class="p">,</span><span class="s1">&#39;EST&#39;</span><span class="p">,</span>\
</span><span id="GeoRegion-704"><a href="#GeoRegion-704"><span class="linenos">704</span></a>                        <span class="s1">&#39;ESP&#39;</span><span class="p">,</span><span class="s1">&#39;FIN&#39;</span><span class="p">,</span><span class="s1">&#39;FRA&#39;</span><span class="p">,</span><span class="s1">&#39;GRC&#39;</span><span class="p">,</span><span class="s1">&#39;HRV&#39;</span><span class="p">,</span><span class="s1">&#39;HUN&#39;</span><span class="p">,</span><span class="s1">&#39;IRL&#39;</span><span class="p">,</span><span class="s1">&#39;ITA&#39;</span><span class="p">,</span>\
</span><span id="GeoRegion-705"><a href="#GeoRegion-705"><span class="linenos">705</span></a>                        <span class="s1">&#39;LTU&#39;</span><span class="p">,</span><span class="s1">&#39;LUX&#39;</span><span class="p">,</span><span class="s1">&#39;LVA&#39;</span><span class="p">,</span><span class="s1">&#39;MLT&#39;</span><span class="p">,</span><span class="s1">&#39;NLD&#39;</span><span class="p">,</span><span class="s1">&#39;POL&#39;</span><span class="p">,</span><span class="s1">&#39;PRT&#39;</span><span class="p">,</span><span class="s1">&#39;ROU&#39;</span><span class="p">,</span>\
</span><span id="GeoRegion-706"><a href="#GeoRegion-706"><span class="linenos">706</span></a>                        <span class="s1">&#39;SWE&#39;</span><span class="p">,</span><span class="s1">&#39;SVN&#39;</span><span class="p">,</span><span class="s1">&#39;SVK&#39;</span><span class="p">]</span>
</span><span id="GeoRegion-707"><a href="#GeoRegion-707"><span class="linenos">707</span></a>        <span class="k">elif</span> <span class="n">region</span><span class="o">==</span><span class="s1">&#39;G7&#39;</span><span class="p">:</span>
</span><span id="GeoRegion-708"><a href="#GeoRegion-708"><span class="linenos">708</span></a>            <span class="n">clist</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;DEU&#39;</span><span class="p">,</span><span class="s1">&#39;CAN&#39;</span><span class="p">,</span><span class="s1">&#39;USA&#39;</span><span class="p">,</span><span class="s1">&#39;FRA&#39;</span><span class="p">,</span><span class="s1">&#39;ITA&#39;</span><span class="p">,</span><span class="s1">&#39;JPN&#39;</span><span class="p">,</span><span class="s1">&#39;GBR&#39;</span><span class="p">]</span>
</span><span id="GeoRegion-709"><a href="#GeoRegion-709"><span class="linenos">709</span></a>        <span class="k">elif</span> <span class="n">region</span><span class="o">==</span><span class="s1">&#39;G8&#39;</span><span class="p">:</span>
</span><span id="GeoRegion-710"><a href="#GeoRegion-710"><span class="linenos">710</span></a>            <span class="n">clist</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;DEU&#39;</span><span class="p">,</span><span class="s1">&#39;CAN&#39;</span><span class="p">,</span><span class="s1">&#39;USA&#39;</span><span class="p">,</span><span class="s1">&#39;FRA&#39;</span><span class="p">,</span><span class="s1">&#39;ITA&#39;</span><span class="p">,</span><span class="s1">&#39;JPN&#39;</span><span class="p">,</span><span class="s1">&#39;GBR&#39;</span><span class="p">,</span><span class="s1">&#39;RUS&#39;</span><span class="p">]</span>
</span><span id="GeoRegion-711"><a href="#GeoRegion-711"><span class="linenos">711</span></a>        <span class="k">elif</span> <span class="n">region</span><span class="o">==</span><span class="s1">&#39;G20&#39;</span><span class="p">:</span>
</span><span id="GeoRegion-712"><a href="#GeoRegion-712"><span class="linenos">712</span></a>            <span class="n">clist</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ZAF&#39;</span><span class="p">,</span><span class="s1">&#39;SAU&#39;</span><span class="p">,</span><span class="s1">&#39;ARG&#39;</span><span class="p">,</span><span class="s1">&#39;AUS&#39;</span><span class="p">,</span><span class="s1">&#39;BRA&#39;</span><span class="p">,</span><span class="s1">&#39;CAN&#39;</span><span class="p">,</span><span class="s1">&#39;CHN&#39;</span><span class="p">,</span><span class="s1">&#39;KOR&#39;</span><span class="p">,</span><span class="s1">&#39;USA&#39;</span><span class="p">,</span>\
</span><span id="GeoRegion-713"><a href="#GeoRegion-713"><span class="linenos">713</span></a>                <span class="s1">&#39;IND&#39;</span><span class="p">,</span><span class="s1">&#39;IDN&#39;</span><span class="p">,</span><span class="s1">&#39;JPN&#39;</span><span class="p">,</span><span class="s1">&#39;MEX&#39;</span><span class="p">,</span><span class="s1">&#39;GBR&#39;</span><span class="p">,</span><span class="s1">&#39;DEU&#39;</span><span class="p">,</span><span class="s1">&#39;FRA&#39;</span><span class="p">,</span><span class="s1">&#39;ITA&#39;</span><span class="p">,</span><span class="s1">&#39;TUR&#39;</span><span class="p">,</span>\
</span><span id="GeoRegion-714"><a href="#GeoRegion-714"><span class="linenos">714</span></a>                <span class="s1">&#39;MEX&#39;</span><span class="p">,</span><span class="s1">&#39;RUS&#39;</span><span class="p">]</span>
</span><span id="GeoRegion-715"><a href="#GeoRegion-715"><span class="linenos">715</span></a>        <span class="k">elif</span> <span class="n">region</span><span class="o">==</span><span class="s1">&#39;Oecd&#39;</span><span class="p">:</span> <span class="c1"># OCDE in french</span>
</span><span id="GeoRegion-716"><a href="#GeoRegion-716"><span class="linenos">716</span></a>            <span class="n">clist</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;DEU&#39;</span><span class="p">,</span><span class="s1">&#39;AUS&#39;</span><span class="p">,</span><span class="s1">&#39;AUT&#39;</span><span class="p">,</span><span class="s1">&#39;BEL&#39;</span><span class="p">,</span><span class="s1">&#39;CAN&#39;</span><span class="p">,</span><span class="s1">&#39;CHL&#39;</span><span class="p">,</span><span class="s1">&#39;COL&#39;</span><span class="p">,</span><span class="s1">&#39;KOR&#39;</span><span class="p">,</span><span class="s1">&#39;DNK&#39;</span><span class="p">,</span>\
</span><span id="GeoRegion-717"><a href="#GeoRegion-717"><span class="linenos">717</span></a>                <span class="s1">&#39;ESP&#39;</span><span class="p">,</span><span class="s1">&#39;EST&#39;</span><span class="p">,</span><span class="s1">&#39;USA&#39;</span><span class="p">,</span><span class="s1">&#39;FIN&#39;</span><span class="p">,</span><span class="s1">&#39;FRA&#39;</span><span class="p">,</span><span class="s1">&#39;GRC&#39;</span><span class="p">,</span><span class="s1">&#39;HUN&#39;</span><span class="p">,</span><span class="s1">&#39;IRL&#39;</span><span class="p">,</span><span class="s1">&#39;ISL&#39;</span><span class="p">,</span><span class="s1">&#39;ISR&#39;</span><span class="p">,</span>\
</span><span id="GeoRegion-718"><a href="#GeoRegion-718"><span class="linenos">718</span></a>                <span class="s1">&#39;ITA&#39;</span><span class="p">,</span><span class="s1">&#39;JPN&#39;</span><span class="p">,</span><span class="s1">&#39;LVA&#39;</span><span class="p">,</span><span class="s1">&#39;LTU&#39;</span><span class="p">,</span><span class="s1">&#39;LUX&#39;</span><span class="p">,</span><span class="s1">&#39;MEX&#39;</span><span class="p">,</span><span class="s1">&#39;NOR&#39;</span><span class="p">,</span><span class="s1">&#39;NZL&#39;</span><span class="p">,</span><span class="s1">&#39;NLD&#39;</span><span class="p">,</span><span class="s1">&#39;POL&#39;</span><span class="p">,</span>\
</span><span id="GeoRegion-719"><a href="#GeoRegion-719"><span class="linenos">719</span></a>                <span class="s1">&#39;PRT&#39;</span><span class="p">,</span><span class="s1">&#39;SVK&#39;</span><span class="p">,</span><span class="s1">&#39;SVN&#39;</span><span class="p">,</span><span class="s1">&#39;SWE&#39;</span><span class="p">,</span><span class="s1">&#39;CHE&#39;</span><span class="p">,</span><span class="s1">&#39;GBR&#39;</span><span class="p">,</span><span class="s1">&#39;CZE&#39;</span><span class="p">,</span><span class="s1">&#39;TUR&#39;</span><span class="p">]</span>
</span><span id="GeoRegion-720"><a href="#GeoRegion-720"><span class="linenos">720</span></a>        <span class="k">elif</span> <span class="n">region</span><span class="o">==</span><span class="s1">&#39;G77&#39;</span><span class="p">:</span>
</span><span id="GeoRegion-721"><a href="#GeoRegion-721"><span class="linenos">721</span></a>            <span class="n">clist</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;AFG&#39;</span><span class="p">,</span><span class="s1">&#39;DZA&#39;</span><span class="p">,</span><span class="s1">&#39;AGO&#39;</span><span class="p">,</span><span class="s1">&#39;ATG&#39;</span><span class="p">,</span><span class="s1">&#39;ARG&#39;</span><span class="p">,</span><span class="s1">&#39;AZE&#39;</span><span class="p">,</span><span class="s1">&#39;BHS&#39;</span><span class="p">,</span><span class="s1">&#39;BHR&#39;</span><span class="p">,</span><span class="s1">&#39;BGD&#39;</span><span class="p">,</span><span class="s1">&#39;BRB&#39;</span><span class="p">,</span><span class="s1">&#39;BLZ&#39;</span><span class="p">,</span>
</span><span id="GeoRegion-722"><a href="#GeoRegion-722"><span class="linenos">722</span></a>                <span class="s1">&#39;BEN&#39;</span><span class="p">,</span><span class="s1">&#39;BTN&#39;</span><span class="p">,</span><span class="s1">&#39;BOL&#39;</span><span class="p">,</span><span class="s1">&#39;BWA&#39;</span><span class="p">,</span><span class="s1">&#39;BRA&#39;</span><span class="p">,</span><span class="s1">&#39;BRN&#39;</span><span class="p">,</span><span class="s1">&#39;BFA&#39;</span><span class="p">,</span><span class="s1">&#39;BDI&#39;</span><span class="p">,</span><span class="s1">&#39;CPV&#39;</span><span class="p">,</span><span class="s1">&#39;KHM&#39;</span><span class="p">,</span><span class="s1">&#39;CMR&#39;</span><span class="p">,</span>
</span><span id="GeoRegion-723"><a href="#GeoRegion-723"><span class="linenos">723</span></a>                <span class="s1">&#39;CAF&#39;</span><span class="p">,</span><span class="s1">&#39;TCD&#39;</span><span class="p">,</span><span class="s1">&#39;CHL&#39;</span><span class="p">,</span><span class="s1">&#39;CHN&#39;</span><span class="p">,</span><span class="s1">&#39;COL&#39;</span><span class="p">,</span><span class="s1">&#39;COM&#39;</span><span class="p">,</span><span class="s1">&#39;COG&#39;</span><span class="p">,</span><span class="s1">&#39;CRI&#39;</span><span class="p">,</span><span class="s1">&#39;CIV&#39;</span><span class="p">,</span><span class="s1">&#39;CUB&#39;</span><span class="p">,</span><span class="s1">&#39;PRK&#39;</span><span class="p">,</span>
</span><span id="GeoRegion-724"><a href="#GeoRegion-724"><span class="linenos">724</span></a>                <span class="s1">&#39;COD&#39;</span><span class="p">,</span><span class="s1">&#39;DJI&#39;</span><span class="p">,</span><span class="s1">&#39;DMA&#39;</span><span class="p">,</span><span class="s1">&#39;DOM&#39;</span><span class="p">,</span><span class="s1">&#39;ECU&#39;</span><span class="p">,</span><span class="s1">&#39;EGY&#39;</span><span class="p">,</span><span class="s1">&#39;SLV&#39;</span><span class="p">,</span><span class="s1">&#39;GNQ&#39;</span><span class="p">,</span><span class="s1">&#39;ERI&#39;</span><span class="p">,</span><span class="s1">&#39;SWZ&#39;</span><span class="p">,</span><span class="s1">&#39;ETH&#39;</span><span class="p">,</span>
</span><span id="GeoRegion-725"><a href="#GeoRegion-725"><span class="linenos">725</span></a>                <span class="s1">&#39;FJI&#39;</span><span class="p">,</span><span class="s1">&#39;GAB&#39;</span><span class="p">,</span><span class="s1">&#39;GMB&#39;</span><span class="p">,</span><span class="s1">&#39;GHA&#39;</span><span class="p">,</span><span class="s1">&#39;GRD&#39;</span><span class="p">,</span><span class="s1">&#39;GTM&#39;</span><span class="p">,</span><span class="s1">&#39;GIN&#39;</span><span class="p">,</span><span class="s1">&#39;GNB&#39;</span><span class="p">,</span><span class="s1">&#39;GUY&#39;</span><span class="p">,</span><span class="s1">&#39;HTI&#39;</span><span class="p">,</span><span class="s1">&#39;HND&#39;</span><span class="p">,</span>
</span><span id="GeoRegion-726"><a href="#GeoRegion-726"><span class="linenos">726</span></a>                <span class="s1">&#39;IND&#39;</span><span class="p">,</span><span class="s1">&#39;IDN&#39;</span><span class="p">,</span><span class="s1">&#39;IRN&#39;</span><span class="p">,</span><span class="s1">&#39;IRQ&#39;</span><span class="p">,</span><span class="s1">&#39;JAM&#39;</span><span class="p">,</span><span class="s1">&#39;JOR&#39;</span><span class="p">,</span><span class="s1">&#39;KEN&#39;</span><span class="p">,</span><span class="s1">&#39;KIR&#39;</span><span class="p">,</span><span class="s1">&#39;KWT&#39;</span><span class="p">,</span><span class="s1">&#39;LAO&#39;</span><span class="p">,</span><span class="s1">&#39;LBN&#39;</span><span class="p">,</span>
</span><span id="GeoRegion-727"><a href="#GeoRegion-727"><span class="linenos">727</span></a>                <span class="s1">&#39;LSO&#39;</span><span class="p">,</span><span class="s1">&#39;LBR&#39;</span><span class="p">,</span><span class="s1">&#39;LBY&#39;</span><span class="p">,</span><span class="s1">&#39;MDG&#39;</span><span class="p">,</span><span class="s1">&#39;MWI&#39;</span><span class="p">,</span><span class="s1">&#39;MYS&#39;</span><span class="p">,</span><span class="s1">&#39;MDV&#39;</span><span class="p">,</span><span class="s1">&#39;MLI&#39;</span><span class="p">,</span><span class="s1">&#39;MHL&#39;</span><span class="p">,</span><span class="s1">&#39;MRT&#39;</span><span class="p">,</span><span class="s1">&#39;MUS&#39;</span><span class="p">,</span>
</span><span id="GeoRegion-728"><a href="#GeoRegion-728"><span class="linenos">728</span></a>                <span class="s1">&#39;FSM&#39;</span><span class="p">,</span><span class="s1">&#39;MNG&#39;</span><span class="p">,</span><span class="s1">&#39;MAR&#39;</span><span class="p">,</span><span class="s1">&#39;MOZ&#39;</span><span class="p">,</span><span class="s1">&#39;MMR&#39;</span><span class="p">,</span><span class="s1">&#39;NAM&#39;</span><span class="p">,</span><span class="s1">&#39;NRU&#39;</span><span class="p">,</span><span class="s1">&#39;NPL&#39;</span><span class="p">,</span><span class="s1">&#39;NIC&#39;</span><span class="p">,</span><span class="s1">&#39;NER&#39;</span><span class="p">,</span><span class="s1">&#39;NGA&#39;</span><span class="p">,</span>
</span><span id="GeoRegion-729"><a href="#GeoRegion-729"><span class="linenos">729</span></a>                <span class="s1">&#39;OMN&#39;</span><span class="p">,</span><span class="s1">&#39;PAK&#39;</span><span class="p">,</span><span class="s1">&#39;PAN&#39;</span><span class="p">,</span><span class="s1">&#39;PNG&#39;</span><span class="p">,</span><span class="s1">&#39;PRY&#39;</span><span class="p">,</span><span class="s1">&#39;PER&#39;</span><span class="p">,</span><span class="s1">&#39;PHL&#39;</span><span class="p">,</span><span class="s1">&#39;QAT&#39;</span><span class="p">,</span><span class="s1">&#39;RWA&#39;</span><span class="p">,</span><span class="s1">&#39;KNA&#39;</span><span class="p">,</span><span class="s1">&#39;LCA&#39;</span><span class="p">,</span>
</span><span id="GeoRegion-730"><a href="#GeoRegion-730"><span class="linenos">730</span></a>                <span class="s1">&#39;VCT&#39;</span><span class="p">,</span><span class="s1">&#39;WSM&#39;</span><span class="p">,</span><span class="s1">&#39;STP&#39;</span><span class="p">,</span><span class="s1">&#39;SAU&#39;</span><span class="p">,</span><span class="s1">&#39;SEN&#39;</span><span class="p">,</span><span class="s1">&#39;SYC&#39;</span><span class="p">,</span><span class="s1">&#39;SLE&#39;</span><span class="p">,</span><span class="s1">&#39;SGP&#39;</span><span class="p">,</span><span class="s1">&#39;SLB&#39;</span><span class="p">,</span><span class="s1">&#39;SOM&#39;</span><span class="p">,</span><span class="s1">&#39;ZAF&#39;</span><span class="p">,</span>
</span><span id="GeoRegion-731"><a href="#GeoRegion-731"><span class="linenos">731</span></a>                <span class="s1">&#39;SSD&#39;</span><span class="p">,</span><span class="s1">&#39;LKA&#39;</span><span class="p">,</span><span class="s1">&#39;PSE&#39;</span><span class="p">,</span><span class="s1">&#39;SDN&#39;</span><span class="p">,</span><span class="s1">&#39;SUR&#39;</span><span class="p">,</span><span class="s1">&#39;SYR&#39;</span><span class="p">,</span><span class="s1">&#39;TJK&#39;</span><span class="p">,</span><span class="s1">&#39;THA&#39;</span><span class="p">,</span><span class="s1">&#39;TLS&#39;</span><span class="p">,</span><span class="s1">&#39;TGO&#39;</span><span class="p">,</span><span class="s1">&#39;TON&#39;</span><span class="p">,</span>
</span><span id="GeoRegion-732"><a href="#GeoRegion-732"><span class="linenos">732</span></a>                <span class="s1">&#39;TTO&#39;</span><span class="p">,</span><span class="s1">&#39;TUN&#39;</span><span class="p">,</span><span class="s1">&#39;TKM&#39;</span><span class="p">,</span><span class="s1">&#39;UGA&#39;</span><span class="p">,</span><span class="s1">&#39;ARE&#39;</span><span class="p">,</span><span class="s1">&#39;TZA&#39;</span><span class="p">,</span><span class="s1">&#39;URY&#39;</span><span class="p">,</span><span class="s1">&#39;VUT&#39;</span><span class="p">,</span><span class="s1">&#39;VEN&#39;</span><span class="p">,</span><span class="s1">&#39;VNM&#39;</span><span class="p">,</span><span class="s1">&#39;YEM&#39;</span><span class="p">,</span>
</span><span id="GeoRegion-733"><a href="#GeoRegion-733"><span class="linenos">733</span></a>                <span class="s1">&#39;ZMB&#39;</span><span class="p">,</span><span class="s1">&#39;ZWE&#39;</span><span class="p">]</span>
</span><span id="GeoRegion-734"><a href="#GeoRegion-734"><span class="linenos">734</span></a>
</span><span id="GeoRegion-735"><a href="#GeoRegion-735"><span class="linenos">735</span></a>        <span class="k">elif</span> <span class="n">region</span><span class="o">==</span><span class="s1">&#39;Commonwealth&#39;</span><span class="p">:</span>
</span><span id="GeoRegion-736"><a href="#GeoRegion-736"><span class="linenos">736</span></a>            <span class="n">clist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_cw</span>
</span><span id="GeoRegion-737"><a href="#GeoRegion-737"><span class="linenos">737</span></a>        <span class="k">elif</span> <span class="n">region</span><span class="o">==</span><span class="s1">&#39;Celac&#39;</span><span class="p">:</span>
</span><span id="GeoRegion-738"><a href="#GeoRegion-738"><span class="linenos">738</span></a>            <span class="n">clist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_celac</span>
</span><span id="GeoRegion-739"><a href="#GeoRegion-739"><span class="linenos">739</span></a>        <span class="k">elif</span> <span class="n">region</span><span class="o">==</span><span class="s1">&#39;Cedeao&#39;</span><span class="p">:</span>
</span><span id="GeoRegion-740"><a href="#GeoRegion-740"><span class="linenos">740</span></a>            <span class="n">clist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_cedeao</span>
</span><span id="GeoRegion-741"><a href="#GeoRegion-741"><span class="linenos">741</span></a>        <span class="k">elif</span> <span class="n">region</span><span class="o">==</span><span class="s1">&#39;Sadc&#39;</span><span class="p">:</span>
</span><span id="GeoRegion-742"><a href="#GeoRegion-742"><span class="linenos">742</span></a>            <span class="n">clist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sadc</span>
</span><span id="GeoRegion-743"><a href="#GeoRegion-743"><span class="linenos">743</span></a>        <span class="k">elif</span> <span class="n">region</span><span class="o">==</span><span class="s1">&#39;Amu&#39;</span><span class="p">:</span>
</span><span id="GeoRegion-744"><a href="#GeoRegion-744"><span class="linenos">744</span></a>            <span class="n">clist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_amu</span>
</span><span id="GeoRegion-745"><a href="#GeoRegion-745"><span class="linenos">745</span></a>        <span class="k">elif</span> <span class="n">region</span><span class="o">==</span><span class="s1">&#39;Ceeac&#39;</span><span class="p">:</span>
</span><span id="GeoRegion-746"><a href="#GeoRegion-746"><span class="linenos">746</span></a>            <span class="n">clist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ceeac</span>
</span><span id="GeoRegion-747"><a href="#GeoRegion-747"><span class="linenos">747</span></a>        <span class="k">elif</span> <span class="n">region</span><span class="o">==</span><span class="s1">&#39;Eac&#39;</span><span class="p">:</span>
</span><span id="GeoRegion-748"><a href="#GeoRegion-748"><span class="linenos">748</span></a>            <span class="n">clist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_eac</span>
</span><span id="GeoRegion-749"><a href="#GeoRegion-749"><span class="linenos">749</span></a>        <span class="k">elif</span> <span class="n">region</span><span class="o">==</span><span class="s1">&#39;Censad&#39;</span><span class="p">:</span>
</span><span id="GeoRegion-750"><a href="#GeoRegion-750"><span class="linenos">750</span></a>            <span class="n">clist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_censad</span>
</span><span id="GeoRegion-751"><a href="#GeoRegion-751"><span class="linenos">751</span></a>        <span class="k">elif</span> <span class="n">region</span><span class="o">==</span><span class="s1">&#39;Comesa&#39;</span><span class="p">:</span>
</span><span id="GeoRegion-752"><a href="#GeoRegion-752"><span class="linenos">752</span></a>            <span class="n">clist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_comesa</span>
</span><span id="GeoRegion-753"><a href="#GeoRegion-753"><span class="linenos">753</span></a>        <span class="k">elif</span> <span class="n">region</span><span class="o">==</span><span class="s1">&#39;Brics&#39;</span><span class="p">:</span>
</span><span id="GeoRegion-754"><a href="#GeoRegion-754"><span class="linenos">754</span></a>            <span class="n">clist</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;BRA&#39;</span><span class="p">,</span><span class="s1">&#39;RUS&#39;</span><span class="p">,</span><span class="s1">&#39;IND&#39;</span><span class="p">,</span><span class="s1">&#39;CHN&#39;</span><span class="p">,</span><span class="s1">&#39;ZAF&#39;</span><span class="p">]</span>
</span><span id="GeoRegion-755"><a href="#GeoRegion-755"><span class="linenos">755</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GeoRegion-756"><a href="#GeoRegion-756"><span class="linenos">756</span></a>            <span class="n">clist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_p_gs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_p_gs</span><span class="p">[</span><span class="s1">&#39;region_name&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">region</span><span class="p">][</span><span class="s1">&#39;iso3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
</span><span id="GeoRegion-757"><a href="#GeoRegion-757"><span class="linenos">757</span></a>
</span><span id="GeoRegion-758"><a href="#GeoRegion-758"><span class="linenos">758</span></a>        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">clist</span><span class="p">)</span>
</span><span id="GeoRegion-759"><a href="#GeoRegion-759"><span class="linenos">759</span></a>
</span><span id="GeoRegion-760"><a href="#GeoRegion-760"><span class="linenos">760</span></a>    <span class="k">def</span> <span class="nf">get_pandas</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GeoRegion-761"><a href="#GeoRegion-761"><span class="linenos">761</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_p_gs</span>
</span></pre></div>


            <div class="docstring"><p>GeoRegion class definition. Does not inheritate from any other
class.</p>

<p>It should raise only CoaError and derived exceptions in case
of errors (see pycoa.error)</p>
</div>


                            <div id="GeoRegion.__init__" class="classattr">
                                        <input id="GeoRegion.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">GeoRegion</span><span class="signature pdoc-code condensed">()</span>

                <label class="view-source-button" for="GeoRegion.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GeoRegion.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GeoRegion.__init__-579"><a href="#GeoRegion.__init__-579"><span class="linenos">579</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,):</span>
</span><span id="GeoRegion.__init__-580"><a href="#GeoRegion.__init__-580"><span class="linenos">580</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; __init__ member function.</span>
</span><span id="GeoRegion.__init__-581"><a href="#GeoRegion.__init__-581"><span class="linenos">581</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoRegion.__init__-582"><a href="#GeoRegion.__init__-582"><span class="linenos">582</span></a>        <span class="c1">#if &#39;XK&#39; in self._country_list:</span>
</span><span id="GeoRegion.__init__-583"><a href="#GeoRegion.__init__-583"><span class="linenos">583</span></a>        <span class="c1">#    del self._country_list[&#39;XK&#39;] # creates bugs in pycountry and is currently a contested country as country</span>
</span><span id="GeoRegion.__init__-584"><a href="#GeoRegion.__init__-584"><span class="linenos">584</span></a>
</span><span id="GeoRegion.__init__-585"><a href="#GeoRegion.__init__-585"><span class="linenos">585</span></a>
</span><span id="GeoRegion.__init__-586"><a href="#GeoRegion.__init__-586"><span class="linenos">586</span></a>        <span class="c1"># --- get the UN M49 information and organize the data in the _region_dict</span>
</span><span id="GeoRegion.__init__-587"><a href="#GeoRegion.__init__-587"><span class="linenos">587</span></a>
</span><span id="GeoRegion.__init__-588"><a href="#GeoRegion.__init__-588"><span class="linenos">588</span></a>        <span class="n">verb</span><span class="p">(</span><span class="s2">&quot;Init of GeoRegion() from &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="GeoRegion.__init__-589"><a href="#GeoRegion.__init__-589"><span class="linenos">589</span></a>
</span><span id="GeoRegion.__init__-590"><a href="#GeoRegion.__init__-590"><span class="linenos">590</span></a>        <span class="n">p_m49</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_source_dict</span><span class="p">[</span><span class="s2">&quot;UN_M49&quot;</span><span class="p">],</span><span class="mi">0</span><span class="p">))[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="GeoRegion.__init__-591"><a href="#GeoRegion.__init__-591"><span class="linenos">591</span></a>
</span><span id="GeoRegion.__init__-592"><a href="#GeoRegion.__init__-592"><span class="linenos">592</span></a>        <span class="n">p_m49</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">,</span><span class="s1">&#39;region_name&#39;</span><span class="p">]</span>
</span><span id="GeoRegion.__init__-593"><a href="#GeoRegion.__init__-593"><span class="linenos">593</span></a>        <span class="n">p_m49</span><span class="p">[</span><span class="s1">&#39;region_name&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">title</span><span class="p">()</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">p_m49</span><span class="o">.</span><span class="n">region_name</span><span class="p">]</span>  <span class="c1"># suppress information in parenthesis in region name</span>
</span><span id="GeoRegion.__init__-594"><a href="#GeoRegion.__init__-594"><span class="linenos">594</span></a>        <span class="n">p_m49</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;code&#39;</span><span class="p">)</span>
</span><span id="GeoRegion.__init__-595"><a href="#GeoRegion.__init__-595"><span class="linenos">595</span></a>
</span><span id="GeoRegion.__init__-596"><a href="#GeoRegion.__init__-596"><span class="linenos">596</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_region_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">p_m49</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s1">&#39;split&#39;</span><span class="p">)[</span><span class="s1">&#39;data&#39;</span><span class="p">])</span>
</span><span id="GeoRegion.__init__-597"><a href="#GeoRegion.__init__-597"><span class="linenos">597</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_region_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>  <span class="s2">&quot;UE&quot;</span><span class="p">:</span><span class="s2">&quot;European Union&quot;</span><span class="p">,</span>
</span><span id="GeoRegion.__init__-598"><a href="#GeoRegion.__init__-598"><span class="linenos">598</span></a>                                    <span class="s2">&quot;G7&quot;</span><span class="p">:</span><span class="s2">&quot;G7&quot;</span><span class="p">,</span>
</span><span id="GeoRegion.__init__-599"><a href="#GeoRegion.__init__-599"><span class="linenos">599</span></a>                                    <span class="s2">&quot;G8&quot;</span><span class="p">:</span><span class="s2">&quot;G8&quot;</span><span class="p">,</span>
</span><span id="GeoRegion.__init__-600"><a href="#GeoRegion.__init__-600"><span class="linenos">600</span></a>                                    <span class="s2">&quot;G20&quot;</span><span class="p">:</span><span class="s2">&quot;G20&quot;</span><span class="p">,</span>
</span><span id="GeoRegion.__init__-601"><a href="#GeoRegion.__init__-601"><span class="linenos">601</span></a>                                    <span class="s2">&quot;OECD&quot;</span><span class="p">:</span><span class="s2">&quot;Oecd&quot;</span><span class="p">,</span>
</span><span id="GeoRegion.__init__-602"><a href="#GeoRegion.__init__-602"><span class="linenos">602</span></a>                                    <span class="s2">&quot;BRICS&quot;</span><span class="p">:</span><span class="s2">&quot;Brics&quot;</span><span class="p">,</span>
</span><span id="GeoRegion.__init__-603"><a href="#GeoRegion.__init__-603"><span class="linenos">603</span></a>                                    <span class="s2">&quot;CELAC&quot;</span><span class="p">:</span><span class="s2">&quot;Celac&quot;</span><span class="p">,</span>
</span><span id="GeoRegion.__init__-604"><a href="#GeoRegion.__init__-604"><span class="linenos">604</span></a>                                    <span class="s2">&quot;CEDEAO&quot;</span><span class="p">:</span><span class="s2">&quot;Cedeao&quot;</span><span class="p">,</span>
</span><span id="GeoRegion.__init__-605"><a href="#GeoRegion.__init__-605"><span class="linenos">605</span></a>                                    <span class="s2">&quot;AMU&quot;</span><span class="p">:</span><span class="s2">&quot;Amu&quot;</span><span class="p">,</span>
</span><span id="GeoRegion.__init__-606"><a href="#GeoRegion.__init__-606"><span class="linenos">606</span></a>                                    <span class="s2">&quot;CEEAC&quot;</span><span class="p">:</span><span class="s2">&quot;Ceeac&quot;</span><span class="p">,</span>
</span><span id="GeoRegion.__init__-607"><a href="#GeoRegion.__init__-607"><span class="linenos">607</span></a>                                    <span class="s2">&quot;EAC&quot;</span><span class="p">:</span><span class="s2">&quot;Eac&quot;</span><span class="p">,</span>
</span><span id="GeoRegion.__init__-608"><a href="#GeoRegion.__init__-608"><span class="linenos">608</span></a>                                    <span class="s2">&quot;SADC&quot;</span><span class="p">:</span><span class="s2">&quot;Sadc&quot;</span><span class="p">,</span>
</span><span id="GeoRegion.__init__-609"><a href="#GeoRegion.__init__-609"><span class="linenos">609</span></a>                                    <span class="s2">&quot;CENSAD&quot;</span><span class="p">:</span><span class="s2">&quot;Censad&quot;</span><span class="p">,</span>
</span><span id="GeoRegion.__init__-610"><a href="#GeoRegion.__init__-610"><span class="linenos">610</span></a>                                    <span class="s2">&quot;COMESA&quot;</span><span class="p">:</span><span class="s2">&quot;Comesa&quot;</span><span class="p">,</span>
</span><span id="GeoRegion.__init__-611"><a href="#GeoRegion.__init__-611"><span class="linenos">611</span></a>                                    <span class="s2">&quot;G77&quot;</span><span class="p">:</span><span class="s2">&quot;G77&quot;</span><span class="p">,</span>
</span><span id="GeoRegion.__init__-612"><a href="#GeoRegion.__init__-612"><span class="linenos">612</span></a>                                    <span class="s2">&quot;CW&quot;</span><span class="p">:</span><span class="s2">&quot;Commonwealth&quot;</span>
</span><span id="GeoRegion.__init__-613"><a href="#GeoRegion.__init__-613"><span class="linenos">613</span></a>                                    <span class="p">})</span>  <span class="c1"># add UE for other analysis</span>
</span><span id="GeoRegion.__init__-614"><a href="#GeoRegion.__init__-614"><span class="linenos">614</span></a>
</span><span id="GeoRegion.__init__-615"><a href="#GeoRegion.__init__-615"><span class="linenos">615</span></a>        <span class="c1"># --- filling cw information</span>
</span><span id="GeoRegion.__init__-616"><a href="#GeoRegion.__init__-616"><span class="linenos">616</span></a>        <span class="n">p_cw</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="s1">&#39;https://en.wikipedia.org/w/index.php?title=Member_states_of_the_Commonwealth_of_Nations&amp;oldid=1090420488&#39;</span><span class="p">))</span>
</span><span id="GeoRegion.__init__-617"><a href="#GeoRegion.__init__-617"><span class="linenos">617</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_cw</span><span class="o">=</span><span class="p">[</span><span class="n">w</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">p_cw</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Country&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()]</span>   <span class="c1"># removing wikipedia notes</span>
</span><span id="GeoRegion.__init__-618"><a href="#GeoRegion.__init__-618"><span class="linenos">618</span></a>
</span><span id="GeoRegion.__init__-619"><a href="#GeoRegion.__init__-619"><span class="linenos">619</span></a>        <span class="c1"># --- filling celac information</span>
</span><span id="GeoRegion.__init__-620"><a href="#GeoRegion.__init__-620"><span class="linenos">620</span></a>        <span class="n">p_celac</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="s1">&#39;https://en.wikipedia.org/wiki/Community_of_Latin_American_and_Caribbean_States&#39;</span><span class="p">))</span>
</span><span id="GeoRegion.__init__-621"><a href="#GeoRegion.__init__-621"><span class="linenos">621</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_celac</span><span class="o">=</span><span class="p">[</span><span class="n">w</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">p_celac</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="n">p_celac</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">&lt;</span><span class="mi">33</span><span class="p">][</span><span class="s2">&quot;Country&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()]</span>
</span><span id="GeoRegion.__init__-622"><a href="#GeoRegion.__init__-622"><span class="linenos">622</span></a>
</span><span id="GeoRegion.__init__-623"><a href="#GeoRegion.__init__-623"><span class="linenos">623</span></a>        <span class="c1"># --- filling cedeao information</span>
</span><span id="GeoRegion.__init__-624"><a href="#GeoRegion.__init__-624"><span class="linenos">624</span></a>        <span class="n">p_cedeao</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="s1">&#39;https://en.wikipedia.org/wiki/Economic_Community_of_West_African_States&#39;</span><span class="p">))</span>
</span><span id="GeoRegion.__init__-625"><a href="#GeoRegion.__init__-625"><span class="linenos">625</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_cedeao</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Cabo Verde&quot;</span> <span class="k">if</span> <span class="n">x</span><span class="o">==</span><span class="s2">&quot;Cape Verde&quot;</span> <span class="k">else</span> <span class="s2">&quot;CIV&quot;</span> <span class="k">if</span> <span class="n">x</span><span class="o">==</span><span class="s2">&quot;Ivory Coast&quot;</span> <span class="k">else</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">p_cedeao</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">p_cedeao</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span><span class="o">.</span><span class="n">Country</span><span class="o">.</span><span class="n">to_list</span><span class="p">()]</span>
</span><span id="GeoRegion.__init__-626"><a href="#GeoRegion.__init__-626"><span class="linenos">626</span></a>
</span><span id="GeoRegion.__init__-627"><a href="#GeoRegion.__init__-627"><span class="linenos">627</span></a>        <span class="c1"># --- filling sadc information</span>
</span><span id="GeoRegion.__init__-628"><a href="#GeoRegion.__init__-628"><span class="linenos">628</span></a>        <span class="n">p_sadc</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="s1">&#39;https://en.wikipedia.org/wiki/Southern_African_Development_Community&#39;</span><span class="p">))</span>
</span><span id="GeoRegion.__init__-629"><a href="#GeoRegion.__init__-629"><span class="linenos">629</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_sadc</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;COD&quot;</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">&quot;Democratic Republic of the Congo&quot;</span> <span class="k">else</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="n">w</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">p_sadc</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">p_sadc</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()]]</span>
</span><span id="GeoRegion.__init__-630"><a href="#GeoRegion.__init__-630"><span class="linenos">630</span></a>
</span><span id="GeoRegion.__init__-631"><a href="#GeoRegion.__init__-631"><span class="linenos">631</span></a>        <span class="c1"># --- filling amu information</span>
</span><span id="GeoRegion.__init__-632"><a href="#GeoRegion.__init__-632"><span class="linenos">632</span></a>        <span class="n">p_amu</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="s1">&#39;https://en.wikipedia.org/wiki/Arab_Maghreb_Union&#39;</span><span class="p">))</span>
</span><span id="GeoRegion.__init__-633"><a href="#GeoRegion.__init__-633"><span class="linenos">633</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_amu</span><span class="o">=</span><span class="n">p_amu</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">Country</span><span class="o">.</span><span class="n">to_list</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="GeoRegion.__init__-634"><a href="#GeoRegion.__init__-634"><span class="linenos">634</span></a>
</span><span id="GeoRegion.__init__-635"><a href="#GeoRegion.__init__-635"><span class="linenos">635</span></a>        <span class="c1"># --- filling ceeac information</span>
</span><span id="GeoRegion.__init__-636"><a href="#GeoRegion.__init__-636"><span class="linenos">636</span></a>        <span class="n">p_ceeac</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="s1">&#39;https://en.wikipedia.org/wiki/Economic_Community_of_Central_African_States&#39;</span><span class="p">))</span>
</span><span id="GeoRegion.__init__-637"><a href="#GeoRegion.__init__-637"><span class="linenos">637</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ceeac</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;COD&quot;</span> <span class="k">if</span> <span class="n">w</span> <span class="o">==</span> <span class="s2">&quot;Democratic Republic of the Congo&quot;</span> <span class="k">else</span> <span class="n">w</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">p_ceeac</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">Country</span><span class="o">.</span><span class="n">to_list</span><span class="p">()]]</span>
</span><span id="GeoRegion.__init__-638"><a href="#GeoRegion.__init__-638"><span class="linenos">638</span></a>
</span><span id="GeoRegion.__init__-639"><a href="#GeoRegion.__init__-639"><span class="linenos">639</span></a>        <span class="c1"># --- filling eac information</span>
</span><span id="GeoRegion.__init__-640"><a href="#GeoRegion.__init__-640"><span class="linenos">640</span></a>        <span class="n">p_eac</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="s1">&#39;https://en.wikipedia.org/wiki/East_African_Community&#39;</span><span class="p">))</span>
</span><span id="GeoRegion.__init__-641"><a href="#GeoRegion.__init__-641"><span class="linenos">641</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_eac</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;COD&quot;</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">&quot;DR Congo&quot;</span> <span class="k">else</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">p_eac</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">Country</span><span class="o">.</span><span class="n">to_list</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="GeoRegion.__init__-642"><a href="#GeoRegion.__init__-642"><span class="linenos">642</span></a>
</span><span id="GeoRegion.__init__-643"><a href="#GeoRegion.__init__-643"><span class="linenos">643</span></a>        <span class="c1"># --- filling censad information</span>
</span><span id="GeoRegion.__init__-644"><a href="#GeoRegion.__init__-644"><span class="linenos">644</span></a>        <span class="n">p_censad</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="s1">&#39;https://en.wikipedia.org/wiki/Community_of_Sahel</span><span class="si">%E</span><span class="s1">2</span><span class="si">%80%</span><span class="s1">93Saharan_States&#39;</span><span class="p">))</span>
</span><span id="GeoRegion.__init__-645"><a href="#GeoRegion.__init__-645"><span class="linenos">645</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_censad</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Cabo Verde&quot;</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">&quot;Cape Verde&quot;</span> <span class="k">else</span> <span class="s2">&quot;CIV&quot;</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">&quot;Ivory Coast&quot;</span> <span class="k">else</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">p_censad</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">p_censad</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="GeoRegion.__init__-646"><a href="#GeoRegion.__init__-646"><span class="linenos">646</span></a>
</span><span id="GeoRegion.__init__-647"><a href="#GeoRegion.__init__-647"><span class="linenos">647</span></a>        <span class="c1"># --- filing comesa information</span>
</span><span id="GeoRegion.__init__-648"><a href="#GeoRegion.__init__-648"><span class="linenos">648</span></a>        <span class="n">p_comesa</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="s1">&#39;https://www.worlddata.info/trade-agreements/comesa.php&#39;</span><span class="p">))</span>
</span><span id="GeoRegion.__init__-649"><a href="#GeoRegion.__init__-649"><span class="linenos">649</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_comesa</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;COD&quot;</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">&quot;Congo (Dem. Republic)&quot;</span> <span class="k">else</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">p_comesa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">Country</span><span class="o">.</span><span class="n">to_list</span><span class="p">()]</span>
</span><span id="GeoRegion.__init__-650"><a href="#GeoRegion.__init__-650"><span class="linenos">650</span></a>
</span><span id="GeoRegion.__init__-651"><a href="#GeoRegion.__init__-651"><span class="linenos">651</span></a>        <span class="c1"># --- get the UnitedNation GeoScheme and organize the data</span>
</span><span id="GeoRegion.__init__-652"><a href="#GeoRegion.__init__-652"><span class="linenos">652</span></a>        <span class="n">p_gs</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_source_dict</span><span class="p">[</span><span class="s2">&quot;GeoScheme&quot;</span><span class="p">],</span><span class="mi">0</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GeoRegion.__init__-653"><a href="#GeoRegion.__init__-653"><span class="linenos">653</span></a>        <span class="n">p_gs</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;country&#39;</span><span class="p">,</span><span class="s1">&#39;capital&#39;</span><span class="p">,</span><span class="s1">&#39;iso2&#39;</span><span class="p">,</span><span class="s1">&#39;iso3&#39;</span><span class="p">,</span><span class="s1">&#39;num&#39;</span><span class="p">,</span><span class="s1">&#39;m49&#39;</span><span class="p">]</span>
</span><span id="GeoRegion.__init__-654"><a href="#GeoRegion.__init__-654"><span class="linenos">654</span></a>        <span class="n">p_gs</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">p_gs</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;country&#39;</span><span class="p">:</span><span class="s1">&#39;Taiwan&#39;</span><span class="p">,</span><span class="s1">&#39;iso2&#39;</span><span class="p">:</span><span class="s1">&#39;TW&#39;</span><span class="p">,</span><span class="s1">&#39;iso3&#39;</span><span class="p">:</span><span class="s1">&#39;TWN&#39;</span><span class="p">,</span><span class="s1">&#39;num&#39;</span><span class="p">:</span><span class="s1">&#39;158&#39;</span><span class="p">,</span><span class="s1">&#39;m49&#39;</span><span class="p">:</span><span class="s1">&#39;030 &lt; 0142 &lt; 001&#39;</span><span class="p">},</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoRegion.__init__-655"><a href="#GeoRegion.__init__-655"><span class="linenos">655</span></a>        <span class="c1">#p_gs=p_gs.append({&#39;country&#39;:&#39;Taiwan&#39;,&#39;iso2&#39;:&#39;TW&#39;,&#39;iso3&#39;:&#39;TWN&#39;,&#39;num&#39;:&#39;158&#39;,&#39;m49&#39;:&#39;030 &lt; 0142 &lt; 001&#39;},ignore_index=True)</span>
</span><span id="GeoRegion.__init__-656"><a href="#GeoRegion.__init__-656"><span class="linenos">656</span></a>
</span><span id="GeoRegion.__init__-657"><a href="#GeoRegion.__init__-657"><span class="linenos">657</span></a>        <span class="n">idx</span><span class="o">=</span><span class="p">[]</span>
</span><span id="GeoRegion.__init__-658"><a href="#GeoRegion.__init__-658"><span class="linenos">658</span></a>        <span class="n">reg</span><span class="o">=</span><span class="p">[]</span>
</span><span id="GeoRegion.__init__-659"><a href="#GeoRegion.__init__-659"><span class="linenos">659</span></a>        <span class="n">cap</span><span class="o">=</span><span class="p">[]</span>
</span><span id="GeoRegion.__init__-660"><a href="#GeoRegion.__init__-660"><span class="linenos">660</span></a>
</span><span id="GeoRegion.__init__-661"><a href="#GeoRegion.__init__-661"><span class="linenos">661</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">p_gs</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="GeoRegion.__init__-662"><a href="#GeoRegion.__init__-662"><span class="linenos">662</span></a>            <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">iso3</span> <span class="o">!=</span> <span class="s1">&#39;–&#39;</span> <span class="p">:</span> <span class="c1"># meaning a non standard iso in wikipedia UN GeoScheme</span>
</span><span id="GeoRegion.__init__-663"><a href="#GeoRegion.__init__-663"><span class="linenos">663</span></a>                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">m49</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&lt;&#39;</span><span class="p">):</span>
</span><span id="GeoRegion.__init__-664"><a href="#GeoRegion.__init__-664"><span class="linenos">664</span></a>                    <span class="n">idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">iso3</span><span class="p">)</span>
</span><span id="GeoRegion.__init__-665"><a href="#GeoRegion.__init__-665"><span class="linenos">665</span></a>                    <span class="n">reg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
</span><span id="GeoRegion.__init__-666"><a href="#GeoRegion.__init__-666"><span class="linenos">666</span></a>                    <span class="n">cap</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">capital</span><span class="p">)</span>
</span><span id="GeoRegion.__init__-667"><a href="#GeoRegion.__init__-667"><span class="linenos">667</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_p_gs</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;iso3&#39;</span><span class="p">:</span><span class="n">idx</span><span class="p">,</span><span class="s1">&#39;capital&#39;</span><span class="p">:</span><span class="n">cap</span><span class="p">,</span><span class="s1">&#39;region&#39;</span><span class="p">:</span><span class="n">reg</span><span class="p">})</span>
</span><span id="GeoRegion.__init__-668"><a href="#GeoRegion.__init__-668"><span class="linenos">668</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_p_gs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_p_gs</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">p_m49</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;region&#39;</span><span class="p">,</span>\
</span><span id="GeoRegion.__init__-669"><a href="#GeoRegion.__init__-669"><span class="linenos">669</span></a>                            <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;code&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;code&quot;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>__init__ member function.</p>
</div>


                            </div>
                            <div id="GeoRegion.get_source" class="classattr">
                                        <input id="GeoRegion.get_source-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_source</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GeoRegion.get_source-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GeoRegion.get_source"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GeoRegion.get_source-671"><a href="#GeoRegion.get_source-671"><span class="linenos">671</span></a>    <span class="k">def</span> <span class="nf">get_source</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GeoRegion.get_source-672"><a href="#GeoRegion.get_source-672"><span class="linenos">672</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_dict</span>
</span></pre></div>


    

                            </div>
                            <div id="GeoRegion.get_region_list" class="classattr">
                                        <input id="GeoRegion.get_region_list-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_region_list</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GeoRegion.get_region_list-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GeoRegion.get_region_list"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GeoRegion.get_region_list-674"><a href="#GeoRegion.get_region_list-674"><span class="linenos">674</span></a>    <span class="k">def</span> <span class="nf">get_region_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GeoRegion.get_region_list-675"><a href="#GeoRegion.get_region_list-675"><span class="linenos">675</span></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_region_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span></pre></div>


    

                            </div>
                            <div id="GeoRegion.is_region" class="classattr">
                                        <input id="GeoRegion.is_region-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_region</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">region</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GeoRegion.is_region-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GeoRegion.is_region"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GeoRegion.is_region-677"><a href="#GeoRegion.is_region-677"><span class="linenos">677</span></a>    <span class="k">def</span> <span class="nf">is_region</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">region</span><span class="p">):</span>
</span><span id="GeoRegion.is_region-678"><a href="#GeoRegion.is_region-678"><span class="linenos">678</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; it returns either False or the correctly named region name</span>
</span><span id="GeoRegion.is_region-679"><a href="#GeoRegion.is_region-679"><span class="linenos">679</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoRegion.is_region-680"><a href="#GeoRegion.is_region-680"><span class="linenos">680</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">region</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="GeoRegion.is_region-681"><a href="#GeoRegion.is_region-681"><span class="linenos">681</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s2">&quot;The given region is not a str type.&quot;</span><span class="p">)</span>
</span><span id="GeoRegion.is_region-682"><a href="#GeoRegion.is_region-682"><span class="linenos">682</span></a>
</span><span id="GeoRegion.is_region-683"><a href="#GeoRegion.is_region-683"><span class="linenos">683</span></a>        <span class="n">region</span><span class="o">=</span><span class="n">region</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>  <span class="c1"># if not properly capitalized</span>
</span><span id="GeoRegion.is_region-684"><a href="#GeoRegion.is_region-684"><span class="linenos">684</span></a>
</span><span id="GeoRegion.is_region-685"><a href="#GeoRegion.is_region-685"><span class="linenos">685</span></a>        <span class="k">if</span> <span class="n">region</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_region_list</span><span class="p">():</span>
</span><span id="GeoRegion.is_region-686"><a href="#GeoRegion.is_region-686"><span class="linenos">686</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="GeoRegion.is_region-687"><a href="#GeoRegion.is_region-687"><span class="linenos">687</span></a>        <span class="k">else</span> <span class="p">:</span>
</span><span id="GeoRegion.is_region-688"><a href="#GeoRegion.is_region-688"><span class="linenos">688</span></a>            <span class="k">return</span> <span class="n">region</span>
</span></pre></div>


            <div class="docstring"><p>it returns either False or the correctly named region name</p>
</div>


                            </div>
                            <div id="GeoRegion.get_countries_from_region" class="classattr">
                                        <input id="GeoRegion.get_countries_from_region-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_countries_from_region</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">region</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GeoRegion.get_countries_from_region-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GeoRegion.get_countries_from_region"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GeoRegion.get_countries_from_region-690"><a href="#GeoRegion.get_countries_from_region-690"><span class="linenos">690</span></a>    <span class="k">def</span> <span class="nf">get_countries_from_region</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">region</span><span class="p">):</span>
</span><span id="GeoRegion.get_countries_from_region-691"><a href="#GeoRegion.get_countries_from_region-691"><span class="linenos">691</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; it returns a list of countries for the given region name.</span>
</span><span id="GeoRegion.get_countries_from_region-692"><a href="#GeoRegion.get_countries_from_region-692"><span class="linenos">692</span></a><span class="sd">        The standard used is iso3. To convert to another standard,</span>
</span><span id="GeoRegion.get_countries_from_region-693"><a href="#GeoRegion.get_countries_from_region-693"><span class="linenos">693</span></a><span class="sd">        use the GeoManager class.</span>
</span><span id="GeoRegion.get_countries_from_region-694"><a href="#GeoRegion.get_countries_from_region-694"><span class="linenos">694</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoRegion.get_countries_from_region-695"><a href="#GeoRegion.get_countries_from_region-695"><span class="linenos">695</span></a>        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_region</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>
</span><span id="GeoRegion.get_countries_from_region-696"><a href="#GeoRegion.get_countries_from_region-696"><span class="linenos">696</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">r</span><span class="p">:</span>
</span><span id="GeoRegion.get_countries_from_region-697"><a href="#GeoRegion.get_countries_from_region-697"><span class="linenos">697</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;The given region &quot;&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">region</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;&quot; is unknown.&#39;</span><span class="p">)</span>
</span><span id="GeoRegion.get_countries_from_region-698"><a href="#GeoRegion.get_countries_from_region-698"><span class="linenos">698</span></a>        <span class="n">region</span><span class="o">=</span><span class="n">r</span>
</span><span id="GeoRegion.get_countries_from_region-699"><a href="#GeoRegion.get_countries_from_region-699"><span class="linenos">699</span></a>
</span><span id="GeoRegion.get_countries_from_region-700"><a href="#GeoRegion.get_countries_from_region-700"><span class="linenos">700</span></a>        <span class="n">clist</span><span class="o">=</span><span class="p">[]</span>
</span><span id="GeoRegion.get_countries_from_region-701"><a href="#GeoRegion.get_countries_from_region-701"><span class="linenos">701</span></a>
</span><span id="GeoRegion.get_countries_from_region-702"><a href="#GeoRegion.get_countries_from_region-702"><span class="linenos">702</span></a>        <span class="k">if</span> <span class="n">region</span><span class="o">==</span><span class="s1">&#39;European Union&#39;</span><span class="p">:</span>
</span><span id="GeoRegion.get_countries_from_region-703"><a href="#GeoRegion.get_countries_from_region-703"><span class="linenos">703</span></a>            <span class="n">clist</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;AUT&#39;</span><span class="p">,</span><span class="s1">&#39;BEL&#39;</span><span class="p">,</span><span class="s1">&#39;BGR&#39;</span><span class="p">,</span><span class="s1">&#39;CYP&#39;</span><span class="p">,</span><span class="s1">&#39;CZE&#39;</span><span class="p">,</span><span class="s1">&#39;DEU&#39;</span><span class="p">,</span><span class="s1">&#39;DNK&#39;</span><span class="p">,</span><span class="s1">&#39;EST&#39;</span><span class="p">,</span>\
</span><span id="GeoRegion.get_countries_from_region-704"><a href="#GeoRegion.get_countries_from_region-704"><span class="linenos">704</span></a>                        <span class="s1">&#39;ESP&#39;</span><span class="p">,</span><span class="s1">&#39;FIN&#39;</span><span class="p">,</span><span class="s1">&#39;FRA&#39;</span><span class="p">,</span><span class="s1">&#39;GRC&#39;</span><span class="p">,</span><span class="s1">&#39;HRV&#39;</span><span class="p">,</span><span class="s1">&#39;HUN&#39;</span><span class="p">,</span><span class="s1">&#39;IRL&#39;</span><span class="p">,</span><span class="s1">&#39;ITA&#39;</span><span class="p">,</span>\
</span><span id="GeoRegion.get_countries_from_region-705"><a href="#GeoRegion.get_countries_from_region-705"><span class="linenos">705</span></a>                        <span class="s1">&#39;LTU&#39;</span><span class="p">,</span><span class="s1">&#39;LUX&#39;</span><span class="p">,</span><span class="s1">&#39;LVA&#39;</span><span class="p">,</span><span class="s1">&#39;MLT&#39;</span><span class="p">,</span><span class="s1">&#39;NLD&#39;</span><span class="p">,</span><span class="s1">&#39;POL&#39;</span><span class="p">,</span><span class="s1">&#39;PRT&#39;</span><span class="p">,</span><span class="s1">&#39;ROU&#39;</span><span class="p">,</span>\
</span><span id="GeoRegion.get_countries_from_region-706"><a href="#GeoRegion.get_countries_from_region-706"><span class="linenos">706</span></a>                        <span class="s1">&#39;SWE&#39;</span><span class="p">,</span><span class="s1">&#39;SVN&#39;</span><span class="p">,</span><span class="s1">&#39;SVK&#39;</span><span class="p">]</span>
</span><span id="GeoRegion.get_countries_from_region-707"><a href="#GeoRegion.get_countries_from_region-707"><span class="linenos">707</span></a>        <span class="k">elif</span> <span class="n">region</span><span class="o">==</span><span class="s1">&#39;G7&#39;</span><span class="p">:</span>
</span><span id="GeoRegion.get_countries_from_region-708"><a href="#GeoRegion.get_countries_from_region-708"><span class="linenos">708</span></a>            <span class="n">clist</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;DEU&#39;</span><span class="p">,</span><span class="s1">&#39;CAN&#39;</span><span class="p">,</span><span class="s1">&#39;USA&#39;</span><span class="p">,</span><span class="s1">&#39;FRA&#39;</span><span class="p">,</span><span class="s1">&#39;ITA&#39;</span><span class="p">,</span><span class="s1">&#39;JPN&#39;</span><span class="p">,</span><span class="s1">&#39;GBR&#39;</span><span class="p">]</span>
</span><span id="GeoRegion.get_countries_from_region-709"><a href="#GeoRegion.get_countries_from_region-709"><span class="linenos">709</span></a>        <span class="k">elif</span> <span class="n">region</span><span class="o">==</span><span class="s1">&#39;G8&#39;</span><span class="p">:</span>
</span><span id="GeoRegion.get_countries_from_region-710"><a href="#GeoRegion.get_countries_from_region-710"><span class="linenos">710</span></a>            <span class="n">clist</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;DEU&#39;</span><span class="p">,</span><span class="s1">&#39;CAN&#39;</span><span class="p">,</span><span class="s1">&#39;USA&#39;</span><span class="p">,</span><span class="s1">&#39;FRA&#39;</span><span class="p">,</span><span class="s1">&#39;ITA&#39;</span><span class="p">,</span><span class="s1">&#39;JPN&#39;</span><span class="p">,</span><span class="s1">&#39;GBR&#39;</span><span class="p">,</span><span class="s1">&#39;RUS&#39;</span><span class="p">]</span>
</span><span id="GeoRegion.get_countries_from_region-711"><a href="#GeoRegion.get_countries_from_region-711"><span class="linenos">711</span></a>        <span class="k">elif</span> <span class="n">region</span><span class="o">==</span><span class="s1">&#39;G20&#39;</span><span class="p">:</span>
</span><span id="GeoRegion.get_countries_from_region-712"><a href="#GeoRegion.get_countries_from_region-712"><span class="linenos">712</span></a>            <span class="n">clist</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ZAF&#39;</span><span class="p">,</span><span class="s1">&#39;SAU&#39;</span><span class="p">,</span><span class="s1">&#39;ARG&#39;</span><span class="p">,</span><span class="s1">&#39;AUS&#39;</span><span class="p">,</span><span class="s1">&#39;BRA&#39;</span><span class="p">,</span><span class="s1">&#39;CAN&#39;</span><span class="p">,</span><span class="s1">&#39;CHN&#39;</span><span class="p">,</span><span class="s1">&#39;KOR&#39;</span><span class="p">,</span><span class="s1">&#39;USA&#39;</span><span class="p">,</span>\
</span><span id="GeoRegion.get_countries_from_region-713"><a href="#GeoRegion.get_countries_from_region-713"><span class="linenos">713</span></a>                <span class="s1">&#39;IND&#39;</span><span class="p">,</span><span class="s1">&#39;IDN&#39;</span><span class="p">,</span><span class="s1">&#39;JPN&#39;</span><span class="p">,</span><span class="s1">&#39;MEX&#39;</span><span class="p">,</span><span class="s1">&#39;GBR&#39;</span><span class="p">,</span><span class="s1">&#39;DEU&#39;</span><span class="p">,</span><span class="s1">&#39;FRA&#39;</span><span class="p">,</span><span class="s1">&#39;ITA&#39;</span><span class="p">,</span><span class="s1">&#39;TUR&#39;</span><span class="p">,</span>\
</span><span id="GeoRegion.get_countries_from_region-714"><a href="#GeoRegion.get_countries_from_region-714"><span class="linenos">714</span></a>                <span class="s1">&#39;MEX&#39;</span><span class="p">,</span><span class="s1">&#39;RUS&#39;</span><span class="p">]</span>
</span><span id="GeoRegion.get_countries_from_region-715"><a href="#GeoRegion.get_countries_from_region-715"><span class="linenos">715</span></a>        <span class="k">elif</span> <span class="n">region</span><span class="o">==</span><span class="s1">&#39;Oecd&#39;</span><span class="p">:</span> <span class="c1"># OCDE in french</span>
</span><span id="GeoRegion.get_countries_from_region-716"><a href="#GeoRegion.get_countries_from_region-716"><span class="linenos">716</span></a>            <span class="n">clist</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;DEU&#39;</span><span class="p">,</span><span class="s1">&#39;AUS&#39;</span><span class="p">,</span><span class="s1">&#39;AUT&#39;</span><span class="p">,</span><span class="s1">&#39;BEL&#39;</span><span class="p">,</span><span class="s1">&#39;CAN&#39;</span><span class="p">,</span><span class="s1">&#39;CHL&#39;</span><span class="p">,</span><span class="s1">&#39;COL&#39;</span><span class="p">,</span><span class="s1">&#39;KOR&#39;</span><span class="p">,</span><span class="s1">&#39;DNK&#39;</span><span class="p">,</span>\
</span><span id="GeoRegion.get_countries_from_region-717"><a href="#GeoRegion.get_countries_from_region-717"><span class="linenos">717</span></a>                <span class="s1">&#39;ESP&#39;</span><span class="p">,</span><span class="s1">&#39;EST&#39;</span><span class="p">,</span><span class="s1">&#39;USA&#39;</span><span class="p">,</span><span class="s1">&#39;FIN&#39;</span><span class="p">,</span><span class="s1">&#39;FRA&#39;</span><span class="p">,</span><span class="s1">&#39;GRC&#39;</span><span class="p">,</span><span class="s1">&#39;HUN&#39;</span><span class="p">,</span><span class="s1">&#39;IRL&#39;</span><span class="p">,</span><span class="s1">&#39;ISL&#39;</span><span class="p">,</span><span class="s1">&#39;ISR&#39;</span><span class="p">,</span>\
</span><span id="GeoRegion.get_countries_from_region-718"><a href="#GeoRegion.get_countries_from_region-718"><span class="linenos">718</span></a>                <span class="s1">&#39;ITA&#39;</span><span class="p">,</span><span class="s1">&#39;JPN&#39;</span><span class="p">,</span><span class="s1">&#39;LVA&#39;</span><span class="p">,</span><span class="s1">&#39;LTU&#39;</span><span class="p">,</span><span class="s1">&#39;LUX&#39;</span><span class="p">,</span><span class="s1">&#39;MEX&#39;</span><span class="p">,</span><span class="s1">&#39;NOR&#39;</span><span class="p">,</span><span class="s1">&#39;NZL&#39;</span><span class="p">,</span><span class="s1">&#39;NLD&#39;</span><span class="p">,</span><span class="s1">&#39;POL&#39;</span><span class="p">,</span>\
</span><span id="GeoRegion.get_countries_from_region-719"><a href="#GeoRegion.get_countries_from_region-719"><span class="linenos">719</span></a>                <span class="s1">&#39;PRT&#39;</span><span class="p">,</span><span class="s1">&#39;SVK&#39;</span><span class="p">,</span><span class="s1">&#39;SVN&#39;</span><span class="p">,</span><span class="s1">&#39;SWE&#39;</span><span class="p">,</span><span class="s1">&#39;CHE&#39;</span><span class="p">,</span><span class="s1">&#39;GBR&#39;</span><span class="p">,</span><span class="s1">&#39;CZE&#39;</span><span class="p">,</span><span class="s1">&#39;TUR&#39;</span><span class="p">]</span>
</span><span id="GeoRegion.get_countries_from_region-720"><a href="#GeoRegion.get_countries_from_region-720"><span class="linenos">720</span></a>        <span class="k">elif</span> <span class="n">region</span><span class="o">==</span><span class="s1">&#39;G77&#39;</span><span class="p">:</span>
</span><span id="GeoRegion.get_countries_from_region-721"><a href="#GeoRegion.get_countries_from_region-721"><span class="linenos">721</span></a>            <span class="n">clist</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;AFG&#39;</span><span class="p">,</span><span class="s1">&#39;DZA&#39;</span><span class="p">,</span><span class="s1">&#39;AGO&#39;</span><span class="p">,</span><span class="s1">&#39;ATG&#39;</span><span class="p">,</span><span class="s1">&#39;ARG&#39;</span><span class="p">,</span><span class="s1">&#39;AZE&#39;</span><span class="p">,</span><span class="s1">&#39;BHS&#39;</span><span class="p">,</span><span class="s1">&#39;BHR&#39;</span><span class="p">,</span><span class="s1">&#39;BGD&#39;</span><span class="p">,</span><span class="s1">&#39;BRB&#39;</span><span class="p">,</span><span class="s1">&#39;BLZ&#39;</span><span class="p">,</span>
</span><span id="GeoRegion.get_countries_from_region-722"><a href="#GeoRegion.get_countries_from_region-722"><span class="linenos">722</span></a>                <span class="s1">&#39;BEN&#39;</span><span class="p">,</span><span class="s1">&#39;BTN&#39;</span><span class="p">,</span><span class="s1">&#39;BOL&#39;</span><span class="p">,</span><span class="s1">&#39;BWA&#39;</span><span class="p">,</span><span class="s1">&#39;BRA&#39;</span><span class="p">,</span><span class="s1">&#39;BRN&#39;</span><span class="p">,</span><span class="s1">&#39;BFA&#39;</span><span class="p">,</span><span class="s1">&#39;BDI&#39;</span><span class="p">,</span><span class="s1">&#39;CPV&#39;</span><span class="p">,</span><span class="s1">&#39;KHM&#39;</span><span class="p">,</span><span class="s1">&#39;CMR&#39;</span><span class="p">,</span>
</span><span id="GeoRegion.get_countries_from_region-723"><a href="#GeoRegion.get_countries_from_region-723"><span class="linenos">723</span></a>                <span class="s1">&#39;CAF&#39;</span><span class="p">,</span><span class="s1">&#39;TCD&#39;</span><span class="p">,</span><span class="s1">&#39;CHL&#39;</span><span class="p">,</span><span class="s1">&#39;CHN&#39;</span><span class="p">,</span><span class="s1">&#39;COL&#39;</span><span class="p">,</span><span class="s1">&#39;COM&#39;</span><span class="p">,</span><span class="s1">&#39;COG&#39;</span><span class="p">,</span><span class="s1">&#39;CRI&#39;</span><span class="p">,</span><span class="s1">&#39;CIV&#39;</span><span class="p">,</span><span class="s1">&#39;CUB&#39;</span><span class="p">,</span><span class="s1">&#39;PRK&#39;</span><span class="p">,</span>
</span><span id="GeoRegion.get_countries_from_region-724"><a href="#GeoRegion.get_countries_from_region-724"><span class="linenos">724</span></a>                <span class="s1">&#39;COD&#39;</span><span class="p">,</span><span class="s1">&#39;DJI&#39;</span><span class="p">,</span><span class="s1">&#39;DMA&#39;</span><span class="p">,</span><span class="s1">&#39;DOM&#39;</span><span class="p">,</span><span class="s1">&#39;ECU&#39;</span><span class="p">,</span><span class="s1">&#39;EGY&#39;</span><span class="p">,</span><span class="s1">&#39;SLV&#39;</span><span class="p">,</span><span class="s1">&#39;GNQ&#39;</span><span class="p">,</span><span class="s1">&#39;ERI&#39;</span><span class="p">,</span><span class="s1">&#39;SWZ&#39;</span><span class="p">,</span><span class="s1">&#39;ETH&#39;</span><span class="p">,</span>
</span><span id="GeoRegion.get_countries_from_region-725"><a href="#GeoRegion.get_countries_from_region-725"><span class="linenos">725</span></a>                <span class="s1">&#39;FJI&#39;</span><span class="p">,</span><span class="s1">&#39;GAB&#39;</span><span class="p">,</span><span class="s1">&#39;GMB&#39;</span><span class="p">,</span><span class="s1">&#39;GHA&#39;</span><span class="p">,</span><span class="s1">&#39;GRD&#39;</span><span class="p">,</span><span class="s1">&#39;GTM&#39;</span><span class="p">,</span><span class="s1">&#39;GIN&#39;</span><span class="p">,</span><span class="s1">&#39;GNB&#39;</span><span class="p">,</span><span class="s1">&#39;GUY&#39;</span><span class="p">,</span><span class="s1">&#39;HTI&#39;</span><span class="p">,</span><span class="s1">&#39;HND&#39;</span><span class="p">,</span>
</span><span id="GeoRegion.get_countries_from_region-726"><a href="#GeoRegion.get_countries_from_region-726"><span class="linenos">726</span></a>                <span class="s1">&#39;IND&#39;</span><span class="p">,</span><span class="s1">&#39;IDN&#39;</span><span class="p">,</span><span class="s1">&#39;IRN&#39;</span><span class="p">,</span><span class="s1">&#39;IRQ&#39;</span><span class="p">,</span><span class="s1">&#39;JAM&#39;</span><span class="p">,</span><span class="s1">&#39;JOR&#39;</span><span class="p">,</span><span class="s1">&#39;KEN&#39;</span><span class="p">,</span><span class="s1">&#39;KIR&#39;</span><span class="p">,</span><span class="s1">&#39;KWT&#39;</span><span class="p">,</span><span class="s1">&#39;LAO&#39;</span><span class="p">,</span><span class="s1">&#39;LBN&#39;</span><span class="p">,</span>
</span><span id="GeoRegion.get_countries_from_region-727"><a href="#GeoRegion.get_countries_from_region-727"><span class="linenos">727</span></a>                <span class="s1">&#39;LSO&#39;</span><span class="p">,</span><span class="s1">&#39;LBR&#39;</span><span class="p">,</span><span class="s1">&#39;LBY&#39;</span><span class="p">,</span><span class="s1">&#39;MDG&#39;</span><span class="p">,</span><span class="s1">&#39;MWI&#39;</span><span class="p">,</span><span class="s1">&#39;MYS&#39;</span><span class="p">,</span><span class="s1">&#39;MDV&#39;</span><span class="p">,</span><span class="s1">&#39;MLI&#39;</span><span class="p">,</span><span class="s1">&#39;MHL&#39;</span><span class="p">,</span><span class="s1">&#39;MRT&#39;</span><span class="p">,</span><span class="s1">&#39;MUS&#39;</span><span class="p">,</span>
</span><span id="GeoRegion.get_countries_from_region-728"><a href="#GeoRegion.get_countries_from_region-728"><span class="linenos">728</span></a>                <span class="s1">&#39;FSM&#39;</span><span class="p">,</span><span class="s1">&#39;MNG&#39;</span><span class="p">,</span><span class="s1">&#39;MAR&#39;</span><span class="p">,</span><span class="s1">&#39;MOZ&#39;</span><span class="p">,</span><span class="s1">&#39;MMR&#39;</span><span class="p">,</span><span class="s1">&#39;NAM&#39;</span><span class="p">,</span><span class="s1">&#39;NRU&#39;</span><span class="p">,</span><span class="s1">&#39;NPL&#39;</span><span class="p">,</span><span class="s1">&#39;NIC&#39;</span><span class="p">,</span><span class="s1">&#39;NER&#39;</span><span class="p">,</span><span class="s1">&#39;NGA&#39;</span><span class="p">,</span>
</span><span id="GeoRegion.get_countries_from_region-729"><a href="#GeoRegion.get_countries_from_region-729"><span class="linenos">729</span></a>                <span class="s1">&#39;OMN&#39;</span><span class="p">,</span><span class="s1">&#39;PAK&#39;</span><span class="p">,</span><span class="s1">&#39;PAN&#39;</span><span class="p">,</span><span class="s1">&#39;PNG&#39;</span><span class="p">,</span><span class="s1">&#39;PRY&#39;</span><span class="p">,</span><span class="s1">&#39;PER&#39;</span><span class="p">,</span><span class="s1">&#39;PHL&#39;</span><span class="p">,</span><span class="s1">&#39;QAT&#39;</span><span class="p">,</span><span class="s1">&#39;RWA&#39;</span><span class="p">,</span><span class="s1">&#39;KNA&#39;</span><span class="p">,</span><span class="s1">&#39;LCA&#39;</span><span class="p">,</span>
</span><span id="GeoRegion.get_countries_from_region-730"><a href="#GeoRegion.get_countries_from_region-730"><span class="linenos">730</span></a>                <span class="s1">&#39;VCT&#39;</span><span class="p">,</span><span class="s1">&#39;WSM&#39;</span><span class="p">,</span><span class="s1">&#39;STP&#39;</span><span class="p">,</span><span class="s1">&#39;SAU&#39;</span><span class="p">,</span><span class="s1">&#39;SEN&#39;</span><span class="p">,</span><span class="s1">&#39;SYC&#39;</span><span class="p">,</span><span class="s1">&#39;SLE&#39;</span><span class="p">,</span><span class="s1">&#39;SGP&#39;</span><span class="p">,</span><span class="s1">&#39;SLB&#39;</span><span class="p">,</span><span class="s1">&#39;SOM&#39;</span><span class="p">,</span><span class="s1">&#39;ZAF&#39;</span><span class="p">,</span>
</span><span id="GeoRegion.get_countries_from_region-731"><a href="#GeoRegion.get_countries_from_region-731"><span class="linenos">731</span></a>                <span class="s1">&#39;SSD&#39;</span><span class="p">,</span><span class="s1">&#39;LKA&#39;</span><span class="p">,</span><span class="s1">&#39;PSE&#39;</span><span class="p">,</span><span class="s1">&#39;SDN&#39;</span><span class="p">,</span><span class="s1">&#39;SUR&#39;</span><span class="p">,</span><span class="s1">&#39;SYR&#39;</span><span class="p">,</span><span class="s1">&#39;TJK&#39;</span><span class="p">,</span><span class="s1">&#39;THA&#39;</span><span class="p">,</span><span class="s1">&#39;TLS&#39;</span><span class="p">,</span><span class="s1">&#39;TGO&#39;</span><span class="p">,</span><span class="s1">&#39;TON&#39;</span><span class="p">,</span>
</span><span id="GeoRegion.get_countries_from_region-732"><a href="#GeoRegion.get_countries_from_region-732"><span class="linenos">732</span></a>                <span class="s1">&#39;TTO&#39;</span><span class="p">,</span><span class="s1">&#39;TUN&#39;</span><span class="p">,</span><span class="s1">&#39;TKM&#39;</span><span class="p">,</span><span class="s1">&#39;UGA&#39;</span><span class="p">,</span><span class="s1">&#39;ARE&#39;</span><span class="p">,</span><span class="s1">&#39;TZA&#39;</span><span class="p">,</span><span class="s1">&#39;URY&#39;</span><span class="p">,</span><span class="s1">&#39;VUT&#39;</span><span class="p">,</span><span class="s1">&#39;VEN&#39;</span><span class="p">,</span><span class="s1">&#39;VNM&#39;</span><span class="p">,</span><span class="s1">&#39;YEM&#39;</span><span class="p">,</span>
</span><span id="GeoRegion.get_countries_from_region-733"><a href="#GeoRegion.get_countries_from_region-733"><span class="linenos">733</span></a>                <span class="s1">&#39;ZMB&#39;</span><span class="p">,</span><span class="s1">&#39;ZWE&#39;</span><span class="p">]</span>
</span><span id="GeoRegion.get_countries_from_region-734"><a href="#GeoRegion.get_countries_from_region-734"><span class="linenos">734</span></a>
</span><span id="GeoRegion.get_countries_from_region-735"><a href="#GeoRegion.get_countries_from_region-735"><span class="linenos">735</span></a>        <span class="k">elif</span> <span class="n">region</span><span class="o">==</span><span class="s1">&#39;Commonwealth&#39;</span><span class="p">:</span>
</span><span id="GeoRegion.get_countries_from_region-736"><a href="#GeoRegion.get_countries_from_region-736"><span class="linenos">736</span></a>            <span class="n">clist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_cw</span>
</span><span id="GeoRegion.get_countries_from_region-737"><a href="#GeoRegion.get_countries_from_region-737"><span class="linenos">737</span></a>        <span class="k">elif</span> <span class="n">region</span><span class="o">==</span><span class="s1">&#39;Celac&#39;</span><span class="p">:</span>
</span><span id="GeoRegion.get_countries_from_region-738"><a href="#GeoRegion.get_countries_from_region-738"><span class="linenos">738</span></a>            <span class="n">clist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_celac</span>
</span><span id="GeoRegion.get_countries_from_region-739"><a href="#GeoRegion.get_countries_from_region-739"><span class="linenos">739</span></a>        <span class="k">elif</span> <span class="n">region</span><span class="o">==</span><span class="s1">&#39;Cedeao&#39;</span><span class="p">:</span>
</span><span id="GeoRegion.get_countries_from_region-740"><a href="#GeoRegion.get_countries_from_region-740"><span class="linenos">740</span></a>            <span class="n">clist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_cedeao</span>
</span><span id="GeoRegion.get_countries_from_region-741"><a href="#GeoRegion.get_countries_from_region-741"><span class="linenos">741</span></a>        <span class="k">elif</span> <span class="n">region</span><span class="o">==</span><span class="s1">&#39;Sadc&#39;</span><span class="p">:</span>
</span><span id="GeoRegion.get_countries_from_region-742"><a href="#GeoRegion.get_countries_from_region-742"><span class="linenos">742</span></a>            <span class="n">clist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sadc</span>
</span><span id="GeoRegion.get_countries_from_region-743"><a href="#GeoRegion.get_countries_from_region-743"><span class="linenos">743</span></a>        <span class="k">elif</span> <span class="n">region</span><span class="o">==</span><span class="s1">&#39;Amu&#39;</span><span class="p">:</span>
</span><span id="GeoRegion.get_countries_from_region-744"><a href="#GeoRegion.get_countries_from_region-744"><span class="linenos">744</span></a>            <span class="n">clist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_amu</span>
</span><span id="GeoRegion.get_countries_from_region-745"><a href="#GeoRegion.get_countries_from_region-745"><span class="linenos">745</span></a>        <span class="k">elif</span> <span class="n">region</span><span class="o">==</span><span class="s1">&#39;Ceeac&#39;</span><span class="p">:</span>
</span><span id="GeoRegion.get_countries_from_region-746"><a href="#GeoRegion.get_countries_from_region-746"><span class="linenos">746</span></a>            <span class="n">clist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ceeac</span>
</span><span id="GeoRegion.get_countries_from_region-747"><a href="#GeoRegion.get_countries_from_region-747"><span class="linenos">747</span></a>        <span class="k">elif</span> <span class="n">region</span><span class="o">==</span><span class="s1">&#39;Eac&#39;</span><span class="p">:</span>
</span><span id="GeoRegion.get_countries_from_region-748"><a href="#GeoRegion.get_countries_from_region-748"><span class="linenos">748</span></a>            <span class="n">clist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_eac</span>
</span><span id="GeoRegion.get_countries_from_region-749"><a href="#GeoRegion.get_countries_from_region-749"><span class="linenos">749</span></a>        <span class="k">elif</span> <span class="n">region</span><span class="o">==</span><span class="s1">&#39;Censad&#39;</span><span class="p">:</span>
</span><span id="GeoRegion.get_countries_from_region-750"><a href="#GeoRegion.get_countries_from_region-750"><span class="linenos">750</span></a>            <span class="n">clist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_censad</span>
</span><span id="GeoRegion.get_countries_from_region-751"><a href="#GeoRegion.get_countries_from_region-751"><span class="linenos">751</span></a>        <span class="k">elif</span> <span class="n">region</span><span class="o">==</span><span class="s1">&#39;Comesa&#39;</span><span class="p">:</span>
</span><span id="GeoRegion.get_countries_from_region-752"><a href="#GeoRegion.get_countries_from_region-752"><span class="linenos">752</span></a>            <span class="n">clist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_comesa</span>
</span><span id="GeoRegion.get_countries_from_region-753"><a href="#GeoRegion.get_countries_from_region-753"><span class="linenos">753</span></a>        <span class="k">elif</span> <span class="n">region</span><span class="o">==</span><span class="s1">&#39;Brics&#39;</span><span class="p">:</span>
</span><span id="GeoRegion.get_countries_from_region-754"><a href="#GeoRegion.get_countries_from_region-754"><span class="linenos">754</span></a>            <span class="n">clist</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;BRA&#39;</span><span class="p">,</span><span class="s1">&#39;RUS&#39;</span><span class="p">,</span><span class="s1">&#39;IND&#39;</span><span class="p">,</span><span class="s1">&#39;CHN&#39;</span><span class="p">,</span><span class="s1">&#39;ZAF&#39;</span><span class="p">]</span>
</span><span id="GeoRegion.get_countries_from_region-755"><a href="#GeoRegion.get_countries_from_region-755"><span class="linenos">755</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GeoRegion.get_countries_from_region-756"><a href="#GeoRegion.get_countries_from_region-756"><span class="linenos">756</span></a>            <span class="n">clist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_p_gs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_p_gs</span><span class="p">[</span><span class="s1">&#39;region_name&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">region</span><span class="p">][</span><span class="s1">&#39;iso3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
</span><span id="GeoRegion.get_countries_from_region-757"><a href="#GeoRegion.get_countries_from_region-757"><span class="linenos">757</span></a>
</span><span id="GeoRegion.get_countries_from_region-758"><a href="#GeoRegion.get_countries_from_region-758"><span class="linenos">758</span></a>        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">clist</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>it returns a list of countries for the given region name.
The standard used is iso3. To convert to another standard,
use the GeoManager class.</p>
</div>


                            </div>
                            <div id="GeoRegion.get_pandas" class="classattr">
                                        <input id="GeoRegion.get_pandas-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_pandas</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GeoRegion.get_pandas-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GeoRegion.get_pandas"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GeoRegion.get_pandas-760"><a href="#GeoRegion.get_pandas-760"><span class="linenos">760</span></a>    <span class="k">def</span> <span class="nf">get_pandas</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GeoRegion.get_pandas-761"><a href="#GeoRegion.get_pandas-761"><span class="linenos">761</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_p_gs</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="GeoCountry">
                            <input id="GeoCountry-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">GeoCountry</span>:

                <label class="view-source-button" for="GeoCountry-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GeoCountry"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GeoCountry-768"><a href="#GeoCountry-768"><span class="linenos"> 768</span></a><span class="k">class</span> <span class="nc">GeoCountry</span><span class="p">():</span>
</span><span id="GeoCountry-769"><a href="#GeoCountry-769"><span class="linenos"> 769</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;GeoCountry class definition.</span>
</span><span id="GeoCountry-770"><a href="#GeoCountry-770"><span class="linenos"> 770</span></a><span class="sd">    This class provides functions for specific countries and their states / departments / regions,</span>
</span><span id="GeoCountry-771"><a href="#GeoCountry-771"><span class="linenos"> 771</span></a><span class="sd">    and their geo properties (geometry, population if available, etc.)</span>
</span><span id="GeoCountry-772"><a href="#GeoCountry-772"><span class="linenos"> 772</span></a>
</span><span id="GeoCountry-773"><a href="#GeoCountry-773"><span class="linenos"> 773</span></a><span class="sd">    The list of supported countries is given by get_list_countries() function. &quot;&quot;&quot;</span>
</span><span id="GeoCountry-774"><a href="#GeoCountry-774"><span class="linenos"> 774</span></a>
</span><span id="GeoCountry-775"><a href="#GeoCountry-775"><span class="linenos"> 775</span></a>    <span class="c1"># Assuming zip file here</span>
</span><span id="GeoCountry-776"><a href="#GeoCountry-776"><span class="linenos"> 776</span></a>    <span class="n">_country_info_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;FRA&#39;</span><span class="p">:</span><span class="s1">&#39;https://data.opendatasoft.com/explore/dataset/georef-france-departement@public/download/?format=geojson&amp;timezone=Europe/Berlin&amp;lang=fr&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-777"><a href="#GeoCountry-777"><span class="linenos"> 777</span></a>                    <span class="c1">#previously https://github.com/coa-project/coadata/raw/main/coastore/public.opendatasoft.com_912711563.zip&#39;,\</span>
</span><span id="GeoCountry-778"><a href="#GeoCountry-778"><span class="linenos"> 778</span></a>                    <span class="s1">&#39;USA&#39;</span><span class="p">:</span><span class="s1">&#39;https://alicia.data.socrata.com/api/geospatial/jhnu-yfrj?method=export&amp;format=Original&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-779"><a href="#GeoCountry-779"><span class="linenos"> 779</span></a>                    <span class="s1">&#39;ITA&#39;</span><span class="p">:</span><span class="s1">&#39;https://raw.githubusercontent.com/openpolis/geojson-italy/master/geojson/limits_IT_provinces.geojson&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-780"><a href="#GeoCountry-780"><span class="linenos"> 780</span></a>                    <span class="s1">&#39;IND&#39;</span><span class="p">:</span><span class="s1">&#39;https://raw.githubusercontent.com/deldersveld/topojson/master/countries/india/india-states.json&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-781"><a href="#GeoCountry-781"><span class="linenos"> 781</span></a>                    <span class="s1">&#39;DEU&#39;</span><span class="p">:</span><span class="s1">&#39;https://github.com/jgehrcke/covid-19-germany-gae/raw/master/geodata/DE-counties.geojson&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-782"><a href="#GeoCountry-782"><span class="linenos"> 782</span></a>                    <span class="s1">&#39;ESP&#39;</span><span class="p">:</span><span class="s1">&#39;https://public.opendatasoft.com/explore/dataset/provincias-espanolas/download/?format=shp&amp;timezone=Europe/Berlin&amp;lang=en&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-783"><a href="#GeoCountry-783"><span class="linenos"> 783</span></a>                    <span class="c1"># missing some counties &#39;GBR&#39;:&#39;https://opendata.arcgis.com/datasets/69dc11c7386943b4ad8893c45648b1e1_0.zip?geometry=%7B%22xmin%22%3A-44.36%2C%22ymin%22%3A51.099%2C%22xmax%22%3A39.487%2C%22ymax%22%3A59.78%2C%22type%22%3A%22extent%22%2C%22spatialReference%22%3A%7B%22wkid%22%3A4326%7D%7D&amp;outSR=%7B%22latestWkid%22%3A27700%2C%22wkid%22%3A27700%7D&#39;,\</span>
</span><span id="GeoCountry-784"><a href="#GeoCountry-784"><span class="linenos"> 784</span></a>                    <span class="s1">&#39;GBR&#39;</span><span class="p">:</span><span class="s1">&#39;https://github.com/coa-project/coadata/raw/main/coastore/opendata.arcgis.com_3256063640&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-785"><a href="#GeoCountry-785"><span class="linenos"> 785</span></a>                    <span class="c1"># previously (but broken) : https://opendata.arcgis.com/datasets/3a4fa2ce68f642e399b4de07643eeed3_0.geojson&#39;,\</span>
</span><span id="GeoCountry-786"><a href="#GeoCountry-786"><span class="linenos"> 786</span></a>                    <span class="s1">&#39;BEL&#39;</span><span class="p">:</span><span class="s1">&#39;https://github.com/coa-project/coadata/raw/main/coacache/public.opendatasoft.com_537867990.zip&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-787"><a href="#GeoCountry-787"><span class="linenos"> 787</span></a><span class="c1"># previously (but not all regions now) &#39;https://public.opendatasoft.com/explore/dataset/arrondissements-belges-2019/download/?format=shp&amp;timezone=Europe/Berlin&amp;lang=en&#39;,\</span>
</span><span id="GeoCountry-788"><a href="#GeoCountry-788"><span class="linenos"> 788</span></a>                    <span class="s1">&#39;PRT&#39;</span><span class="p">:</span><span class="s1">&#39;https://github.com/coa-project/coadata/raw/main/coastore/concelhos.zip&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-789"><a href="#GeoCountry-789"><span class="linenos"> 789</span></a>                    <span class="c1"># (simplification of &#39;https://github.com/coa-project/coadata/raw/main&#39;https://dados.gov.pt/en/datasets/r/59368d37-cbdb-426a-9472-5a04cf30fbe4&#39;,\</span>
</span><span id="GeoCountry-790"><a href="#GeoCountry-790"><span class="linenos"> 790</span></a>                    <span class="s1">&#39;MYS&#39;</span><span class="p">:</span><span class="s1">&#39;https://stacks.stanford.edu/file/druid:zd362bc5680/data.zip&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-791"><a href="#GeoCountry-791"><span class="linenos"> 791</span></a>                    <span class="s1">&#39;CHL&#39;</span><span class="p">:</span><span class="s1">&#39;http://geonode.meteochile.gob.cl/geoserver/wfs?format_options=charset%3AUTF-8&amp;typename=geonode%3Adivision_comunal_geo_ide_1&amp;outputFormat=SHAPE-ZIP&amp;version=1.0.0&amp;service=WFS&amp;request=GetFeature&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-792"><a href="#GeoCountry-792"><span class="linenos"> 792</span></a>                    <span class="s1">&#39;EUR&#39;</span><span class="p">:</span><span class="s1">&#39;https://github.com/coa-project/coadata/raw/main/coastore/WHO_EUROsmall2.json&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-793"><a href="#GeoCountry-793"><span class="linenos"> 793</span></a>                    <span class="s1">&#39;GRC&#39;</span><span class="p">:</span><span class="s1">&#39;https://geodata.gov.gr/dataset/6deb6a12-1a54-41b4-b53b-6b36068b8348/resource/3e571f7f-42a4-4b49-8db0-311695d72fa3/download/nomoiokxe.zip&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-794"><a href="#GeoCountry-794"><span class="linenos"> 794</span></a>                    <span class="s1">&#39;JPN&#39;</span><span class="p">:</span><span class="s1">&#39;https://raw.githubusercontent.com/piuccio/open-data-jp-prefectures-geojson/master/output/prefectures.geojson&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-795"><a href="#GeoCountry-795"><span class="linenos"> 795</span></a>                    <span class="p">}</span>
</span><span id="GeoCountry-796"><a href="#GeoCountry-796"><span class="linenos"> 796</span></a>
</span><span id="GeoCountry-797"><a href="#GeoCountry-797"><span class="linenos"> 797</span></a>    <span class="n">_source_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;FRA&#39;</span><span class="p">:{</span><span class="s1">&#39;Basics&#39;</span><span class="p">:</span><span class="n">_country_info_dict</span><span class="p">[</span><span class="s1">&#39;FRA&#39;</span><span class="p">],</span>\
</span><span id="GeoCountry-798"><a href="#GeoCountry-798"><span class="linenos"> 798</span></a>                    <span class="s1">&#39;Subregion Flags&#39;</span><span class="p">:</span><span class="s1">&#39;http://sticker-departement.com/&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-799"><a href="#GeoCountry-799"><span class="linenos"> 799</span></a>                    <span class="s1">&#39;Region Flags&#39;</span><span class="p">:</span><span class="s1">&#39;https://fr.wikipedia.org/w/index.php?title=R%C3%A9gion_fran%C3%A7aise&amp;oldid=177269957&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-800"><a href="#GeoCountry-800"><span class="linenos"> 800</span></a>                    <span class="s1">&#39;Population&#39;</span><span class="p">:</span><span class="s1">&#39;https://github.com/coa-project/coadata/raw/main/coastore/www.insee.fr_3658796960&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-801"><a href="#GeoCountry-801"><span class="linenos"> 801</span></a>                    <span class="c1"># previously (but sometimes broken : &#39;https://www.insee.fr/fr/statistiques/4989753?sommaire=4989761&#39;</span>
</span><span id="GeoCountry-802"><a href="#GeoCountry-802"><span class="linenos"> 802</span></a>                    <span class="p">},</span>\
</span><span id="GeoCountry-803"><a href="#GeoCountry-803"><span class="linenos"> 803</span></a>                    <span class="s1">&#39;USA&#39;</span><span class="p">:{</span><span class="s1">&#39;Basics&#39;</span><span class="p">:</span><span class="n">_country_info_dict</span><span class="p">[</span><span class="s1">&#39;USA&#39;</span><span class="p">],</span>\
</span><span id="GeoCountry-804"><a href="#GeoCountry-804"><span class="linenos"> 804</span></a>                    <span class="s1">&#39;Subregion informations&#39;</span><span class="p">:</span><span class="s1">&#39;https://en.wikipedia.org/wiki/List_of_states_and_territories_of_the_United_States&#39;</span><span class="p">},</span>\
</span><span id="GeoCountry-805"><a href="#GeoCountry-805"><span class="linenos"> 805</span></a>                    <span class="s1">&#39;ITA&#39;</span><span class="p">:{</span><span class="s1">&#39;Basics&#39;</span><span class="p">:</span><span class="n">_country_info_dict</span><span class="p">[</span><span class="s1">&#39;ITA&#39;</span><span class="p">]},</span>\
</span><span id="GeoCountry-806"><a href="#GeoCountry-806"><span class="linenos"> 806</span></a>                    <span class="s1">&#39;IND&#39;</span><span class="p">:{</span><span class="s1">&#39;Basics&#39;</span><span class="p">:</span><span class="n">_country_info_dict</span><span class="p">[</span><span class="s1">&#39;IND&#39;</span><span class="p">]},</span>\
</span><span id="GeoCountry-807"><a href="#GeoCountry-807"><span class="linenos"> 807</span></a>                    <span class="s1">&#39;DEU&#39;</span><span class="p">:{</span><span class="s1">&#39;Basics&#39;</span><span class="p">:</span><span class="n">_country_info_dict</span><span class="p">[</span><span class="s1">&#39;DEU&#39;</span><span class="p">]},</span>\
</span><span id="GeoCountry-808"><a href="#GeoCountry-808"><span class="linenos"> 808</span></a>                    <span class="s1">&#39;ESP&#39;</span><span class="p">:{</span><span class="s1">&#39;Basics&#39;</span><span class="p">:</span><span class="n">_country_info_dict</span><span class="p">[</span><span class="s1">&#39;ESP&#39;</span><span class="p">]},</span>\
</span><span id="GeoCountry-809"><a href="#GeoCountry-809"><span class="linenos"> 809</span></a>                    <span class="s1">&#39;GBR&#39;</span><span class="p">:{</span><span class="s1">&#39;Basics&#39;</span><span class="p">:</span><span class="n">_country_info_dict</span><span class="p">[</span><span class="s1">&#39;GBR&#39;</span><span class="p">],</span><span class="s1">&#39;Regions&#39;</span><span class="p">:</span><span class="s1">&#39;http://geoportal1-ons.opendata.arcgis.com/datasets/0c3a9643cc7c4015bb80751aad1d2594_0.csv&#39;</span><span class="p">},</span>\
</span><span id="GeoCountry-810"><a href="#GeoCountry-810"><span class="linenos"> 810</span></a>                    <span class="s1">&#39;BEL&#39;</span><span class="p">:{</span><span class="s1">&#39;Basics&#39;</span><span class="p">:</span><span class="n">_country_info_dict</span><span class="p">[</span><span class="s1">&#39;BEL&#39;</span><span class="p">]},</span>\
</span><span id="GeoCountry-811"><a href="#GeoCountry-811"><span class="linenos"> 811</span></a>                    <span class="s1">&#39;PRT&#39;</span><span class="p">:{</span><span class="s1">&#39;Basics&#39;</span><span class="p">:</span><span class="n">_country_info_dict</span><span class="p">[</span><span class="s1">&#39;PRT&#39;</span><span class="p">]},</span>\
</span><span id="GeoCountry-812"><a href="#GeoCountry-812"><span class="linenos"> 812</span></a>                    <span class="c1">#,&#39;District&#39;:&#39;https://raw.githubusercontent.com/JoaoFOliveira/portuguese-municipalities/master/municipalities.json&#39;},\</span>
</span><span id="GeoCountry-813"><a href="#GeoCountry-813"><span class="linenos"> 813</span></a>                    <span class="s1">&#39;MYS&#39;</span><span class="p">:{</span><span class="s1">&#39;Basics&#39;</span><span class="p">:</span><span class="n">_country_info_dict</span><span class="p">[</span><span class="s1">&#39;MYS&#39;</span><span class="p">]},</span>\
</span><span id="GeoCountry-814"><a href="#GeoCountry-814"><span class="linenos"> 814</span></a>                    <span class="s1">&#39;CHL&#39;</span><span class="p">:{</span><span class="s1">&#39;Basics&#39;</span><span class="p">:</span><span class="n">_country_info_dict</span><span class="p">[</span><span class="s1">&#39;CHL&#39;</span><span class="p">]},</span>\
</span><span id="GeoCountry-815"><a href="#GeoCountry-815"><span class="linenos"> 815</span></a>                    <span class="s1">&#39;EUR&#39;</span><span class="p">:{</span><span class="s1">&#39;Basics&#39;</span><span class="p">:</span><span class="n">_country_info_dict</span><span class="p">[</span><span class="s1">&#39;EUR&#39;</span><span class="p">]},</span>\
</span><span id="GeoCountry-816"><a href="#GeoCountry-816"><span class="linenos"> 816</span></a>                    <span class="s1">&#39;GRC&#39;</span><span class="p">:{</span><span class="s1">&#39;Basics&#39;</span><span class="p">:</span><span class="n">_country_info_dict</span><span class="p">[</span><span class="s1">&#39;GRC&#39;</span><span class="p">]},</span>\
</span><span id="GeoCountry-817"><a href="#GeoCountry-817"><span class="linenos"> 817</span></a>                    <span class="s1">&#39;JPN&#39;</span><span class="p">:{</span><span class="s1">&#39;Basics&#39;</span><span class="p">:</span><span class="n">_country_info_dict</span><span class="p">[</span><span class="s1">&#39;JPN&#39;</span><span class="p">]},</span>\
</span><span id="GeoCountry-818"><a href="#GeoCountry-818"><span class="linenos"> 818</span></a>                    <span class="p">}</span>
</span><span id="GeoCountry-819"><a href="#GeoCountry-819"><span class="linenos"> 819</span></a>
</span><span id="GeoCountry-820"><a href="#GeoCountry-820"><span class="linenos"> 820</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">country</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="GeoCountry-821"><a href="#GeoCountry-821"><span class="linenos"> 821</span></a>
</span><span id="GeoCountry-822"><a href="#GeoCountry-822"><span class="linenos"> 822</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; __init__ member function.</span>
</span><span id="GeoCountry-823"><a href="#GeoCountry-823"><span class="linenos"> 823</span></a><span class="sd">        Must give as arg the country to deal with, as a valid ISO3 string.</span>
</span><span id="GeoCountry-824"><a href="#GeoCountry-824"><span class="linenos"> 824</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoCountry-825"><a href="#GeoCountry-825"><span class="linenos"> 825</span></a>
</span><span id="GeoCountry-826"><a href="#GeoCountry-826"><span class="linenos"> 826</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_country</span><span class="o">=</span><span class="n">country</span>
</span><span id="GeoCountry-827"><a href="#GeoCountry-827"><span class="linenos"> 827</span></a>        <span class="k">if</span> <span class="n">country</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GeoCountry-828"><a href="#GeoCountry-828"><span class="linenos"> 828</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="GeoCountry-829"><a href="#GeoCountry-829"><span class="linenos"> 829</span></a>
</span><span id="GeoCountry-830"><a href="#GeoCountry-830"><span class="linenos"> 830</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">country</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list_countries</span><span class="p">():</span>
</span><span id="GeoCountry-831"><a href="#GeoCountry-831"><span class="linenos"> 831</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s2">&quot;Country &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">country</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; not supported. Please see get_list_countries() and help. &quot;</span><span class="p">)</span>
</span><span id="GeoCountry-832"><a href="#GeoCountry-832"><span class="linenos"> 832</span></a>
</span><span id="GeoCountry-833"><a href="#GeoCountry-833"><span class="linenos"> 833</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_country_data_region</span><span class="o">=</span><span class="kc">None</span>
</span><span id="GeoCountry-834"><a href="#GeoCountry-834"><span class="linenos"> 834</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_country_data_subregion</span><span class="o">=</span><span class="kc">None</span>
</span><span id="GeoCountry-835"><a href="#GeoCountry-835"><span class="linenos"> 835</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_municipality_region</span><span class="o">=</span><span class="kc">None</span>
</span><span id="GeoCountry-836"><a href="#GeoCountry-836"><span class="linenos"> 836</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_dense_geometry</span><span class="o">=</span><span class="kc">False</span>
</span><span id="GeoCountry-837"><a href="#GeoCountry-837"><span class="linenos"> 837</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_exploded_geometry</span><span class="o">=</span><span class="kc">False</span>
</span><span id="GeoCountry-838"><a href="#GeoCountry-838"><span class="linenos"> 838</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_main_geometry</span><span class="o">=</span><span class="kc">False</span>
</span><span id="GeoCountry-839"><a href="#GeoCountry-839"><span class="linenos"> 839</span></a>
</span><span id="GeoCountry-840"><a href="#GeoCountry-840"><span class="linenos"> 840</span></a>        <span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_info_dict</span><span class="p">[</span><span class="n">country</span><span class="p">]</span>
</span><span id="GeoCountry-841"><a href="#GeoCountry-841"><span class="linenos"> 841</span></a>        <span class="c1"># country by country, adapt the read file informations</span>
</span><span id="GeoCountry-842"><a href="#GeoCountry-842"><span class="linenos"> 842</span></a>
</span><span id="GeoCountry-843"><a href="#GeoCountry-843"><span class="linenos"> 843</span></a>        <span class="c1"># --- &#39;FRA&#39; case ---------------------------------------------------------------------------------------</span>
</span><span id="GeoCountry-844"><a href="#GeoCountry-844"><span class="linenos"> 844</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country</span><span class="o">==</span><span class="s1">&#39;FRA&#39;</span><span class="p">:</span>
</span><span id="GeoCountry-845"><a href="#GeoCountry-845"><span class="linenos"> 845</span></a>            <span class="c1">#self._country_data = gpd.read_file(&#39;zip://&#39;+get_local_from_url(url,0,&#39;.zip&#39;))</span>
</span><span id="GeoCountry-846"><a href="#GeoCountry-846"><span class="linenos"> 846</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
</span><span id="GeoCountry-847"><a href="#GeoCountry-847"><span class="linenos"> 847</span></a>
</span><span id="GeoCountry-848"><a href="#GeoCountry-848"><span class="linenos"> 848</span></a>            <span class="c1"># adding a flag for subregion (departements)</span>
</span><span id="GeoCountry-849"><a href="#GeoCountry-849"><span class="linenos"> 849</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;flag_subregion&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_source_dict</span><span class="p">[</span><span class="s1">&#39;FRA&#39;</span><span class="p">][</span><span class="s1">&#39;Subregion Flags&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;img/dept/sticker_plaque_immat_&#39;</span><span class="o">+</span>\
</span><span id="GeoCountry-850"><a href="#GeoCountry-850"><span class="linenos"> 850</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;dep_code&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span>\
</span><span id="GeoCountry-851"><a href="#GeoCountry-851"><span class="linenos"> 851</span></a>                <span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;dep_name&#39;</span><span class="p">]]</span><span class="o">+</span><span class="s1">&#39;_moto.png&#39;</span> <span class="c1"># picture of a sticker for motobikes, not so bad...</span>
</span><span id="GeoCountry-852"><a href="#GeoCountry-852"><span class="linenos"> 852</span></a>
</span><span id="GeoCountry-853"><a href="#GeoCountry-853"><span class="linenos"> 853</span></a>            <span class="c1"># Reading information to get region flags and correct names of regions</span>
</span><span id="GeoCountry-854"><a href="#GeoCountry-854"><span class="linenos"> 854</span></a>            <span class="n">f_reg_flag</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_source_dict</span><span class="p">[</span><span class="s1">&#39;FRA&#39;</span><span class="p">][</span><span class="s1">&#39;Region Flags&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span>
</span><span id="GeoCountry-855"><a href="#GeoCountry-855"><span class="linenos"> 855</span></a>
</span><span id="GeoCountry-856"><a href="#GeoCountry-856"><span class="linenos"> 856</span></a>            <span class="n">content_reg_flag</span> <span class="o">=</span> <span class="n">f_reg_flag</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="GeoCountry-857"><a href="#GeoCountry-857"><span class="linenos"> 857</span></a>            <span class="n">f_reg_flag</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="GeoCountry-858"><a href="#GeoCountry-858"><span class="linenos"> 858</span></a>            <span class="n">soup_reg_flag</span> <span class="o">=</span> <span class="n">bs4</span><span class="o">.</span><span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">content_reg_flag</span><span class="p">,</span><span class="s1">&#39;lxml&#39;</span><span class="p">)</span>
</span><span id="GeoCountry-859"><a href="#GeoCountry-859"><span class="linenos"> 859</span></a>            <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">soup_reg_flag</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;img&#39;</span><span class="p">):</span>  <span class="c1"># need to convert &lt;img tags to src content for pandas_read</span>
</span><span id="GeoCountry-860"><a href="#GeoCountry-860"><span class="linenos"> 860</span></a>                <span class="n">src</span><span class="o">=</span><span class="n">img</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">)</span>
</span><span id="GeoCountry-861"><a href="#GeoCountry-861"><span class="linenos"> 861</span></a>                <span class="k">if</span> <span class="n">src</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
</span><span id="GeoCountry-862"><a href="#GeoCountry-862"><span class="linenos"> 862</span></a>                    <span class="n">src</span><span class="o">=</span><span class="s1">&#39;http:&#39;</span><span class="o">+</span><span class="n">src</span>
</span><span id="GeoCountry-863"><a href="#GeoCountry-863"><span class="linenos"> 863</span></a>                <span class="n">img</span><span class="o">.</span><span class="n">replace_with</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
</span><span id="GeoCountry-864"><a href="#GeoCountry-864"><span class="linenos"> 864</span></a>
</span><span id="GeoCountry-865"><a href="#GeoCountry-865"><span class="linenos"> 865</span></a>            <span class="n">tabs_reg_flag</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">soup_reg_flag</span><span class="p">))</span> <span class="c1"># pandas read the modified html</span>
</span><span id="GeoCountry-866"><a href="#GeoCountry-866"><span class="linenos"> 866</span></a>            <span class="n">metropole</span><span class="o">=</span><span class="n">tabs_reg_flag</span><span class="p">[</span><span class="mi">5</span><span class="p">][[</span><span class="s2">&quot;Logo&quot;</span><span class="p">,</span><span class="s2">&quot;Dénomination&quot;</span><span class="p">,</span><span class="s2">&quot;Code INSEE[5]&quot;</span><span class="p">]]</span>  <span class="c1"># getting 5th table, and only usefull columns</span>
</span><span id="GeoCountry-867"><a href="#GeoCountry-867"><span class="linenos"> 867</span></a>            <span class="n">ultramarin</span><span class="o">=</span><span class="n">tabs_reg_flag</span><span class="p">[</span><span class="mi">6</span><span class="p">][[</span><span class="s2">&quot;Logo&quot;</span><span class="p">,</span><span class="s2">&quot;Dénomination&quot;</span><span class="p">,</span><span class="s2">&quot;Code INSEE[5]&quot;</span><span class="p">]]</span> <span class="c1"># getting 6th table</span>
</span><span id="GeoCountry-868"><a href="#GeoCountry-868"><span class="linenos"> 868</span></a>            <span class="n">p_reg_flag</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">metropole</span><span class="p">,</span><span class="n">ultramarin</span><span class="p">])</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Code INSEE[5]&quot;</span><span class="p">:</span><span class="s2">&quot;code_region&quot;</span><span class="p">,</span>\
</span><span id="GeoCountry-869"><a href="#GeoCountry-869"><span class="linenos"> 869</span></a>                                                                        <span class="s2">&quot;Logo&quot;</span><span class="p">:</span><span class="s2">&quot;flag_region&quot;</span><span class="p">,</span>\
</span><span id="GeoCountry-870"><a href="#GeoCountry-870"><span class="linenos"> 870</span></a>                                                                        <span class="s2">&quot;Dénomination&quot;</span><span class="p">:</span><span class="s2">&quot;name_region&quot;</span><span class="p">})</span>
</span><span id="GeoCountry-871"><a href="#GeoCountry-871"><span class="linenos"> 871</span></a>
</span><span id="GeoCountry-872"><a href="#GeoCountry-872"><span class="linenos"> 872</span></a>            <span class="n">p_reg_flag</span><span class="o">=</span><span class="n">p_reg_flag</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">notnull</span><span class="p">(</span><span class="n">p_reg_flag</span><span class="p">[</span><span class="s2">&quot;code_region&quot;</span><span class="p">])]</span>  <span class="c1"># select only valid rows</span>
</span><span id="GeoCountry-873"><a href="#GeoCountry-873"><span class="linenos"> 873</span></a>            <span class="n">p_reg_flag</span><span class="p">[</span><span class="s2">&quot;name_region&quot;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span> <span class="n">n</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">p_reg_flag</span><span class="p">[</span><span class="s2">&quot;name_region&quot;</span><span class="p">]</span> <span class="p">]</span> <span class="c1"># remove footnote [k] index from wikipedia</span>
</span><span id="GeoCountry-874"><a href="#GeoCountry-874"><span class="linenos"> 874</span></a>            <span class="n">p_reg_flag</span><span class="p">[</span><span class="s2">&quot;code_region&quot;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">))</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">p_reg_flag</span><span class="p">[</span><span class="s2">&quot;code_region&quot;</span><span class="p">]</span> <span class="p">]</span> <span class="c1"># convert to str for merge the code, adding 1 leading 0 if needed</span>
</span><span id="GeoCountry-875"><a href="#GeoCountry-875"><span class="linenos"> 875</span></a>
</span><span id="GeoCountry-876"><a href="#GeoCountry-876"><span class="linenos"> 876</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">p_reg_flag</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-877"><a href="#GeoCountry-877"><span class="linenos"> 877</span></a>                    <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;reg_code&#39;</span><span class="p">,</span><span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;code_region&#39;</span><span class="p">)</span> <span class="c1"># merging with flag and correct names</span>
</span><span id="GeoCountry-878"><a href="#GeoCountry-878"><span class="linenos"> 878</span></a>            <span class="c1"># standardize name for region, subregion</span>
</span><span id="GeoCountry-879"><a href="#GeoCountry-879"><span class="linenos"> 879</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>\
</span><span id="GeoCountry-880"><a href="#GeoCountry-880"><span class="linenos"> 880</span></a>                <span class="s1">&#39;dep_code&#39;</span><span class="p">:</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-881"><a href="#GeoCountry-881"><span class="linenos"> 881</span></a>                <span class="s1">&#39;dep_name&#39;</span><span class="p">:</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-882"><a href="#GeoCountry-882"><span class="linenos"> 882</span></a>                <span class="c1">#&#39;nom_chf&#39;:&#39;town_subregion&#39;,\</span>
</span><span id="GeoCountry-883"><a href="#GeoCountry-883"><span class="linenos"> 883</span></a>                <span class="p">},</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry-884"><a href="#GeoCountry-884"><span class="linenos"> 884</span></a>
</span><span id="GeoCountry-885"><a href="#GeoCountry-885"><span class="linenos"> 885</span></a>            <span class="c1"># adding population information (departements)</span>
</span><span id="GeoCountry-886"><a href="#GeoCountry-886"><span class="linenos"> 886</span></a>            <span class="n">pop_fra</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_source_dict</span><span class="p">[</span><span class="s1">&#39;FRA&#39;</span><span class="p">][</span><span class="s1">&#39;Population&#39;</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GeoCountry-887"><a href="#GeoCountry-887"><span class="linenos"> 887</span></a>            <span class="n">pop_fra</span><span class="p">[</span><span class="s1">&#39;population_subregion&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">pop_fra</span><span class="p">[</span><span class="s1">&#39;Population municipale&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[ \xa0]&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="GeoCountry-888"><a href="#GeoCountry-888"><span class="linenos"> 888</span></a>            <span class="c1"># En l&#39;absence de Mayotte dans ce document, car le recensement n&#39;a pas eu lieu en phase, ajout à la main</span>
</span><span id="GeoCountry-889"><a href="#GeoCountry-889"><span class="linenos"> 889</span></a>            <span class="c1"># En référence à la page pour Mayotte : https://www.insee.fr/fr/statistiques/3291775?sommaire=2120838</span>
</span><span id="GeoCountry-890"><a href="#GeoCountry-890"><span class="linenos"> 890</span></a>            <span class="n">mayotte_df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([{</span><span class="s1">&#39;Code département&#39;</span><span class="p">:</span><span class="s1">&#39;976&#39;</span><span class="p">,</span><span class="s1">&#39;population_subregion&#39;</span><span class="p">:</span><span class="mi">256518</span><span class="p">}])</span>
</span><span id="GeoCountry-891"><a href="#GeoCountry-891"><span class="linenos"> 891</span></a>            <span class="n">pop_fra</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pop_fra</span><span class="p">,</span><span class="n">mayotte_df</span><span class="p">])</span>
</span><span id="GeoCountry-892"><a href="#GeoCountry-892"><span class="linenos"> 892</span></a>            <span class="c1">#pop_fra=pop_fra.append(mayotte_df)</span>
</span><span id="GeoCountry-893"><a href="#GeoCountry-893"><span class="linenos"> 893</span></a>            <span class="c1"># Pour les collectivités d&#39;Outremer : https://www.insee.fr/fr/statistiques/4989739?sommaire=4989761</span>
</span><span id="GeoCountry-894"><a href="#GeoCountry-894"><span class="linenos"> 894</span></a>            <span class="n">com_df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([{</span><span class="s1">&#39;Code département&#39;</span><span class="p">:</span><span class="s1">&#39;980&#39;</span><span class="p">,</span><span class="s1">&#39;population_subregion&#39;</span><span class="p">:(</span><span class="mi">5985</span><span class="o">+</span><span class="mi">10124</span><span class="o">+</span><span class="mi">34065</span><span class="o">+</span><span class="mi">281674</span><span class="o">+</span><span class="mi">12067</span><span class="p">)}])</span>
</span><span id="GeoCountry-895"><a href="#GeoCountry-895"><span class="linenos"> 895</span></a>            <span class="n">pop_fra</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pop_fra</span><span class="p">,</span><span class="n">com_df</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="GeoCountry-896"><a href="#GeoCountry-896"><span class="linenos"> 896</span></a>            <span class="c1">#pop_fra=pop_fra.append(com_df).reset_index()</span>
</span><span id="GeoCountry-897"><a href="#GeoCountry-897"><span class="linenos"> 897</span></a>            <span class="n">geo_com</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">code_subregion</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;975&#39;</span><span class="p">,</span><span class="s1">&#39;977&#39;</span><span class="p">,</span><span class="s1">&#39;978&#39;</span><span class="p">,</span><span class="s1">&#39;986&#39;</span><span class="p">,</span><span class="s1">&#39;987&#39;</span><span class="p">])][[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]]</span>
</span><span id="GeoCountry-898"><a href="#GeoCountry-898"><span class="linenos"> 898</span></a>            <span class="n">geo_com</span><span class="p">[</span><span class="s1">&#39;smthing&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
</span><span id="GeoCountry-899"><a href="#GeoCountry-899"><span class="linenos"> 899</span></a>            <span class="n">geo_com</span><span class="o">=</span><span class="n">geo_com</span><span class="o">.</span><span class="n">dissolve</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;smthing&#39;</span><span class="p">)[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span>
</span><span id="GeoCountry-900"><a href="#GeoCountry-900"><span class="linenos"> 900</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">,</span>\
</span><span id="GeoCountry-901"><a href="#GeoCountry-901"><span class="linenos"> 901</span></a>            <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([{</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">:</span><span class="s1">&#39;980&#39;</span><span class="p">,</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">:</span><span class="s1">&#39;Collectivités d</span><span class="se">\&#39;</span><span class="s1">outre-mer&#39;</span><span class="p">,</span><span class="s1">&#39;code_region&#39;</span><span class="p">:</span><span class="s1">&#39;09&#39;</span><span class="p">,</span><span class="s1">&#39;name_region&#39;</span><span class="p">:</span><span class="s1">&#39;Collectivités d</span><span class="se">\&#39;</span><span class="s1">outre-mer&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span><span class="n">geo_com</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]}])],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry-902"><a href="#GeoCountry-902"><span class="linenos"> 902</span></a>            <span class="c1">#self._country_data=self._country_data.append(</span>
</span><span id="GeoCountry-903"><a href="#GeoCountry-903"><span class="linenos"> 903</span></a>            <span class="c1">#    pd.DataFrame([{&#39;code_subregion&#39;:&#39;980&#39;,&#39;name_subregion&#39;:&#39;Collectivités d\&#39;outre-mer&#39;,&#39;code_region&#39;:&#39;09&#39;,&#39;name_region&#39;:&#39;Collectivités d\&#39;outre-mer&#39;,&#39;geometry&#39;:geo_com.values[0]}])).reset_index()</span>
</span><span id="GeoCountry-904"><a href="#GeoCountry-904"><span class="linenos"> 904</span></a>            <span class="c1"># Merging</span>
</span><span id="GeoCountry-905"><a href="#GeoCountry-905"><span class="linenos"> 905</span></a>            <span class="c1">#self._country_data=self._country_data.append(</span>
</span><span id="GeoCountry-906"><a href="#GeoCountry-906"><span class="linenos"> 906</span></a>            <span class="c1">#    pd.DataFrame([{&#39;code_subregion&#39;:&#39;980&#39;,&#39;name_subregion&#39;:&#39;Collectivités d\&#39;outre-mer&#39;,&#39;code_region&#39;:&#39;09&#39;,&#39;name_region&#39;:&#39;Collectivités d\&#39;outre-mer&#39;,&#39;geometry&#39;:geo_com.values[0]}])).reset_index()</span>
</span><span id="GeoCountry-907"><a href="#GeoCountry-907"><span class="linenos"> 907</span></a>            <span class="c1"># Merging</span>
</span><span id="GeoCountry-908"><a href="#GeoCountry-908"><span class="linenos"> 908</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">pop_fra</span><span class="p">,</span><span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span><span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;Code département&#39;</span><span class="p">)</span>
</span><span id="GeoCountry-909"><a href="#GeoCountry-909"><span class="linenos"> 909</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[[</span><span class="s1">&#39;geometry&#39;</span><span class="p">,</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;flag_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;code_region&#39;</span><span class="p">,</span><span class="s1">&#39;name_region&#39;</span><span class="p">,</span><span class="s1">&#39;population_subregion&#39;</span><span class="p">]]</span>
</span><span id="GeoCountry-910"><a href="#GeoCountry-910"><span class="linenos"> 910</span></a>            <span class="c1">#if needed, define translation for dense geometry</span>
</span><span id="GeoCountry-911"><a href="#GeoCountry-911"><span class="linenos"> 911</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_list_translation</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;971&#39;</span><span class="p">:(</span><span class="mi">63</span><span class="p">,</span><span class="mi">23</span><span class="p">),</span>   <span class="c1"># Guadeloupe</span>
</span><span id="GeoCountry-912"><a href="#GeoCountry-912"><span class="linenos"> 912</span></a>                     <span class="s1">&#39;972&#39;</span><span class="p">:(</span><span class="mi">63</span><span class="p">,</span><span class="mi">23</span><span class="p">),</span> <span class="c1"># Martinique</span>
</span><span id="GeoCountry-913"><a href="#GeoCountry-913"><span class="linenos"> 913</span></a>                     <span class="s1">&#39;973&#39;</span><span class="p">:(</span><span class="mi">50</span><span class="p">,</span><span class="mi">35</span><span class="p">),</span> <span class="c1"># Guyane</span>
</span><span id="GeoCountry-914"><a href="#GeoCountry-914"><span class="linenos"> 914</span></a>                     <span class="s1">&#39;974&#39;</span><span class="p">:(</span><span class="o">-</span><span class="mi">51</span><span class="p">,</span><span class="mi">60</span><span class="p">),</span> <span class="c1"># Réunion</span>
</span><span id="GeoCountry-915"><a href="#GeoCountry-915"><span class="linenos"> 915</span></a>                     <span class="s1">&#39;976&#39;</span><span class="p">:(</span><span class="o">-</span><span class="mi">38</span><span class="p">,</span><span class="mf">51.5</span><span class="p">)}</span>  <span class="c1"># Mayotte</span>
</span><span id="GeoCountry-916"><a href="#GeoCountry-916"><span class="linenos"> 916</span></a>
</span><span id="GeoCountry-917"><a href="#GeoCountry-917"><span class="linenos"> 917</span></a>        <span class="c1"># --- &#39;USA&#39; case ---------------------------------------------------------------------------------------</span>
</span><span id="GeoCountry-918"><a href="#GeoCountry-918"><span class="linenos"> 918</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country</span> <span class="o">==</span> <span class="s1">&#39;USA&#39;</span><span class="p">:</span>
</span><span id="GeoCountry-919"><a href="#GeoCountry-919"><span class="linenos"> 919</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;zip://&#39;</span><span class="o">+</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;.zip&#39;</span><span class="p">))</span> <span class="c1"># under the hypothesis this is a zip file</span>
</span><span id="GeoCountry-920"><a href="#GeoCountry-920"><span class="linenos"> 920</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>\
</span><span id="GeoCountry-921"><a href="#GeoCountry-921"><span class="linenos"> 921</span></a>                <span class="s1">&#39;STATE_NAME&#39;</span><span class="p">:</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-922"><a href="#GeoCountry-922"><span class="linenos"> 922</span></a>                <span class="s1">&#39;STATE_ABBR&#39;</span><span class="p">:</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-923"><a href="#GeoCountry-923"><span class="linenos"> 923</span></a>                <span class="s1">&#39;SUB_REGION&#39;</span><span class="p">:</span><span class="s1">&#39;code_region&#39;</span><span class="p">},</span>\
</span><span id="GeoCountry-924"><a href="#GeoCountry-924"><span class="linenos"> 924</span></a>                <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry-925"><a href="#GeoCountry-925"><span class="linenos"> 925</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span>
</span><span id="GeoCountry-926"><a href="#GeoCountry-926"><span class="linenos"> 926</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;DRAWSEQ&#39;</span><span class="p">,</span><span class="s1">&#39;STATE_FIPS&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry-927"><a href="#GeoCountry-927"><span class="linenos"> 927</span></a>
</span><span id="GeoCountry-928"><a href="#GeoCountry-928"><span class="linenos"> 928</span></a>            <span class="c1"># Adding informations from wikipedia</span>
</span><span id="GeoCountry-929"><a href="#GeoCountry-929"><span class="linenos"> 929</span></a>            <span class="n">f_us</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_source_dict</span><span class="p">[</span><span class="s1">&#39;USA&#39;</span><span class="p">][</span><span class="s1">&#39;Subregion informations&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
</span><span id="GeoCountry-930"><a href="#GeoCountry-930"><span class="linenos"> 930</span></a>            <span class="n">content_us</span> <span class="o">=</span> <span class="n">f_us</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="GeoCountry-931"><a href="#GeoCountry-931"><span class="linenos"> 931</span></a>            <span class="n">f_us</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="GeoCountry-932"><a href="#GeoCountry-932"><span class="linenos"> 932</span></a>            <span class="n">soup_us</span> <span class="o">=</span> <span class="n">bs4</span><span class="o">.</span><span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">content_us</span><span class="p">,</span><span class="s1">&#39;lxml&#39;</span><span class="p">)</span>
</span><span id="GeoCountry-933"><a href="#GeoCountry-933"><span class="linenos"> 933</span></a>            <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">soup_us</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;img&#39;</span><span class="p">):</span>  <span class="c1"># need to convert &lt;img tags to src content for pandas_read</span>
</span><span id="GeoCountry-934"><a href="#GeoCountry-934"><span class="linenos"> 934</span></a>                <span class="n">src</span><span class="o">=</span><span class="n">img</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">)</span>
</span><span id="GeoCountry-935"><a href="#GeoCountry-935"><span class="linenos"> 935</span></a>                <span class="k">if</span> <span class="n">src</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
</span><span id="GeoCountry-936"><a href="#GeoCountry-936"><span class="linenos"> 936</span></a>                    <span class="n">src</span><span class="o">=</span><span class="s1">&#39;http:&#39;</span><span class="o">+</span><span class="n">src</span>
</span><span id="GeoCountry-937"><a href="#GeoCountry-937"><span class="linenos"> 937</span></a>                <span class="n">img</span><span class="o">.</span><span class="n">replace_with</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
</span><span id="GeoCountry-938"><a href="#GeoCountry-938"><span class="linenos"> 938</span></a>
</span><span id="GeoCountry-939"><a href="#GeoCountry-939"><span class="linenos"> 939</span></a>            <span class="n">h_us</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">soup_us</span><span class="p">))</span> <span class="c1"># pandas read the modified html</span>
</span><span id="GeoCountry-940"><a href="#GeoCountry-940"><span class="linenos"> 940</span></a>            <span class="n">h_us</span><span class="o">=</span><span class="n">h_us</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">h_us</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">]]]</span>
</span><span id="GeoCountry-941"><a href="#GeoCountry-941"><span class="linenos"> 941</span></a>            <span class="n">h_us</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;flag_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;town_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;population_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;area_subregion&#39;</span><span class="p">]</span>
</span><span id="GeoCountry-942"><a href="#GeoCountry-942"><span class="linenos"> 942</span></a>            <span class="n">h_us</span><span class="p">[</span><span class="s1">&#39;flag_subregion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="n">h</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\xa0</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">h_us</span><span class="p">[</span><span class="s1">&#39;flag_subregion&#39;</span><span class="p">]</span> <span class="p">]</span>
</span><span id="GeoCountry-943"><a href="#GeoCountry-943"><span class="linenos"> 943</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">h_us</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">)</span>
</span><span id="GeoCountry-944"><a href="#GeoCountry-944"><span class="linenos"> 944</span></a>
</span><span id="GeoCountry-945"><a href="#GeoCountry-945"><span class="linenos"> 945</span></a>            <span class="c1"># if needed, define some variable for dense / main geometry</span>
</span><span id="GeoCountry-946"><a href="#GeoCountry-946"><span class="linenos"> 946</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_list_translation</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;AK&quot;</span><span class="p">:(</span><span class="mi">40</span><span class="p">,</span><span class="o">-</span><span class="mi">40</span><span class="p">),</span><span class="s2">&quot;HI&quot;</span><span class="p">:(</span><span class="mi">60</span><span class="p">,</span><span class="mi">0</span><span class="p">)}</span>
</span><span id="GeoCountry-947"><a href="#GeoCountry-947"><span class="linenos"> 947</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_list_scale</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;AK&quot;</span><span class="p">:</span><span class="mf">0.4</span><span class="p">,</span><span class="s2">&quot;HI&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>
</span><span id="GeoCountry-948"><a href="#GeoCountry-948"><span class="linenos"> 948</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_list_center</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;AK&quot;</span><span class="p">:(</span><span class="o">-</span><span class="mi">120</span><span class="p">,</span><span class="mi">25</span><span class="p">),</span><span class="s2">&quot;HI&quot;</span><span class="p">:(</span><span class="o">-</span><span class="mi">130</span><span class="p">,</span><span class="mi">25</span><span class="p">)}</span>
</span><span id="GeoCountry-949"><a href="#GeoCountry-949"><span class="linenos"> 949</span></a>
</span><span id="GeoCountry-950"><a href="#GeoCountry-950"><span class="linenos"> 950</span></a>        <span class="c1"># --- &#39;ITA&#39; case ---------------------------------------------------------------------------------------</span>
</span><span id="GeoCountry-951"><a href="#GeoCountry-951"><span class="linenos"> 951</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country</span> <span class="o">==</span> <span class="s1">&#39;ITA&#39;</span><span class="p">:</span>
</span><span id="GeoCountry-952"><a href="#GeoCountry-952"><span class="linenos"> 952</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span> <span class="c1"># this is a geojson file</span>
</span><span id="GeoCountry-953"><a href="#GeoCountry-953"><span class="linenos"> 953</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>\
</span><span id="GeoCountry-954"><a href="#GeoCountry-954"><span class="linenos"> 954</span></a>                <span class="s1">&#39;prov_name&#39;</span><span class="p">:</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-955"><a href="#GeoCountry-955"><span class="linenos"> 955</span></a>                <span class="s1">&#39;prov_acr&#39;</span><span class="p">:</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-956"><a href="#GeoCountry-956"><span class="linenos"> 956</span></a>                <span class="s1">&#39;reg_name&#39;</span><span class="p">:</span><span class="s1">&#39;name_region&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-957"><a href="#GeoCountry-957"><span class="linenos"> 957</span></a>                <span class="s1">&#39;reg_istat_code&#39;</span><span class="p">:</span><span class="s1">&#39;code_region&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-958"><a href="#GeoCountry-958"><span class="linenos"> 958</span></a>                <span class="p">},</span>
</span><span id="GeoCountry-959"><a href="#GeoCountry-959"><span class="linenos"> 959</span></a>                <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry-960"><a href="#GeoCountry-960"><span class="linenos"> 960</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span>
</span><span id="GeoCountry-961"><a href="#GeoCountry-961"><span class="linenos"> 961</span></a>            <span class="s1">&#39;Valle d</span><span class="se">\&#39;</span><span class="s1">Aosta/Vallée d</span><span class="se">\&#39;</span><span class="s1">Aoste&#39;</span><span class="p">:</span><span class="s1">&#39;Valle d</span><span class="se">\&#39;</span><span class="s1">Aosta&#39;</span><span class="p">,</span>
</span><span id="GeoCountry-962"><a href="#GeoCountry-962"><span class="linenos"> 962</span></a>            <span class="s1">&#39;Trentino-Alto Adige/Südtirol&#39;</span><span class="p">:</span><span class="s1">&#39;Trentino-Alto Adige&#39;</span><span class="p">,</span> <span class="s1">&#39;Friuli-Venezia Giulia&#39;</span><span class="p">:</span><span class="s1">&#39;Friuli Venezia Giulia&#39;</span><span class="p">})</span>
</span><span id="GeoCountry-963"><a href="#GeoCountry-963"><span class="linenos"> 963</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;prov_istat_code_num&#39;</span><span class="p">,</span><span class="s1">&#39;reg_istat_code_num&#39;</span><span class="p">,</span><span class="s1">&#39;prov_istat_code&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry-964"><a href="#GeoCountry-964"><span class="linenos"> 964</span></a>
</span><span id="GeoCountry-965"><a href="#GeoCountry-965"><span class="linenos"> 965</span></a>        <span class="c1"># --- &#39;IND&#39; case ---------------------------------------------------------------------------------------</span>
</span><span id="GeoCountry-966"><a href="#GeoCountry-966"><span class="linenos"> 966</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country</span> <span class="o">==</span> <span class="s1">&#39;IND&#39;</span><span class="p">:</span>
</span><span id="GeoCountry-967"><a href="#GeoCountry-967"><span class="linenos"> 967</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span> <span class="c1"># this is a geojson file</span>
</span><span id="GeoCountry-968"><a href="#GeoCountry-968"><span class="linenos"> 968</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>\
</span><span id="GeoCountry-969"><a href="#GeoCountry-969"><span class="linenos"> 969</span></a>                <span class="s1">&#39;NAME_1&#39;</span><span class="p">:</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-970"><a href="#GeoCountry-970"><span class="linenos"> 970</span></a>                <span class="s1">&#39;VARNAME_1&#39;</span><span class="p">:</span><span class="s1">&#39;variationname&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-971"><a href="#GeoCountry-971"><span class="linenos"> 971</span></a>                <span class="s1">&#39;HASC_1&#39;</span><span class="p">:</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-972"><a href="#GeoCountry-972"><span class="linenos"> 972</span></a>                <span class="p">},</span>
</span><span id="GeoCountry-973"><a href="#GeoCountry-973"><span class="linenos"> 973</span></a>                <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry-974"><a href="#GeoCountry-974"><span class="linenos"> 974</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">]</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Orissa&#39;</span><span class="p">,</span><span class="s1">&#39;Odisha&#39;</span><span class="p">)</span>
</span><span id="GeoCountry-975"><a href="#GeoCountry-975"><span class="linenos"> 975</span></a>            <span class="n">variationname</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;variationname&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
</span><span id="GeoCountry-976"><a href="#GeoCountry-976"><span class="linenos"> 976</span></a>            <span class="n">name_subregion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
</span><span id="GeoCountry-977"><a href="#GeoCountry-977"><span class="linenos"> 977</span></a>            <span class="n">alllocationvariation</span><span class="o">=</span><span class="p">[</span> <span class="n">i</span><span class="o">+</span><span class="s1">&#39;|&#39;</span><span class="o">+</span><span class="n">j</span> <span class="k">if</span> <span class="n">j</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="k">else</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">name_subregion</span><span class="p">,</span><span class="n">variationname</span><span class="p">)]</span>
</span><span id="GeoCountry-978"><a href="#GeoCountry-978"><span class="linenos"> 978</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;variation_name_subregion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">]</span><span class="o">.</span>\
</span><span id="GeoCountry-979"><a href="#GeoCountry-979"><span class="linenos"> 979</span></a>                    <span class="n">replace</span><span class="p">(</span><span class="n">name_subregion</span><span class="p">,</span><span class="n">alllocationvariation</span><span class="p">)</span>
</span><span id="GeoCountry-980"><a href="#GeoCountry-980"><span class="linenos"> 980</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">]</span>
</span><span id="GeoCountry-981"><a href="#GeoCountry-981"><span class="linenos"> 981</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">]</span>
</span><span id="GeoCountry-982"><a href="#GeoCountry-982"><span class="linenos"> 982</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;ISO&#39;</span><span class="p">,</span><span class="s1">&#39;NAME_0&#39;</span><span class="p">,</span><span class="s1">&#39;ID_1&#39;</span><span class="p">,</span><span class="s1">&#39;TYPE_1&#39;</span><span class="p">,</span><span class="s1">&#39;ENGTYPE_1&#39;</span><span class="p">,</span><span class="s1">&#39;id&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry-983"><a href="#GeoCountry-983"><span class="linenos"> 983</span></a>
</span><span id="GeoCountry-984"><a href="#GeoCountry-984"><span class="linenos"> 984</span></a>        <span class="c1"># --- &#39;DEU&#39; case ---------------------------------------------------------------------------------------</span>
</span><span id="GeoCountry-985"><a href="#GeoCountry-985"><span class="linenos"> 985</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country</span> <span class="o">==</span> <span class="s1">&#39;DEU&#39;</span><span class="p">:</span>
</span><span id="GeoCountry-986"><a href="#GeoCountry-986"><span class="linenos"> 986</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span> <span class="c1"># this is a geojson file</span>
</span><span id="GeoCountry-987"><a href="#GeoCountry-987"><span class="linenos"> 987</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>\
</span><span id="GeoCountry-988"><a href="#GeoCountry-988"><span class="linenos"> 988</span></a>                <span class="s1">&#39;GEN&#39;</span><span class="p">:</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-989"><a href="#GeoCountry-989"><span class="linenos"> 989</span></a>                <span class="s1">&#39;AGS&#39;</span><span class="p">:</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-990"><a href="#GeoCountry-990"><span class="linenos"> 990</span></a>                <span class="p">},</span>
</span><span id="GeoCountry-991"><a href="#GeoCountry-991"><span class="linenos"> 991</span></a>                <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry-992"><a href="#GeoCountry-992"><span class="linenos"> 992</span></a>            <span class="c1"># See https://www.ioer-monitor.de/en/methodology/glossary/o/official-municipality-key-ags/ for decoding information of region code</span>
</span><span id="GeoCountry-993"><a href="#GeoCountry-993"><span class="linenos"> 993</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">code_subregion</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">//</span><span class="mi">1000</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span id="GeoCountry-994"><a href="#GeoCountry-994"><span class="linenos"> 994</span></a>            <span class="n">h_deu</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="s1">&#39;https://de.zxc.wiki/wiki/Amtlicher_Gemeindeschl%C3%BCssel&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">))[</span><span class="mi">3</span><span class="p">]</span>
</span><span id="GeoCountry-995"><a href="#GeoCountry-995"><span class="linenos"> 995</span></a>            <span class="n">h_deu</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">h_deu</span><span class="p">[</span><span class="s1">&#39;#&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">stop</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="GeoCountry-996"><a href="#GeoCountry-996"><span class="linenos"> 996</span></a>            <span class="n">h_deu</span><span class="p">[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">h_deu</span><span class="p">[</span><span class="s1">&#39;country&#39;</span><span class="p">]</span>
</span><span id="GeoCountry-997"><a href="#GeoCountry-997"><span class="linenos"> 997</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">h_deu</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;code_region&#39;</span><span class="p">,</span><span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
</span><span id="GeoCountry-998"><a href="#GeoCountry-998"><span class="linenos"> 998</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">code_subregion</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
</span><span id="GeoCountry-999"><a href="#GeoCountry-999"><span class="linenos"> 999</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;name_region&#39;</span><span class="p">,</span><span class="s1">&#39;code_region&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]]</span>
</span><span id="GeoCountry-1000"><a href="#GeoCountry-1000"><span class="linenos">1000</span></a>            <span class="n">disso</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">dissolve</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="s1">&#39;sum&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="GeoCountry-1001"><a href="#GeoCountry-1001"><span class="linenos">1001</span></a>            <span class="c1"># aggregate geometry with the same subregion name # some code subregion is lost somehow</span>
</span><span id="GeoCountry-1002"><a href="#GeoCountry-1002"><span class="linenos">1002</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">])</span>
</span><span id="GeoCountry-1003"><a href="#GeoCountry-1003"><span class="linenos">1003</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]),</span><span class="n">disso</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">)</span>
</span><span id="GeoCountry-1004"><a href="#GeoCountry-1004"><span class="linenos">1004</span></a>
</span><span id="GeoCountry-1005"><a href="#GeoCountry-1005"><span class="linenos">1005</span></a>        <span class="c1"># --- &#39;ESP&#39; case ---------------------------------------------------------------------------------------</span>
</span><span id="GeoCountry-1006"><a href="#GeoCountry-1006"><span class="linenos">1006</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country</span> <span class="o">==</span> <span class="s1">&#39;ESP&#39;</span><span class="p">:</span>
</span><span id="GeoCountry-1007"><a href="#GeoCountry-1007"><span class="linenos">1007</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;zip://&#39;</span><span class="o">+</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;.zip&#39;</span><span class="p">),</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="c1"># this is shapefile file</span>
</span><span id="GeoCountry-1008"><a href="#GeoCountry-1008"><span class="linenos">1008</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>\
</span><span id="GeoCountry-1009"><a href="#GeoCountry-1009"><span class="linenos">1009</span></a>                <span class="s1">&#39;ccaa&#39;</span><span class="p">:</span><span class="s1">&#39;name_region&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-1010"><a href="#GeoCountry-1010"><span class="linenos">1010</span></a>                <span class="s1">&#39;cod_ccaa&#39;</span><span class="p">:</span><span class="s1">&#39;code_region&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-1011"><a href="#GeoCountry-1011"><span class="linenos">1011</span></a>                <span class="s1">&#39;provincia&#39;</span><span class="p">:</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-1012"><a href="#GeoCountry-1012"><span class="linenos">1012</span></a>                <span class="s1">&#39;codigo&#39;</span><span class="p">:</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">},</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry-1013"><a href="#GeoCountry-1013"><span class="linenos">1013</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;texto&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry-1014"><a href="#GeoCountry-1014"><span class="linenos">1014</span></a>
</span><span id="GeoCountry-1015"><a href="#GeoCountry-1015"><span class="linenos">1015</span></a>        <span class="c1"># --- &#39;GBR&#39; case ---------------------------------------------------------------------------------------</span>
</span><span id="GeoCountry-1016"><a href="#GeoCountry-1016"><span class="linenos">1016</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country</span> <span class="o">==</span> <span class="s1">&#39;GBR&#39;</span><span class="p">:</span>
</span><span id="GeoCountry-1017"><a href="#GeoCountry-1017"><span class="linenos">1017</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
</span><span id="GeoCountry-1018"><a href="#GeoCountry-1018"><span class="linenos">1018</span></a>            <span class="n">reg_england</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_source_dict</span><span class="p">[</span><span class="s1">&#39;GBR&#39;</span><span class="p">][</span><span class="s1">&#39;Regions&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">))</span>
</span><span id="GeoCountry-1019"><a href="#GeoCountry-1019"><span class="linenos">1019</span></a>            <span class="n">reg_adding_dict</span><span class="o">=</span><span class="p">{</span>
</span><span id="GeoCountry-1020"><a href="#GeoCountry-1020"><span class="linenos">1020</span></a>                <span class="s1">&#39;E07000245&#39;</span><span class="p">:(</span><span class="s1">&#39;E12000006&#39;</span><span class="p">,</span><span class="s1">&#39;East of England&#39;</span><span class="p">),</span> <span class="c1"># West Suffolk in East of England</span>
</span><span id="GeoCountry-1021"><a href="#GeoCountry-1021"><span class="linenos">1021</span></a>                <span class="s1">&#39;E07000244&#39;</span><span class="p">:(</span><span class="s1">&#39;E12000006&#39;</span><span class="p">,</span><span class="s1">&#39;East of England&#39;</span><span class="p">),</span> <span class="c1"># East Suffolk in East of England</span>
</span><span id="GeoCountry-1022"><a href="#GeoCountry-1022"><span class="linenos">1022</span></a>                <span class="s1">&#39;E06000059&#39;</span><span class="p">:(</span><span class="s1">&#39;E12000009&#39;</span><span class="p">,</span><span class="s1">&#39;South West&#39;</span><span class="p">),</span> <span class="c1"># Dorset in South West</span>
</span><span id="GeoCountry-1023"><a href="#GeoCountry-1023"><span class="linenos">1023</span></a>                <span class="s1">&#39;E06000058&#39;</span><span class="p">:(</span><span class="s1">&#39;E12000009&#39;</span><span class="p">,</span><span class="s1">&#39;South West&#39;</span><span class="p">),</span> <span class="c1"># Bournemouth, Christchurch and Poole in South West</span>
</span><span id="GeoCountry-1024"><a href="#GeoCountry-1024"><span class="linenos">1024</span></a>                <span class="s1">&#39;E07000246&#39;</span><span class="p">:(</span><span class="s1">&#39;E12000009&#39;</span><span class="p">,</span><span class="s1">&#39;South West&#39;</span><span class="p">),</span> <span class="c1"># Somerset West and Taunton in South West</span>
</span><span id="GeoCountry-1025"><a href="#GeoCountry-1025"><span class="linenos">1025</span></a>            <span class="p">}</span>
</span><span id="GeoCountry-1026"><a href="#GeoCountry-1026"><span class="linenos">1026</span></a>            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">reg_adding_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="GeoCountry-1027"><a href="#GeoCountry-1027"><span class="linenos">1027</span></a>                <span class="n">reg_england</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">reg_england</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_records</span><span class="p">([{</span><span class="s1">&#39;LAD18CD&#39;</span><span class="p">:</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;RGN18CD&#39;</span><span class="p">:</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;RGN18NM&#39;</span><span class="p">:</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]}])],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry-1028"><a href="#GeoCountry-1028"><span class="linenos">1028</span></a>
</span><span id="GeoCountry-1029"><a href="#GeoCountry-1029"><span class="linenos">1029</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">reg_england</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;lad19cd&#39;</span><span class="p">,</span><span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;LAD18CD&#39;</span><span class="p">)</span>
</span><span id="GeoCountry-1030"><a href="#GeoCountry-1030"><span class="linenos">1030</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>\
</span><span id="GeoCountry-1031"><a href="#GeoCountry-1031"><span class="linenos">1031</span></a>                <span class="s1">&#39;lad19nm&#39;</span><span class="p">:</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-1032"><a href="#GeoCountry-1032"><span class="linenos">1032</span></a>                <span class="s1">&#39;lad19cd&#39;</span><span class="p">:</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-1033"><a href="#GeoCountry-1033"><span class="linenos">1033</span></a>                <span class="s1">&#39;RGN18CD&#39;</span><span class="p">:</span><span class="s1">&#39;code_region&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-1034"><a href="#GeoCountry-1034"><span class="linenos">1034</span></a>                <span class="s1">&#39;RGN18NM&#39;</span><span class="p">:</span><span class="s1">&#39;name_region&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-1035"><a href="#GeoCountry-1035"><span class="linenos">1035</span></a>                <span class="p">},</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry-1036"><a href="#GeoCountry-1036"><span class="linenos">1036</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">code_region</span><span class="o">.</span><span class="n">isnull</span><span class="p">(),</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span> <span class="o">=</span> \
</span><span id="GeoCountry-1037"><a href="#GeoCountry-1037"><span class="linenos">1037</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">code_region</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span><span class="o">.</span><span class="n">code_subregion</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">stop</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="GeoCountry-1038"><a href="#GeoCountry-1038"><span class="linenos">1038</span></a>            <span class="n">dict_region</span><span class="o">=</span><span class="p">{</span>\
</span><span id="GeoCountry-1039"><a href="#GeoCountry-1039"><span class="linenos">1039</span></a>                <span class="s1">&#39;E&#39;</span><span class="p">:</span><span class="s1">&#39;England&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-1040"><a href="#GeoCountry-1040"><span class="linenos">1040</span></a>                <span class="s1">&#39;W&#39;</span><span class="p">:</span><span class="s1">&#39;Wales&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-1041"><a href="#GeoCountry-1041"><span class="linenos">1041</span></a>                <span class="s1">&#39;S&#39;</span><span class="p">:</span><span class="s1">&#39;Scotland&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-1042"><a href="#GeoCountry-1042"><span class="linenos">1042</span></a>                <span class="s1">&#39;N&#39;</span><span class="p">:</span><span class="s1">&#39;Northern Ireland&#39;</span>\
</span><span id="GeoCountry-1043"><a href="#GeoCountry-1043"><span class="linenos">1043</span></a>                <span class="p">}</span>
</span><span id="GeoCountry-1044"><a href="#GeoCountry-1044"><span class="linenos">1044</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">code_region</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">dict_region</span><span class="o">.</span><span class="n">keys</span><span class="p">())),</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span> <span class="o">=</span> \
</span><span id="GeoCountry-1045"><a href="#GeoCountry-1045"><span class="linenos">1045</span></a>                <span class="p">[</span><span class="n">dict_region</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">code_region</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">dict_region</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span>
</span><span id="GeoCountry-1046"><a href="#GeoCountry-1046"><span class="linenos">1046</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">,</span><span class="s1">&#39;code_region&#39;</span><span class="p">,</span><span class="s1">&#39;name_region&#39;</span><span class="p">]]</span>
</span><span id="GeoCountry-1047"><a href="#GeoCountry-1047"><span class="linenos">1047</span></a>            <span class="c1"># modifying projection</span>
</span><span id="GeoCountry-1048"><a href="#GeoCountry-1048"><span class="linenos">1048</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="s1">&#39;epsg:4326&#39;</span><span class="p">)</span>
</span><span id="GeoCountry-1049"><a href="#GeoCountry-1049"><span class="linenos">1049</span></a>        <span class="c1"># --- &#39;BEL&#39; case --------------------------------------------------------------------------------------------</span>
</span><span id="GeoCountry-1050"><a href="#GeoCountry-1050"><span class="linenos">1050</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country</span> <span class="o">==</span> <span class="s1">&#39;BEL&#39;</span><span class="p">:</span>
</span><span id="GeoCountry-1051"><a href="#GeoCountry-1051"><span class="linenos">1051</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;zip://&#39;</span><span class="o">+</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;.zip&#39;</span><span class="p">),</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="c1"># this is shapefile file</span>
</span><span id="GeoCountry-1052"><a href="#GeoCountry-1052"><span class="linenos">1052</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">notnull</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span> <span class="c1"># to solve the issue https://github.com/geopandas/geopandas/issues/2783</span>
</span><span id="GeoCountry-1053"><a href="#GeoCountry-1053"><span class="linenos">1053</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>\
</span><span id="GeoCountry-1054"><a href="#GeoCountry-1054"><span class="linenos">1054</span></a>                <span class="s1">&#39;nom_arrondi&#39;</span><span class="p">:</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-1055"><a href="#GeoCountry-1055"><span class="linenos">1055</span></a>                <span class="s1">&#39;niscode&#39;</span><span class="p">:</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-1056"><a href="#GeoCountry-1056"><span class="linenos">1056</span></a>                <span class="s1">&#39;prov_code&#39;</span><span class="p">:</span><span class="s1">&#39;code_region&#39;</span><span class="p">},</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry-1057"><a href="#GeoCountry-1057"><span class="linenos">1057</span></a>            <span class="n">p</span><span class="o">=</span><span class="p">[]</span>
</span><span id="GeoCountry-1058"><a href="#GeoCountry-1058"><span class="linenos">1058</span></a>
</span><span id="GeoCountry-1059"><a href="#GeoCountry-1059"><span class="linenos">1059</span></a>            <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="GeoCountry-1060"><a href="#GeoCountry-1060"><span class="linenos">1060</span></a>                <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">prov_name_n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GeoCountry-1061"><a href="#GeoCountry-1061"><span class="linenos">1061</span></a>                    <span class="n">p0</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">prov_name_n</span>
</span><span id="GeoCountry-1062"><a href="#GeoCountry-1062"><span class="linenos">1062</span></a>                <span class="k">elif</span> <span class="n">row</span><span class="o">.</span><span class="n">prov_name_f</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GeoCountry-1063"><a href="#GeoCountry-1063"><span class="linenos">1063</span></a>                    <span class="n">p0</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">prov_name_f</span>
</span><span id="GeoCountry-1064"><a href="#GeoCountry-1064"><span class="linenos">1064</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="GeoCountry-1065"><a href="#GeoCountry-1065"><span class="linenos">1065</span></a>                    <span class="n">p0</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">region</span>
</span><span id="GeoCountry-1066"><a href="#GeoCountry-1066"><span class="linenos">1066</span></a>                <span class="n">p0</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">p0</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;(Le)&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;(La)&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="GeoCountry-1067"><a href="#GeoCountry-1067"><span class="linenos">1067</span></a>                <span class="k">if</span> <span class="n">p0</span><span class="o">==</span><span class="s1">&#39;RégionDeBruxellesCapitale&#39;</span><span class="p">:</span>
</span><span id="GeoCountry-1068"><a href="#GeoCountry-1068"><span class="linenos">1068</span></a>                    <span class="n">p0</span><span class="o">=</span><span class="s1">&#39;Brussels&#39;</span>
</span><span id="GeoCountry-1069"><a href="#GeoCountry-1069"><span class="linenos">1069</span></a>                <span class="k">if</span> <span class="n">p0</span><span class="o">==</span><span class="s1">&#39;Henegouwen&#39;</span><span class="p">:</span>
</span><span id="GeoCountry-1070"><a href="#GeoCountry-1070"><span class="linenos">1070</span></a>                    <span class="n">p0</span><span class="o">=</span><span class="s1">&#39;Hainaut&#39;</span>
</span><span id="GeoCountry-1071"><a href="#GeoCountry-1071"><span class="linenos">1071</span></a>                <span class="n">p</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p0</span><span class="p">)</span>
</span><span id="GeoCountry-1072"><a href="#GeoCountry-1072"><span class="linenos">1072</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">p</span>
</span><span id="GeoCountry-1073"><a href="#GeoCountry-1073"><span class="linenos">1073</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">code_region</span><span class="o">.</span><span class="n">isnull</span><span class="p">(),</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;00000&#39;</span>
</span><span id="GeoCountry-1074"><a href="#GeoCountry-1074"><span class="linenos">1074</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;name_region&#39;</span><span class="p">,</span><span class="s1">&#39;code_region&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]]</span>
</span><span id="GeoCountry-1075"><a href="#GeoCountry-1075"><span class="linenos">1075</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="s1">&#39;epsg:4326&#39;</span><span class="p">)</span>
</span><span id="GeoCountry-1076"><a href="#GeoCountry-1076"><span class="linenos">1076</span></a>        <span class="c1"># --- &#39;PRT&#39; case --------------------------------------------------------------------------------------------</span>
</span><span id="GeoCountry-1077"><a href="#GeoCountry-1077"><span class="linenos">1077</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country</span> <span class="o">==</span> <span class="s1">&#39;PRT&#39;</span><span class="p">:</span>
</span><span id="GeoCountry-1078"><a href="#GeoCountry-1078"><span class="linenos">1078</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;zip://&#39;</span><span class="o">+</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;.zip&#39;</span><span class="p">),</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="GeoCountry-1079"><a href="#GeoCountry-1079"><span class="linenos">1079</span></a>            <span class="c1">#self._district=pd.read_json(self._source_dict[&#39;PRT&#39;][&#39;District&#39;])[[&#39;name&#39;,&#39;district&#39;]].dropna()</span>
</span><span id="GeoCountry-1080"><a href="#GeoCountry-1080"><span class="linenos">1080</span></a>
</span><span id="GeoCountry-1081"><a href="#GeoCountry-1081"><span class="linenos">1081</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>\
</span><span id="GeoCountry-1082"><a href="#GeoCountry-1082"><span class="linenos">1082</span></a>                <span class="s1">&#39;NAME_2&#39;</span><span class="p">:</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-1083"><a href="#GeoCountry-1083"><span class="linenos">1083</span></a>                <span class="s1">&#39;NAME_1&#39;</span><span class="p">:</span><span class="s1">&#39;name_region&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-1084"><a href="#GeoCountry-1084"><span class="linenos">1084</span></a>                <span class="s1">&#39;HASC_2&#39;</span><span class="p">:</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">},</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry-1085"><a href="#GeoCountry-1085"><span class="linenos">1085</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">code_subregion</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">stop</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="GeoCountry-1086"><a href="#GeoCountry-1086"><span class="linenos">1086</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;name_region&#39;</span><span class="p">,</span><span class="s1">&#39;code_region&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]]</span>
</span><span id="GeoCountry-1087"><a href="#GeoCountry-1087"><span class="linenos">1087</span></a>        <span class="c1"># --- &#39;MYS&#39; case --------------------------------------------------------------------------------------------</span>
</span><span id="GeoCountry-1088"><a href="#GeoCountry-1088"><span class="linenos">1088</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country</span> <span class="o">==</span> <span class="s1">&#39;MYS&#39;</span><span class="p">:</span>
</span><span id="GeoCountry-1089"><a href="#GeoCountry-1089"><span class="linenos">1089</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;zip://&#39;</span><span class="o">+</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;.zip&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">dissolve</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;nam&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="GeoCountry-1090"><a href="#GeoCountry-1090"><span class="linenos">1090</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">title</span><span class="p">()</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">nam</span><span class="p">]</span>
</span><span id="GeoCountry-1091"><a href="#GeoCountry-1091"><span class="linenos">1091</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">name_subregion</span>
</span><span id="GeoCountry-1092"><a href="#GeoCountry-1092"><span class="linenos">1092</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;MYS&#39;</span>
</span><span id="GeoCountry-1093"><a href="#GeoCountry-1093"><span class="linenos">1093</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;Malaysia&#39;</span>
</span><span id="GeoCountry-1094"><a href="#GeoCountry-1094"><span class="linenos">1094</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">code_subregion</span>
</span><span id="GeoCountry-1095"><a href="#GeoCountry-1095"><span class="linenos">1095</span></a>            <span class="c1"># to help the join procedure with current covid data, some translation</span>
</span><span id="GeoCountry-1096"><a href="#GeoCountry-1096"><span class="linenos">1096</span></a>            <span class="n">dict_subregion</span><span class="o">=</span><span class="p">{</span>\
</span><span id="GeoCountry-1097"><a href="#GeoCountry-1097"><span class="linenos">1097</span></a>                <span class="s1">&#39;Wilayah Persekutuan Labuan&#39;</span><span class="p">:</span><span class="s1">&#39;W.P. Labuan&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-1098"><a href="#GeoCountry-1098"><span class="linenos">1098</span></a>                <span class="s1">&#39;Wilayah Persekutuan&#39;</span><span class="p">:</span><span class="s1">&#39;W.P. Kuala Lumpur&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-1099"><a href="#GeoCountry-1099"><span class="linenos">1099</span></a>                <span class="p">}</span>
</span><span id="GeoCountry-1100"><a href="#GeoCountry-1100"><span class="linenos">1100</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">code_subregion</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">dict_subregion</span><span class="o">.</span><span class="n">keys</span><span class="p">())),</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">]</span> <span class="o">=</span> \
</span><span id="GeoCountry-1101"><a href="#GeoCountry-1101"><span class="linenos">1101</span></a>                <span class="p">[</span><span class="n">dict_subregion</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">code_subregion</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">dict_subregion</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span>
</span><span id="GeoCountry-1102"><a href="#GeoCountry-1102"><span class="linenos">1102</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;name_region&#39;</span><span class="p">,</span><span class="s1">&#39;code_region&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]]</span>
</span><span id="GeoCountry-1103"><a href="#GeoCountry-1103"><span class="linenos">1103</span></a>        <span class="c1"># --- &#39;CHL&#39; case --------------------------------------------------------------------------------------------</span>
</span><span id="GeoCountry-1104"><a href="#GeoCountry-1104"><span class="linenos">1104</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country</span> <span class="o">==</span> <span class="s1">&#39;CHL&#39;</span><span class="p">:</span>
</span><span id="GeoCountry-1105"><a href="#GeoCountry-1105"><span class="linenos">1105</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;zip://&#39;</span><span class="o">+</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;.zip&#39;</span><span class="p">),</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="GeoCountry-1106"><a href="#GeoCountry-1106"><span class="linenos">1106</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>\
</span><span id="GeoCountry-1107"><a href="#GeoCountry-1107"><span class="linenos">1107</span></a>                <span class="s1">&#39;NOM_REG&#39;</span><span class="p">:</span><span class="s1">&#39;name_region&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-1108"><a href="#GeoCountry-1108"><span class="linenos">1108</span></a>                <span class="s1">&#39;NOM_COM&#39;</span><span class="p">:</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">},</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry-1109"><a href="#GeoCountry-1109"><span class="linenos">1109</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">COD_COMUNA</span><span class="p">]</span>
</span><span id="GeoCountry-1110"><a href="#GeoCountry-1110"><span class="linenos">1110</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">code_subregion</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">stop</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="GeoCountry-1111"><a href="#GeoCountry-1111"><span class="linenos">1111</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;name_region&#39;</span><span class="p">,</span><span class="s1">&#39;code_region&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]]</span>
</span><span id="GeoCountry-1112"><a href="#GeoCountry-1112"><span class="linenos">1112</span></a>
</span><span id="GeoCountry-1113"><a href="#GeoCountry-1113"><span class="linenos">1113</span></a>        <span class="c1"># --- &#39;EUR&#39; case, which is a pseudo country for Europe ---------------------------------------------------------</span>
</span><span id="GeoCountry-1114"><a href="#GeoCountry-1114"><span class="linenos">1114</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country</span> <span class="o">==</span> <span class="s1">&#39;EUR&#39;</span><span class="p">:</span>
</span><span id="GeoCountry-1115"><a href="#GeoCountry-1115"><span class="linenos">1115</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
</span><span id="GeoCountry-1116"><a href="#GeoCountry-1116"><span class="linenos">1116</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>\
</span><span id="GeoCountry-1117"><a href="#GeoCountry-1117"><span class="linenos">1117</span></a>                <span class="s1">&#39;UID&#39;</span><span class="p">:</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-1118"><a href="#GeoCountry-1118"><span class="linenos">1118</span></a>                <span class="s1">&#39;RegionName&#39;</span><span class="p">:</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-1119"><a href="#GeoCountry-1119"><span class="linenos">1119</span></a>                <span class="s1">&#39;ADM0_ISO3&#39;</span><span class="p">:</span><span class="s1">&#39;code_region&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-1120"><a href="#GeoCountry-1120"><span class="linenos">1120</span></a>                <span class="s1">&#39;ADM0_NAME&#39;</span><span class="p">:</span><span class="s1">&#39;name_region&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-1121"><a href="#GeoCountry-1121"><span class="linenos">1121</span></a>                <span class="s1">&#39;Population&#39;</span><span class="p">:</span><span class="s1">&#39;population_subregion&#39;</span><span class="p">},</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry-1122"><a href="#GeoCountry-1122"><span class="linenos">1122</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;population_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;name_region&#39;</span><span class="p">,</span><span class="s1">&#39;code_region&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]]</span>
</span><span id="GeoCountry-1123"><a href="#GeoCountry-1123"><span class="linenos">1123</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">is_empty</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span>
</span><span id="GeoCountry-1124"><a href="#GeoCountry-1124"><span class="linenos">1124</span></a>            <span class="c1"># self._country_data=self._country_data[self._country_data.geometry!=None] to remove subregion without geometry</span>
</span><span id="GeoCountry-1125"><a href="#GeoCountry-1125"><span class="linenos">1125</span></a>
</span><span id="GeoCountry-1126"><a href="#GeoCountry-1126"><span class="linenos">1126</span></a>        <span class="c1"># --- &#39;GRC&#39; case ------------------------------------------------------------------------------------------------</span>
</span><span id="GeoCountry-1127"><a href="#GeoCountry-1127"><span class="linenos">1127</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country</span> <span class="o">==</span> <span class="s1">&#39;GRC&#39;</span><span class="p">:</span>
</span><span id="GeoCountry-1128"><a href="#GeoCountry-1128"><span class="linenos">1128</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;zip://&#39;</span><span class="o">+</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;.zip&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;!nomoi_okxe&#39;</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;ISO-8859-7&#39;</span><span class="p">)</span>
</span><span id="GeoCountry-1129"><a href="#GeoCountry-1129"><span class="linenos">1129</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>\
</span><span id="GeoCountry-1130"><a href="#GeoCountry-1130"><span class="linenos">1130</span></a>                <span class="s1">&#39;POP&#39;</span><span class="p">:</span><span class="s1">&#39;population_subregion&#39;</span><span class="p">},</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry-1131"><a href="#GeoCountry-1131"><span class="linenos">1131</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">NAME_GR</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span id="GeoCountry-1132"><a href="#GeoCountry-1132"><span class="linenos">1132</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">PARENT</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">stop</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="GeoCountry-1133"><a href="#GeoCountry-1133"><span class="linenos">1133</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">]</span>
</span><span id="GeoCountry-1134"><a href="#GeoCountry-1134"><span class="linenos">1134</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">]</span> <span class="c1"># no region info</span>
</span><span id="GeoCountry-1135"><a href="#GeoCountry-1135"><span class="linenos">1135</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;population_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;name_region&#39;</span><span class="p">,</span><span class="s1">&#39;code_region&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]]</span>
</span><span id="GeoCountry-1136"><a href="#GeoCountry-1136"><span class="linenos">1136</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">4326</span><span class="p">)</span>
</span><span id="GeoCountry-1137"><a href="#GeoCountry-1137"><span class="linenos">1137</span></a>            <span class="c1"># Merge region to fit with the CSV epidemiological data</span>
</span><span id="GeoCountry-1138"><a href="#GeoCountry-1138"><span class="linenos">1138</span></a>            <span class="n">ath</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ΔΥΤΙΚΗΣ ΑΤΤΙΚΗΣ&#39;</span><span class="p">,</span> <span class="s1">&#39;ΑΝΑΤΟΛΙΚΗΣ ΑΤΤΙΚΗΣ&#39;</span><span class="p">,</span> <span class="s1">&#39;ΠΕΙΡΑΙΩΣ ΚΑΙ ΝΗΣΩΝ&#39;</span><span class="p">,</span><span class="s1">&#39;ΑΘΗΝΩΝ&#39;</span><span class="p">]</span>
</span><span id="GeoCountry-1139"><a href="#GeoCountry-1139"><span class="linenos">1139</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">name_subregion</span><span class="o">==</span><span class="s1">&#39;ΑΘΗΝΩΝ&#39;</span><span class="p">),[</span><span class="s1">&#39;geometry&#39;</span><span class="p">,</span><span class="s1">&#39;population_subregion&#39;</span><span class="p">]]</span><span class="o">=</span>\
</span><span id="GeoCountry-1140"><a href="#GeoCountry-1140"><span class="linenos">1140</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">name_subregion</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">ath</span><span class="p">)]</span><span class="o">.</span><span class="n">dissolve</span><span class="p">(</span><span class="n">aggfunc</span><span class="o">=</span><span class="s1">&#39;sum&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
</span><span id="GeoCountry-1141"><a href="#GeoCountry-1141"><span class="linenos">1141</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">name_subregion</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">ath</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])]</span>
</span><span id="GeoCountry-1142"><a href="#GeoCountry-1142"><span class="linenos">1142</span></a>            <span class="n">changename</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Ο ΟΡΟΣ&#39;</span><span class="p">:</span><span class="s1">&#39;ΑΓΙΟ ΟΡΟΣ&#39;</span><span class="p">,</span><span class="s1">&#39;ΑΘΗΝΩΝ&#39;</span><span class="p">:</span><span class="s1">&#39;ΑΤΤΙΚΗΣ&#39;</span><span class="p">}</span>
</span><span id="GeoCountry-1143"><a href="#GeoCountry-1143"><span class="linenos">1143</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">changename</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry-1144"><a href="#GeoCountry-1144"><span class="linenos">1144</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">changename</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry-1145"><a href="#GeoCountry-1145"><span class="linenos">1145</span></a>
</span><span id="GeoCountry-1146"><a href="#GeoCountry-1146"><span class="linenos">1146</span></a>        <span class="c1">#--- &#39;JPN&#39; case ----------------------------------------------------------------------------------------</span>
</span><span id="GeoCountry-1147"><a href="#GeoCountry-1147"><span class="linenos">1147</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country</span> <span class="o">==</span> <span class="s1">&#39;JPN&#39;</span><span class="p">:</span>
</span><span id="GeoCountry-1148"><a href="#GeoCountry-1148"><span class="linenos">1148</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/dataofjapan/land/master/japan.geojson&#39;</span><span class="p">)</span>
</span><span id="GeoCountry-1149"><a href="#GeoCountry-1149"><span class="linenos">1149</span></a>            <span class="n">np_name_subregion_jpn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;Hokkaido&#39;</span><span class="p">,</span> <span class="s1">&#39;Aomori&#39;</span><span class="p">,</span> <span class="s1">&#39;Iwate&#39;</span><span class="p">,</span> <span class="s1">&#39;Miyagi&#39;</span><span class="p">,</span> <span class="s1">&#39;Akita&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-1150"><a href="#GeoCountry-1150"><span class="linenos">1150</span></a>                                              <span class="s1">&#39;Yamagata&#39;</span><span class="p">,</span> <span class="s1">&#39;Fukushima&#39;</span><span class="p">,</span> <span class="s1">&#39;Ibaraki&#39;</span><span class="p">,</span> <span class="s1">&#39;Tochigi&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-1151"><a href="#GeoCountry-1151"><span class="linenos">1151</span></a>                                              <span class="s1">&#39;Gunma&#39;</span><span class="p">,</span> <span class="s1">&#39;Saitama&#39;</span><span class="p">,</span><span class="s1">&#39;Chiba&#39;</span><span class="p">,</span> <span class="s1">&#39;Tokyo&#39;</span><span class="p">,</span> <span class="s1">&#39;Kanagawa&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-1152"><a href="#GeoCountry-1152"><span class="linenos">1152</span></a>                                              <span class="s1">&#39;Niigata&#39;</span><span class="p">,</span> <span class="s1">&#39;Toyama&#39;</span><span class="p">,</span> <span class="s1">&#39;Ishikawa&#39;</span><span class="p">,</span> <span class="s1">&#39;Fukui&#39;</span><span class="p">,</span><span class="s1">&#39;Yamanashi&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-1153"><a href="#GeoCountry-1153"><span class="linenos">1153</span></a>                                              <span class="s1">&#39;Nagano&#39;</span><span class="p">,</span> <span class="s1">&#39;Gifu&#39;</span><span class="p">,</span> <span class="s1">&#39;Shizuoka&#39;</span><span class="p">,</span> <span class="s1">&#39;Aichi&#39;</span><span class="p">,</span> <span class="s1">&#39;Mie&#39;</span><span class="p">,</span> <span class="s1">&#39;Shiga&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-1154"><a href="#GeoCountry-1154"><span class="linenos">1154</span></a>                                              <span class="s1">&#39;Kyoto&#39;</span><span class="p">,</span> <span class="s1">&#39;Osaka&#39;</span><span class="p">,</span> <span class="s1">&#39;Hyogo&#39;</span><span class="p">,</span> <span class="s1">&#39;Nara&#39;</span><span class="p">,</span> <span class="s1">&#39;Wakayama&#39;</span><span class="p">,</span> <span class="s1">&#39;Tottori&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-1155"><a href="#GeoCountry-1155"><span class="linenos">1155</span></a>                                              <span class="s1">&#39;Shimane&#39;</span><span class="p">,</span><span class="s1">&#39;Okayama&#39;</span><span class="p">,</span> <span class="s1">&#39;Hiroshima&#39;</span><span class="p">,</span> <span class="s1">&#39;Yamaguchi&#39;</span><span class="p">,</span> <span class="s1">&#39;Tokushima&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-1156"><a href="#GeoCountry-1156"><span class="linenos">1156</span></a>                                              <span class="s1">&#39;Kagawa&#39;</span><span class="p">,</span> <span class="s1">&#39;Ehime&#39;</span><span class="p">,</span><span class="s1">&#39;Kochi&#39;</span><span class="p">,</span> <span class="s1">&#39;Fukuoka&#39;</span><span class="p">,</span> <span class="s1">&#39;Saga&#39;</span><span class="p">,</span> <span class="s1">&#39;Nagasaki&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-1157"><a href="#GeoCountry-1157"><span class="linenos">1157</span></a>                                              <span class="s1">&#39;Kumamoto&#39;</span><span class="p">,</span> <span class="s1">&#39;Oita&#39;</span><span class="p">,</span> <span class="s1">&#39;Miyazaki&#39;</span><span class="p">,</span><span class="s1">&#39;Kagoshima&#39;</span><span class="p">,</span> <span class="s1">&#39;Okinawa&#39;</span><span class="p">])</span>
</span><span id="GeoCountry-1158"><a href="#GeoCountry-1158"><span class="linenos">1158</span></a>            <span class="n">np_town_subregion_jpn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;Sapporo&#39;</span><span class="p">,</span><span class="s1">&#39;Aomori&#39;</span><span class="p">,</span><span class="s1">&#39;Morioka&#39;</span><span class="p">,</span><span class="s1">&#39;Sendai&#39;</span><span class="p">,</span><span class="s1">&#39;Akita&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-1159"><a href="#GeoCountry-1159"><span class="linenos">1159</span></a>                                              <span class="s1">&#39;Yamagata&#39;</span><span class="p">,</span><span class="s1">&#39;Fukushima&#39;</span><span class="p">,</span><span class="s1">&#39;Mito&#39;</span><span class="p">,</span><span class="s1">&#39;Utsunomiya&#39;</span><span class="p">,</span><span class="s1">&#39;Maebashi&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-1160"><a href="#GeoCountry-1160"><span class="linenos">1160</span></a>                                              <span class="s1">&#39;Saitama&#39;</span><span class="p">,</span><span class="s1">&#39;Chiba&#39;</span><span class="p">,</span><span class="s1">&#39;Shinjuku&#39;</span><span class="p">,</span><span class="s1">&#39;Yokohama&#39;</span><span class="p">,</span><span class="s1">&#39;Niigata&#39;</span><span class="p">,</span><span class="s1">&#39;Toyama&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-1161"><a href="#GeoCountry-1161"><span class="linenos">1161</span></a>                                              <span class="s1">&#39;Kanazawa&#39;</span><span class="p">,</span><span class="s1">&#39;Fukui&#39;</span><span class="p">,</span><span class="s1">&#39;Kofu&#39;</span><span class="p">,</span><span class="s1">&#39;Nagano&#39;</span><span class="p">,</span><span class="s1">&#39;Gifu&#39;</span><span class="p">,</span><span class="s1">&#39;Shizuoka&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-1162"><a href="#GeoCountry-1162"><span class="linenos">1162</span></a>                                              <span class="s1">&#39;Nagoya&#39;</span><span class="p">,</span><span class="s1">&#39;Tsu&#39;</span><span class="p">,</span><span class="s1">&#39;Otsu&#39;</span><span class="p">,</span><span class="s1">&#39;Kyoto&#39;</span><span class="p">,</span><span class="s1">&#39;Osaka&#39;</span><span class="p">,</span><span class="s1">&#39;Kobe&#39;</span><span class="p">,</span><span class="s1">&#39;Nara&#39;</span><span class="p">,</span><span class="s1">&#39;Wakayama&#39;</span><span class="p">,</span><span class="s1">&#39;Tottori&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-1163"><a href="#GeoCountry-1163"><span class="linenos">1163</span></a>                                              <span class="s1">&#39;Matsue&#39;</span><span class="p">,</span><span class="s1">&#39;Okayama&#39;</span><span class="p">,</span><span class="s1">&#39;Hiroshima&#39;</span><span class="p">,</span><span class="s1">&#39;Yamaguchi&#39;</span><span class="p">,</span><span class="s1">&#39;Tokushima&#39;</span><span class="p">,</span><span class="s1">&#39;Takamatsu&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-1164"><a href="#GeoCountry-1164"><span class="linenos">1164</span></a>                                              <span class="s1">&#39;Matsuyama&#39;</span><span class="p">,</span><span class="s1">&#39;Kochi&#39;</span><span class="p">,</span><span class="s1">&#39;Fukuoka&#39;</span><span class="p">,</span><span class="s1">&#39;Saga&#39;</span><span class="p">,</span><span class="s1">&#39;Nagasaki&#39;</span><span class="p">,</span><span class="s1">&#39;Kumamoto&#39;</span><span class="p">,</span><span class="s1">&#39;Oita&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry-1165"><a href="#GeoCountry-1165"><span class="linenos">1165</span></a>                                              <span class="s1">&#39;Miyazaki&#39;</span><span class="p">,</span><span class="s1">&#39;Kagoshima&#39;</span><span class="p">,</span><span class="s1">&#39;Naha&#39;</span><span class="p">])</span>
</span><span id="GeoCountry-1166"><a href="#GeoCountry-1166"><span class="linenos">1166</span></a>            <span class="n">np_name_region_jpn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;Hokkaido&#39;</span><span class="p">]</span><span class="o">+</span> <span class="mi">6</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;Tohoku&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">7</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;Kanto&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">9</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;Chubu&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">5</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;Chugoku&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;Shikoku&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">7</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;Kansai&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">8</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;Kyushu&#39;</span><span class="p">])</span>
</span><span id="GeoCountry-1167"><a href="#GeoCountry-1167"><span class="linenos">1167</span></a>            <span class="n">np_code_region_jpn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;Hokkaido&#39;</span><span class="p">]</span><span class="o">+</span> <span class="mi">6</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;Tohoku&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">7</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;Kanto&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">9</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;Chubu&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">5</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;Chugoku&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;Shikoku&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">7</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;Kansai&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">8</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;Kyushu&#39;</span><span class="p">])</span>
</span><span id="GeoCountry-1168"><a href="#GeoCountry-1168"><span class="linenos">1168</span></a>            <span class="n">np_code_subregion_jpn</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">48</span><span class="p">)</span>
</span><span id="GeoCountry-1169"><a href="#GeoCountry-1169"><span class="linenos">1169</span></a>            <span class="n">np_population_subregion_jpn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">5224614</span><span class="p">,</span><span class="mi">1237984</span><span class="p">,</span><span class="mi">1210534</span><span class="p">,</span><span class="mi">2301996</span><span class="p">,</span><span class="mi">959502</span><span class="p">,</span> <span class="mi">1068027</span><span class="p">,</span>
</span><span id="GeoCountry-1170"><a href="#GeoCountry-1170"><span class="linenos">1170</span></a>                                        <span class="mi">1833152</span><span class="p">,</span><span class="mi">2867009</span><span class="p">,</span><span class="mi">1933146</span><span class="p">,</span><span class="mi">1939110</span><span class="p">,</span><span class="mi">7344765</span><span class="p">,</span><span class="mi">6284480</span><span class="p">,</span><span class="mi">14047594</span><span class="p">,</span>
</span><span id="GeoCountry-1171"><a href="#GeoCountry-1171"><span class="linenos">1171</span></a>                                        <span class="mi">9237337</span><span class="p">,</span><span class="mi">2201272</span><span class="p">,</span><span class="mi">1034814</span><span class="p">,</span><span class="mi">1132852</span><span class="p">,</span><span class="mi">766863</span><span class="p">,</span><span class="mi">809974</span><span class="p">,</span><span class="mi">2048011</span><span class="p">,</span> <span class="mi">1978742</span><span class="p">,</span><span class="mi">3633202</span><span class="p">,</span><span class="mi">7542415</span><span class="p">,</span><span class="mi">1770254</span><span class="p">,</span><span class="mi">1413610</span><span class="p">,</span><span class="mi">2578087</span><span class="p">,</span>
</span><span id="GeoCountry-1172"><a href="#GeoCountry-1172"><span class="linenos">1172</span></a>                                        <span class="mi">8837685</span><span class="p">,</span> <span class="mi">5465002</span><span class="p">,</span> <span class="mi">1324473</span><span class="p">,</span> <span class="mi">922584</span><span class="p">,</span> <span class="mi">553407</span><span class="p">,</span> <span class="mi">671126</span><span class="p">,</span> <span class="mi">1888432</span><span class="p">,</span> <span class="mi">2799702</span><span class="p">,</span> <span class="mi">1342059</span><span class="p">,</span><span class="mi">719559</span><span class="p">,</span> <span class="mi">950244</span><span class="p">,</span> <span class="mi">1344841</span><span class="p">,</span> <span class="mi">691527</span><span class="p">,</span> <span class="mi">5135214</span><span class="p">,</span>
</span><span id="GeoCountry-1173"><a href="#GeoCountry-1173"><span class="linenos">1173</span></a>                                        <span class="mi">811442</span><span class="p">,</span> <span class="mi">1312317</span><span class="p">,</span> <span class="mi">1738301</span><span class="p">,</span> <span class="mi">1123852</span><span class="p">,</span> <span class="mi">1069576</span><span class="p">,</span> <span class="mi">1588256</span><span class="p">,</span> <span class="mi">1467480</span><span class="p">])</span>
</span><span id="GeoCountry-1174"><a href="#GeoCountry-1174"><span class="linenos">1174</span></a>            <span class="n">np_area_subregion_jpn</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">83457.00</span><span class="p">,</span><span class="mf">9644.55</span><span class="p">,</span><span class="mf">15278.89</span><span class="p">,</span><span class="mf">7285.77</span><span class="p">,</span> <span class="mf">11636.28</span><span class="p">,</span> <span class="mf">9323.46</span><span class="p">,</span> <span class="mf">13782.76</span><span class="p">,</span>  <span class="mf">6095.72</span><span class="p">,</span>
</span><span id="GeoCountry-1175"><a href="#GeoCountry-1175"><span class="linenos">1175</span></a>                                 <span class="mf">6408.28</span><span class="p">,</span><span class="mf">6362.33</span><span class="p">,</span> <span class="mf">3798.08</span><span class="p">,</span> <span class="mf">5156.61</span><span class="p">,</span> <span class="mf">2188.67</span><span class="p">,</span> <span class="mf">2415.86</span><span class="p">,</span> <span class="mf">12583.83</span><span class="p">,</span> <span class="mf">4247.61</span><span class="p">,</span><span class="mf">4185.67</span><span class="p">,</span> <span class="mf">4189.88</span><span class="p">,</span>
</span><span id="GeoCountry-1176"><a href="#GeoCountry-1176"><span class="linenos">1176</span></a>                                 <span class="mf">4465.37</span><span class="p">,</span>  <span class="mf">13562.23</span><span class="p">,</span> <span class="mf">10621.17</span><span class="p">,</span> <span class="mf">7780.50</span><span class="p">,</span>  <span class="mf">5165.12</span><span class="p">,</span> <span class="mf">5777.31</span><span class="p">,</span> <span class="mf">4017.36</span><span class="p">,</span> <span class="mf">4613.21</span><span class="p">,</span> <span class="mf">1899.28</span><span class="p">,</span> <span class="mf">8396.16</span><span class="p">,</span> <span class="mf">3691.09</span><span class="p">,</span> <span class="mf">4726.29</span><span class="p">,</span> <span class="mf">3507.28</span><span class="p">,</span> <span class="mf">6707.96</span><span class="p">,</span> <span class="mf">7113.23</span><span class="p">,</span> <span class="mf">8479.70</span>
</span><span id="GeoCountry-1177"><a href="#GeoCountry-1177"><span class="linenos">1177</span></a>                                 <span class="p">,</span><span class="mf">6114.09</span><span class="p">,</span> <span class="mf">4146.74</span><span class="p">,</span> <span class="mf">1876.55</span><span class="p">,</span> <span class="mf">5678.33</span><span class="p">,</span> <span class="mf">7105.16</span><span class="p">,</span> <span class="mf">4978.51</span><span class="p">,</span> <span class="mf">2439.65</span><span class="p">,</span> <span class="mf">4105.47</span><span class="p">,</span> <span class="mf">7404.79</span><span class="p">,</span> <span class="mf">6339.74</span><span class="p">,</span> <span class="mf">7735.99</span><span class="p">,</span> <span class="mf">9188.82</span><span class="p">,</span> <span class="mf">2276.49</span><span class="p">])</span>
</span><span id="GeoCountry-1178"><a href="#GeoCountry-1178"><span class="linenos">1178</span></a>            <span class="n">np_flag_subregion_jpn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="GeoCountry-1179"><a href="#GeoCountry-1179"><span class="linenos">1179</span></a>                            <span class="p">[</span><span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/2/22/Flag_of_Hokkaido_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry-1180"><a href="#GeoCountry-1180"><span class="linenos">1180</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/3/30/Flag_of_Aomori_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry-1181"><a href="#GeoCountry-1181"><span class="linenos">1181</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/a/a9/Flag_of_Iwate_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry-1182"><a href="#GeoCountry-1182"><span class="linenos">1182</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/c/c7/Flag_of_Miyagi_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry-1183"><a href="#GeoCountry-1183"><span class="linenos">1183</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/8/84/Flag_of_Akita_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry-1184"><a href="#GeoCountry-1184"><span class="linenos">1184</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/a/a1/Flag_of_Yamagata_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry-1185"><a href="#GeoCountry-1185"><span class="linenos">1185</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/4/4b/Flag_of_Fukushima_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry-1186"><a href="#GeoCountry-1186"><span class="linenos">1186</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/a/a8/Flag_of_Ibaraki_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry-1187"><a href="#GeoCountry-1187"><span class="linenos">1187</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/d/d5/Flag_of_Tochigi_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry-1188"><a href="#GeoCountry-1188"><span class="linenos">1188</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/b/ba/Flag_of_Gunma_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry-1189"><a href="#GeoCountry-1189"><span class="linenos">1189</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/c/cd/Flag_of_Saitama_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry-1190"><a href="#GeoCountry-1190"><span class="linenos">1190</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/0/0a/Flag_of_Chiba_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry-1191"><a href="#GeoCountry-1191"><span class="linenos">1191</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/1/15/Flag_of_Tokyo_Metropolis.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry-1192"><a href="#GeoCountry-1192"><span class="linenos">1192</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/a/a7/Flag_of_Kanagawa_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry-1193"><a href="#GeoCountry-1193"><span class="linenos">1193</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/c/cb/Flag_of_Niigata_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry-1194"><a href="#GeoCountry-1194"><span class="linenos">1194</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/1/1d/Flag_of_Toyama_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry-1195"><a href="#GeoCountry-1195"><span class="linenos">1195</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/6/6a/Flag_of_Ishikawa_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry-1196"><a href="#GeoCountry-1196"><span class="linenos">1196</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/5/56/Flag_of_Fukui_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry-1197"><a href="#GeoCountry-1197"><span class="linenos">1197</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/0/00/Flag_of_Yamanashi_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry-1198"><a href="#GeoCountry-1198"><span class="linenos">1198</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/f/f0/Flag_of_Nagano_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry-1199"><a href="#GeoCountry-1199"><span class="linenos">1199</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/3/3e/Flag_of_Gifu_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry-1200"><a href="#GeoCountry-1200"><span class="linenos">1200</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/9/92/Flag_of_Shizuoka_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry-1201"><a href="#GeoCountry-1201"><span class="linenos">1201</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/0/02/Flag_of_Aichi_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry-1202"><a href="#GeoCountry-1202"><span class="linenos">1202</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/8/8c/Flag_of_Mie_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry-1203"><a href="#GeoCountry-1203"><span class="linenos">1203</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/9/99/Flag_of_Shiga_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry-1204"><a href="#GeoCountry-1204"><span class="linenos">1204</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/0/06/Flag_of_Kyoto_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry-1205"><a href="#GeoCountry-1205"><span class="linenos">1205</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/5/5a/Flag_of_Osaka_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry-1206"><a href="#GeoCountry-1206"><span class="linenos">1206</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/7/74/Flag_of_Hyogo_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry-1207"><a href="#GeoCountry-1207"><span class="linenos">1207</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/0/00/Flag_of_Nara_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry-1208"><a href="#GeoCountry-1208"><span class="linenos">1208</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/6/6e/Flag_of_Wakayama_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry-1209"><a href="#GeoCountry-1209"><span class="linenos">1209</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/1/1c/Flag_of_Tottori_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry-1210"><a href="#GeoCountry-1210"><span class="linenos">1210</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/e/e8/Flag_of_Shimane_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry-1211"><a href="#GeoCountry-1211"><span class="linenos">1211</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/3/33/Flag_of_Okayama_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry-1212"><a href="#GeoCountry-1212"><span class="linenos">1212</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/e/ed/Flag_of_Hiroshima_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry-1213"><a href="#GeoCountry-1213"><span class="linenos">1213</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/b/b9/Flag_of_Yamaguchi_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry-1214"><a href="#GeoCountry-1214"><span class="linenos">1214</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/a/ac/Flag_of_Tokushima_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry-1215"><a href="#GeoCountry-1215"><span class="linenos">1215</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/2/29/Flag_of_Kagawa_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry-1216"><a href="#GeoCountry-1216"><span class="linenos">1216</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/2/2d/Flag_of_Ehime_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry-1217"><a href="#GeoCountry-1217"><span class="linenos">1217</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/5/50/Flag_of_Kochi_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry-1218"><a href="#GeoCountry-1218"><span class="linenos">1218</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/7/71/Flag_of_Fukuoka_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry-1219"><a href="#GeoCountry-1219"><span class="linenos">1219</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/1/18/Flag_of_Saga_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry-1220"><a href="#GeoCountry-1220"><span class="linenos">1220</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/6/65/Flag_of_Nagasaki_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry-1221"><a href="#GeoCountry-1221"><span class="linenos">1221</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/f/f7/Flag_of_Kumamoto_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry-1222"><a href="#GeoCountry-1222"><span class="linenos">1222</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/c/c8/Flag_of_Oita_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry-1223"><a href="#GeoCountry-1223"><span class="linenos">1223</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/0/0b/Flag_of_Miyazaki_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry-1224"><a href="#GeoCountry-1224"><span class="linenos">1224</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/c/c5/Flag_of_Kagoshima_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry-1225"><a href="#GeoCountry-1225"><span class="linenos">1225</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/2/2f/Flag_of_Okinawa_Prefecture.svg&#39;</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="nb">object</span><span class="p">)</span>
</span><span id="GeoCountry-1226"><a href="#GeoCountry-1226"><span class="linenos">1226</span></a>            <span class="n">dic_japan</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name_subregion&#39;</span> <span class="p">:</span> <span class="n">np_name_subregion_jpn</span><span class="p">,</span><span class="s1">&#39;code_region&#39;</span> <span class="p">:</span> <span class="n">np_name_region_jpn</span><span class="p">,</span> <span class="s1">&#39;name_region&#39;</span><span class="p">:</span> <span class="n">np_name_region_jpn</span><span class="p">,</span>\
</span><span id="GeoCountry-1227"><a href="#GeoCountry-1227"><span class="linenos">1227</span></a>                         <span class="s1">&#39;code_subregion&#39;</span> <span class="p">:</span> <span class="n">np_code_subregion_jpn</span><span class="p">,</span> <span class="s1">&#39;flag_subregion&#39;</span> <span class="p">:</span> <span class="n">np_flag_subregion_jpn</span><span class="p">,</span> <span class="s1">&#39;town_subregion&#39;</span> <span class="p">:</span> <span class="n">np_town_subregion_jpn</span><span class="p">,</span>\
</span><span id="GeoCountry-1228"><a href="#GeoCountry-1228"><span class="linenos">1228</span></a>                         <span class="s1">&#39;population_subregion&#39;</span> <span class="p">:</span> <span class="n">np_population_subregion_jpn</span><span class="p">,</span> <span class="s1">&#39;area_subregion&#39;</span> <span class="p">:</span> <span class="n">np_area_subregion_jpn</span> <span class="p">}</span>
</span><span id="GeoCountry-1229"><a href="#GeoCountry-1229"><span class="linenos">1229</span></a>            <span class="n">df_japan</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">dic_japan</span><span class="p">)</span>
</span><span id="GeoCountry-1230"><a href="#GeoCountry-1230"><span class="linenos">1230</span></a>            <span class="n">df_japan</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">48</span><span class="p">)</span>
</span><span id="GeoCountry-1231"><a href="#GeoCountry-1231"><span class="linenos">1231</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span> <span class="p">:</span> <span class="s2">&quot;code_subregion&quot;</span><span class="p">})</span>  <span class="c1">#</span>
</span><span id="GeoCountry-1232"><a href="#GeoCountry-1232"><span class="linenos">1232</span></a>            <span class="n">df_final_japan</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_japan</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">])</span>
</span><span id="GeoCountry-1233"><a href="#GeoCountry-1233"><span class="linenos">1233</span></a>            <span class="n">df_final_japan</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;nam&#39;</span><span class="p">,</span> <span class="s1">&#39;nam_ja&#39;</span><span class="p">],</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry-1234"><a href="#GeoCountry-1234"><span class="linenos">1234</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">df_final_japan</span><span class="p">)</span>
</span><span id="GeoCountry-1235"><a href="#GeoCountry-1235"><span class="linenos">1235</span></a>            <span class="c1">#code_subregion as to be str to be able to be merged ...</span>
</span><span id="GeoCountry-1236"><a href="#GeoCountry-1236"><span class="linenos">1236</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
</span><span id="GeoCountry-1237"><a href="#GeoCountry-1237"><span class="linenos">1237</span></a>
</span><span id="GeoCountry-1238"><a href="#GeoCountry-1238"><span class="linenos">1238</span></a>    <span class="c1"># def get_region_from_municipality(self,lname):</span>
</span><span id="GeoCountry-1239"><a href="#GeoCountry-1239"><span class="linenos">1239</span></a>    <span class="c1">#     &quot;&quot;&quot;  Return region list from a municipality list</span>
</span><span id="GeoCountry-1240"><a href="#GeoCountry-1240"><span class="linenos">1240</span></a>    <span class="c1">#     &quot;&quot;&quot;</span>
</span><span id="GeoCountry-1241"><a href="#GeoCountry-1241"><span class="linenos">1241</span></a>    <span class="c1">#     if not isinstance(lname, list):</span>
</span><span id="GeoCountry-1242"><a href="#GeoCountry-1242"><span class="linenos">1242</span></a>    <span class="c1">#         lname=[lname]</span>
</span><span id="GeoCountry-1243"><a href="#GeoCountry-1243"><span class="linenos">1243</span></a>    <span class="c1">#     return self._municipality_region.loc[self._municipality_region.name.isin(lname)][&#39;district&#39;].to_list()</span>
</span><span id="GeoCountry-1244"><a href="#GeoCountry-1244"><span class="linenos">1244</span></a>
</span><span id="GeoCountry-1245"><a href="#GeoCountry-1245"><span class="linenos">1245</span></a>    <span class="k">def</span> <span class="nf">set_dense_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GeoCountry-1246"><a href="#GeoCountry-1246"><span class="linenos">1246</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;  If used, we&#39;re using for the current country a dense geometry forsubregions</span>
</span><span id="GeoCountry-1247"><a href="#GeoCountry-1247"><span class="linenos">1247</span></a><span class="sd">        and regions.</span>
</span><span id="GeoCountry-1248"><a href="#GeoCountry-1248"><span class="linenos">1248</span></a><span class="sd">        It&#39;s not possible to go back.</span>
</span><span id="GeoCountry-1249"><a href="#GeoCountry-1249"><span class="linenos">1249</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoCountry-1250"><a href="#GeoCountry-1250"><span class="linenos">1250</span></a>
</span><span id="GeoCountry-1251"><a href="#GeoCountry-1251"><span class="linenos">1251</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dense_geometry</span><span class="p">():</span>
</span><span id="GeoCountry-1252"><a href="#GeoCountry-1252"><span class="linenos">1252</span></a>            <span class="k">return</span>
</span><span id="GeoCountry-1253"><a href="#GeoCountry-1253"><span class="linenos">1253</span></a>
</span><span id="GeoCountry-1254"><a href="#GeoCountry-1254"><span class="linenos">1254</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_main_geometry</span><span class="p">():</span>
</span><span id="GeoCountry-1255"><a href="#GeoCountry-1255"><span class="linenos">1255</span></a>            <span class="k">raise</span> <span class="n">CoaError</span><span class="p">(</span><span class="s2">&quot;You already set the main geometry. Cannot set the dense geometry now.&quot;</span><span class="p">)</span>
</span><span id="GeoCountry-1256"><a href="#GeoCountry-1256"><span class="linenos">1256</span></a>
</span><span id="GeoCountry-1257"><a href="#GeoCountry-1257"><span class="linenos">1257</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_exploded_geometry</span><span class="p">():</span>
</span><span id="GeoCountry-1258"><a href="#GeoCountry-1258"><span class="linenos">1258</span></a>            <span class="k">raise</span> <span class="n">CoaError</span><span class="p">(</span><span class="s2">&quot;You already set the exploded geometry. Cannot set the dense geometry now.&quot;</span><span class="p">)</span>
</span><span id="GeoCountry-1259"><a href="#GeoCountry-1259"><span class="linenos">1259</span></a>
</span><span id="GeoCountry-1260"><a href="#GeoCountry-1260"><span class="linenos">1260</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;FRA&#39;</span><span class="p">:</span>
</span><span id="GeoCountry-1261"><a href="#GeoCountry-1261"><span class="linenos">1261</span></a>            <span class="c1">#.drop([&#39;id_geofla&#39;,&#39;code_reg&#39;,&#39;nom_reg&#39;,&#39;x_chf_lieu&#39;,&#39;y_chf_lieu&#39;,&#39;x_centroid&#39;,&#39;y_centroid&#39;,&#39;Code département&#39;,&#39;Nom du département&#39;,&#39;Population municipale&#39;],axis=1,inplace=True) # removing some column without interest</span>
</span><span id="GeoCountry-1262"><a href="#GeoCountry-1262"><span class="linenos">1262</span></a>            <span class="c1"># moving artificially (if needed) outre-mer area to be near to metropole for map representations</span>
</span><span id="GeoCountry-1263"><a href="#GeoCountry-1263"><span class="linenos">1263</span></a>
</span><span id="GeoCountry-1264"><a href="#GeoCountry-1264"><span class="linenos">1264</span></a>            <span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="GeoCountry-1265"><a href="#GeoCountry-1265"><span class="linenos">1265</span></a>            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">poi</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="GeoCountry-1266"><a href="#GeoCountry-1266"><span class="linenos">1266</span></a>                <span class="n">x</span><span class="o">=</span><span class="mi">0</span>
</span><span id="GeoCountry-1267"><a href="#GeoCountry-1267"><span class="linenos">1267</span></a>                <span class="n">y</span><span class="o">=</span><span class="mi">0</span>
</span><span id="GeoCountry-1268"><a href="#GeoCountry-1268"><span class="linenos">1268</span></a>                <span class="n">w</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="s2">&quot;code_subregion&quot;</span><span class="p">]</span>
</span><span id="GeoCountry-1269"><a href="#GeoCountry-1269"><span class="linenos">1269</span></a>                <span class="k">if</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_list_translation</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="GeoCountry-1270"><a href="#GeoCountry-1270"><span class="linenos">1270</span></a>                    <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_list_translation</span><span class="p">[</span><span class="n">w</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GeoCountry-1271"><a href="#GeoCountry-1271"><span class="linenos">1271</span></a>                    <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_list_translation</span><span class="p">[</span><span class="n">w</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</span><span id="GeoCountry-1272"><a href="#GeoCountry-1272"><span class="linenos">1272</span></a>                <span class="n">g</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">],</span> <span class="n">xoff</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">yoff</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
</span><span id="GeoCountry-1273"><a href="#GeoCountry-1273"><span class="linenos">1273</span></a>                <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</span><span id="GeoCountry-1274"><a href="#GeoCountry-1274"><span class="linenos">1274</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">tmp</span>
</span><span id="GeoCountry-1275"><a href="#GeoCountry-1275"><span class="linenos">1275</span></a>
</span><span id="GeoCountry-1276"><a href="#GeoCountry-1276"><span class="linenos">1276</span></a>            <span class="c1"># Remove COM with dense geometry true, too many islands to manage</span>
</span><span id="GeoCountry-1277"><a href="#GeoCountry-1277"><span class="linenos">1277</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">code_subregion</span><span class="o">!=</span><span class="s1">&#39;980&#39;</span><span class="p">]</span>
</span><span id="GeoCountry-1278"><a href="#GeoCountry-1278"><span class="linenos">1278</span></a>
</span><span id="GeoCountry-1279"><a href="#GeoCountry-1279"><span class="linenos">1279</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;USA&#39;</span><span class="p">:</span>
</span><span id="GeoCountry-1280"><a href="#GeoCountry-1280"><span class="linenos">1280</span></a>            <span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="GeoCountry-1281"><a href="#GeoCountry-1281"><span class="linenos">1281</span></a>            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">poi</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="GeoCountry-1282"><a href="#GeoCountry-1282"><span class="linenos">1282</span></a>                <span class="n">x</span><span class="o">=</span><span class="mi">0</span>
</span><span id="GeoCountry-1283"><a href="#GeoCountry-1283"><span class="linenos">1283</span></a>                <span class="n">y</span><span class="o">=</span><span class="mi">0</span>
</span><span id="GeoCountry-1284"><a href="#GeoCountry-1284"><span class="linenos">1284</span></a>                <span class="n">w</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="s2">&quot;code_subregion&quot;</span><span class="p">]</span>
</span><span id="GeoCountry-1285"><a href="#GeoCountry-1285"><span class="linenos">1285</span></a>                <span class="k">if</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_list_translation</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="GeoCountry-1286"><a href="#GeoCountry-1286"><span class="linenos">1286</span></a>                    <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_list_translation</span><span class="p">[</span><span class="n">w</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GeoCountry-1287"><a href="#GeoCountry-1287"><span class="linenos">1287</span></a>                    <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_list_translation</span><span class="p">[</span><span class="n">w</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</span><span id="GeoCountry-1288"><a href="#GeoCountry-1288"><span class="linenos">1288</span></a>                    <span class="n">g</span><span class="o">=</span><span class="n">sa</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">sa</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">],</span><span class="n">xoff</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">yoff</span><span class="o">=</span><span class="n">y</span><span class="p">),</span>\
</span><span id="GeoCountry-1289"><a href="#GeoCountry-1289"><span class="linenos">1289</span></a>                                            <span class="n">xfact</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_list_scale</span><span class="p">[</span><span class="n">w</span><span class="p">],</span><span class="n">yfact</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_list_scale</span><span class="p">[</span><span class="n">w</span><span class="p">],</span><span class="n">origin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_list_center</span><span class="p">[</span><span class="n">w</span><span class="p">])</span>
</span><span id="GeoCountry-1290"><a href="#GeoCountry-1290"><span class="linenos">1290</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="GeoCountry-1291"><a href="#GeoCountry-1291"><span class="linenos">1291</span></a>                    <span class="n">g</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">]</span>
</span><span id="GeoCountry-1292"><a href="#GeoCountry-1292"><span class="linenos">1292</span></a>
</span><span id="GeoCountry-1293"><a href="#GeoCountry-1293"><span class="linenos">1293</span></a>                <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</span><span id="GeoCountry-1294"><a href="#GeoCountry-1294"><span class="linenos">1294</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">tmp</span>
</span><span id="GeoCountry-1295"><a href="#GeoCountry-1295"><span class="linenos">1295</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GeoCountry-1296"><a href="#GeoCountry-1296"><span class="linenos">1296</span></a>            <span class="k">raise</span> <span class="n">CoaError</span><span class="p">(</span><span class="s2">&quot;The current country does not have dense geometry support.&quot;</span><span class="p">)</span>
</span><span id="GeoCountry-1297"><a href="#GeoCountry-1297"><span class="linenos">1297</span></a>
</span><span id="GeoCountry-1298"><a href="#GeoCountry-1298"><span class="linenos">1298</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_country_data_region</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GeoCountry-1299"><a href="#GeoCountry-1299"><span class="linenos">1299</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_country_data_subregion</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GeoCountry-1300"><a href="#GeoCountry-1300"><span class="linenos">1300</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_dense_geometry</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="GeoCountry-1301"><a href="#GeoCountry-1301"><span class="linenos">1301</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_main_geometry</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="GeoCountry-1302"><a href="#GeoCountry-1302"><span class="linenos">1302</span></a>
</span><span id="GeoCountry-1303"><a href="#GeoCountry-1303"><span class="linenos">1303</span></a>    <span class="k">def</span> <span class="nf">set_exploded_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GeoCountry-1304"><a href="#GeoCountry-1304"><span class="linenos">1304</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;  If used, we&#39;re using for the current country a dense geometry forsubregions</span>
</span><span id="GeoCountry-1305"><a href="#GeoCountry-1305"><span class="linenos">1305</span></a><span class="sd">        and regions.</span>
</span><span id="GeoCountry-1306"><a href="#GeoCountry-1306"><span class="linenos">1306</span></a><span class="sd">        Moreover we&#39;re exploding internal dense geometry for some countries (currently IdF</span>
</span><span id="GeoCountry-1307"><a href="#GeoCountry-1307"><span class="linenos">1307</span></a><span class="sd">        for France, only).</span>
</span><span id="GeoCountry-1308"><a href="#GeoCountry-1308"><span class="linenos">1308</span></a>
</span><span id="GeoCountry-1309"><a href="#GeoCountry-1309"><span class="linenos">1309</span></a><span class="sd">        It&#39;s not possible to go back.</span>
</span><span id="GeoCountry-1310"><a href="#GeoCountry-1310"><span class="linenos">1310</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoCountry-1311"><a href="#GeoCountry-1311"><span class="linenos">1311</span></a>
</span><span id="GeoCountry-1312"><a href="#GeoCountry-1312"><span class="linenos">1312</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_main_geometry</span><span class="p">():</span>
</span><span id="GeoCountry-1313"><a href="#GeoCountry-1313"><span class="linenos">1313</span></a>            <span class="k">raise</span> <span class="n">CoaError</span><span class="p">(</span><span class="s2">&quot;You already set the main geometry. Cannot set the exploded geometry now.&quot;</span><span class="p">)</span>
</span><span id="GeoCountry-1314"><a href="#GeoCountry-1314"><span class="linenos">1314</span></a>
</span><span id="GeoCountry-1315"><a href="#GeoCountry-1315"><span class="linenos">1315</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dense_geometry</span><span class="p">():</span>
</span><span id="GeoCountry-1316"><a href="#GeoCountry-1316"><span class="linenos">1316</span></a>            <span class="k">raise</span> <span class="n">CoaError</span><span class="p">(</span><span class="s2">&quot;You already set the dense geometry. Cannot set the exploded geometry now.&quot;</span><span class="p">)</span>
</span><span id="GeoCountry-1317"><a href="#GeoCountry-1317"><span class="linenos">1317</span></a>
</span><span id="GeoCountry-1318"><a href="#GeoCountry-1318"><span class="linenos">1318</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_exploded_geometry</span><span class="p">():</span>
</span><span id="GeoCountry-1319"><a href="#GeoCountry-1319"><span class="linenos">1319</span></a>            <span class="k">return</span>
</span><span id="GeoCountry-1320"><a href="#GeoCountry-1320"><span class="linenos">1320</span></a>
</span><span id="GeoCountry-1321"><a href="#GeoCountry-1321"><span class="linenos">1321</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_dense_geometry</span><span class="p">()</span>
</span><span id="GeoCountry-1322"><a href="#GeoCountry-1322"><span class="linenos">1322</span></a>
</span><span id="GeoCountry-1323"><a href="#GeoCountry-1323"><span class="linenos">1323</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;FRA&#39;</span><span class="p">:</span>
</span><span id="GeoCountry-1324"><a href="#GeoCountry-1324"><span class="linenos">1324</span></a>            <span class="c1"># Add Ile de France zoom</span>
</span><span id="GeoCountry-1325"><a href="#GeoCountry-1325"><span class="linenos">1325</span></a>            <span class="n">idf_translation</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">6.5</span><span class="p">,</span><span class="o">-</span><span class="mi">5</span><span class="p">)</span>
</span><span id="GeoCountry-1326"><a href="#GeoCountry-1326"><span class="linenos">1326</span></a>            <span class="n">idf_scale</span><span class="o">=</span><span class="mi">3</span>
</span><span id="GeoCountry-1327"><a href="#GeoCountry-1327"><span class="linenos">1327</span></a>            <span class="n">idf_center</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span><span class="mi">43</span><span class="p">)</span>
</span><span id="GeoCountry-1328"><a href="#GeoCountry-1328"><span class="linenos">1328</span></a>            <span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="GeoCountry-1329"><a href="#GeoCountry-1329"><span class="linenos">1329</span></a>            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">poi</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="GeoCountry-1330"><a href="#GeoCountry-1330"><span class="linenos">1330</span></a>                <span class="n">g</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">]</span>
</span><span id="GeoCountry-1331"><a href="#GeoCountry-1331"><span class="linenos">1331</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;75&#39;</span><span class="p">,</span><span class="s1">&#39;91&#39;</span><span class="p">,</span><span class="s1">&#39;92&#39;</span><span class="p">,</span><span class="s1">&#39;93&#39;</span><span class="p">,</span><span class="s1">&#39;94&#39;</span><span class="p">,</span><span class="s1">&#39;95&#39;</span><span class="p">,</span><span class="s1">&#39;77&#39;</span><span class="p">,</span><span class="s1">&#39;78&#39;</span><span class="p">]:</span>
</span><span id="GeoCountry-1332"><a href="#GeoCountry-1332"><span class="linenos">1332</span></a>                    <span class="n">g2</span><span class="o">=</span><span class="n">sa</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">sa</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="n">xoff</span><span class="o">=</span><span class="n">idf_translation</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">yoff</span><span class="o">=</span><span class="n">idf_translation</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>\
</span><span id="GeoCountry-1333"><a href="#GeoCountry-1333"><span class="linenos">1333</span></a>                                            <span class="n">xfact</span><span class="o">=</span><span class="n">idf_scale</span><span class="p">,</span><span class="n">yfact</span><span class="o">=</span><span class="n">idf_scale</span><span class="p">,</span><span class="n">origin</span><span class="o">=</span><span class="n">idf_center</span><span class="p">)</span>
</span><span id="GeoCountry-1334"><a href="#GeoCountry-1334"><span class="linenos">1334</span></a>                    <span class="n">g</span><span class="o">=</span><span class="n">g2</span> <span class="c1"># so.unary_union([g,g2]) # uncomment if you want a copy</span>
</span><span id="GeoCountry-1335"><a href="#GeoCountry-1335"><span class="linenos">1335</span></a>                <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</span><span id="GeoCountry-1336"><a href="#GeoCountry-1336"><span class="linenos">1336</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">tmp</span>
</span><span id="GeoCountry-1337"><a href="#GeoCountry-1337"><span class="linenos">1337</span></a>
</span><span id="GeoCountry-1338"><a href="#GeoCountry-1338"><span class="linenos">1338</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_dense_geometry</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="GeoCountry-1339"><a href="#GeoCountry-1339"><span class="linenos">1339</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_main_geometry</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="GeoCountry-1340"><a href="#GeoCountry-1340"><span class="linenos">1340</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_exploded_geometry</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="GeoCountry-1341"><a href="#GeoCountry-1341"><span class="linenos">1341</span></a>
</span><span id="GeoCountry-1342"><a href="#GeoCountry-1342"><span class="linenos">1342</span></a>    <span class="k">def</span> <span class="nf">set_main_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GeoCountry-1343"><a href="#GeoCountry-1343"><span class="linenos">1343</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;  If used, we&#39;re using only for the current country the main</span>
</span><span id="GeoCountry-1344"><a href="#GeoCountry-1344"><span class="linenos">1344</span></a><span class="sd">        geometry for subregions and regions.</span>
</span><span id="GeoCountry-1345"><a href="#GeoCountry-1345"><span class="linenos">1345</span></a><span class="sd">        It&#39;s not possible to go back.</span>
</span><span id="GeoCountry-1346"><a href="#GeoCountry-1346"><span class="linenos">1346</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoCountry-1347"><a href="#GeoCountry-1347"><span class="linenos">1347</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_main_geometry</span><span class="p">():</span>
</span><span id="GeoCountry-1348"><a href="#GeoCountry-1348"><span class="linenos">1348</span></a>            <span class="k">return</span>
</span><span id="GeoCountry-1349"><a href="#GeoCountry-1349"><span class="linenos">1349</span></a>
</span><span id="GeoCountry-1350"><a href="#GeoCountry-1350"><span class="linenos">1350</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dense_geometry</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_exploded_geometry</span><span class="p">():</span>
</span><span id="GeoCountry-1351"><a href="#GeoCountry-1351"><span class="linenos">1351</span></a>            <span class="k">raise</span> <span class="n">CoaError</span><span class="p">(</span><span class="s2">&quot;You already set the dense or exploded geometry. Cannot set the main geometry now.&quot;</span><span class="p">)</span>
</span><span id="GeoCountry-1352"><a href="#GeoCountry-1352"><span class="linenos">1352</span></a>
</span><span id="GeoCountry-1353"><a href="#GeoCountry-1353"><span class="linenos">1353</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;FRA&#39;</span><span class="p">:</span>
</span><span id="GeoCountry-1354"><a href="#GeoCountry-1354"><span class="linenos">1354</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_list_translation</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span>
</span><span id="GeoCountry-1355"><a href="#GeoCountry-1355"><span class="linenos">1355</span></a>            <span class="c1"># Remove COM with main geometry true, too many islands to manage</span>
</span><span id="GeoCountry-1356"><a href="#GeoCountry-1356"><span class="linenos">1356</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">code_subregion</span><span class="o">!=</span><span class="s1">&#39;980&#39;</span><span class="p">]</span>
</span><span id="GeoCountry-1357"><a href="#GeoCountry-1357"><span class="linenos">1357</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;USA&#39;</span><span class="p">:</span>
</span><span id="GeoCountry-1358"><a href="#GeoCountry-1358"><span class="linenos">1358</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_list_translation</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span>
</span><span id="GeoCountry-1359"><a href="#GeoCountry-1359"><span class="linenos">1359</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GeoCountry-1360"><a href="#GeoCountry-1360"><span class="linenos">1360</span></a>            <span class="k">raise</span> <span class="n">CoaError</span><span class="p">(</span><span class="s2">&quot;The current country does not have dense geometry support.&quot;</span><span class="p">)</span>
</span><span id="GeoCountry-1361"><a href="#GeoCountry-1361"><span class="linenos">1361</span></a>
</span><span id="GeoCountry-1362"><a href="#GeoCountry-1362"><span class="linenos">1362</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_country_data_region</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GeoCountry-1363"><a href="#GeoCountry-1363"><span class="linenos">1363</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_country_data_subregion</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GeoCountry-1364"><a href="#GeoCountry-1364"><span class="linenos">1364</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_main_geometry</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="GeoCountry-1365"><a href="#GeoCountry-1365"><span class="linenos">1365</span></a>
</span><span id="GeoCountry-1366"><a href="#GeoCountry-1366"><span class="linenos">1366</span></a>    <span class="k">def</span> <span class="nf">is_dense_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GeoCountry-1367"><a href="#GeoCountry-1367"><span class="linenos">1367</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the self._is_dense_geometry variable</span>
</span><span id="GeoCountry-1368"><a href="#GeoCountry-1368"><span class="linenos">1368</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoCountry-1369"><a href="#GeoCountry-1369"><span class="linenos">1369</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_dense_geometry</span>
</span><span id="GeoCountry-1370"><a href="#GeoCountry-1370"><span class="linenos">1370</span></a>
</span><span id="GeoCountry-1371"><a href="#GeoCountry-1371"><span class="linenos">1371</span></a>    <span class="k">def</span> <span class="nf">is_exploded_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GeoCountry-1372"><a href="#GeoCountry-1372"><span class="linenos">1372</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the self._is_exploded_geometry variable</span>
</span><span id="GeoCountry-1373"><a href="#GeoCountry-1373"><span class="linenos">1373</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoCountry-1374"><a href="#GeoCountry-1374"><span class="linenos">1374</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_exploded_geometry</span>
</span><span id="GeoCountry-1375"><a href="#GeoCountry-1375"><span class="linenos">1375</span></a>
</span><span id="GeoCountry-1376"><a href="#GeoCountry-1376"><span class="linenos">1376</span></a>    <span class="k">def</span> <span class="nf">is_main_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GeoCountry-1377"><a href="#GeoCountry-1377"><span class="linenos">1377</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the self._is_main_geometry variable</span>
</span><span id="GeoCountry-1378"><a href="#GeoCountry-1378"><span class="linenos">1378</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoCountry-1379"><a href="#GeoCountry-1379"><span class="linenos">1379</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_main_geometry</span>
</span><span id="GeoCountry-1380"><a href="#GeoCountry-1380"><span class="linenos">1380</span></a>
</span><span id="GeoCountry-1381"><a href="#GeoCountry-1381"><span class="linenos">1381</span></a>    <span class="k">def</span> <span class="nf">get_source</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GeoCountry-1382"><a href="#GeoCountry-1382"><span class="linenos">1382</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Return informations about URL sources</span>
</span><span id="GeoCountry-1383"><a href="#GeoCountry-1383"><span class="linenos">1383</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoCountry-1384"><a href="#GeoCountry-1384"><span class="linenos">1384</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GeoCountry-1385"><a href="#GeoCountry-1385"><span class="linenos">1385</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()]</span>
</span><span id="GeoCountry-1386"><a href="#GeoCountry-1386"><span class="linenos">1386</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GeoCountry-1387"><a href="#GeoCountry-1387"><span class="linenos">1387</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_dict</span>
</span><span id="GeoCountry-1388"><a href="#GeoCountry-1388"><span class="linenos">1388</span></a>
</span><span id="GeoCountry-1389"><a href="#GeoCountry-1389"><span class="linenos">1389</span></a>    <span class="k">def</span> <span class="nf">get_country</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GeoCountry-1390"><a href="#GeoCountry-1390"><span class="linenos">1390</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Return the current country used.</span>
</span><span id="GeoCountry-1391"><a href="#GeoCountry-1391"><span class="linenos">1391</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoCountry-1392"><a href="#GeoCountry-1392"><span class="linenos">1392</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country</span>
</span><span id="GeoCountry-1393"><a href="#GeoCountry-1393"><span class="linenos">1393</span></a>
</span><span id="GeoCountry-1394"><a href="#GeoCountry-1394"><span class="linenos">1394</span></a>    <span class="k">def</span> <span class="nf">get_list_countries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GeoCountry-1395"><a href="#GeoCountry-1395"><span class="linenos">1395</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; This function returns back the list of supported countries</span>
</span><span id="GeoCountry-1396"><a href="#GeoCountry-1396"><span class="linenos">1396</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoCountry-1397"><a href="#GeoCountry-1397"><span class="linenos">1397</span></a>        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_info_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
</span><span id="GeoCountry-1398"><a href="#GeoCountry-1398"><span class="linenos">1398</span></a>
</span><span id="GeoCountry-1399"><a href="#GeoCountry-1399"><span class="linenos">1399</span></a>    <span class="k">def</span> <span class="nf">is_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GeoCountry-1400"><a href="#GeoCountry-1400"><span class="linenos">1400</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Test if the country is initialized. Return True if it is. False if not.</span>
</span><span id="GeoCountry-1401"><a href="#GeoCountry-1401"><span class="linenos">1401</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoCountry-1402"><a href="#GeoCountry-1402"><span class="linenos">1402</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GeoCountry-1403"><a href="#GeoCountry-1403"><span class="linenos">1403</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="GeoCountry-1404"><a href="#GeoCountry-1404"><span class="linenos">1404</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GeoCountry-1405"><a href="#GeoCountry-1405"><span class="linenos">1405</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="GeoCountry-1406"><a href="#GeoCountry-1406"><span class="linenos">1406</span></a>
</span><span id="GeoCountry-1407"><a href="#GeoCountry-1407"><span class="linenos">1407</span></a>    <span class="k">def</span> <span class="nf">test_is_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GeoCountry-1408"><a href="#GeoCountry-1408"><span class="linenos">1408</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Test if the country is initialized. If not, raise a CoaDbError.</span>
</span><span id="GeoCountry-1409"><a href="#GeoCountry-1409"><span class="linenos">1409</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoCountry-1410"><a href="#GeoCountry-1410"><span class="linenos">1410</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_init</span><span class="p">():</span>
</span><span id="GeoCountry-1411"><a href="#GeoCountry-1411"><span class="linenos">1411</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="GeoCountry-1412"><a href="#GeoCountry-1412"><span class="linenos">1412</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GeoCountry-1413"><a href="#GeoCountry-1413"><span class="linenos">1413</span></a>            <span class="k">raise</span> <span class="n">CoaDbError</span><span class="p">(</span><span class="s2">&quot;The country is not set. Use a constructor with non empty country string.&quot;</span><span class="p">)</span>
</span><span id="GeoCountry-1414"><a href="#GeoCountry-1414"><span class="linenos">1414</span></a>
</span><span id="GeoCountry-1415"><a href="#GeoCountry-1415"><span class="linenos">1415</span></a>    <span class="k">def</span> <span class="nf">get_region_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GeoCountry-1416"><a href="#GeoCountry-1416"><span class="linenos">1416</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Return the list of available regions with code, name and geometry</span>
</span><span id="GeoCountry-1417"><a href="#GeoCountry-1417"><span class="linenos">1417</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoCountry-1418"><a href="#GeoCountry-1418"><span class="linenos">1418</span></a>        <span class="n">cols</span><span class="o">=</span><span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list_properties</span><span class="p">()</span> <span class="k">if</span> <span class="s1">&#39;_region&#39;</span> <span class="ow">in</span> <span class="n">c</span><span class="p">]</span>
</span><span id="GeoCountry-1419"><a href="#GeoCountry-1419"><span class="linenos">1419</span></a>        <span class="n">cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;geometry&#39;</span><span class="p">)</span>
</span><span id="GeoCountry-1420"><a href="#GeoCountry-1420"><span class="linenos">1420</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="kc">True</span><span class="p">)[</span><span class="n">cols</span><span class="p">]</span>
</span><span id="GeoCountry-1421"><a href="#GeoCountry-1421"><span class="linenos">1421</span></a>
</span><span id="GeoCountry-1422"><a href="#GeoCountry-1422"><span class="linenos">1422</span></a>    <span class="k">def</span> <span class="nf">is_region</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">r</span><span class="p">):</span>
</span><span id="GeoCountry-1423"><a href="#GeoCountry-1423"><span class="linenos">1423</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Return False if r is a not a known region, return the correctly capitalized name if ok</span>
</span><span id="GeoCountry-1424"><a href="#GeoCountry-1424"><span class="linenos">1424</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoCountry-1425"><a href="#GeoCountry-1425"><span class="linenos">1425</span></a>        <span class="n">r</span><span class="o">=</span><span class="n">tostdstring</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</span><span id="GeoCountry-1426"><a href="#GeoCountry-1426"><span class="linenos">1426</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_region_list</span><span class="p">()</span><span class="o">.</span><span class="n">name_region</span><span class="o">.</span><span class="n">to_list</span><span class="p">():</span>
</span><span id="GeoCountry-1427"><a href="#GeoCountry-1427"><span class="linenos">1427</span></a>            <span class="k">if</span> <span class="n">tostdstring</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="n">r</span><span class="p">:</span>
</span><span id="GeoCountry-1428"><a href="#GeoCountry-1428"><span class="linenos">1428</span></a>                <span class="k">return</span> <span class="n">i</span>
</span><span id="GeoCountry-1429"><a href="#GeoCountry-1429"><span class="linenos">1429</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="GeoCountry-1430"><a href="#GeoCountry-1430"><span class="linenos">1430</span></a>
</span><span id="GeoCountry-1431"><a href="#GeoCountry-1431"><span class="linenos">1431</span></a>    <span class="k">def</span> <span class="nf">get_subregion_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GeoCountry-1432"><a href="#GeoCountry-1432"><span class="linenos">1432</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Return the list of available subregions with code, name and geometry</span>
</span><span id="GeoCountry-1433"><a href="#GeoCountry-1433"><span class="linenos">1433</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoCountry-1434"><a href="#GeoCountry-1434"><span class="linenos">1434</span></a>        <span class="n">cols</span><span class="o">=</span><span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list_properties</span><span class="p">()</span> <span class="k">if</span> <span class="s1">&#39;_subregion&#39;</span> <span class="ow">in</span> <span class="n">c</span> <span class="p">]</span>
</span><span id="GeoCountry-1435"><a href="#GeoCountry-1435"><span class="linenos">1435</span></a>        <span class="n">cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;geometry&#39;</span><span class="p">)</span>
</span><span id="GeoCountry-1436"><a href="#GeoCountry-1436"><span class="linenos">1436</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">()[</span><span class="n">cols</span><span class="p">]</span>
</span><span id="GeoCountry-1437"><a href="#GeoCountry-1437"><span class="linenos">1437</span></a>
</span><span id="GeoCountry-1438"><a href="#GeoCountry-1438"><span class="linenos">1438</span></a>    <span class="k">def</span> <span class="nf">is_subregion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">r</span><span class="p">):</span>
</span><span id="GeoCountry-1439"><a href="#GeoCountry-1439"><span class="linenos">1439</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Return False if r is a not a known region, return the correctly capitalized name if ok</span>
</span><span id="GeoCountry-1440"><a href="#GeoCountry-1440"><span class="linenos">1440</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoCountry-1441"><a href="#GeoCountry-1441"><span class="linenos">1441</span></a>        <span class="n">r2</span><span class="o">=</span><span class="n">tostdstring</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</span><span id="GeoCountry-1442"><a href="#GeoCountry-1442"><span class="linenos">1442</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_subregion_list</span><span class="p">()</span><span class="o">.</span><span class="n">name_subregion</span><span class="o">.</span><span class="n">to_list</span><span class="p">():</span>
</span><span id="GeoCountry-1443"><a href="#GeoCountry-1443"><span class="linenos">1443</span></a>            <span class="k">if</span> <span class="n">tostdstring</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="n">r2</span><span class="p">:</span>
</span><span id="GeoCountry-1444"><a href="#GeoCountry-1444"><span class="linenos">1444</span></a>                <span class="k">return</span> <span class="n">i</span>
</span><span id="GeoCountry-1445"><a href="#GeoCountry-1445"><span class="linenos">1445</span></a>        <span class="n">a</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_subregion_list</span><span class="p">()[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_subregion_list</span><span class="p">()</span><span class="o">.</span><span class="n">code_subregion</span><span class="o">==</span><span class="n">r</span><span class="p">]</span><span class="o">.</span><span class="n">name_subregion</span><span class="o">.</span><span class="n">values</span>
</span><span id="GeoCountry-1446"><a href="#GeoCountry-1446"><span class="linenos">1446</span></a>        <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="GeoCountry-1447"><a href="#GeoCountry-1447"><span class="linenos">1447</span></a>            <span class="k">return</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GeoCountry-1448"><a href="#GeoCountry-1448"><span class="linenos">1448</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="GeoCountry-1449"><a href="#GeoCountry-1449"><span class="linenos">1449</span></a>
</span><span id="GeoCountry-1450"><a href="#GeoCountry-1450"><span class="linenos">1450</span></a>    <span class="k">def</span> <span class="nf">get_subregions_from_region</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="GeoCountry-1451"><a href="#GeoCountry-1451"><span class="linenos">1451</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Return the list of subregions within a specified region.</span>
</span><span id="GeoCountry-1452"><a href="#GeoCountry-1452"><span class="linenos">1452</span></a><span class="sd">        Should give either the code or the name of the region as strings in kwarg : code=# or name=#</span>
</span><span id="GeoCountry-1453"><a href="#GeoCountry-1453"><span class="linenos">1453</span></a><span class="sd">        Output default is &#39;code&#39; of subregions. Can be changed with output=&#39;name&#39;.</span>
</span><span id="GeoCountry-1454"><a href="#GeoCountry-1454"><span class="linenos">1454</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoCountry-1455"><a href="#GeoCountry-1455"><span class="linenos">1455</span></a>        <span class="n">kwargs_test</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;code&#39;</span><span class="p">,</span><span class="s1">&#39;output&#39;</span><span class="p">],</span><span class="s1">&#39;Should give either name or code of region. Output can be changed with the output option.&#39;</span><span class="p">)</span>
</span><span id="GeoCountry-1456"><a href="#GeoCountry-1456"><span class="linenos">1456</span></a>        <span class="n">code</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
</span><span id="GeoCountry-1457"><a href="#GeoCountry-1457"><span class="linenos">1457</span></a>        <span class="n">name</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
</span><span id="GeoCountry-1458"><a href="#GeoCountry-1458"><span class="linenos">1458</span></a>        <span class="n">out</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">,</span><span class="s1">&#39;code&#39;</span><span class="p">)</span>
</span><span id="GeoCountry-1459"><a href="#GeoCountry-1459"><span class="linenos">1459</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">code</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span> <span class="o">^</span> <span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="GeoCountry-1460"><a href="#GeoCountry-1460"><span class="linenos">1460</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s2">&quot;Should give either code or name of region, not both.&quot;</span><span class="p">)</span>
</span><span id="GeoCountry-1461"><a href="#GeoCountry-1461"><span class="linenos">1461</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">out</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span>
</span><span id="GeoCountry-1462"><a href="#GeoCountry-1462"><span class="linenos">1462</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s2">&quot;Should set output either as &#39;code&#39; or &#39;name&#39; for subregions.&quot;</span><span class="p">)</span>
</span><span id="GeoCountry-1463"><a href="#GeoCountry-1463"><span class="linenos">1463</span></a>
</span><span id="GeoCountry-1464"><a href="#GeoCountry-1464"><span class="linenos">1464</span></a>        <span class="k">if</span> <span class="n">name</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GeoCountry-1465"><a href="#GeoCountry-1465"><span class="linenos">1465</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
</span><span id="GeoCountry-1466"><a href="#GeoCountry-1466"><span class="linenos">1466</span></a>                <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s2">&quot;Name should be given as string.&quot;</span><span class="p">)</span>
</span><span id="GeoCountry-1467"><a href="#GeoCountry-1467"><span class="linenos">1467</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_region_list</span><span class="p">()[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">():</span>
</span><span id="GeoCountry-1468"><a href="#GeoCountry-1468"><span class="linenos">1468</span></a>                <span class="k">raise</span> <span class="n">CoaWhereError</span> <span class="p">(</span><span class="s2">&quot;The region &quot;</span><span class="o">+</span><span class="n">name</span><span class="o">+</span><span class="s2">&quot; does not exist for country &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()</span><span class="o">+</span><span class="s2">&quot;. See get_region_list().&quot;</span><span class="p">)</span>
</span><span id="GeoCountry-1469"><a href="#GeoCountry-1469"><span class="linenos">1469</span></a>            <span class="n">cut</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="kc">True</span><span class="p">)[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">name</span><span class="p">)</span>
</span><span id="GeoCountry-1470"><a href="#GeoCountry-1470"><span class="linenos">1470</span></a>
</span><span id="GeoCountry-1471"><a href="#GeoCountry-1471"><span class="linenos">1471</span></a>        <span class="k">if</span> <span class="n">code</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GeoCountry-1472"><a href="#GeoCountry-1472"><span class="linenos">1472</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">code</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
</span><span id="GeoCountry-1473"><a href="#GeoCountry-1473"><span class="linenos">1473</span></a>                <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s2">&quot;Name should be given as string.&quot;</span><span class="p">)</span>
</span><span id="GeoCountry-1474"><a href="#GeoCountry-1474"><span class="linenos">1474</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">code</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_region_list</span><span class="p">()[</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">():</span>
</span><span id="GeoCountry-1475"><a href="#GeoCountry-1475"><span class="linenos">1475</span></a>                <span class="k">raise</span> <span class="n">CoaWhereError</span><span class="p">(</span><span class="s2">&quot;The region &quot;</span><span class="o">+</span><span class="n">code</span><span class="o">+</span><span class="s2">&quot; does not exist for country &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()</span><span class="o">+</span><span class="s2">&quot;. See get_region_list().&quot;</span><span class="p">)</span>
</span><span id="GeoCountry-1476"><a href="#GeoCountry-1476"><span class="linenos">1476</span></a>            <span class="n">cut</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="kc">True</span><span class="p">)[</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">code</span><span class="p">)</span>
</span><span id="GeoCountry-1477"><a href="#GeoCountry-1477"><span class="linenos">1477</span></a>
</span><span id="GeoCountry-1478"><a href="#GeoCountry-1478"><span class="linenos">1478</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="kc">True</span><span class="p">)[</span><span class="n">cut</span><span class="p">][</span><span class="n">out</span><span class="o">+</span><span class="s1">&#39;_subregion&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="c1">#to_list()</span>
</span><span id="GeoCountry-1479"><a href="#GeoCountry-1479"><span class="linenos">1479</span></a>
</span><span id="GeoCountry-1480"><a href="#GeoCountry-1480"><span class="linenos">1480</span></a>    <span class="k">def</span> <span class="nf">get_subregions_from_list_of_region_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;code&#39;</span><span class="p">):</span>
</span><span id="GeoCountry-1481"><a href="#GeoCountry-1481"><span class="linenos">1481</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Return the list of subregions according to list of region names given.</span>
</span><span id="GeoCountry-1482"><a href="#GeoCountry-1482"><span class="linenos">1482</span></a><span class="sd">        The output argument (&#39;code&#39; as default) is given to the get_subregions_from_region function.</span>
</span><span id="GeoCountry-1483"><a href="#GeoCountry-1483"><span class="linenos">1483</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoCountry-1484"><a href="#GeoCountry-1484"><span class="linenos">1484</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
</span><span id="GeoCountry-1485"><a href="#GeoCountry-1485"><span class="linenos">1485</span></a>            <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s2">&quot;Should provide list as argument&quot;</span><span class="p">)</span>
</span><span id="GeoCountry-1486"><a href="#GeoCountry-1486"><span class="linenos">1486</span></a>        <span class="n">s</span><span class="o">=</span><span class="p">[]</span>
</span><span id="GeoCountry-1487"><a href="#GeoCountry-1487"><span class="linenos">1487</span></a>        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
</span><span id="GeoCountry-1488"><a href="#GeoCountry-1488"><span class="linenos">1488</span></a>            <span class="n">s</span><span class="o">=</span><span class="n">s</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">get_subregions_from_region</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">r</span><span class="p">,</span><span class="n">output</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
</span><span id="GeoCountry-1489"><a href="#GeoCountry-1489"><span class="linenos">1489</span></a>        <span class="k">return</span> <span class="n">s</span>
</span><span id="GeoCountry-1490"><a href="#GeoCountry-1490"><span class="linenos">1490</span></a>
</span><span id="GeoCountry-1491"><a href="#GeoCountry-1491"><span class="linenos">1491</span></a>    <span class="k">def</span> <span class="nf">get_regions_from_subregion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">code</span><span class="p">,</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;code&#39;</span><span class="p">):</span>
</span><span id="GeoCountry-1492"><a href="#GeoCountry-1492"><span class="linenos">1492</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Return the list of regions where the subregion, given by a code, is.</span>
</span><span id="GeoCountry-1493"><a href="#GeoCountry-1493"><span class="linenos">1493</span></a><span class="sd">        Output default is &#39;code&#39; of subregions. Can be changer with output=&#39;name&#39;.</span>
</span><span id="GeoCountry-1494"><a href="#GeoCountry-1494"><span class="linenos">1494</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoCountry-1495"><a href="#GeoCountry-1495"><span class="linenos">1495</span></a>
</span><span id="GeoCountry-1496"><a href="#GeoCountry-1496"><span class="linenos">1496</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">output</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span>
</span><span id="GeoCountry-1497"><a href="#GeoCountry-1497"><span class="linenos">1497</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;The output option should be &quot;code&quot; or &quot;name&quot; only&#39;</span><span class="p">)</span>
</span><span id="GeoCountry-1498"><a href="#GeoCountry-1498"><span class="linenos">1498</span></a>
</span><span id="GeoCountry-1499"><a href="#GeoCountry-1499"><span class="linenos">1499</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">code</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_subregion_list</span><span class="p">()[</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">():</span>
</span><span id="GeoCountry-1500"><a href="#GeoCountry-1500"><span class="linenos">1500</span></a>            <span class="k">raise</span> <span class="n">CoaWhereError</span><span class="p">(</span><span class="s2">&quot;The subregion &quot;</span><span class="o">+</span><span class="n">code</span><span class="o">+</span><span class="s2">&quot; does not exist for country &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()</span><span class="o">+</span><span class="s2">&quot;. See get_subregion_list().&quot;</span><span class="p">)</span>
</span><span id="GeoCountry-1501"><a href="#GeoCountry-1501"><span class="linenos">1501</span></a>
</span><span id="GeoCountry-1502"><a href="#GeoCountry-1502"><span class="linenos">1502</span></a>        <span class="n">l</span><span class="o">=</span><span class="p">[]</span>
</span><span id="GeoCountry-1503"><a href="#GeoCountry-1503"><span class="linenos">1503</span></a>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="GeoCountry-1504"><a href="#GeoCountry-1504"><span class="linenos">1504</span></a>            <span class="k">if</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">code_subregion</span><span class="p">:</span>
</span><span id="GeoCountry-1505"><a href="#GeoCountry-1505"><span class="linenos">1505</span></a>                <span class="k">if</span> <span class="n">output</span> <span class="o">==</span> <span class="s1">&#39;code&#39;</span><span class="p">:</span>
</span><span id="GeoCountry-1506"><a href="#GeoCountry-1506"><span class="linenos">1506</span></a>                    <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">code_region</span><span class="p">)</span>
</span><span id="GeoCountry-1507"><a href="#GeoCountry-1507"><span class="linenos">1507</span></a>                <span class="k">else</span><span class="p">:</span> <span class="c1"># due to first test, that&#39;s for sure name</span>
</span><span id="GeoCountry-1508"><a href="#GeoCountry-1508"><span class="linenos">1508</span></a>                    <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">name_region</span><span class="p">)</span>
</span><span id="GeoCountry-1509"><a href="#GeoCountry-1509"><span class="linenos">1509</span></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">l</span><span class="p">))</span>
</span><span id="GeoCountry-1510"><a href="#GeoCountry-1510"><span class="linenos">1510</span></a>
</span><span id="GeoCountry-1511"><a href="#GeoCountry-1511"><span class="linenos">1511</span></a>    <span class="k">def</span> <span class="nf">get_regions_from_list_of_subregion_codes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;code&#39;</span><span class="p">):</span>
</span><span id="GeoCountry-1512"><a href="#GeoCountry-1512"><span class="linenos">1512</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Return the list of regions according to list of subregion names given.</span>
</span><span id="GeoCountry-1513"><a href="#GeoCountry-1513"><span class="linenos">1513</span></a><span class="sd">        The output argument (&#39;code&#39; as default) is given to the get_regions_from_subregion function.</span>
</span><span id="GeoCountry-1514"><a href="#GeoCountry-1514"><span class="linenos">1514</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoCountry-1515"><a href="#GeoCountry-1515"><span class="linenos">1515</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
</span><span id="GeoCountry-1516"><a href="#GeoCountry-1516"><span class="linenos">1516</span></a>            <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s2">&quot;Should provide list as argument&quot;</span><span class="p">)</span>
</span><span id="GeoCountry-1517"><a href="#GeoCountry-1517"><span class="linenos">1517</span></a>        <span class="n">s</span><span class="o">=</span><span class="p">[]</span>
</span><span id="GeoCountry-1518"><a href="#GeoCountry-1518"><span class="linenos">1518</span></a>        <span class="k">for</span> <span class="n">sr</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
</span><span id="GeoCountry-1519"><a href="#GeoCountry-1519"><span class="linenos">1519</span></a>            <span class="n">s</span><span class="o">=</span><span class="n">s</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">get_regions_from_subregion</span><span class="p">(</span><span class="n">sr</span><span class="p">,</span><span class="n">output</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
</span><span id="GeoCountry-1520"><a href="#GeoCountry-1520"><span class="linenos">1520</span></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
</span><span id="GeoCountry-1521"><a href="#GeoCountry-1521"><span class="linenos">1521</span></a>
</span><span id="GeoCountry-1522"><a href="#GeoCountry-1522"><span class="linenos">1522</span></a>    <span class="k">def</span> <span class="nf">get_regions_from_macroregion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="GeoCountry-1523"><a href="#GeoCountry-1523"><span class="linenos">1523</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Return the list of regions included in another macroregion</span>
</span><span id="GeoCountry-1524"><a href="#GeoCountry-1524"><span class="linenos">1524</span></a><span class="sd">        Can provide input as code= or name=</span>
</span><span id="GeoCountry-1525"><a href="#GeoCountry-1525"><span class="linenos">1525</span></a><span class="sd">        Can provide output as &#39;name&#39; or &#39;code&#39; (default).</span>
</span><span id="GeoCountry-1526"><a href="#GeoCountry-1526"><span class="linenos">1526</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoCountry-1527"><a href="#GeoCountry-1527"><span class="linenos">1527</span></a>        <span class="n">kwargs_test</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;code&#39;</span><span class="p">,</span><span class="s1">&#39;output&#39;</span><span class="p">],</span><span class="s1">&#39;Should give either name or code of region. Output can be changed with the output option.&#39;</span><span class="p">)</span>
</span><span id="GeoCountry-1528"><a href="#GeoCountry-1528"><span class="linenos">1528</span></a>        <span class="n">code</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
</span><span id="GeoCountry-1529"><a href="#GeoCountry-1529"><span class="linenos">1529</span></a>        <span class="n">name</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
</span><span id="GeoCountry-1530"><a href="#GeoCountry-1530"><span class="linenos">1530</span></a>        <span class="n">out</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">,</span><span class="s1">&#39;code&#39;</span><span class="p">)</span>
</span><span id="GeoCountry-1531"><a href="#GeoCountry-1531"><span class="linenos">1531</span></a>
</span><span id="GeoCountry-1532"><a href="#GeoCountry-1532"><span class="linenos">1532</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">code</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span> <span class="o">^</span> <span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="GeoCountry-1533"><a href="#GeoCountry-1533"><span class="linenos">1533</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s2">&quot;Should give either code or name of region, not both.&quot;</span><span class="p">)</span>
</span><span id="GeoCountry-1534"><a href="#GeoCountry-1534"><span class="linenos">1534</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">out</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span>
</span><span id="GeoCountry-1535"><a href="#GeoCountry-1535"><span class="linenos">1535</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s2">&quot;Should set output either as &#39;code&#39; or &#39;name&#39; for subregions.&quot;</span><span class="p">)</span>
</span><span id="GeoCountry-1536"><a href="#GeoCountry-1536"><span class="linenos">1536</span></a>
</span><span id="GeoCountry-1537"><a href="#GeoCountry-1537"><span class="linenos">1537</span></a>        <span class="n">dict_input</span><span class="o">=</span><span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">]}</span>
</span><span id="GeoCountry-1538"><a href="#GeoCountry-1538"><span class="linenos">1538</span></a>        <span class="n">r_out</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_regions_from_list_of_subregion_codes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_subregions_from_region</span><span class="p">(</span><span class="o">**</span><span class="n">dict_input</span><span class="p">),</span><span class="n">output</span><span class="o">=</span><span class="n">out</span><span class="p">)</span>
</span><span id="GeoCountry-1539"><a href="#GeoCountry-1539"><span class="linenos">1539</span></a>
</span><span id="GeoCountry-1540"><a href="#GeoCountry-1540"><span class="linenos">1540</span></a>        <span class="c1"># remove the input</span>
</span><span id="GeoCountry-1541"><a href="#GeoCountry-1541"><span class="linenos">1541</span></a>        <span class="n">rl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_region_list</span><span class="p">()</span>
</span><span id="GeoCountry-1542"><a href="#GeoCountry-1542"><span class="linenos">1542</span></a>        <span class="k">if</span> <span class="n">code</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GeoCountry-1543"><a href="#GeoCountry-1543"><span class="linenos">1543</span></a>            <span class="k">if</span> <span class="n">out</span><span class="o">==</span><span class="s1">&#39;code&#39;</span><span class="p">:</span>
</span><span id="GeoCountry-1544"><a href="#GeoCountry-1544"><span class="linenos">1544</span></a>                <span class="nb">input</span><span class="o">=</span><span class="n">rl</span><span class="p">[</span><span class="n">rl</span><span class="o">.</span><span class="n">code_region</span><span class="o">==</span><span class="n">code</span><span class="p">]</span><span class="o">.</span><span class="n">name_region</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span><span id="GeoCountry-1545"><a href="#GeoCountry-1545"><span class="linenos">1545</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="GeoCountry-1546"><a href="#GeoCountry-1546"><span class="linenos">1546</span></a>                <span class="nb">input</span><span class="o">=</span><span class="n">code</span>
</span><span id="GeoCountry-1547"><a href="#GeoCountry-1547"><span class="linenos">1547</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GeoCountry-1548"><a href="#GeoCountry-1548"><span class="linenos">1548</span></a>            <span class="k">if</span> <span class="n">out</span><span class="o">==</span><span class="s1">&#39;name&#39;</span><span class="p">:</span>
</span><span id="GeoCountry-1549"><a href="#GeoCountry-1549"><span class="linenos">1549</span></a>                <span class="nb">input</span><span class="o">=</span><span class="n">name</span>
</span><span id="GeoCountry-1550"><a href="#GeoCountry-1550"><span class="linenos">1550</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="GeoCountry-1551"><a href="#GeoCountry-1551"><span class="linenos">1551</span></a>                <span class="nb">input</span><span class="o">=</span><span class="n">rl</span><span class="p">[</span><span class="n">rl</span><span class="o">.</span><span class="n">name_region</span><span class="o">==</span><span class="n">code</span><span class="p">]</span><span class="o">.</span><span class="n">code_region</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span><span id="GeoCountry-1552"><a href="#GeoCountry-1552"><span class="linenos">1552</span></a>
</span><span id="GeoCountry-1553"><a href="#GeoCountry-1553"><span class="linenos">1553</span></a>        <span class="k">if</span> <span class="nb">input</span> <span class="ow">in</span> <span class="n">r_out</span><span class="p">:</span>
</span><span id="GeoCountry-1554"><a href="#GeoCountry-1554"><span class="linenos">1554</span></a>            <span class="n">r_out</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
</span><span id="GeoCountry-1555"><a href="#GeoCountry-1555"><span class="linenos">1555</span></a>
</span><span id="GeoCountry-1556"><a href="#GeoCountry-1556"><span class="linenos">1556</span></a>        <span class="c1"># Append the input in the right position, the macro region should be at the end</span>
</span><span id="GeoCountry-1557"><a href="#GeoCountry-1557"><span class="linenos">1557</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">r_out</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># the input is not a macro region but just a region</span>
</span><span id="GeoCountry-1558"><a href="#GeoCountry-1558"><span class="linenos">1558</span></a>            <span class="n">r_out</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">input</span><span class="p">)</span>
</span><span id="GeoCountry-1559"><a href="#GeoCountry-1559"><span class="linenos">1559</span></a>        <span class="k">else</span><span class="p">:</span> <span class="c1"># the input is a real macro region</span>
</span><span id="GeoCountry-1560"><a href="#GeoCountry-1560"><span class="linenos">1560</span></a>            <span class="n">r_out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
</span><span id="GeoCountry-1561"><a href="#GeoCountry-1561"><span class="linenos">1561</span></a>
</span><span id="GeoCountry-1562"><a href="#GeoCountry-1562"><span class="linenos">1562</span></a>        <span class="k">return</span> <span class="n">r_out</span>
</span><span id="GeoCountry-1563"><a href="#GeoCountry-1563"><span class="linenos">1563</span></a>
</span><span id="GeoCountry-1564"><a href="#GeoCountry-1564"><span class="linenos">1564</span></a>    <span class="k">def</span> <span class="nf">get_list_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GeoCountry-1565"><a href="#GeoCountry-1565"><span class="linenos">1565</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the list of available properties for the current country</span>
</span><span id="GeoCountry-1566"><a href="#GeoCountry-1566"><span class="linenos">1566</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoCountry-1567"><a href="#GeoCountry-1567"><span class="linenos">1567</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_is_init</span><span class="p">():</span>
</span><span id="GeoCountry-1568"><a href="#GeoCountry-1568"><span class="linenos">1568</span></a>            <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span>
</span><span id="GeoCountry-1569"><a href="#GeoCountry-1569"><span class="linenos">1569</span></a>
</span><span id="GeoCountry-1570"><a href="#GeoCountry-1570"><span class="linenos">1570</span></a>    <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">region_version</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="GeoCountry-1571"><a href="#GeoCountry-1571"><span class="linenos">1571</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the whole geopandas data.</span>
</span><span id="GeoCountry-1572"><a href="#GeoCountry-1572"><span class="linenos">1572</span></a><span class="sd">        If region_version = True (not default), the pandas output is region based focalized.</span>
</span><span id="GeoCountry-1573"><a href="#GeoCountry-1573"><span class="linenos">1573</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoCountry-1574"><a href="#GeoCountry-1574"><span class="linenos">1574</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_is_init</span><span class="p">():</span>
</span><span id="GeoCountry-1575"><a href="#GeoCountry-1575"><span class="linenos">1575</span></a>            <span class="k">if</span> <span class="n">region_version</span><span class="p">:</span>
</span><span id="GeoCountry-1576"><a href="#GeoCountry-1576"><span class="linenos">1576</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data_region</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span> <span class="c1"># i.e. is None</span>
</span><span id="GeoCountry-1577"><a href="#GeoCountry-1577"><span class="linenos">1577</span></a>                    <span class="n">col_reg</span><span class="o">=</span><span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">if</span> <span class="s1">&#39;_region&#39;</span> <span class="ow">in</span> <span class="n">c</span><span class="p">]</span>
</span><span id="GeoCountry-1578"><a href="#GeoCountry-1578"><span class="linenos">1578</span></a>                    <span class="n">col</span><span class="o">=</span><span class="n">col_reg</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="GeoCountry-1579"><a href="#GeoCountry-1579"><span class="linenos">1579</span></a>                    <span class="n">col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;geometry&#39;</span><span class="p">)</span> <span class="c1"># to merge the geometry of subregions</span>
</span><span id="GeoCountry-1580"><a href="#GeoCountry-1580"><span class="linenos">1580</span></a>                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list_properties</span><span class="p">():</span>
</span><span id="GeoCountry-1581"><a href="#GeoCountry-1581"><span class="linenos">1581</span></a>                        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;_subregion&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">)</span> <span class="ow">and</span> <span class="n">pd</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_numeric_dtype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="n">p</span><span class="p">]):</span>
</span><span id="GeoCountry-1582"><a href="#GeoCountry-1582"><span class="linenos">1582</span></a>                            <span class="n">col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span><span id="GeoCountry-1583"><a href="#GeoCountry-1583"><span class="linenos">1583</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;code_subregion&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
</span><span id="GeoCountry-1584"><a href="#GeoCountry-1584"><span class="linenos">1584</span></a>                        <span class="n">col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">)</span> <span class="c1"># to get the list of subregion in region</span>
</span><span id="GeoCountry-1585"><a href="#GeoCountry-1585"><span class="linenos">1585</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;name_subregion&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
</span><span id="GeoCountry-1586"><a href="#GeoCountry-1586"><span class="linenos">1586</span></a>                        <span class="n">col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">)</span> <span class="c1"># to get the list of subregion name in region</span>
</span><span id="GeoCountry-1587"><a href="#GeoCountry-1587"><span class="linenos">1587</span></a>
</span><span id="GeoCountry-1588"><a href="#GeoCountry-1588"><span class="linenos">1588</span></a>                    <span class="n">pr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="GeoCountry-1589"><a href="#GeoCountry-1589"><span class="linenos">1589</span></a>
</span><span id="GeoCountry-1590"><a href="#GeoCountry-1590"><span class="linenos">1590</span></a>                    <span class="c1"># Country specific management</span>
</span><span id="GeoCountry-1591"><a href="#GeoCountry-1591"><span class="linenos">1591</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;FRA&#39;</span><span class="p">:</span> <span class="c1"># manage pseudo &#39;FRA&#39; regions &#39;Métropole&#39; and &#39;Outre-mer&#39;</span>
</span><span id="GeoCountry-1592"><a href="#GeoCountry-1592"><span class="linenos">1592</span></a>                        <span class="n">metropole_cut</span><span class="o">=</span><span class="n">pr</span><span class="o">.</span><span class="n">code_region</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">10</span>
</span><span id="GeoCountry-1593"><a href="#GeoCountry-1593"><span class="linenos">1593</span></a>                        <span class="n">pr_metropole</span><span class="o">=</span><span class="n">pr</span><span class="p">[</span><span class="n">metropole_cut</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="GeoCountry-1594"><a href="#GeoCountry-1594"><span class="linenos">1594</span></a>                        <span class="n">pr_metropole</span><span class="p">[</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;999&#39;</span>
</span><span id="GeoCountry-1595"><a href="#GeoCountry-1595"><span class="linenos">1595</span></a>                        <span class="n">pr_metropole</span><span class="p">[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;Métropole&#39;</span>
</span><span id="GeoCountry-1596"><a href="#GeoCountry-1596"><span class="linenos">1596</span></a>                        <span class="n">pr_metropole</span><span class="p">[</span><span class="s1">&#39;flag_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
</span><span id="GeoCountry-1597"><a href="#GeoCountry-1597"><span class="linenos">1597</span></a>                        <span class="n">pr_outremer</span><span class="o">=</span><span class="n">pr</span><span class="p">[</span><span class="o">~</span><span class="n">metropole_cut</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="GeoCountry-1598"><a href="#GeoCountry-1598"><span class="linenos">1598</span></a>                        <span class="n">pr_outremer</span><span class="p">[</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;000&#39;</span>
</span><span id="GeoCountry-1599"><a href="#GeoCountry-1599"><span class="linenos">1599</span></a>                        <span class="n">pr_outremer</span><span class="p">[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;Outre-mer&#39;</span>
</span><span id="GeoCountry-1600"><a href="#GeoCountry-1600"><span class="linenos">1600</span></a>                        <span class="n">pr_outremer</span><span class="p">[</span><span class="s1">&#39;flag_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
</span><span id="GeoCountry-1601"><a href="#GeoCountry-1601"><span class="linenos">1601</span></a>
</span><span id="GeoCountry-1602"><a href="#GeoCountry-1602"><span class="linenos">1602</span></a>                        <span class="n">pr</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pr</span><span class="p">,</span><span class="n">pr_metropole</span><span class="p">],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry-1603"><a href="#GeoCountry-1603"><span class="linenos">1603</span></a>                        <span class="n">pr</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pr</span><span class="p">,</span><span class="n">pr_outremer</span><span class="p">],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry-1604"><a href="#GeoCountry-1604"><span class="linenos">1604</span></a>                        <span class="c1">#pr=pr.append(pr_metropole,ignore_index=True).append(pr_outremer,ignore_index=True)</span>
</span><span id="GeoCountry-1605"><a href="#GeoCountry-1605"><span class="linenos">1605</span></a>
</span><span id="GeoCountry-1606"><a href="#GeoCountry-1606"><span class="linenos">1606</span></a>                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;ESP&#39;</span> <span class="p">:</span> <span class="c1"># manage pseudo &#39;ESP&#39; regions within and outside continent</span>
</span><span id="GeoCountry-1607"><a href="#GeoCountry-1607"><span class="linenos">1607</span></a>                        <span class="n">islands_cut</span><span class="o">=</span><span class="n">pr</span><span class="o">.</span><span class="n">code_region</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;05&#39;</span><span class="p">])</span>
</span><span id="GeoCountry-1608"><a href="#GeoCountry-1608"><span class="linenos">1608</span></a>                        <span class="n">pr_metropole</span><span class="o">=</span><span class="n">pr</span><span class="p">[</span><span class="o">~</span><span class="n">islands_cut</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="GeoCountry-1609"><a href="#GeoCountry-1609"><span class="linenos">1609</span></a>                        <span class="n">pr_metropole</span><span class="p">[</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;99&#39;</span>
</span><span id="GeoCountry-1610"><a href="#GeoCountry-1610"><span class="linenos">1610</span></a>                        <span class="n">pr_metropole</span><span class="p">[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;España peninsular&#39;</span>
</span><span id="GeoCountry-1611"><a href="#GeoCountry-1611"><span class="linenos">1611</span></a>                        <span class="n">pr_metropole</span><span class="p">[</span><span class="s1">&#39;flag_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
</span><span id="GeoCountry-1612"><a href="#GeoCountry-1612"><span class="linenos">1612</span></a>
</span><span id="GeoCountry-1613"><a href="#GeoCountry-1613"><span class="linenos">1613</span></a>                        <span class="n">pr_outremer</span><span class="o">=</span><span class="n">pr</span><span class="p">[</span><span class="n">islands_cut</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="GeoCountry-1614"><a href="#GeoCountry-1614"><span class="linenos">1614</span></a>                        <span class="n">pr_outremer</span><span class="p">[</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;00&#39;</span>
</span><span id="GeoCountry-1615"><a href="#GeoCountry-1615"><span class="linenos">1615</span></a>                        <span class="n">pr_outremer</span><span class="p">[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;Islas españolas&#39;</span>
</span><span id="GeoCountry-1616"><a href="#GeoCountry-1616"><span class="linenos">1616</span></a>                        <span class="n">pr_outremer</span><span class="p">[</span><span class="s1">&#39;flag_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
</span><span id="GeoCountry-1617"><a href="#GeoCountry-1617"><span class="linenos">1617</span></a>
</span><span id="GeoCountry-1618"><a href="#GeoCountry-1618"><span class="linenos">1618</span></a>                        <span class="n">pr</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pr</span><span class="p">,</span><span class="n">pr_metropole</span><span class="p">,</span><span class="n">pr_outremer</span><span class="p">],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry-1619"><a href="#GeoCountry-1619"><span class="linenos">1619</span></a>
</span><span id="GeoCountry-1620"><a href="#GeoCountry-1620"><span class="linenos">1620</span></a>                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;PRT&#39;</span> <span class="p">:</span> <span class="c1"># manage pseudo &#39;PRT&#39; regions within and outside continent</span>
</span><span id="GeoCountry-1621"><a href="#GeoCountry-1621"><span class="linenos">1621</span></a>                        <span class="n">islands_cut</span><span class="o">=</span><span class="n">pr</span><span class="o">.</span><span class="n">code_region</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;PT.AC&#39;</span><span class="p">,</span><span class="s1">&#39;PT.MA&#39;</span><span class="p">])</span>
</span><span id="GeoCountry-1622"><a href="#GeoCountry-1622"><span class="linenos">1622</span></a>                        <span class="n">pr_metropole</span><span class="o">=</span><span class="n">pr</span><span class="p">[</span><span class="o">~</span><span class="n">islands_cut</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="GeoCountry-1623"><a href="#GeoCountry-1623"><span class="linenos">1623</span></a>                        <span class="n">pr_metropole</span><span class="p">[</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;PT.99&#39;</span>
</span><span id="GeoCountry-1624"><a href="#GeoCountry-1624"><span class="linenos">1624</span></a>                        <span class="n">pr_metropole</span><span class="p">[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;Portugal continental&#39;</span>
</span><span id="GeoCountry-1625"><a href="#GeoCountry-1625"><span class="linenos">1625</span></a>                        <span class="n">pr_metropole</span><span class="p">[</span><span class="s1">&#39;flag_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
</span><span id="GeoCountry-1626"><a href="#GeoCountry-1626"><span class="linenos">1626</span></a>
</span><span id="GeoCountry-1627"><a href="#GeoCountry-1627"><span class="linenos">1627</span></a>                        <span class="n">pr_outremer</span><span class="o">=</span><span class="n">pr</span><span class="p">[</span><span class="n">islands_cut</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="GeoCountry-1628"><a href="#GeoCountry-1628"><span class="linenos">1628</span></a>                        <span class="n">pr_outremer</span><span class="p">[</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;PT.00&#39;</span>
</span><span id="GeoCountry-1629"><a href="#GeoCountry-1629"><span class="linenos">1629</span></a>                        <span class="n">pr_outremer</span><span class="p">[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;Ilhas portuguesas&#39;</span>
</span><span id="GeoCountry-1630"><a href="#GeoCountry-1630"><span class="linenos">1630</span></a>                        <span class="n">pr_outremer</span><span class="p">[</span><span class="s1">&#39;flag_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
</span><span id="GeoCountry-1631"><a href="#GeoCountry-1631"><span class="linenos">1631</span></a>
</span><span id="GeoCountry-1632"><a href="#GeoCountry-1632"><span class="linenos">1632</span></a>                        <span class="n">pr</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pr</span><span class="p">,</span><span class="n">pr_metropole</span><span class="p">],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry-1633"><a href="#GeoCountry-1633"><span class="linenos">1633</span></a>                        <span class="n">pr</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pr</span><span class="p">,</span><span class="n">pr_outremer</span><span class="p">],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry-1634"><a href="#GeoCountry-1634"><span class="linenos">1634</span></a>                        <span class="c1">#pr=pr.append(pr_metropole,ignore_index=True).append(pr_outremer,ignore_index=True)</span>
</span><span id="GeoCountry-1635"><a href="#GeoCountry-1635"><span class="linenos">1635</span></a>
</span><span id="GeoCountry-1636"><a href="#GeoCountry-1636"><span class="linenos">1636</span></a>                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;USA&#39;</span><span class="p">:</span>
</span><span id="GeoCountry-1637"><a href="#GeoCountry-1637"><span class="linenos">1637</span></a>                        <span class="n">usa_col</span><span class="o">=</span><span class="n">pr</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="GeoCountry-1638"><a href="#GeoCountry-1638"><span class="linenos">1638</span></a>                        <span class="c1">#usa_col.remove(&#39;_subregion&#39;) # Remove numeric column, if not, the dissolve does not work properly</span>
</span><span id="GeoCountry-1639"><a href="#GeoCountry-1639"><span class="linenos">1639</span></a>                        <span class="c1">#usa_col.remove(&#39;area_subregion&#39;) # idem</span>
</span><span id="GeoCountry-1640"><a href="#GeoCountry-1640"><span class="linenos">1640</span></a>                        <span class="n">pr</span><span class="o">=</span><span class="n">pr</span><span class="p">[</span><span class="n">usa_col</span><span class="p">]</span>
</span><span id="GeoCountry-1641"><a href="#GeoCountry-1641"><span class="linenos">1641</span></a>
</span><span id="GeoCountry-1642"><a href="#GeoCountry-1642"><span class="linenos">1642</span></a>                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;EUR&#39;</span><span class="p">:</span>
</span><span id="GeoCountry-1643"><a href="#GeoCountry-1643"><span class="linenos">1643</span></a>                        <span class="n">pr</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pr</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">isnull</span><span class="p">(),</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sg</span><span class="o">.</span><span class="n">Point</span><span class="p">()</span>  <span class="c1"># For correct geometry merge</span>
</span><span id="GeoCountry-1644"><a href="#GeoCountry-1644"><span class="linenos">1644</span></a>                        <span class="n">pr</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pr</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span> <span class="c1"># needed with geopandas 0.10.2&#39; for EUR data only (apparently)</span>
</span><span id="GeoCountry-1645"><a href="#GeoCountry-1645"><span class="linenos">1645</span></a>
</span><span id="GeoCountry-1646"><a href="#GeoCountry-1646"><span class="linenos">1646</span></a>                    <span class="n">pr</span><span class="p">[</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">pr</span><span class="o">.</span><span class="n">code_subregion</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span><span class="n">x</span><span class="p">])</span>
</span><span id="GeoCountry-1647"><a href="#GeoCountry-1647"><span class="linenos">1647</span></a>                    <span class="n">pr</span><span class="p">[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">pr</span><span class="o">.</span><span class="n">name_subregion</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span><span class="n">x</span><span class="p">])</span>
</span><span id="GeoCountry-1648"><a href="#GeoCountry-1648"><span class="linenos">1648</span></a>
</span><span id="GeoCountry-1649"><a href="#GeoCountry-1649"><span class="linenos">1649</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_country_data_region</span><span class="o">=</span><span class="n">pr</span><span class="o">.</span><span class="n">dissolve</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="n">col_reg</span><span class="p">,</span><span class="n">aggfunc</span><span class="o">=</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">()))</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;code_region&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="GeoCountry-1650"><a href="#GeoCountry-1650"><span class="linenos">1650</span></a>                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;population&#39;</span><span class="p">,</span><span class="s1">&#39;area&#39;</span><span class="p">]:</span>
</span><span id="GeoCountry-1651"><a href="#GeoCountry-1651"><span class="linenos">1651</span></a>                        <span class="k">if</span> <span class="n">x</span><span class="o">+</span><span class="s1">&#39;_subregion&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data_region</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="GeoCountry-1652"><a href="#GeoCountry-1652"><span class="linenos">1652</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data_region</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">x</span><span class="o">+</span><span class="s1">&#39;_subregion&#39;</span><span class="p">:</span><span class="n">x</span><span class="o">+</span><span class="s1">&#39;_region&#39;</span><span class="p">},</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry-1653"><a href="#GeoCountry-1653"><span class="linenos">1653</span></a>
</span><span id="GeoCountry-1654"><a href="#GeoCountry-1654"><span class="linenos">1654</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data_region</span>
</span><span id="GeoCountry-1655"><a href="#GeoCountry-1655"><span class="linenos">1655</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="GeoCountry-1656"><a href="#GeoCountry-1656"><span class="linenos">1656</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data_subregion</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span> <span class="c1">#i.e. is None</span>
</span><span id="GeoCountry-1657"><a href="#GeoCountry-1657"><span class="linenos">1657</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_country_data_subregion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">)</span>
</span><span id="GeoCountry-1658"><a href="#GeoCountry-1658"><span class="linenos">1658</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data_subregion</span>
</span><span id="GeoCountry-1659"><a href="#GeoCountry-1659"><span class="linenos">1659</span></a>
</span><span id="GeoCountry-1660"><a href="#GeoCountry-1660"><span class="linenos">1660</span></a>    <span class="k">def</span> <span class="nf">add_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="GeoCountry-1661"><a href="#GeoCountry-1661"><span class="linenos">1661</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a the data pandas.Dataframe with an additionnal column with property prop.</span>
</span><span id="GeoCountry-1662"><a href="#GeoCountry-1662"><span class="linenos">1662</span></a>
</span><span id="GeoCountry-1663"><a href="#GeoCountry-1663"><span class="linenos">1663</span></a><span class="sd">        Arguments :</span>
</span><span id="GeoCountry-1664"><a href="#GeoCountry-1664"><span class="linenos">1664</span></a><span class="sd">        input        : pandas.Dataframe object. Mandatory.</span>
</span><span id="GeoCountry-1665"><a href="#GeoCountry-1665"><span class="linenos">1665</span></a><span class="sd">        field        : field of properties to add. Should be within the get_list_prop() list. Mandatory.</span>
</span><span id="GeoCountry-1666"><a href="#GeoCountry-1666"><span class="linenos">1666</span></a><span class="sd">        input_key    : input geo key of the input pandas dataframe. Default  &#39;where&#39;</span>
</span><span id="GeoCountry-1667"><a href="#GeoCountry-1667"><span class="linenos">1667</span></a><span class="sd">        geofield     : internal geo field to make the merge. Default &#39;code_subregion&#39;</span>
</span><span id="GeoCountry-1668"><a href="#GeoCountry-1668"><span class="linenos">1668</span></a><span class="sd">        region_merging : Boolean value. Default False, except if the geofield contains &#39;_region&#39;.</span>
</span><span id="GeoCountry-1669"><a href="#GeoCountry-1669"><span class="linenos">1669</span></a><span class="sd">                       If True, the merge between input dans GeoCountry data is done within the</span>
</span><span id="GeoCountry-1670"><a href="#GeoCountry-1670"><span class="linenos">1670</span></a><span class="sd">                       region version of the data, not the subregion data which is the default</span>
</span><span id="GeoCountry-1671"><a href="#GeoCountry-1671"><span class="linenos">1671</span></a><span class="sd">                       behavious.</span>
</span><span id="GeoCountry-1672"><a href="#GeoCountry-1672"><span class="linenos">1672</span></a><span class="sd">        overload   : Allow to overload a field. Boolean value. Default : False</span>
</span><span id="GeoCountry-1673"><a href="#GeoCountry-1673"><span class="linenos">1673</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoCountry-1674"><a href="#GeoCountry-1674"><span class="linenos">1674</span></a>
</span><span id="GeoCountry-1675"><a href="#GeoCountry-1675"><span class="linenos">1675</span></a>        <span class="c1"># Test of args</span>
</span><span id="GeoCountry-1676"><a href="#GeoCountry-1676"><span class="linenos">1676</span></a>        <span class="n">kwargs_test</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;input&#39;</span><span class="p">,</span><span class="s1">&#39;field&#39;</span><span class="p">,</span><span class="s1">&#39;input_key&#39;</span><span class="p">,</span><span class="s1">&#39;geofield&#39;</span><span class="p">,</span><span class="s1">&#39;geotype&#39;</span><span class="p">,</span><span class="s1">&#39;overload&#39;</span><span class="p">],</span>
</span><span id="GeoCountry-1677"><a href="#GeoCountry-1677"><span class="linenos">1677</span></a>            <span class="s1">&#39;Bad args used in the add_field() function.&#39;</span><span class="p">)</span>
</span><span id="GeoCountry-1678"><a href="#GeoCountry-1678"><span class="linenos">1678</span></a>
</span><span id="GeoCountry-1679"><a href="#GeoCountry-1679"><span class="linenos">1679</span></a>        <span class="c1"># Testing input</span>
</span><span id="GeoCountry-1680"><a href="#GeoCountry-1680"><span class="linenos">1680</span></a>        <span class="n">data</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span> <span class="c1"># the panda</span>
</span><span id="GeoCountry-1681"><a href="#GeoCountry-1681"><span class="linenos">1681</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
</span><span id="GeoCountry-1682"><a href="#GeoCountry-1682"><span class="linenos">1682</span></a>            <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s1">&#39;You should provide a valid input pandas&#39;</span>
</span><span id="GeoCountry-1683"><a href="#GeoCountry-1683"><span class="linenos">1683</span></a>                <span class="s1">&#39; DataFrame as input. See help.&#39;</span><span class="p">)</span>
</span><span id="GeoCountry-1684"><a href="#GeoCountry-1684"><span class="linenos">1684</span></a>        <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="GeoCountry-1685"><a href="#GeoCountry-1685"><span class="linenos">1685</span></a>
</span><span id="GeoCountry-1686"><a href="#GeoCountry-1686"><span class="linenos">1686</span></a>        <span class="c1"># Testing input_key</span>
</span><span id="GeoCountry-1687"><a href="#GeoCountry-1687"><span class="linenos">1687</span></a>        <span class="n">input_key</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;input_key&#39;</span><span class="p">,</span><span class="s1">&#39;where&#39;</span><span class="p">)</span>
</span><span id="GeoCountry-1688"><a href="#GeoCountry-1688"><span class="linenos">1688</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_key</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
</span><span id="GeoCountry-1689"><a href="#GeoCountry-1689"><span class="linenos">1689</span></a>            <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s1">&#39;The input_key should be given as a string.&#39;</span><span class="p">)</span>
</span><span id="GeoCountry-1690"><a href="#GeoCountry-1690"><span class="linenos">1690</span></a>        <span class="k">if</span> <span class="n">input_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
</span><span id="GeoCountry-1691"><a href="#GeoCountry-1691"><span class="linenos">1691</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;The input_key &quot;&#39;</span><span class="o">+</span><span class="n">input_key</span><span class="o">+</span><span class="s1">&#39;&quot; given is &#39;</span>
</span><span id="GeoCountry-1692"><a href="#GeoCountry-1692"><span class="linenos">1692</span></a>                <span class="s1">&#39;not a valid column name of the input pandas dataframe.&#39;</span><span class="p">)</span>
</span><span id="GeoCountry-1693"><a href="#GeoCountry-1693"><span class="linenos">1693</span></a>
</span><span id="GeoCountry-1694"><a href="#GeoCountry-1694"><span class="linenos">1694</span></a>        <span class="c1"># Testing geofield</span>
</span><span id="GeoCountry-1695"><a href="#GeoCountry-1695"><span class="linenos">1695</span></a>        <span class="n">geofield</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;geofield&#39;</span><span class="p">,</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">)</span>
</span><span id="GeoCountry-1696"><a href="#GeoCountry-1696"><span class="linenos">1696</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geofield</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
</span><span id="GeoCountry-1697"><a href="#GeoCountry-1697"><span class="linenos">1697</span></a>            <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s1">&#39;The geofield should be given as a string.&#39;</span><span class="p">)</span>
</span><span id="GeoCountry-1698"><a href="#GeoCountry-1698"><span class="linenos">1698</span></a>        <span class="k">if</span> <span class="n">geofield</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
</span><span id="GeoCountry-1699"><a href="#GeoCountry-1699"><span class="linenos">1699</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;The geofield &quot;&#39;</span><span class="o">+</span><span class="n">geofield</span><span class="o">+</span><span class="s1">&#39;&quot; given is &#39;</span>
</span><span id="GeoCountry-1700"><a href="#GeoCountry-1700"><span class="linenos">1700</span></a>                <span class="s1">&#39;not a valid column name of the available data. &#39;</span>
</span><span id="GeoCountry-1701"><a href="#GeoCountry-1701"><span class="linenos">1701</span></a>                <span class="s1">&#39;See get_list_properties() for valid fields.&#39;</span><span class="p">)</span>
</span><span id="GeoCountry-1702"><a href="#GeoCountry-1702"><span class="linenos">1702</span></a>
</span><span id="GeoCountry-1703"><a href="#GeoCountry-1703"><span class="linenos">1703</span></a>        <span class="n">region_merging</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;region_merging&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
</span><span id="GeoCountry-1704"><a href="#GeoCountry-1704"><span class="linenos">1704</span></a>        <span class="k">if</span> <span class="n">region_merging</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GeoCountry-1705"><a href="#GeoCountry-1705"><span class="linenos">1705</span></a>            <span class="k">if</span> <span class="s1">&#39;_region&#39;</span> <span class="ow">in</span> <span class="n">geofield</span><span class="p">:</span>
</span><span id="GeoCountry-1706"><a href="#GeoCountry-1706"><span class="linenos">1706</span></a>                <span class="n">region_merging</span><span class="o">=</span><span class="kc">True</span>
</span><span id="GeoCountry-1707"><a href="#GeoCountry-1707"><span class="linenos">1707</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="GeoCountry-1708"><a href="#GeoCountry-1708"><span class="linenos">1708</span></a>                <span class="n">region_merging</span><span class="o">=</span><span class="kc">False</span>
</span><span id="GeoCountry-1709"><a href="#GeoCountry-1709"><span class="linenos">1709</span></a>
</span><span id="GeoCountry-1710"><a href="#GeoCountry-1710"><span class="linenos">1710</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">region_merging</span><span class="p">,</span><span class="nb">bool</span><span class="p">):</span>
</span><span id="GeoCountry-1711"><a href="#GeoCountry-1711"><span class="linenos">1711</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;The region_mergin key should be boolean. See help.&#39;</span><span class="p">)</span>
</span><span id="GeoCountry-1712"><a href="#GeoCountry-1712"><span class="linenos">1712</span></a>
</span><span id="GeoCountry-1713"><a href="#GeoCountry-1713"><span class="linenos">1713</span></a>        <span class="c1"># Testing fields</span>
</span><span id="GeoCountry-1714"><a href="#GeoCountry-1714"><span class="linenos">1714</span></a>        <span class="n">prop</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;field&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span> <span class="c1"># field list</span>
</span><span id="GeoCountry-1715"><a href="#GeoCountry-1715"><span class="linenos">1715</span></a>        <span class="k">if</span> <span class="n">prop</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GeoCountry-1716"><a href="#GeoCountry-1716"><span class="linenos">1716</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;No field given. See help.&#39;</span><span class="p">)</span>
</span><span id="GeoCountry-1717"><a href="#GeoCountry-1717"><span class="linenos">1717</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
</span><span id="GeoCountry-1718"><a href="#GeoCountry-1718"><span class="linenos">1718</span></a>            <span class="n">prop</span><span class="o">=</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span> <span class="c1"># make the prop input a list if needed</span>
</span><span id="GeoCountry-1719"><a href="#GeoCountry-1719"><span class="linenos">1719</span></a>
</span><span id="GeoCountry-1720"><a href="#GeoCountry-1720"><span class="linenos">1720</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">):</span>
</span><span id="GeoCountry-1721"><a href="#GeoCountry-1721"><span class="linenos">1721</span></a>            <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s2">&quot;Each property should be a string whereas &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; is not a list of string.&quot;</span><span class="p">)</span>
</span><span id="GeoCountry-1722"><a href="#GeoCountry-1722"><span class="linenos">1722</span></a>
</span><span id="GeoCountry-1723"><a href="#GeoCountry-1723"><span class="linenos">1723</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list_properties</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">):</span>
</span><span id="GeoCountry-1724"><a href="#GeoCountry-1724"><span class="linenos">1724</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s2">&quot;The property &quot;</span><span class="o">+</span><span class="n">prop</span><span class="o">+</span><span class="s2">&quot; is not available for country &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()</span><span class="o">+</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
</span><span id="GeoCountry-1725"><a href="#GeoCountry-1725"><span class="linenos">1725</span></a>
</span><span id="GeoCountry-1726"><a href="#GeoCountry-1726"><span class="linenos">1726</span></a>        <span class="c1"># Testing overload</span>
</span><span id="GeoCountry-1727"><a href="#GeoCountry-1727"><span class="linenos">1727</span></a>        <span class="n">overload</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;overload&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
</span><span id="GeoCountry-1728"><a href="#GeoCountry-1728"><span class="linenos">1728</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">overload</span><span class="p">,</span><span class="nb">bool</span><span class="p">):</span>
</span><span id="GeoCountry-1729"><a href="#GeoCountry-1729"><span class="linenos">1729</span></a>            <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s1">&#39;The overload option should be a boolean.&#39;</span><span class="p">)</span>
</span><span id="GeoCountry-1730"><a href="#GeoCountry-1730"><span class="linenos">1730</span></a>
</span><span id="GeoCountry-1731"><a href="#GeoCountry-1731"><span class="linenos">1731</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">overload</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">):</span>
</span><span id="GeoCountry-1732"><a href="#GeoCountry-1732"><span class="linenos">1732</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;Some fields already exist in you panda &#39;</span>
</span><span id="GeoCountry-1733"><a href="#GeoCountry-1733"><span class="linenos">1733</span></a>                <span class="s1">&#39;dataframe columns. You may set overload to True.&#39;</span><span class="p">)</span>
</span><span id="GeoCountry-1734"><a href="#GeoCountry-1734"><span class="linenos">1734</span></a>
</span><span id="GeoCountry-1735"><a href="#GeoCountry-1735"><span class="linenos">1735</span></a>        <span class="c1"># Is the oject properly initialized ?</span>
</span><span id="GeoCountry-1736"><a href="#GeoCountry-1736"><span class="linenos">1736</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">test_is_init</span><span class="p">()</span>
</span><span id="GeoCountry-1737"><a href="#GeoCountry-1737"><span class="linenos">1737</span></a>
</span><span id="GeoCountry-1738"><a href="#GeoCountry-1738"><span class="linenos">1738</span></a>        <span class="c1"># Now let&#39;s go for merging</span>
</span><span id="GeoCountry-1739"><a href="#GeoCountry-1739"><span class="linenos">1739</span></a>        <span class="n">prop</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">)</span>
</span><span id="GeoCountry-1740"><a href="#GeoCountry-1740"><span class="linenos">1740</span></a>        <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">region_merging</span><span class="p">)[</span><span class="n">prop</span><span class="p">],</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">left_on</span><span class="o">=</span><span class="n">input_key</span><span class="p">,</span>\
</span><span id="GeoCountry-1741"><a href="#GeoCountry-1741"><span class="linenos">1741</span></a>                            <span class="n">right_on</span><span class="o">=</span><span class="n">geofield</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>GeoCountry class definition.
This class provides functions for specific countries and their states / departments / regions,
and their geo properties (geometry, population if available, etc.)</p>

<p>The list of supported countries is given by get_list_countries() function.</p>
</div>


                            <div id="GeoCountry.__init__" class="classattr">
                                        <input id="GeoCountry.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">GeoCountry</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">country</span><span class="o">=</span><span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="GeoCountry.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GeoCountry.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GeoCountry.__init__-820"><a href="#GeoCountry.__init__-820"><span class="linenos"> 820</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">country</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="GeoCountry.__init__-821"><a href="#GeoCountry.__init__-821"><span class="linenos"> 821</span></a>
</span><span id="GeoCountry.__init__-822"><a href="#GeoCountry.__init__-822"><span class="linenos"> 822</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; __init__ member function.</span>
</span><span id="GeoCountry.__init__-823"><a href="#GeoCountry.__init__-823"><span class="linenos"> 823</span></a><span class="sd">        Must give as arg the country to deal with, as a valid ISO3 string.</span>
</span><span id="GeoCountry.__init__-824"><a href="#GeoCountry.__init__-824"><span class="linenos"> 824</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoCountry.__init__-825"><a href="#GeoCountry.__init__-825"><span class="linenos"> 825</span></a>
</span><span id="GeoCountry.__init__-826"><a href="#GeoCountry.__init__-826"><span class="linenos"> 826</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_country</span><span class="o">=</span><span class="n">country</span>
</span><span id="GeoCountry.__init__-827"><a href="#GeoCountry.__init__-827"><span class="linenos"> 827</span></a>        <span class="k">if</span> <span class="n">country</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GeoCountry.__init__-828"><a href="#GeoCountry.__init__-828"><span class="linenos"> 828</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="GeoCountry.__init__-829"><a href="#GeoCountry.__init__-829"><span class="linenos"> 829</span></a>
</span><span id="GeoCountry.__init__-830"><a href="#GeoCountry.__init__-830"><span class="linenos"> 830</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">country</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list_countries</span><span class="p">():</span>
</span><span id="GeoCountry.__init__-831"><a href="#GeoCountry.__init__-831"><span class="linenos"> 831</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s2">&quot;Country &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">country</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; not supported. Please see get_list_countries() and help. &quot;</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-832"><a href="#GeoCountry.__init__-832"><span class="linenos"> 832</span></a>
</span><span id="GeoCountry.__init__-833"><a href="#GeoCountry.__init__-833"><span class="linenos"> 833</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_country_data_region</span><span class="o">=</span><span class="kc">None</span>
</span><span id="GeoCountry.__init__-834"><a href="#GeoCountry.__init__-834"><span class="linenos"> 834</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_country_data_subregion</span><span class="o">=</span><span class="kc">None</span>
</span><span id="GeoCountry.__init__-835"><a href="#GeoCountry.__init__-835"><span class="linenos"> 835</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_municipality_region</span><span class="o">=</span><span class="kc">None</span>
</span><span id="GeoCountry.__init__-836"><a href="#GeoCountry.__init__-836"><span class="linenos"> 836</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_dense_geometry</span><span class="o">=</span><span class="kc">False</span>
</span><span id="GeoCountry.__init__-837"><a href="#GeoCountry.__init__-837"><span class="linenos"> 837</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_exploded_geometry</span><span class="o">=</span><span class="kc">False</span>
</span><span id="GeoCountry.__init__-838"><a href="#GeoCountry.__init__-838"><span class="linenos"> 838</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_main_geometry</span><span class="o">=</span><span class="kc">False</span>
</span><span id="GeoCountry.__init__-839"><a href="#GeoCountry.__init__-839"><span class="linenos"> 839</span></a>
</span><span id="GeoCountry.__init__-840"><a href="#GeoCountry.__init__-840"><span class="linenos"> 840</span></a>        <span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_info_dict</span><span class="p">[</span><span class="n">country</span><span class="p">]</span>
</span><span id="GeoCountry.__init__-841"><a href="#GeoCountry.__init__-841"><span class="linenos"> 841</span></a>        <span class="c1"># country by country, adapt the read file informations</span>
</span><span id="GeoCountry.__init__-842"><a href="#GeoCountry.__init__-842"><span class="linenos"> 842</span></a>
</span><span id="GeoCountry.__init__-843"><a href="#GeoCountry.__init__-843"><span class="linenos"> 843</span></a>        <span class="c1"># --- &#39;FRA&#39; case ---------------------------------------------------------------------------------------</span>
</span><span id="GeoCountry.__init__-844"><a href="#GeoCountry.__init__-844"><span class="linenos"> 844</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country</span><span class="o">==</span><span class="s1">&#39;FRA&#39;</span><span class="p">:</span>
</span><span id="GeoCountry.__init__-845"><a href="#GeoCountry.__init__-845"><span class="linenos"> 845</span></a>            <span class="c1">#self._country_data = gpd.read_file(&#39;zip://&#39;+get_local_from_url(url,0,&#39;.zip&#39;))</span>
</span><span id="GeoCountry.__init__-846"><a href="#GeoCountry.__init__-846"><span class="linenos"> 846</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
</span><span id="GeoCountry.__init__-847"><a href="#GeoCountry.__init__-847"><span class="linenos"> 847</span></a>
</span><span id="GeoCountry.__init__-848"><a href="#GeoCountry.__init__-848"><span class="linenos"> 848</span></a>            <span class="c1"># adding a flag for subregion (departements)</span>
</span><span id="GeoCountry.__init__-849"><a href="#GeoCountry.__init__-849"><span class="linenos"> 849</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;flag_subregion&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_source_dict</span><span class="p">[</span><span class="s1">&#39;FRA&#39;</span><span class="p">][</span><span class="s1">&#39;Subregion Flags&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;img/dept/sticker_plaque_immat_&#39;</span><span class="o">+</span>\
</span><span id="GeoCountry.__init__-850"><a href="#GeoCountry.__init__-850"><span class="linenos"> 850</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;dep_code&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span>\
</span><span id="GeoCountry.__init__-851"><a href="#GeoCountry.__init__-851"><span class="linenos"> 851</span></a>                <span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;dep_name&#39;</span><span class="p">]]</span><span class="o">+</span><span class="s1">&#39;_moto.png&#39;</span> <span class="c1"># picture of a sticker for motobikes, not so bad...</span>
</span><span id="GeoCountry.__init__-852"><a href="#GeoCountry.__init__-852"><span class="linenos"> 852</span></a>
</span><span id="GeoCountry.__init__-853"><a href="#GeoCountry.__init__-853"><span class="linenos"> 853</span></a>            <span class="c1"># Reading information to get region flags and correct names of regions</span>
</span><span id="GeoCountry.__init__-854"><a href="#GeoCountry.__init__-854"><span class="linenos"> 854</span></a>            <span class="n">f_reg_flag</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_source_dict</span><span class="p">[</span><span class="s1">&#39;FRA&#39;</span><span class="p">][</span><span class="s1">&#39;Region Flags&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-855"><a href="#GeoCountry.__init__-855"><span class="linenos"> 855</span></a>
</span><span id="GeoCountry.__init__-856"><a href="#GeoCountry.__init__-856"><span class="linenos"> 856</span></a>            <span class="n">content_reg_flag</span> <span class="o">=</span> <span class="n">f_reg_flag</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="GeoCountry.__init__-857"><a href="#GeoCountry.__init__-857"><span class="linenos"> 857</span></a>            <span class="n">f_reg_flag</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="GeoCountry.__init__-858"><a href="#GeoCountry.__init__-858"><span class="linenos"> 858</span></a>            <span class="n">soup_reg_flag</span> <span class="o">=</span> <span class="n">bs4</span><span class="o">.</span><span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">content_reg_flag</span><span class="p">,</span><span class="s1">&#39;lxml&#39;</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-859"><a href="#GeoCountry.__init__-859"><span class="linenos"> 859</span></a>            <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">soup_reg_flag</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;img&#39;</span><span class="p">):</span>  <span class="c1"># need to convert &lt;img tags to src content for pandas_read</span>
</span><span id="GeoCountry.__init__-860"><a href="#GeoCountry.__init__-860"><span class="linenos"> 860</span></a>                <span class="n">src</span><span class="o">=</span><span class="n">img</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-861"><a href="#GeoCountry.__init__-861"><span class="linenos"> 861</span></a>                <span class="k">if</span> <span class="n">src</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
</span><span id="GeoCountry.__init__-862"><a href="#GeoCountry.__init__-862"><span class="linenos"> 862</span></a>                    <span class="n">src</span><span class="o">=</span><span class="s1">&#39;http:&#39;</span><span class="o">+</span><span class="n">src</span>
</span><span id="GeoCountry.__init__-863"><a href="#GeoCountry.__init__-863"><span class="linenos"> 863</span></a>                <span class="n">img</span><span class="o">.</span><span class="n">replace_with</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-864"><a href="#GeoCountry.__init__-864"><span class="linenos"> 864</span></a>
</span><span id="GeoCountry.__init__-865"><a href="#GeoCountry.__init__-865"><span class="linenos"> 865</span></a>            <span class="n">tabs_reg_flag</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">soup_reg_flag</span><span class="p">))</span> <span class="c1"># pandas read the modified html</span>
</span><span id="GeoCountry.__init__-866"><a href="#GeoCountry.__init__-866"><span class="linenos"> 866</span></a>            <span class="n">metropole</span><span class="o">=</span><span class="n">tabs_reg_flag</span><span class="p">[</span><span class="mi">5</span><span class="p">][[</span><span class="s2">&quot;Logo&quot;</span><span class="p">,</span><span class="s2">&quot;Dénomination&quot;</span><span class="p">,</span><span class="s2">&quot;Code INSEE[5]&quot;</span><span class="p">]]</span>  <span class="c1"># getting 5th table, and only usefull columns</span>
</span><span id="GeoCountry.__init__-867"><a href="#GeoCountry.__init__-867"><span class="linenos"> 867</span></a>            <span class="n">ultramarin</span><span class="o">=</span><span class="n">tabs_reg_flag</span><span class="p">[</span><span class="mi">6</span><span class="p">][[</span><span class="s2">&quot;Logo&quot;</span><span class="p">,</span><span class="s2">&quot;Dénomination&quot;</span><span class="p">,</span><span class="s2">&quot;Code INSEE[5]&quot;</span><span class="p">]]</span> <span class="c1"># getting 6th table</span>
</span><span id="GeoCountry.__init__-868"><a href="#GeoCountry.__init__-868"><span class="linenos"> 868</span></a>            <span class="n">p_reg_flag</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">metropole</span><span class="p">,</span><span class="n">ultramarin</span><span class="p">])</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Code INSEE[5]&quot;</span><span class="p">:</span><span class="s2">&quot;code_region&quot;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-869"><a href="#GeoCountry.__init__-869"><span class="linenos"> 869</span></a>                                                                        <span class="s2">&quot;Logo&quot;</span><span class="p">:</span><span class="s2">&quot;flag_region&quot;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-870"><a href="#GeoCountry.__init__-870"><span class="linenos"> 870</span></a>                                                                        <span class="s2">&quot;Dénomination&quot;</span><span class="p">:</span><span class="s2">&quot;name_region&quot;</span><span class="p">})</span>
</span><span id="GeoCountry.__init__-871"><a href="#GeoCountry.__init__-871"><span class="linenos"> 871</span></a>
</span><span id="GeoCountry.__init__-872"><a href="#GeoCountry.__init__-872"><span class="linenos"> 872</span></a>            <span class="n">p_reg_flag</span><span class="o">=</span><span class="n">p_reg_flag</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">notnull</span><span class="p">(</span><span class="n">p_reg_flag</span><span class="p">[</span><span class="s2">&quot;code_region&quot;</span><span class="p">])]</span>  <span class="c1"># select only valid rows</span>
</span><span id="GeoCountry.__init__-873"><a href="#GeoCountry.__init__-873"><span class="linenos"> 873</span></a>            <span class="n">p_reg_flag</span><span class="p">[</span><span class="s2">&quot;name_region&quot;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span> <span class="n">n</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">p_reg_flag</span><span class="p">[</span><span class="s2">&quot;name_region&quot;</span><span class="p">]</span> <span class="p">]</span> <span class="c1"># remove footnote [k] index from wikipedia</span>
</span><span id="GeoCountry.__init__-874"><a href="#GeoCountry.__init__-874"><span class="linenos"> 874</span></a>            <span class="n">p_reg_flag</span><span class="p">[</span><span class="s2">&quot;code_region&quot;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">))</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">p_reg_flag</span><span class="p">[</span><span class="s2">&quot;code_region&quot;</span><span class="p">]</span> <span class="p">]</span> <span class="c1"># convert to str for merge the code, adding 1 leading 0 if needed</span>
</span><span id="GeoCountry.__init__-875"><a href="#GeoCountry.__init__-875"><span class="linenos"> 875</span></a>
</span><span id="GeoCountry.__init__-876"><a href="#GeoCountry.__init__-876"><span class="linenos"> 876</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">p_reg_flag</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-877"><a href="#GeoCountry.__init__-877"><span class="linenos"> 877</span></a>                    <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;reg_code&#39;</span><span class="p">,</span><span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;code_region&#39;</span><span class="p">)</span> <span class="c1"># merging with flag and correct names</span>
</span><span id="GeoCountry.__init__-878"><a href="#GeoCountry.__init__-878"><span class="linenos"> 878</span></a>            <span class="c1"># standardize name for region, subregion</span>
</span><span id="GeoCountry.__init__-879"><a href="#GeoCountry.__init__-879"><span class="linenos"> 879</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>\
</span><span id="GeoCountry.__init__-880"><a href="#GeoCountry.__init__-880"><span class="linenos"> 880</span></a>                <span class="s1">&#39;dep_code&#39;</span><span class="p">:</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-881"><a href="#GeoCountry.__init__-881"><span class="linenos"> 881</span></a>                <span class="s1">&#39;dep_name&#39;</span><span class="p">:</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-882"><a href="#GeoCountry.__init__-882"><span class="linenos"> 882</span></a>                <span class="c1">#&#39;nom_chf&#39;:&#39;town_subregion&#39;,\</span>
</span><span id="GeoCountry.__init__-883"><a href="#GeoCountry.__init__-883"><span class="linenos"> 883</span></a>                <span class="p">},</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-884"><a href="#GeoCountry.__init__-884"><span class="linenos"> 884</span></a>
</span><span id="GeoCountry.__init__-885"><a href="#GeoCountry.__init__-885"><span class="linenos"> 885</span></a>            <span class="c1"># adding population information (departements)</span>
</span><span id="GeoCountry.__init__-886"><a href="#GeoCountry.__init__-886"><span class="linenos"> 886</span></a>            <span class="n">pop_fra</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_source_dict</span><span class="p">[</span><span class="s1">&#39;FRA&#39;</span><span class="p">][</span><span class="s1">&#39;Population&#39;</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GeoCountry.__init__-887"><a href="#GeoCountry.__init__-887"><span class="linenos"> 887</span></a>            <span class="n">pop_fra</span><span class="p">[</span><span class="s1">&#39;population_subregion&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">pop_fra</span><span class="p">[</span><span class="s1">&#39;Population municipale&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[ \xa0]&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-888"><a href="#GeoCountry.__init__-888"><span class="linenos"> 888</span></a>            <span class="c1"># En l&#39;absence de Mayotte dans ce document, car le recensement n&#39;a pas eu lieu en phase, ajout à la main</span>
</span><span id="GeoCountry.__init__-889"><a href="#GeoCountry.__init__-889"><span class="linenos"> 889</span></a>            <span class="c1"># En référence à la page pour Mayotte : https://www.insee.fr/fr/statistiques/3291775?sommaire=2120838</span>
</span><span id="GeoCountry.__init__-890"><a href="#GeoCountry.__init__-890"><span class="linenos"> 890</span></a>            <span class="n">mayotte_df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([{</span><span class="s1">&#39;Code département&#39;</span><span class="p">:</span><span class="s1">&#39;976&#39;</span><span class="p">,</span><span class="s1">&#39;population_subregion&#39;</span><span class="p">:</span><span class="mi">256518</span><span class="p">}])</span>
</span><span id="GeoCountry.__init__-891"><a href="#GeoCountry.__init__-891"><span class="linenos"> 891</span></a>            <span class="n">pop_fra</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pop_fra</span><span class="p">,</span><span class="n">mayotte_df</span><span class="p">])</span>
</span><span id="GeoCountry.__init__-892"><a href="#GeoCountry.__init__-892"><span class="linenos"> 892</span></a>            <span class="c1">#pop_fra=pop_fra.append(mayotte_df)</span>
</span><span id="GeoCountry.__init__-893"><a href="#GeoCountry.__init__-893"><span class="linenos"> 893</span></a>            <span class="c1"># Pour les collectivités d&#39;Outremer : https://www.insee.fr/fr/statistiques/4989739?sommaire=4989761</span>
</span><span id="GeoCountry.__init__-894"><a href="#GeoCountry.__init__-894"><span class="linenos"> 894</span></a>            <span class="n">com_df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([{</span><span class="s1">&#39;Code département&#39;</span><span class="p">:</span><span class="s1">&#39;980&#39;</span><span class="p">,</span><span class="s1">&#39;population_subregion&#39;</span><span class="p">:(</span><span class="mi">5985</span><span class="o">+</span><span class="mi">10124</span><span class="o">+</span><span class="mi">34065</span><span class="o">+</span><span class="mi">281674</span><span class="o">+</span><span class="mi">12067</span><span class="p">)}])</span>
</span><span id="GeoCountry.__init__-895"><a href="#GeoCountry.__init__-895"><span class="linenos"> 895</span></a>            <span class="n">pop_fra</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pop_fra</span><span class="p">,</span><span class="n">com_df</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="GeoCountry.__init__-896"><a href="#GeoCountry.__init__-896"><span class="linenos"> 896</span></a>            <span class="c1">#pop_fra=pop_fra.append(com_df).reset_index()</span>
</span><span id="GeoCountry.__init__-897"><a href="#GeoCountry.__init__-897"><span class="linenos"> 897</span></a>            <span class="n">geo_com</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">code_subregion</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;975&#39;</span><span class="p">,</span><span class="s1">&#39;977&#39;</span><span class="p">,</span><span class="s1">&#39;978&#39;</span><span class="p">,</span><span class="s1">&#39;986&#39;</span><span class="p">,</span><span class="s1">&#39;987&#39;</span><span class="p">])][[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]]</span>
</span><span id="GeoCountry.__init__-898"><a href="#GeoCountry.__init__-898"><span class="linenos"> 898</span></a>            <span class="n">geo_com</span><span class="p">[</span><span class="s1">&#39;smthing&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
</span><span id="GeoCountry.__init__-899"><a href="#GeoCountry.__init__-899"><span class="linenos"> 899</span></a>            <span class="n">geo_com</span><span class="o">=</span><span class="n">geo_com</span><span class="o">.</span><span class="n">dissolve</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;smthing&#39;</span><span class="p">)[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span>
</span><span id="GeoCountry.__init__-900"><a href="#GeoCountry.__init__-900"><span class="linenos"> 900</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-901"><a href="#GeoCountry.__init__-901"><span class="linenos"> 901</span></a>            <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([{</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">:</span><span class="s1">&#39;980&#39;</span><span class="p">,</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">:</span><span class="s1">&#39;Collectivités d</span><span class="se">\&#39;</span><span class="s1">outre-mer&#39;</span><span class="p">,</span><span class="s1">&#39;code_region&#39;</span><span class="p">:</span><span class="s1">&#39;09&#39;</span><span class="p">,</span><span class="s1">&#39;name_region&#39;</span><span class="p">:</span><span class="s1">&#39;Collectivités d</span><span class="se">\&#39;</span><span class="s1">outre-mer&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span><span class="n">geo_com</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]}])],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-902"><a href="#GeoCountry.__init__-902"><span class="linenos"> 902</span></a>            <span class="c1">#self._country_data=self._country_data.append(</span>
</span><span id="GeoCountry.__init__-903"><a href="#GeoCountry.__init__-903"><span class="linenos"> 903</span></a>            <span class="c1">#    pd.DataFrame([{&#39;code_subregion&#39;:&#39;980&#39;,&#39;name_subregion&#39;:&#39;Collectivités d\&#39;outre-mer&#39;,&#39;code_region&#39;:&#39;09&#39;,&#39;name_region&#39;:&#39;Collectivités d\&#39;outre-mer&#39;,&#39;geometry&#39;:geo_com.values[0]}])).reset_index()</span>
</span><span id="GeoCountry.__init__-904"><a href="#GeoCountry.__init__-904"><span class="linenos"> 904</span></a>            <span class="c1"># Merging</span>
</span><span id="GeoCountry.__init__-905"><a href="#GeoCountry.__init__-905"><span class="linenos"> 905</span></a>            <span class="c1">#self._country_data=self._country_data.append(</span>
</span><span id="GeoCountry.__init__-906"><a href="#GeoCountry.__init__-906"><span class="linenos"> 906</span></a>            <span class="c1">#    pd.DataFrame([{&#39;code_subregion&#39;:&#39;980&#39;,&#39;name_subregion&#39;:&#39;Collectivités d\&#39;outre-mer&#39;,&#39;code_region&#39;:&#39;09&#39;,&#39;name_region&#39;:&#39;Collectivités d\&#39;outre-mer&#39;,&#39;geometry&#39;:geo_com.values[0]}])).reset_index()</span>
</span><span id="GeoCountry.__init__-907"><a href="#GeoCountry.__init__-907"><span class="linenos"> 907</span></a>            <span class="c1"># Merging</span>
</span><span id="GeoCountry.__init__-908"><a href="#GeoCountry.__init__-908"><span class="linenos"> 908</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">pop_fra</span><span class="p">,</span><span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span><span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;Code département&#39;</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-909"><a href="#GeoCountry.__init__-909"><span class="linenos"> 909</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[[</span><span class="s1">&#39;geometry&#39;</span><span class="p">,</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;flag_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;code_region&#39;</span><span class="p">,</span><span class="s1">&#39;name_region&#39;</span><span class="p">,</span><span class="s1">&#39;population_subregion&#39;</span><span class="p">]]</span>
</span><span id="GeoCountry.__init__-910"><a href="#GeoCountry.__init__-910"><span class="linenos"> 910</span></a>            <span class="c1">#if needed, define translation for dense geometry</span>
</span><span id="GeoCountry.__init__-911"><a href="#GeoCountry.__init__-911"><span class="linenos"> 911</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_list_translation</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;971&#39;</span><span class="p">:(</span><span class="mi">63</span><span class="p">,</span><span class="mi">23</span><span class="p">),</span>   <span class="c1"># Guadeloupe</span>
</span><span id="GeoCountry.__init__-912"><a href="#GeoCountry.__init__-912"><span class="linenos"> 912</span></a>                     <span class="s1">&#39;972&#39;</span><span class="p">:(</span><span class="mi">63</span><span class="p">,</span><span class="mi">23</span><span class="p">),</span> <span class="c1"># Martinique</span>
</span><span id="GeoCountry.__init__-913"><a href="#GeoCountry.__init__-913"><span class="linenos"> 913</span></a>                     <span class="s1">&#39;973&#39;</span><span class="p">:(</span><span class="mi">50</span><span class="p">,</span><span class="mi">35</span><span class="p">),</span> <span class="c1"># Guyane</span>
</span><span id="GeoCountry.__init__-914"><a href="#GeoCountry.__init__-914"><span class="linenos"> 914</span></a>                     <span class="s1">&#39;974&#39;</span><span class="p">:(</span><span class="o">-</span><span class="mi">51</span><span class="p">,</span><span class="mi">60</span><span class="p">),</span> <span class="c1"># Réunion</span>
</span><span id="GeoCountry.__init__-915"><a href="#GeoCountry.__init__-915"><span class="linenos"> 915</span></a>                     <span class="s1">&#39;976&#39;</span><span class="p">:(</span><span class="o">-</span><span class="mi">38</span><span class="p">,</span><span class="mf">51.5</span><span class="p">)}</span>  <span class="c1"># Mayotte</span>
</span><span id="GeoCountry.__init__-916"><a href="#GeoCountry.__init__-916"><span class="linenos"> 916</span></a>
</span><span id="GeoCountry.__init__-917"><a href="#GeoCountry.__init__-917"><span class="linenos"> 917</span></a>        <span class="c1"># --- &#39;USA&#39; case ---------------------------------------------------------------------------------------</span>
</span><span id="GeoCountry.__init__-918"><a href="#GeoCountry.__init__-918"><span class="linenos"> 918</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country</span> <span class="o">==</span> <span class="s1">&#39;USA&#39;</span><span class="p">:</span>
</span><span id="GeoCountry.__init__-919"><a href="#GeoCountry.__init__-919"><span class="linenos"> 919</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;zip://&#39;</span><span class="o">+</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;.zip&#39;</span><span class="p">))</span> <span class="c1"># under the hypothesis this is a zip file</span>
</span><span id="GeoCountry.__init__-920"><a href="#GeoCountry.__init__-920"><span class="linenos"> 920</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>\
</span><span id="GeoCountry.__init__-921"><a href="#GeoCountry.__init__-921"><span class="linenos"> 921</span></a>                <span class="s1">&#39;STATE_NAME&#39;</span><span class="p">:</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-922"><a href="#GeoCountry.__init__-922"><span class="linenos"> 922</span></a>                <span class="s1">&#39;STATE_ABBR&#39;</span><span class="p">:</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-923"><a href="#GeoCountry.__init__-923"><span class="linenos"> 923</span></a>                <span class="s1">&#39;SUB_REGION&#39;</span><span class="p">:</span><span class="s1">&#39;code_region&#39;</span><span class="p">},</span>\
</span><span id="GeoCountry.__init__-924"><a href="#GeoCountry.__init__-924"><span class="linenos"> 924</span></a>                <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-925"><a href="#GeoCountry.__init__-925"><span class="linenos"> 925</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span>
</span><span id="GeoCountry.__init__-926"><a href="#GeoCountry.__init__-926"><span class="linenos"> 926</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;DRAWSEQ&#39;</span><span class="p">,</span><span class="s1">&#39;STATE_FIPS&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-927"><a href="#GeoCountry.__init__-927"><span class="linenos"> 927</span></a>
</span><span id="GeoCountry.__init__-928"><a href="#GeoCountry.__init__-928"><span class="linenos"> 928</span></a>            <span class="c1"># Adding informations from wikipedia</span>
</span><span id="GeoCountry.__init__-929"><a href="#GeoCountry.__init__-929"><span class="linenos"> 929</span></a>            <span class="n">f_us</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_source_dict</span><span class="p">[</span><span class="s1">&#39;USA&#39;</span><span class="p">][</span><span class="s1">&#39;Subregion informations&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-930"><a href="#GeoCountry.__init__-930"><span class="linenos"> 930</span></a>            <span class="n">content_us</span> <span class="o">=</span> <span class="n">f_us</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="GeoCountry.__init__-931"><a href="#GeoCountry.__init__-931"><span class="linenos"> 931</span></a>            <span class="n">f_us</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="GeoCountry.__init__-932"><a href="#GeoCountry.__init__-932"><span class="linenos"> 932</span></a>            <span class="n">soup_us</span> <span class="o">=</span> <span class="n">bs4</span><span class="o">.</span><span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">content_us</span><span class="p">,</span><span class="s1">&#39;lxml&#39;</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-933"><a href="#GeoCountry.__init__-933"><span class="linenos"> 933</span></a>            <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">soup_us</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;img&#39;</span><span class="p">):</span>  <span class="c1"># need to convert &lt;img tags to src content for pandas_read</span>
</span><span id="GeoCountry.__init__-934"><a href="#GeoCountry.__init__-934"><span class="linenos"> 934</span></a>                <span class="n">src</span><span class="o">=</span><span class="n">img</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-935"><a href="#GeoCountry.__init__-935"><span class="linenos"> 935</span></a>                <span class="k">if</span> <span class="n">src</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
</span><span id="GeoCountry.__init__-936"><a href="#GeoCountry.__init__-936"><span class="linenos"> 936</span></a>                    <span class="n">src</span><span class="o">=</span><span class="s1">&#39;http:&#39;</span><span class="o">+</span><span class="n">src</span>
</span><span id="GeoCountry.__init__-937"><a href="#GeoCountry.__init__-937"><span class="linenos"> 937</span></a>                <span class="n">img</span><span class="o">.</span><span class="n">replace_with</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-938"><a href="#GeoCountry.__init__-938"><span class="linenos"> 938</span></a>
</span><span id="GeoCountry.__init__-939"><a href="#GeoCountry.__init__-939"><span class="linenos"> 939</span></a>            <span class="n">h_us</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">soup_us</span><span class="p">))</span> <span class="c1"># pandas read the modified html</span>
</span><span id="GeoCountry.__init__-940"><a href="#GeoCountry.__init__-940"><span class="linenos"> 940</span></a>            <span class="n">h_us</span><span class="o">=</span><span class="n">h_us</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">h_us</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">]]]</span>
</span><span id="GeoCountry.__init__-941"><a href="#GeoCountry.__init__-941"><span class="linenos"> 941</span></a>            <span class="n">h_us</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;flag_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;town_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;population_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;area_subregion&#39;</span><span class="p">]</span>
</span><span id="GeoCountry.__init__-942"><a href="#GeoCountry.__init__-942"><span class="linenos"> 942</span></a>            <span class="n">h_us</span><span class="p">[</span><span class="s1">&#39;flag_subregion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="n">h</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\xa0</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">h_us</span><span class="p">[</span><span class="s1">&#39;flag_subregion&#39;</span><span class="p">]</span> <span class="p">]</span>
</span><span id="GeoCountry.__init__-943"><a href="#GeoCountry.__init__-943"><span class="linenos"> 943</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">h_us</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-944"><a href="#GeoCountry.__init__-944"><span class="linenos"> 944</span></a>
</span><span id="GeoCountry.__init__-945"><a href="#GeoCountry.__init__-945"><span class="linenos"> 945</span></a>            <span class="c1"># if needed, define some variable for dense / main geometry</span>
</span><span id="GeoCountry.__init__-946"><a href="#GeoCountry.__init__-946"><span class="linenos"> 946</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_list_translation</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;AK&quot;</span><span class="p">:(</span><span class="mi">40</span><span class="p">,</span><span class="o">-</span><span class="mi">40</span><span class="p">),</span><span class="s2">&quot;HI&quot;</span><span class="p">:(</span><span class="mi">60</span><span class="p">,</span><span class="mi">0</span><span class="p">)}</span>
</span><span id="GeoCountry.__init__-947"><a href="#GeoCountry.__init__-947"><span class="linenos"> 947</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_list_scale</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;AK&quot;</span><span class="p">:</span><span class="mf">0.4</span><span class="p">,</span><span class="s2">&quot;HI&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>
</span><span id="GeoCountry.__init__-948"><a href="#GeoCountry.__init__-948"><span class="linenos"> 948</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_list_center</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;AK&quot;</span><span class="p">:(</span><span class="o">-</span><span class="mi">120</span><span class="p">,</span><span class="mi">25</span><span class="p">),</span><span class="s2">&quot;HI&quot;</span><span class="p">:(</span><span class="o">-</span><span class="mi">130</span><span class="p">,</span><span class="mi">25</span><span class="p">)}</span>
</span><span id="GeoCountry.__init__-949"><a href="#GeoCountry.__init__-949"><span class="linenos"> 949</span></a>
</span><span id="GeoCountry.__init__-950"><a href="#GeoCountry.__init__-950"><span class="linenos"> 950</span></a>        <span class="c1"># --- &#39;ITA&#39; case ---------------------------------------------------------------------------------------</span>
</span><span id="GeoCountry.__init__-951"><a href="#GeoCountry.__init__-951"><span class="linenos"> 951</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country</span> <span class="o">==</span> <span class="s1">&#39;ITA&#39;</span><span class="p">:</span>
</span><span id="GeoCountry.__init__-952"><a href="#GeoCountry.__init__-952"><span class="linenos"> 952</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span> <span class="c1"># this is a geojson file</span>
</span><span id="GeoCountry.__init__-953"><a href="#GeoCountry.__init__-953"><span class="linenos"> 953</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>\
</span><span id="GeoCountry.__init__-954"><a href="#GeoCountry.__init__-954"><span class="linenos"> 954</span></a>                <span class="s1">&#39;prov_name&#39;</span><span class="p">:</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-955"><a href="#GeoCountry.__init__-955"><span class="linenos"> 955</span></a>                <span class="s1">&#39;prov_acr&#39;</span><span class="p">:</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-956"><a href="#GeoCountry.__init__-956"><span class="linenos"> 956</span></a>                <span class="s1">&#39;reg_name&#39;</span><span class="p">:</span><span class="s1">&#39;name_region&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-957"><a href="#GeoCountry.__init__-957"><span class="linenos"> 957</span></a>                <span class="s1">&#39;reg_istat_code&#39;</span><span class="p">:</span><span class="s1">&#39;code_region&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-958"><a href="#GeoCountry.__init__-958"><span class="linenos"> 958</span></a>                <span class="p">},</span>
</span><span id="GeoCountry.__init__-959"><a href="#GeoCountry.__init__-959"><span class="linenos"> 959</span></a>                <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-960"><a href="#GeoCountry.__init__-960"><span class="linenos"> 960</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span>
</span><span id="GeoCountry.__init__-961"><a href="#GeoCountry.__init__-961"><span class="linenos"> 961</span></a>            <span class="s1">&#39;Valle d</span><span class="se">\&#39;</span><span class="s1">Aosta/Vallée d</span><span class="se">\&#39;</span><span class="s1">Aoste&#39;</span><span class="p">:</span><span class="s1">&#39;Valle d</span><span class="se">\&#39;</span><span class="s1">Aosta&#39;</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-962"><a href="#GeoCountry.__init__-962"><span class="linenos"> 962</span></a>            <span class="s1">&#39;Trentino-Alto Adige/Südtirol&#39;</span><span class="p">:</span><span class="s1">&#39;Trentino-Alto Adige&#39;</span><span class="p">,</span> <span class="s1">&#39;Friuli-Venezia Giulia&#39;</span><span class="p">:</span><span class="s1">&#39;Friuli Venezia Giulia&#39;</span><span class="p">})</span>
</span><span id="GeoCountry.__init__-963"><a href="#GeoCountry.__init__-963"><span class="linenos"> 963</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;prov_istat_code_num&#39;</span><span class="p">,</span><span class="s1">&#39;reg_istat_code_num&#39;</span><span class="p">,</span><span class="s1">&#39;prov_istat_code&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-964"><a href="#GeoCountry.__init__-964"><span class="linenos"> 964</span></a>
</span><span id="GeoCountry.__init__-965"><a href="#GeoCountry.__init__-965"><span class="linenos"> 965</span></a>        <span class="c1"># --- &#39;IND&#39; case ---------------------------------------------------------------------------------------</span>
</span><span id="GeoCountry.__init__-966"><a href="#GeoCountry.__init__-966"><span class="linenos"> 966</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country</span> <span class="o">==</span> <span class="s1">&#39;IND&#39;</span><span class="p">:</span>
</span><span id="GeoCountry.__init__-967"><a href="#GeoCountry.__init__-967"><span class="linenos"> 967</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span> <span class="c1"># this is a geojson file</span>
</span><span id="GeoCountry.__init__-968"><a href="#GeoCountry.__init__-968"><span class="linenos"> 968</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>\
</span><span id="GeoCountry.__init__-969"><a href="#GeoCountry.__init__-969"><span class="linenos"> 969</span></a>                <span class="s1">&#39;NAME_1&#39;</span><span class="p">:</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-970"><a href="#GeoCountry.__init__-970"><span class="linenos"> 970</span></a>                <span class="s1">&#39;VARNAME_1&#39;</span><span class="p">:</span><span class="s1">&#39;variationname&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-971"><a href="#GeoCountry.__init__-971"><span class="linenos"> 971</span></a>                <span class="s1">&#39;HASC_1&#39;</span><span class="p">:</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-972"><a href="#GeoCountry.__init__-972"><span class="linenos"> 972</span></a>                <span class="p">},</span>
</span><span id="GeoCountry.__init__-973"><a href="#GeoCountry.__init__-973"><span class="linenos"> 973</span></a>                <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-974"><a href="#GeoCountry.__init__-974"><span class="linenos"> 974</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">]</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Orissa&#39;</span><span class="p">,</span><span class="s1">&#39;Odisha&#39;</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-975"><a href="#GeoCountry.__init__-975"><span class="linenos"> 975</span></a>            <span class="n">variationname</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;variationname&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
</span><span id="GeoCountry.__init__-976"><a href="#GeoCountry.__init__-976"><span class="linenos"> 976</span></a>            <span class="n">name_subregion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
</span><span id="GeoCountry.__init__-977"><a href="#GeoCountry.__init__-977"><span class="linenos"> 977</span></a>            <span class="n">alllocationvariation</span><span class="o">=</span><span class="p">[</span> <span class="n">i</span><span class="o">+</span><span class="s1">&#39;|&#39;</span><span class="o">+</span><span class="n">j</span> <span class="k">if</span> <span class="n">j</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="k">else</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">name_subregion</span><span class="p">,</span><span class="n">variationname</span><span class="p">)]</span>
</span><span id="GeoCountry.__init__-978"><a href="#GeoCountry.__init__-978"><span class="linenos"> 978</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;variation_name_subregion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">]</span><span class="o">.</span>\
</span><span id="GeoCountry.__init__-979"><a href="#GeoCountry.__init__-979"><span class="linenos"> 979</span></a>                    <span class="n">replace</span><span class="p">(</span><span class="n">name_subregion</span><span class="p">,</span><span class="n">alllocationvariation</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-980"><a href="#GeoCountry.__init__-980"><span class="linenos"> 980</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">]</span>
</span><span id="GeoCountry.__init__-981"><a href="#GeoCountry.__init__-981"><span class="linenos"> 981</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">]</span>
</span><span id="GeoCountry.__init__-982"><a href="#GeoCountry.__init__-982"><span class="linenos"> 982</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;ISO&#39;</span><span class="p">,</span><span class="s1">&#39;NAME_0&#39;</span><span class="p">,</span><span class="s1">&#39;ID_1&#39;</span><span class="p">,</span><span class="s1">&#39;TYPE_1&#39;</span><span class="p">,</span><span class="s1">&#39;ENGTYPE_1&#39;</span><span class="p">,</span><span class="s1">&#39;id&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-983"><a href="#GeoCountry.__init__-983"><span class="linenos"> 983</span></a>
</span><span id="GeoCountry.__init__-984"><a href="#GeoCountry.__init__-984"><span class="linenos"> 984</span></a>        <span class="c1"># --- &#39;DEU&#39; case ---------------------------------------------------------------------------------------</span>
</span><span id="GeoCountry.__init__-985"><a href="#GeoCountry.__init__-985"><span class="linenos"> 985</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country</span> <span class="o">==</span> <span class="s1">&#39;DEU&#39;</span><span class="p">:</span>
</span><span id="GeoCountry.__init__-986"><a href="#GeoCountry.__init__-986"><span class="linenos"> 986</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span> <span class="c1"># this is a geojson file</span>
</span><span id="GeoCountry.__init__-987"><a href="#GeoCountry.__init__-987"><span class="linenos"> 987</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>\
</span><span id="GeoCountry.__init__-988"><a href="#GeoCountry.__init__-988"><span class="linenos"> 988</span></a>                <span class="s1">&#39;GEN&#39;</span><span class="p">:</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-989"><a href="#GeoCountry.__init__-989"><span class="linenos"> 989</span></a>                <span class="s1">&#39;AGS&#39;</span><span class="p">:</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-990"><a href="#GeoCountry.__init__-990"><span class="linenos"> 990</span></a>                <span class="p">},</span>
</span><span id="GeoCountry.__init__-991"><a href="#GeoCountry.__init__-991"><span class="linenos"> 991</span></a>                <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-992"><a href="#GeoCountry.__init__-992"><span class="linenos"> 992</span></a>            <span class="c1"># See https://www.ioer-monitor.de/en/methodology/glossary/o/official-municipality-key-ags/ for decoding information of region code</span>
</span><span id="GeoCountry.__init__-993"><a href="#GeoCountry.__init__-993"><span class="linenos"> 993</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">code_subregion</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">//</span><span class="mi">1000</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-994"><a href="#GeoCountry.__init__-994"><span class="linenos"> 994</span></a>            <span class="n">h_deu</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="s1">&#39;https://de.zxc.wiki/wiki/Amtlicher_Gemeindeschl%C3%BCssel&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">))[</span><span class="mi">3</span><span class="p">]</span>
</span><span id="GeoCountry.__init__-995"><a href="#GeoCountry.__init__-995"><span class="linenos"> 995</span></a>            <span class="n">h_deu</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">h_deu</span><span class="p">[</span><span class="s1">&#39;#&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">stop</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-996"><a href="#GeoCountry.__init__-996"><span class="linenos"> 996</span></a>            <span class="n">h_deu</span><span class="p">[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">h_deu</span><span class="p">[</span><span class="s1">&#39;country&#39;</span><span class="p">]</span>
</span><span id="GeoCountry.__init__-997"><a href="#GeoCountry.__init__-997"><span class="linenos"> 997</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">h_deu</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;code_region&#39;</span><span class="p">,</span><span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-998"><a href="#GeoCountry.__init__-998"><span class="linenos"> 998</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">code_subregion</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-999"><a href="#GeoCountry.__init__-999"><span class="linenos"> 999</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;name_region&#39;</span><span class="p">,</span><span class="s1">&#39;code_region&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]]</span>
</span><span id="GeoCountry.__init__-1000"><a href="#GeoCountry.__init__-1000"><span class="linenos">1000</span></a>            <span class="n">disso</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">dissolve</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="s1">&#39;sum&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="GeoCountry.__init__-1001"><a href="#GeoCountry.__init__-1001"><span class="linenos">1001</span></a>            <span class="c1"># aggregate geometry with the same subregion name # some code subregion is lost somehow</span>
</span><span id="GeoCountry.__init__-1002"><a href="#GeoCountry.__init__-1002"><span class="linenos">1002</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">])</span>
</span><span id="GeoCountry.__init__-1003"><a href="#GeoCountry.__init__-1003"><span class="linenos">1003</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]),</span><span class="n">disso</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-1004"><a href="#GeoCountry.__init__-1004"><span class="linenos">1004</span></a>
</span><span id="GeoCountry.__init__-1005"><a href="#GeoCountry.__init__-1005"><span class="linenos">1005</span></a>        <span class="c1"># --- &#39;ESP&#39; case ---------------------------------------------------------------------------------------</span>
</span><span id="GeoCountry.__init__-1006"><a href="#GeoCountry.__init__-1006"><span class="linenos">1006</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country</span> <span class="o">==</span> <span class="s1">&#39;ESP&#39;</span><span class="p">:</span>
</span><span id="GeoCountry.__init__-1007"><a href="#GeoCountry.__init__-1007"><span class="linenos">1007</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;zip://&#39;</span><span class="o">+</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;.zip&#39;</span><span class="p">),</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="c1"># this is shapefile file</span>
</span><span id="GeoCountry.__init__-1008"><a href="#GeoCountry.__init__-1008"><span class="linenos">1008</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>\
</span><span id="GeoCountry.__init__-1009"><a href="#GeoCountry.__init__-1009"><span class="linenos">1009</span></a>                <span class="s1">&#39;ccaa&#39;</span><span class="p">:</span><span class="s1">&#39;name_region&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-1010"><a href="#GeoCountry.__init__-1010"><span class="linenos">1010</span></a>                <span class="s1">&#39;cod_ccaa&#39;</span><span class="p">:</span><span class="s1">&#39;code_region&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-1011"><a href="#GeoCountry.__init__-1011"><span class="linenos">1011</span></a>                <span class="s1">&#39;provincia&#39;</span><span class="p">:</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-1012"><a href="#GeoCountry.__init__-1012"><span class="linenos">1012</span></a>                <span class="s1">&#39;codigo&#39;</span><span class="p">:</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">},</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-1013"><a href="#GeoCountry.__init__-1013"><span class="linenos">1013</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;texto&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-1014"><a href="#GeoCountry.__init__-1014"><span class="linenos">1014</span></a>
</span><span id="GeoCountry.__init__-1015"><a href="#GeoCountry.__init__-1015"><span class="linenos">1015</span></a>        <span class="c1"># --- &#39;GBR&#39; case ---------------------------------------------------------------------------------------</span>
</span><span id="GeoCountry.__init__-1016"><a href="#GeoCountry.__init__-1016"><span class="linenos">1016</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country</span> <span class="o">==</span> <span class="s1">&#39;GBR&#39;</span><span class="p">:</span>
</span><span id="GeoCountry.__init__-1017"><a href="#GeoCountry.__init__-1017"><span class="linenos">1017</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
</span><span id="GeoCountry.__init__-1018"><a href="#GeoCountry.__init__-1018"><span class="linenos">1018</span></a>            <span class="n">reg_england</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_source_dict</span><span class="p">[</span><span class="s1">&#39;GBR&#39;</span><span class="p">][</span><span class="s1">&#39;Regions&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">))</span>
</span><span id="GeoCountry.__init__-1019"><a href="#GeoCountry.__init__-1019"><span class="linenos">1019</span></a>            <span class="n">reg_adding_dict</span><span class="o">=</span><span class="p">{</span>
</span><span id="GeoCountry.__init__-1020"><a href="#GeoCountry.__init__-1020"><span class="linenos">1020</span></a>                <span class="s1">&#39;E07000245&#39;</span><span class="p">:(</span><span class="s1">&#39;E12000006&#39;</span><span class="p">,</span><span class="s1">&#39;East of England&#39;</span><span class="p">),</span> <span class="c1"># West Suffolk in East of England</span>
</span><span id="GeoCountry.__init__-1021"><a href="#GeoCountry.__init__-1021"><span class="linenos">1021</span></a>                <span class="s1">&#39;E07000244&#39;</span><span class="p">:(</span><span class="s1">&#39;E12000006&#39;</span><span class="p">,</span><span class="s1">&#39;East of England&#39;</span><span class="p">),</span> <span class="c1"># East Suffolk in East of England</span>
</span><span id="GeoCountry.__init__-1022"><a href="#GeoCountry.__init__-1022"><span class="linenos">1022</span></a>                <span class="s1">&#39;E06000059&#39;</span><span class="p">:(</span><span class="s1">&#39;E12000009&#39;</span><span class="p">,</span><span class="s1">&#39;South West&#39;</span><span class="p">),</span> <span class="c1"># Dorset in South West</span>
</span><span id="GeoCountry.__init__-1023"><a href="#GeoCountry.__init__-1023"><span class="linenos">1023</span></a>                <span class="s1">&#39;E06000058&#39;</span><span class="p">:(</span><span class="s1">&#39;E12000009&#39;</span><span class="p">,</span><span class="s1">&#39;South West&#39;</span><span class="p">),</span> <span class="c1"># Bournemouth, Christchurch and Poole in South West</span>
</span><span id="GeoCountry.__init__-1024"><a href="#GeoCountry.__init__-1024"><span class="linenos">1024</span></a>                <span class="s1">&#39;E07000246&#39;</span><span class="p">:(</span><span class="s1">&#39;E12000009&#39;</span><span class="p">,</span><span class="s1">&#39;South West&#39;</span><span class="p">),</span> <span class="c1"># Somerset West and Taunton in South West</span>
</span><span id="GeoCountry.__init__-1025"><a href="#GeoCountry.__init__-1025"><span class="linenos">1025</span></a>            <span class="p">}</span>
</span><span id="GeoCountry.__init__-1026"><a href="#GeoCountry.__init__-1026"><span class="linenos">1026</span></a>            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">reg_adding_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="GeoCountry.__init__-1027"><a href="#GeoCountry.__init__-1027"><span class="linenos">1027</span></a>                <span class="n">reg_england</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">reg_england</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_records</span><span class="p">([{</span><span class="s1">&#39;LAD18CD&#39;</span><span class="p">:</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;RGN18CD&#39;</span><span class="p">:</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;RGN18NM&#39;</span><span class="p">:</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]}])],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-1028"><a href="#GeoCountry.__init__-1028"><span class="linenos">1028</span></a>
</span><span id="GeoCountry.__init__-1029"><a href="#GeoCountry.__init__-1029"><span class="linenos">1029</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">reg_england</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;lad19cd&#39;</span><span class="p">,</span><span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;LAD18CD&#39;</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-1030"><a href="#GeoCountry.__init__-1030"><span class="linenos">1030</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>\
</span><span id="GeoCountry.__init__-1031"><a href="#GeoCountry.__init__-1031"><span class="linenos">1031</span></a>                <span class="s1">&#39;lad19nm&#39;</span><span class="p">:</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-1032"><a href="#GeoCountry.__init__-1032"><span class="linenos">1032</span></a>                <span class="s1">&#39;lad19cd&#39;</span><span class="p">:</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-1033"><a href="#GeoCountry.__init__-1033"><span class="linenos">1033</span></a>                <span class="s1">&#39;RGN18CD&#39;</span><span class="p">:</span><span class="s1">&#39;code_region&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-1034"><a href="#GeoCountry.__init__-1034"><span class="linenos">1034</span></a>                <span class="s1">&#39;RGN18NM&#39;</span><span class="p">:</span><span class="s1">&#39;name_region&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-1035"><a href="#GeoCountry.__init__-1035"><span class="linenos">1035</span></a>                <span class="p">},</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-1036"><a href="#GeoCountry.__init__-1036"><span class="linenos">1036</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">code_region</span><span class="o">.</span><span class="n">isnull</span><span class="p">(),</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span> <span class="o">=</span> \
</span><span id="GeoCountry.__init__-1037"><a href="#GeoCountry.__init__-1037"><span class="linenos">1037</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">code_region</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span><span class="o">.</span><span class="n">code_subregion</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">stop</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-1038"><a href="#GeoCountry.__init__-1038"><span class="linenos">1038</span></a>            <span class="n">dict_region</span><span class="o">=</span><span class="p">{</span>\
</span><span id="GeoCountry.__init__-1039"><a href="#GeoCountry.__init__-1039"><span class="linenos">1039</span></a>                <span class="s1">&#39;E&#39;</span><span class="p">:</span><span class="s1">&#39;England&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-1040"><a href="#GeoCountry.__init__-1040"><span class="linenos">1040</span></a>                <span class="s1">&#39;W&#39;</span><span class="p">:</span><span class="s1">&#39;Wales&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-1041"><a href="#GeoCountry.__init__-1041"><span class="linenos">1041</span></a>                <span class="s1">&#39;S&#39;</span><span class="p">:</span><span class="s1">&#39;Scotland&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-1042"><a href="#GeoCountry.__init__-1042"><span class="linenos">1042</span></a>                <span class="s1">&#39;N&#39;</span><span class="p">:</span><span class="s1">&#39;Northern Ireland&#39;</span>\
</span><span id="GeoCountry.__init__-1043"><a href="#GeoCountry.__init__-1043"><span class="linenos">1043</span></a>                <span class="p">}</span>
</span><span id="GeoCountry.__init__-1044"><a href="#GeoCountry.__init__-1044"><span class="linenos">1044</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">code_region</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">dict_region</span><span class="o">.</span><span class="n">keys</span><span class="p">())),</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span> <span class="o">=</span> \
</span><span id="GeoCountry.__init__-1045"><a href="#GeoCountry.__init__-1045"><span class="linenos">1045</span></a>                <span class="p">[</span><span class="n">dict_region</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">code_region</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">dict_region</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span>
</span><span id="GeoCountry.__init__-1046"><a href="#GeoCountry.__init__-1046"><span class="linenos">1046</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">,</span><span class="s1">&#39;code_region&#39;</span><span class="p">,</span><span class="s1">&#39;name_region&#39;</span><span class="p">]]</span>
</span><span id="GeoCountry.__init__-1047"><a href="#GeoCountry.__init__-1047"><span class="linenos">1047</span></a>            <span class="c1"># modifying projection</span>
</span><span id="GeoCountry.__init__-1048"><a href="#GeoCountry.__init__-1048"><span class="linenos">1048</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="s1">&#39;epsg:4326&#39;</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-1049"><a href="#GeoCountry.__init__-1049"><span class="linenos">1049</span></a>        <span class="c1"># --- &#39;BEL&#39; case --------------------------------------------------------------------------------------------</span>
</span><span id="GeoCountry.__init__-1050"><a href="#GeoCountry.__init__-1050"><span class="linenos">1050</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country</span> <span class="o">==</span> <span class="s1">&#39;BEL&#39;</span><span class="p">:</span>
</span><span id="GeoCountry.__init__-1051"><a href="#GeoCountry.__init__-1051"><span class="linenos">1051</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;zip://&#39;</span><span class="o">+</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;.zip&#39;</span><span class="p">),</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="c1"># this is shapefile file</span>
</span><span id="GeoCountry.__init__-1052"><a href="#GeoCountry.__init__-1052"><span class="linenos">1052</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">notnull</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span> <span class="c1"># to solve the issue https://github.com/geopandas/geopandas/issues/2783</span>
</span><span id="GeoCountry.__init__-1053"><a href="#GeoCountry.__init__-1053"><span class="linenos">1053</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>\
</span><span id="GeoCountry.__init__-1054"><a href="#GeoCountry.__init__-1054"><span class="linenos">1054</span></a>                <span class="s1">&#39;nom_arrondi&#39;</span><span class="p">:</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-1055"><a href="#GeoCountry.__init__-1055"><span class="linenos">1055</span></a>                <span class="s1">&#39;niscode&#39;</span><span class="p">:</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-1056"><a href="#GeoCountry.__init__-1056"><span class="linenos">1056</span></a>                <span class="s1">&#39;prov_code&#39;</span><span class="p">:</span><span class="s1">&#39;code_region&#39;</span><span class="p">},</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-1057"><a href="#GeoCountry.__init__-1057"><span class="linenos">1057</span></a>            <span class="n">p</span><span class="o">=</span><span class="p">[]</span>
</span><span id="GeoCountry.__init__-1058"><a href="#GeoCountry.__init__-1058"><span class="linenos">1058</span></a>
</span><span id="GeoCountry.__init__-1059"><a href="#GeoCountry.__init__-1059"><span class="linenos">1059</span></a>            <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="GeoCountry.__init__-1060"><a href="#GeoCountry.__init__-1060"><span class="linenos">1060</span></a>                <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">prov_name_n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GeoCountry.__init__-1061"><a href="#GeoCountry.__init__-1061"><span class="linenos">1061</span></a>                    <span class="n">p0</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">prov_name_n</span>
</span><span id="GeoCountry.__init__-1062"><a href="#GeoCountry.__init__-1062"><span class="linenos">1062</span></a>                <span class="k">elif</span> <span class="n">row</span><span class="o">.</span><span class="n">prov_name_f</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GeoCountry.__init__-1063"><a href="#GeoCountry.__init__-1063"><span class="linenos">1063</span></a>                    <span class="n">p0</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">prov_name_f</span>
</span><span id="GeoCountry.__init__-1064"><a href="#GeoCountry.__init__-1064"><span class="linenos">1064</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="GeoCountry.__init__-1065"><a href="#GeoCountry.__init__-1065"><span class="linenos">1065</span></a>                    <span class="n">p0</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">region</span>
</span><span id="GeoCountry.__init__-1066"><a href="#GeoCountry.__init__-1066"><span class="linenos">1066</span></a>                <span class="n">p0</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">p0</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;(Le)&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;(La)&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-1067"><a href="#GeoCountry.__init__-1067"><span class="linenos">1067</span></a>                <span class="k">if</span> <span class="n">p0</span><span class="o">==</span><span class="s1">&#39;RégionDeBruxellesCapitale&#39;</span><span class="p">:</span>
</span><span id="GeoCountry.__init__-1068"><a href="#GeoCountry.__init__-1068"><span class="linenos">1068</span></a>                    <span class="n">p0</span><span class="o">=</span><span class="s1">&#39;Brussels&#39;</span>
</span><span id="GeoCountry.__init__-1069"><a href="#GeoCountry.__init__-1069"><span class="linenos">1069</span></a>                <span class="k">if</span> <span class="n">p0</span><span class="o">==</span><span class="s1">&#39;Henegouwen&#39;</span><span class="p">:</span>
</span><span id="GeoCountry.__init__-1070"><a href="#GeoCountry.__init__-1070"><span class="linenos">1070</span></a>                    <span class="n">p0</span><span class="o">=</span><span class="s1">&#39;Hainaut&#39;</span>
</span><span id="GeoCountry.__init__-1071"><a href="#GeoCountry.__init__-1071"><span class="linenos">1071</span></a>                <span class="n">p</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p0</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-1072"><a href="#GeoCountry.__init__-1072"><span class="linenos">1072</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">p</span>
</span><span id="GeoCountry.__init__-1073"><a href="#GeoCountry.__init__-1073"><span class="linenos">1073</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">code_region</span><span class="o">.</span><span class="n">isnull</span><span class="p">(),</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;00000&#39;</span>
</span><span id="GeoCountry.__init__-1074"><a href="#GeoCountry.__init__-1074"><span class="linenos">1074</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;name_region&#39;</span><span class="p">,</span><span class="s1">&#39;code_region&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]]</span>
</span><span id="GeoCountry.__init__-1075"><a href="#GeoCountry.__init__-1075"><span class="linenos">1075</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="s1">&#39;epsg:4326&#39;</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-1076"><a href="#GeoCountry.__init__-1076"><span class="linenos">1076</span></a>        <span class="c1"># --- &#39;PRT&#39; case --------------------------------------------------------------------------------------------</span>
</span><span id="GeoCountry.__init__-1077"><a href="#GeoCountry.__init__-1077"><span class="linenos">1077</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country</span> <span class="o">==</span> <span class="s1">&#39;PRT&#39;</span><span class="p">:</span>
</span><span id="GeoCountry.__init__-1078"><a href="#GeoCountry.__init__-1078"><span class="linenos">1078</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;zip://&#39;</span><span class="o">+</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;.zip&#39;</span><span class="p">),</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-1079"><a href="#GeoCountry.__init__-1079"><span class="linenos">1079</span></a>            <span class="c1">#self._district=pd.read_json(self._source_dict[&#39;PRT&#39;][&#39;District&#39;])[[&#39;name&#39;,&#39;district&#39;]].dropna()</span>
</span><span id="GeoCountry.__init__-1080"><a href="#GeoCountry.__init__-1080"><span class="linenos">1080</span></a>
</span><span id="GeoCountry.__init__-1081"><a href="#GeoCountry.__init__-1081"><span class="linenos">1081</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>\
</span><span id="GeoCountry.__init__-1082"><a href="#GeoCountry.__init__-1082"><span class="linenos">1082</span></a>                <span class="s1">&#39;NAME_2&#39;</span><span class="p">:</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-1083"><a href="#GeoCountry.__init__-1083"><span class="linenos">1083</span></a>                <span class="s1">&#39;NAME_1&#39;</span><span class="p">:</span><span class="s1">&#39;name_region&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-1084"><a href="#GeoCountry.__init__-1084"><span class="linenos">1084</span></a>                <span class="s1">&#39;HASC_2&#39;</span><span class="p">:</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">},</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-1085"><a href="#GeoCountry.__init__-1085"><span class="linenos">1085</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">code_subregion</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">stop</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-1086"><a href="#GeoCountry.__init__-1086"><span class="linenos">1086</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;name_region&#39;</span><span class="p">,</span><span class="s1">&#39;code_region&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]]</span>
</span><span id="GeoCountry.__init__-1087"><a href="#GeoCountry.__init__-1087"><span class="linenos">1087</span></a>        <span class="c1"># --- &#39;MYS&#39; case --------------------------------------------------------------------------------------------</span>
</span><span id="GeoCountry.__init__-1088"><a href="#GeoCountry.__init__-1088"><span class="linenos">1088</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country</span> <span class="o">==</span> <span class="s1">&#39;MYS&#39;</span><span class="p">:</span>
</span><span id="GeoCountry.__init__-1089"><a href="#GeoCountry.__init__-1089"><span class="linenos">1089</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;zip://&#39;</span><span class="o">+</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;.zip&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">dissolve</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;nam&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="GeoCountry.__init__-1090"><a href="#GeoCountry.__init__-1090"><span class="linenos">1090</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">title</span><span class="p">()</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">nam</span><span class="p">]</span>
</span><span id="GeoCountry.__init__-1091"><a href="#GeoCountry.__init__-1091"><span class="linenos">1091</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">name_subregion</span>
</span><span id="GeoCountry.__init__-1092"><a href="#GeoCountry.__init__-1092"><span class="linenos">1092</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;MYS&#39;</span>
</span><span id="GeoCountry.__init__-1093"><a href="#GeoCountry.__init__-1093"><span class="linenos">1093</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;Malaysia&#39;</span>
</span><span id="GeoCountry.__init__-1094"><a href="#GeoCountry.__init__-1094"><span class="linenos">1094</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">code_subregion</span>
</span><span id="GeoCountry.__init__-1095"><a href="#GeoCountry.__init__-1095"><span class="linenos">1095</span></a>            <span class="c1"># to help the join procedure with current covid data, some translation</span>
</span><span id="GeoCountry.__init__-1096"><a href="#GeoCountry.__init__-1096"><span class="linenos">1096</span></a>            <span class="n">dict_subregion</span><span class="o">=</span><span class="p">{</span>\
</span><span id="GeoCountry.__init__-1097"><a href="#GeoCountry.__init__-1097"><span class="linenos">1097</span></a>                <span class="s1">&#39;Wilayah Persekutuan Labuan&#39;</span><span class="p">:</span><span class="s1">&#39;W.P. Labuan&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-1098"><a href="#GeoCountry.__init__-1098"><span class="linenos">1098</span></a>                <span class="s1">&#39;Wilayah Persekutuan&#39;</span><span class="p">:</span><span class="s1">&#39;W.P. Kuala Lumpur&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-1099"><a href="#GeoCountry.__init__-1099"><span class="linenos">1099</span></a>                <span class="p">}</span>
</span><span id="GeoCountry.__init__-1100"><a href="#GeoCountry.__init__-1100"><span class="linenos">1100</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">code_subregion</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">dict_subregion</span><span class="o">.</span><span class="n">keys</span><span class="p">())),</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">]</span> <span class="o">=</span> \
</span><span id="GeoCountry.__init__-1101"><a href="#GeoCountry.__init__-1101"><span class="linenos">1101</span></a>                <span class="p">[</span><span class="n">dict_subregion</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">code_subregion</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">dict_subregion</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span>
</span><span id="GeoCountry.__init__-1102"><a href="#GeoCountry.__init__-1102"><span class="linenos">1102</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;name_region&#39;</span><span class="p">,</span><span class="s1">&#39;code_region&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]]</span>
</span><span id="GeoCountry.__init__-1103"><a href="#GeoCountry.__init__-1103"><span class="linenos">1103</span></a>        <span class="c1"># --- &#39;CHL&#39; case --------------------------------------------------------------------------------------------</span>
</span><span id="GeoCountry.__init__-1104"><a href="#GeoCountry.__init__-1104"><span class="linenos">1104</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country</span> <span class="o">==</span> <span class="s1">&#39;CHL&#39;</span><span class="p">:</span>
</span><span id="GeoCountry.__init__-1105"><a href="#GeoCountry.__init__-1105"><span class="linenos">1105</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;zip://&#39;</span><span class="o">+</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;.zip&#39;</span><span class="p">),</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-1106"><a href="#GeoCountry.__init__-1106"><span class="linenos">1106</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>\
</span><span id="GeoCountry.__init__-1107"><a href="#GeoCountry.__init__-1107"><span class="linenos">1107</span></a>                <span class="s1">&#39;NOM_REG&#39;</span><span class="p">:</span><span class="s1">&#39;name_region&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-1108"><a href="#GeoCountry.__init__-1108"><span class="linenos">1108</span></a>                <span class="s1">&#39;NOM_COM&#39;</span><span class="p">:</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">},</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-1109"><a href="#GeoCountry.__init__-1109"><span class="linenos">1109</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">COD_COMUNA</span><span class="p">]</span>
</span><span id="GeoCountry.__init__-1110"><a href="#GeoCountry.__init__-1110"><span class="linenos">1110</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">code_subregion</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">stop</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-1111"><a href="#GeoCountry.__init__-1111"><span class="linenos">1111</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;name_region&#39;</span><span class="p">,</span><span class="s1">&#39;code_region&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]]</span>
</span><span id="GeoCountry.__init__-1112"><a href="#GeoCountry.__init__-1112"><span class="linenos">1112</span></a>
</span><span id="GeoCountry.__init__-1113"><a href="#GeoCountry.__init__-1113"><span class="linenos">1113</span></a>        <span class="c1"># --- &#39;EUR&#39; case, which is a pseudo country for Europe ---------------------------------------------------------</span>
</span><span id="GeoCountry.__init__-1114"><a href="#GeoCountry.__init__-1114"><span class="linenos">1114</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country</span> <span class="o">==</span> <span class="s1">&#39;EUR&#39;</span><span class="p">:</span>
</span><span id="GeoCountry.__init__-1115"><a href="#GeoCountry.__init__-1115"><span class="linenos">1115</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
</span><span id="GeoCountry.__init__-1116"><a href="#GeoCountry.__init__-1116"><span class="linenos">1116</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>\
</span><span id="GeoCountry.__init__-1117"><a href="#GeoCountry.__init__-1117"><span class="linenos">1117</span></a>                <span class="s1">&#39;UID&#39;</span><span class="p">:</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-1118"><a href="#GeoCountry.__init__-1118"><span class="linenos">1118</span></a>                <span class="s1">&#39;RegionName&#39;</span><span class="p">:</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-1119"><a href="#GeoCountry.__init__-1119"><span class="linenos">1119</span></a>                <span class="s1">&#39;ADM0_ISO3&#39;</span><span class="p">:</span><span class="s1">&#39;code_region&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-1120"><a href="#GeoCountry.__init__-1120"><span class="linenos">1120</span></a>                <span class="s1">&#39;ADM0_NAME&#39;</span><span class="p">:</span><span class="s1">&#39;name_region&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-1121"><a href="#GeoCountry.__init__-1121"><span class="linenos">1121</span></a>                <span class="s1">&#39;Population&#39;</span><span class="p">:</span><span class="s1">&#39;population_subregion&#39;</span><span class="p">},</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-1122"><a href="#GeoCountry.__init__-1122"><span class="linenos">1122</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;population_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;name_region&#39;</span><span class="p">,</span><span class="s1">&#39;code_region&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]]</span>
</span><span id="GeoCountry.__init__-1123"><a href="#GeoCountry.__init__-1123"><span class="linenos">1123</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">is_empty</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span>
</span><span id="GeoCountry.__init__-1124"><a href="#GeoCountry.__init__-1124"><span class="linenos">1124</span></a>            <span class="c1"># self._country_data=self._country_data[self._country_data.geometry!=None] to remove subregion without geometry</span>
</span><span id="GeoCountry.__init__-1125"><a href="#GeoCountry.__init__-1125"><span class="linenos">1125</span></a>
</span><span id="GeoCountry.__init__-1126"><a href="#GeoCountry.__init__-1126"><span class="linenos">1126</span></a>        <span class="c1"># --- &#39;GRC&#39; case ------------------------------------------------------------------------------------------------</span>
</span><span id="GeoCountry.__init__-1127"><a href="#GeoCountry.__init__-1127"><span class="linenos">1127</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country</span> <span class="o">==</span> <span class="s1">&#39;GRC&#39;</span><span class="p">:</span>
</span><span id="GeoCountry.__init__-1128"><a href="#GeoCountry.__init__-1128"><span class="linenos">1128</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;zip://&#39;</span><span class="o">+</span><span class="n">get_local_from_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;.zip&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;!nomoi_okxe&#39;</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;ISO-8859-7&#39;</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-1129"><a href="#GeoCountry.__init__-1129"><span class="linenos">1129</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>\
</span><span id="GeoCountry.__init__-1130"><a href="#GeoCountry.__init__-1130"><span class="linenos">1130</span></a>                <span class="s1">&#39;POP&#39;</span><span class="p">:</span><span class="s1">&#39;population_subregion&#39;</span><span class="p">},</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-1131"><a href="#GeoCountry.__init__-1131"><span class="linenos">1131</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">NAME_GR</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-1132"><a href="#GeoCountry.__init__-1132"><span class="linenos">1132</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">PARENT</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">stop</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-1133"><a href="#GeoCountry.__init__-1133"><span class="linenos">1133</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">]</span>
</span><span id="GeoCountry.__init__-1134"><a href="#GeoCountry.__init__-1134"><span class="linenos">1134</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">]</span> <span class="c1"># no region info</span>
</span><span id="GeoCountry.__init__-1135"><a href="#GeoCountry.__init__-1135"><span class="linenos">1135</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;population_subregion&#39;</span><span class="p">,</span><span class="s1">&#39;name_region&#39;</span><span class="p">,</span><span class="s1">&#39;code_region&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]]</span>
</span><span id="GeoCountry.__init__-1136"><a href="#GeoCountry.__init__-1136"><span class="linenos">1136</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">4326</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-1137"><a href="#GeoCountry.__init__-1137"><span class="linenos">1137</span></a>            <span class="c1"># Merge region to fit with the CSV epidemiological data</span>
</span><span id="GeoCountry.__init__-1138"><a href="#GeoCountry.__init__-1138"><span class="linenos">1138</span></a>            <span class="n">ath</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ΔΥΤΙΚΗΣ ΑΤΤΙΚΗΣ&#39;</span><span class="p">,</span> <span class="s1">&#39;ΑΝΑΤΟΛΙΚΗΣ ΑΤΤΙΚΗΣ&#39;</span><span class="p">,</span> <span class="s1">&#39;ΠΕΙΡΑΙΩΣ ΚΑΙ ΝΗΣΩΝ&#39;</span><span class="p">,</span><span class="s1">&#39;ΑΘΗΝΩΝ&#39;</span><span class="p">]</span>
</span><span id="GeoCountry.__init__-1139"><a href="#GeoCountry.__init__-1139"><span class="linenos">1139</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">name_subregion</span><span class="o">==</span><span class="s1">&#39;ΑΘΗΝΩΝ&#39;</span><span class="p">),[</span><span class="s1">&#39;geometry&#39;</span><span class="p">,</span><span class="s1">&#39;population_subregion&#39;</span><span class="p">]]</span><span class="o">=</span>\
</span><span id="GeoCountry.__init__-1140"><a href="#GeoCountry.__init__-1140"><span class="linenos">1140</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">name_subregion</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">ath</span><span class="p">)]</span><span class="o">.</span><span class="n">dissolve</span><span class="p">(</span><span class="n">aggfunc</span><span class="o">=</span><span class="s1">&#39;sum&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
</span><span id="GeoCountry.__init__-1141"><a href="#GeoCountry.__init__-1141"><span class="linenos">1141</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">name_subregion</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">ath</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])]</span>
</span><span id="GeoCountry.__init__-1142"><a href="#GeoCountry.__init__-1142"><span class="linenos">1142</span></a>            <span class="n">changename</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Ο ΟΡΟΣ&#39;</span><span class="p">:</span><span class="s1">&#39;ΑΓΙΟ ΟΡΟΣ&#39;</span><span class="p">,</span><span class="s1">&#39;ΑΘΗΝΩΝ&#39;</span><span class="p">:</span><span class="s1">&#39;ΑΤΤΙΚΗΣ&#39;</span><span class="p">}</span>
</span><span id="GeoCountry.__init__-1143"><a href="#GeoCountry.__init__-1143"><span class="linenos">1143</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">changename</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-1144"><a href="#GeoCountry.__init__-1144"><span class="linenos">1144</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">changename</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-1145"><a href="#GeoCountry.__init__-1145"><span class="linenos">1145</span></a>
</span><span id="GeoCountry.__init__-1146"><a href="#GeoCountry.__init__-1146"><span class="linenos">1146</span></a>        <span class="c1">#--- &#39;JPN&#39; case ----------------------------------------------------------------------------------------</span>
</span><span id="GeoCountry.__init__-1147"><a href="#GeoCountry.__init__-1147"><span class="linenos">1147</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country</span> <span class="o">==</span> <span class="s1">&#39;JPN&#39;</span><span class="p">:</span>
</span><span id="GeoCountry.__init__-1148"><a href="#GeoCountry.__init__-1148"><span class="linenos">1148</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/dataofjapan/land/master/japan.geojson&#39;</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-1149"><a href="#GeoCountry.__init__-1149"><span class="linenos">1149</span></a>            <span class="n">np_name_subregion_jpn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;Hokkaido&#39;</span><span class="p">,</span> <span class="s1">&#39;Aomori&#39;</span><span class="p">,</span> <span class="s1">&#39;Iwate&#39;</span><span class="p">,</span> <span class="s1">&#39;Miyagi&#39;</span><span class="p">,</span> <span class="s1">&#39;Akita&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-1150"><a href="#GeoCountry.__init__-1150"><span class="linenos">1150</span></a>                                              <span class="s1">&#39;Yamagata&#39;</span><span class="p">,</span> <span class="s1">&#39;Fukushima&#39;</span><span class="p">,</span> <span class="s1">&#39;Ibaraki&#39;</span><span class="p">,</span> <span class="s1">&#39;Tochigi&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-1151"><a href="#GeoCountry.__init__-1151"><span class="linenos">1151</span></a>                                              <span class="s1">&#39;Gunma&#39;</span><span class="p">,</span> <span class="s1">&#39;Saitama&#39;</span><span class="p">,</span><span class="s1">&#39;Chiba&#39;</span><span class="p">,</span> <span class="s1">&#39;Tokyo&#39;</span><span class="p">,</span> <span class="s1">&#39;Kanagawa&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-1152"><a href="#GeoCountry.__init__-1152"><span class="linenos">1152</span></a>                                              <span class="s1">&#39;Niigata&#39;</span><span class="p">,</span> <span class="s1">&#39;Toyama&#39;</span><span class="p">,</span> <span class="s1">&#39;Ishikawa&#39;</span><span class="p">,</span> <span class="s1">&#39;Fukui&#39;</span><span class="p">,</span><span class="s1">&#39;Yamanashi&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-1153"><a href="#GeoCountry.__init__-1153"><span class="linenos">1153</span></a>                                              <span class="s1">&#39;Nagano&#39;</span><span class="p">,</span> <span class="s1">&#39;Gifu&#39;</span><span class="p">,</span> <span class="s1">&#39;Shizuoka&#39;</span><span class="p">,</span> <span class="s1">&#39;Aichi&#39;</span><span class="p">,</span> <span class="s1">&#39;Mie&#39;</span><span class="p">,</span> <span class="s1">&#39;Shiga&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-1154"><a href="#GeoCountry.__init__-1154"><span class="linenos">1154</span></a>                                              <span class="s1">&#39;Kyoto&#39;</span><span class="p">,</span> <span class="s1">&#39;Osaka&#39;</span><span class="p">,</span> <span class="s1">&#39;Hyogo&#39;</span><span class="p">,</span> <span class="s1">&#39;Nara&#39;</span><span class="p">,</span> <span class="s1">&#39;Wakayama&#39;</span><span class="p">,</span> <span class="s1">&#39;Tottori&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-1155"><a href="#GeoCountry.__init__-1155"><span class="linenos">1155</span></a>                                              <span class="s1">&#39;Shimane&#39;</span><span class="p">,</span><span class="s1">&#39;Okayama&#39;</span><span class="p">,</span> <span class="s1">&#39;Hiroshima&#39;</span><span class="p">,</span> <span class="s1">&#39;Yamaguchi&#39;</span><span class="p">,</span> <span class="s1">&#39;Tokushima&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-1156"><a href="#GeoCountry.__init__-1156"><span class="linenos">1156</span></a>                                              <span class="s1">&#39;Kagawa&#39;</span><span class="p">,</span> <span class="s1">&#39;Ehime&#39;</span><span class="p">,</span><span class="s1">&#39;Kochi&#39;</span><span class="p">,</span> <span class="s1">&#39;Fukuoka&#39;</span><span class="p">,</span> <span class="s1">&#39;Saga&#39;</span><span class="p">,</span> <span class="s1">&#39;Nagasaki&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-1157"><a href="#GeoCountry.__init__-1157"><span class="linenos">1157</span></a>                                              <span class="s1">&#39;Kumamoto&#39;</span><span class="p">,</span> <span class="s1">&#39;Oita&#39;</span><span class="p">,</span> <span class="s1">&#39;Miyazaki&#39;</span><span class="p">,</span><span class="s1">&#39;Kagoshima&#39;</span><span class="p">,</span> <span class="s1">&#39;Okinawa&#39;</span><span class="p">])</span>
</span><span id="GeoCountry.__init__-1158"><a href="#GeoCountry.__init__-1158"><span class="linenos">1158</span></a>            <span class="n">np_town_subregion_jpn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;Sapporo&#39;</span><span class="p">,</span><span class="s1">&#39;Aomori&#39;</span><span class="p">,</span><span class="s1">&#39;Morioka&#39;</span><span class="p">,</span><span class="s1">&#39;Sendai&#39;</span><span class="p">,</span><span class="s1">&#39;Akita&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-1159"><a href="#GeoCountry.__init__-1159"><span class="linenos">1159</span></a>                                              <span class="s1">&#39;Yamagata&#39;</span><span class="p">,</span><span class="s1">&#39;Fukushima&#39;</span><span class="p">,</span><span class="s1">&#39;Mito&#39;</span><span class="p">,</span><span class="s1">&#39;Utsunomiya&#39;</span><span class="p">,</span><span class="s1">&#39;Maebashi&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-1160"><a href="#GeoCountry.__init__-1160"><span class="linenos">1160</span></a>                                              <span class="s1">&#39;Saitama&#39;</span><span class="p">,</span><span class="s1">&#39;Chiba&#39;</span><span class="p">,</span><span class="s1">&#39;Shinjuku&#39;</span><span class="p">,</span><span class="s1">&#39;Yokohama&#39;</span><span class="p">,</span><span class="s1">&#39;Niigata&#39;</span><span class="p">,</span><span class="s1">&#39;Toyama&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-1161"><a href="#GeoCountry.__init__-1161"><span class="linenos">1161</span></a>                                              <span class="s1">&#39;Kanazawa&#39;</span><span class="p">,</span><span class="s1">&#39;Fukui&#39;</span><span class="p">,</span><span class="s1">&#39;Kofu&#39;</span><span class="p">,</span><span class="s1">&#39;Nagano&#39;</span><span class="p">,</span><span class="s1">&#39;Gifu&#39;</span><span class="p">,</span><span class="s1">&#39;Shizuoka&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-1162"><a href="#GeoCountry.__init__-1162"><span class="linenos">1162</span></a>                                              <span class="s1">&#39;Nagoya&#39;</span><span class="p">,</span><span class="s1">&#39;Tsu&#39;</span><span class="p">,</span><span class="s1">&#39;Otsu&#39;</span><span class="p">,</span><span class="s1">&#39;Kyoto&#39;</span><span class="p">,</span><span class="s1">&#39;Osaka&#39;</span><span class="p">,</span><span class="s1">&#39;Kobe&#39;</span><span class="p">,</span><span class="s1">&#39;Nara&#39;</span><span class="p">,</span><span class="s1">&#39;Wakayama&#39;</span><span class="p">,</span><span class="s1">&#39;Tottori&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-1163"><a href="#GeoCountry.__init__-1163"><span class="linenos">1163</span></a>                                              <span class="s1">&#39;Matsue&#39;</span><span class="p">,</span><span class="s1">&#39;Okayama&#39;</span><span class="p">,</span><span class="s1">&#39;Hiroshima&#39;</span><span class="p">,</span><span class="s1">&#39;Yamaguchi&#39;</span><span class="p">,</span><span class="s1">&#39;Tokushima&#39;</span><span class="p">,</span><span class="s1">&#39;Takamatsu&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-1164"><a href="#GeoCountry.__init__-1164"><span class="linenos">1164</span></a>                                              <span class="s1">&#39;Matsuyama&#39;</span><span class="p">,</span><span class="s1">&#39;Kochi&#39;</span><span class="p">,</span><span class="s1">&#39;Fukuoka&#39;</span><span class="p">,</span><span class="s1">&#39;Saga&#39;</span><span class="p">,</span><span class="s1">&#39;Nagasaki&#39;</span><span class="p">,</span><span class="s1">&#39;Kumamoto&#39;</span><span class="p">,</span><span class="s1">&#39;Oita&#39;</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-1165"><a href="#GeoCountry.__init__-1165"><span class="linenos">1165</span></a>                                              <span class="s1">&#39;Miyazaki&#39;</span><span class="p">,</span><span class="s1">&#39;Kagoshima&#39;</span><span class="p">,</span><span class="s1">&#39;Naha&#39;</span><span class="p">])</span>
</span><span id="GeoCountry.__init__-1166"><a href="#GeoCountry.__init__-1166"><span class="linenos">1166</span></a>            <span class="n">np_name_region_jpn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;Hokkaido&#39;</span><span class="p">]</span><span class="o">+</span> <span class="mi">6</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;Tohoku&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">7</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;Kanto&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">9</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;Chubu&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">5</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;Chugoku&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;Shikoku&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">7</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;Kansai&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">8</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;Kyushu&#39;</span><span class="p">])</span>
</span><span id="GeoCountry.__init__-1167"><a href="#GeoCountry.__init__-1167"><span class="linenos">1167</span></a>            <span class="n">np_code_region_jpn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;Hokkaido&#39;</span><span class="p">]</span><span class="o">+</span> <span class="mi">6</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;Tohoku&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">7</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;Kanto&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">9</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;Chubu&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">5</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;Chugoku&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;Shikoku&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">7</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;Kansai&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">8</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;Kyushu&#39;</span><span class="p">])</span>
</span><span id="GeoCountry.__init__-1168"><a href="#GeoCountry.__init__-1168"><span class="linenos">1168</span></a>            <span class="n">np_code_subregion_jpn</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">48</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-1169"><a href="#GeoCountry.__init__-1169"><span class="linenos">1169</span></a>            <span class="n">np_population_subregion_jpn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">5224614</span><span class="p">,</span><span class="mi">1237984</span><span class="p">,</span><span class="mi">1210534</span><span class="p">,</span><span class="mi">2301996</span><span class="p">,</span><span class="mi">959502</span><span class="p">,</span> <span class="mi">1068027</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1170"><a href="#GeoCountry.__init__-1170"><span class="linenos">1170</span></a>                                        <span class="mi">1833152</span><span class="p">,</span><span class="mi">2867009</span><span class="p">,</span><span class="mi">1933146</span><span class="p">,</span><span class="mi">1939110</span><span class="p">,</span><span class="mi">7344765</span><span class="p">,</span><span class="mi">6284480</span><span class="p">,</span><span class="mi">14047594</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1171"><a href="#GeoCountry.__init__-1171"><span class="linenos">1171</span></a>                                        <span class="mi">9237337</span><span class="p">,</span><span class="mi">2201272</span><span class="p">,</span><span class="mi">1034814</span><span class="p">,</span><span class="mi">1132852</span><span class="p">,</span><span class="mi">766863</span><span class="p">,</span><span class="mi">809974</span><span class="p">,</span><span class="mi">2048011</span><span class="p">,</span> <span class="mi">1978742</span><span class="p">,</span><span class="mi">3633202</span><span class="p">,</span><span class="mi">7542415</span><span class="p">,</span><span class="mi">1770254</span><span class="p">,</span><span class="mi">1413610</span><span class="p">,</span><span class="mi">2578087</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1172"><a href="#GeoCountry.__init__-1172"><span class="linenos">1172</span></a>                                        <span class="mi">8837685</span><span class="p">,</span> <span class="mi">5465002</span><span class="p">,</span> <span class="mi">1324473</span><span class="p">,</span> <span class="mi">922584</span><span class="p">,</span> <span class="mi">553407</span><span class="p">,</span> <span class="mi">671126</span><span class="p">,</span> <span class="mi">1888432</span><span class="p">,</span> <span class="mi">2799702</span><span class="p">,</span> <span class="mi">1342059</span><span class="p">,</span><span class="mi">719559</span><span class="p">,</span> <span class="mi">950244</span><span class="p">,</span> <span class="mi">1344841</span><span class="p">,</span> <span class="mi">691527</span><span class="p">,</span> <span class="mi">5135214</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1173"><a href="#GeoCountry.__init__-1173"><span class="linenos">1173</span></a>                                        <span class="mi">811442</span><span class="p">,</span> <span class="mi">1312317</span><span class="p">,</span> <span class="mi">1738301</span><span class="p">,</span> <span class="mi">1123852</span><span class="p">,</span> <span class="mi">1069576</span><span class="p">,</span> <span class="mi">1588256</span><span class="p">,</span> <span class="mi">1467480</span><span class="p">])</span>
</span><span id="GeoCountry.__init__-1174"><a href="#GeoCountry.__init__-1174"><span class="linenos">1174</span></a>            <span class="n">np_area_subregion_jpn</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">83457.00</span><span class="p">,</span><span class="mf">9644.55</span><span class="p">,</span><span class="mf">15278.89</span><span class="p">,</span><span class="mf">7285.77</span><span class="p">,</span> <span class="mf">11636.28</span><span class="p">,</span> <span class="mf">9323.46</span><span class="p">,</span> <span class="mf">13782.76</span><span class="p">,</span>  <span class="mf">6095.72</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1175"><a href="#GeoCountry.__init__-1175"><span class="linenos">1175</span></a>                                 <span class="mf">6408.28</span><span class="p">,</span><span class="mf">6362.33</span><span class="p">,</span> <span class="mf">3798.08</span><span class="p">,</span> <span class="mf">5156.61</span><span class="p">,</span> <span class="mf">2188.67</span><span class="p">,</span> <span class="mf">2415.86</span><span class="p">,</span> <span class="mf">12583.83</span><span class="p">,</span> <span class="mf">4247.61</span><span class="p">,</span><span class="mf">4185.67</span><span class="p">,</span> <span class="mf">4189.88</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1176"><a href="#GeoCountry.__init__-1176"><span class="linenos">1176</span></a>                                 <span class="mf">4465.37</span><span class="p">,</span>  <span class="mf">13562.23</span><span class="p">,</span> <span class="mf">10621.17</span><span class="p">,</span> <span class="mf">7780.50</span><span class="p">,</span>  <span class="mf">5165.12</span><span class="p">,</span> <span class="mf">5777.31</span><span class="p">,</span> <span class="mf">4017.36</span><span class="p">,</span> <span class="mf">4613.21</span><span class="p">,</span> <span class="mf">1899.28</span><span class="p">,</span> <span class="mf">8396.16</span><span class="p">,</span> <span class="mf">3691.09</span><span class="p">,</span> <span class="mf">4726.29</span><span class="p">,</span> <span class="mf">3507.28</span><span class="p">,</span> <span class="mf">6707.96</span><span class="p">,</span> <span class="mf">7113.23</span><span class="p">,</span> <span class="mf">8479.70</span>
</span><span id="GeoCountry.__init__-1177"><a href="#GeoCountry.__init__-1177"><span class="linenos">1177</span></a>                                 <span class="p">,</span><span class="mf">6114.09</span><span class="p">,</span> <span class="mf">4146.74</span><span class="p">,</span> <span class="mf">1876.55</span><span class="p">,</span> <span class="mf">5678.33</span><span class="p">,</span> <span class="mf">7105.16</span><span class="p">,</span> <span class="mf">4978.51</span><span class="p">,</span> <span class="mf">2439.65</span><span class="p">,</span> <span class="mf">4105.47</span><span class="p">,</span> <span class="mf">7404.79</span><span class="p">,</span> <span class="mf">6339.74</span><span class="p">,</span> <span class="mf">7735.99</span><span class="p">,</span> <span class="mf">9188.82</span><span class="p">,</span> <span class="mf">2276.49</span><span class="p">])</span>
</span><span id="GeoCountry.__init__-1178"><a href="#GeoCountry.__init__-1178"><span class="linenos">1178</span></a>            <span class="n">np_flag_subregion_jpn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="GeoCountry.__init__-1179"><a href="#GeoCountry.__init__-1179"><span class="linenos">1179</span></a>                            <span class="p">[</span><span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/2/22/Flag_of_Hokkaido_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1180"><a href="#GeoCountry.__init__-1180"><span class="linenos">1180</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/3/30/Flag_of_Aomori_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1181"><a href="#GeoCountry.__init__-1181"><span class="linenos">1181</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/a/a9/Flag_of_Iwate_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1182"><a href="#GeoCountry.__init__-1182"><span class="linenos">1182</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/c/c7/Flag_of_Miyagi_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1183"><a href="#GeoCountry.__init__-1183"><span class="linenos">1183</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/8/84/Flag_of_Akita_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1184"><a href="#GeoCountry.__init__-1184"><span class="linenos">1184</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/a/a1/Flag_of_Yamagata_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1185"><a href="#GeoCountry.__init__-1185"><span class="linenos">1185</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/4/4b/Flag_of_Fukushima_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1186"><a href="#GeoCountry.__init__-1186"><span class="linenos">1186</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/a/a8/Flag_of_Ibaraki_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1187"><a href="#GeoCountry.__init__-1187"><span class="linenos">1187</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/d/d5/Flag_of_Tochigi_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1188"><a href="#GeoCountry.__init__-1188"><span class="linenos">1188</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/b/ba/Flag_of_Gunma_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1189"><a href="#GeoCountry.__init__-1189"><span class="linenos">1189</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/c/cd/Flag_of_Saitama_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1190"><a href="#GeoCountry.__init__-1190"><span class="linenos">1190</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/0/0a/Flag_of_Chiba_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1191"><a href="#GeoCountry.__init__-1191"><span class="linenos">1191</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/1/15/Flag_of_Tokyo_Metropolis.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1192"><a href="#GeoCountry.__init__-1192"><span class="linenos">1192</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/a/a7/Flag_of_Kanagawa_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1193"><a href="#GeoCountry.__init__-1193"><span class="linenos">1193</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/c/cb/Flag_of_Niigata_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1194"><a href="#GeoCountry.__init__-1194"><span class="linenos">1194</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/1/1d/Flag_of_Toyama_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1195"><a href="#GeoCountry.__init__-1195"><span class="linenos">1195</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/6/6a/Flag_of_Ishikawa_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1196"><a href="#GeoCountry.__init__-1196"><span class="linenos">1196</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/5/56/Flag_of_Fukui_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1197"><a href="#GeoCountry.__init__-1197"><span class="linenos">1197</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/0/00/Flag_of_Yamanashi_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1198"><a href="#GeoCountry.__init__-1198"><span class="linenos">1198</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/f/f0/Flag_of_Nagano_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1199"><a href="#GeoCountry.__init__-1199"><span class="linenos">1199</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/3/3e/Flag_of_Gifu_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1200"><a href="#GeoCountry.__init__-1200"><span class="linenos">1200</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/9/92/Flag_of_Shizuoka_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1201"><a href="#GeoCountry.__init__-1201"><span class="linenos">1201</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/0/02/Flag_of_Aichi_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1202"><a href="#GeoCountry.__init__-1202"><span class="linenos">1202</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/8/8c/Flag_of_Mie_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1203"><a href="#GeoCountry.__init__-1203"><span class="linenos">1203</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/9/99/Flag_of_Shiga_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1204"><a href="#GeoCountry.__init__-1204"><span class="linenos">1204</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/0/06/Flag_of_Kyoto_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1205"><a href="#GeoCountry.__init__-1205"><span class="linenos">1205</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/5/5a/Flag_of_Osaka_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1206"><a href="#GeoCountry.__init__-1206"><span class="linenos">1206</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/7/74/Flag_of_Hyogo_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1207"><a href="#GeoCountry.__init__-1207"><span class="linenos">1207</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/0/00/Flag_of_Nara_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1208"><a href="#GeoCountry.__init__-1208"><span class="linenos">1208</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/6/6e/Flag_of_Wakayama_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1209"><a href="#GeoCountry.__init__-1209"><span class="linenos">1209</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/1/1c/Flag_of_Tottori_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1210"><a href="#GeoCountry.__init__-1210"><span class="linenos">1210</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/e/e8/Flag_of_Shimane_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1211"><a href="#GeoCountry.__init__-1211"><span class="linenos">1211</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/3/33/Flag_of_Okayama_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1212"><a href="#GeoCountry.__init__-1212"><span class="linenos">1212</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/e/ed/Flag_of_Hiroshima_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1213"><a href="#GeoCountry.__init__-1213"><span class="linenos">1213</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/b/b9/Flag_of_Yamaguchi_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1214"><a href="#GeoCountry.__init__-1214"><span class="linenos">1214</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/a/ac/Flag_of_Tokushima_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1215"><a href="#GeoCountry.__init__-1215"><span class="linenos">1215</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/2/29/Flag_of_Kagawa_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1216"><a href="#GeoCountry.__init__-1216"><span class="linenos">1216</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/2/2d/Flag_of_Ehime_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1217"><a href="#GeoCountry.__init__-1217"><span class="linenos">1217</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/5/50/Flag_of_Kochi_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1218"><a href="#GeoCountry.__init__-1218"><span class="linenos">1218</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/7/71/Flag_of_Fukuoka_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1219"><a href="#GeoCountry.__init__-1219"><span class="linenos">1219</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/1/18/Flag_of_Saga_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1220"><a href="#GeoCountry.__init__-1220"><span class="linenos">1220</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/6/65/Flag_of_Nagasaki_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1221"><a href="#GeoCountry.__init__-1221"><span class="linenos">1221</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/f/f7/Flag_of_Kumamoto_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1222"><a href="#GeoCountry.__init__-1222"><span class="linenos">1222</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/c/c8/Flag_of_Oita_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1223"><a href="#GeoCountry.__init__-1223"><span class="linenos">1223</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/0/0b/Flag_of_Miyazaki_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1224"><a href="#GeoCountry.__init__-1224"><span class="linenos">1224</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/c/c5/Flag_of_Kagoshima_Prefecture.svg&#39;</span><span class="p">,</span>
</span><span id="GeoCountry.__init__-1225"><a href="#GeoCountry.__init__-1225"><span class="linenos">1225</span></a>                             <span class="s1">&#39;https://upload.wikimedia.org/wikipedia/commons/2/2f/Flag_of_Okinawa_Prefecture.svg&#39;</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="nb">object</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-1226"><a href="#GeoCountry.__init__-1226"><span class="linenos">1226</span></a>            <span class="n">dic_japan</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name_subregion&#39;</span> <span class="p">:</span> <span class="n">np_name_subregion_jpn</span><span class="p">,</span><span class="s1">&#39;code_region&#39;</span> <span class="p">:</span> <span class="n">np_name_region_jpn</span><span class="p">,</span> <span class="s1">&#39;name_region&#39;</span><span class="p">:</span> <span class="n">np_name_region_jpn</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-1227"><a href="#GeoCountry.__init__-1227"><span class="linenos">1227</span></a>                         <span class="s1">&#39;code_subregion&#39;</span> <span class="p">:</span> <span class="n">np_code_subregion_jpn</span><span class="p">,</span> <span class="s1">&#39;flag_subregion&#39;</span> <span class="p">:</span> <span class="n">np_flag_subregion_jpn</span><span class="p">,</span> <span class="s1">&#39;town_subregion&#39;</span> <span class="p">:</span> <span class="n">np_town_subregion_jpn</span><span class="p">,</span>\
</span><span id="GeoCountry.__init__-1228"><a href="#GeoCountry.__init__-1228"><span class="linenos">1228</span></a>                         <span class="s1">&#39;population_subregion&#39;</span> <span class="p">:</span> <span class="n">np_population_subregion_jpn</span><span class="p">,</span> <span class="s1">&#39;area_subregion&#39;</span> <span class="p">:</span> <span class="n">np_area_subregion_jpn</span> <span class="p">}</span>
</span><span id="GeoCountry.__init__-1229"><a href="#GeoCountry.__init__-1229"><span class="linenos">1229</span></a>            <span class="n">df_japan</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">dic_japan</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-1230"><a href="#GeoCountry.__init__-1230"><span class="linenos">1230</span></a>            <span class="n">df_japan</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">48</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-1231"><a href="#GeoCountry.__init__-1231"><span class="linenos">1231</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span> <span class="p">:</span> <span class="s2">&quot;code_subregion&quot;</span><span class="p">})</span>  <span class="c1">#</span>
</span><span id="GeoCountry.__init__-1232"><a href="#GeoCountry.__init__-1232"><span class="linenos">1232</span></a>            <span class="n">df_final_japan</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_japan</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">])</span>
</span><span id="GeoCountry.__init__-1233"><a href="#GeoCountry.__init__-1233"><span class="linenos">1233</span></a>            <span class="n">df_final_japan</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;nam&#39;</span><span class="p">,</span> <span class="s1">&#39;nam_ja&#39;</span><span class="p">],</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-1234"><a href="#GeoCountry.__init__-1234"><span class="linenos">1234</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">df_final_japan</span><span class="p">)</span>
</span><span id="GeoCountry.__init__-1235"><a href="#GeoCountry.__init__-1235"><span class="linenos">1235</span></a>            <span class="c1">#code_subregion as to be str to be able to be merged ...</span>
</span><span id="GeoCountry.__init__-1236"><a href="#GeoCountry.__init__-1236"><span class="linenos">1236</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>__init__ member function.
Must give as arg the country to deal with, as a valid ISO3 string.</p>
</div>


                            </div>
                            <div id="GeoCountry.set_dense_geometry" class="classattr">
                                        <input id="GeoCountry.set_dense_geometry-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_dense_geometry</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GeoCountry.set_dense_geometry-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GeoCountry.set_dense_geometry"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GeoCountry.set_dense_geometry-1245"><a href="#GeoCountry.set_dense_geometry-1245"><span class="linenos">1245</span></a>    <span class="k">def</span> <span class="nf">set_dense_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GeoCountry.set_dense_geometry-1246"><a href="#GeoCountry.set_dense_geometry-1246"><span class="linenos">1246</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;  If used, we&#39;re using for the current country a dense geometry forsubregions</span>
</span><span id="GeoCountry.set_dense_geometry-1247"><a href="#GeoCountry.set_dense_geometry-1247"><span class="linenos">1247</span></a><span class="sd">        and regions.</span>
</span><span id="GeoCountry.set_dense_geometry-1248"><a href="#GeoCountry.set_dense_geometry-1248"><span class="linenos">1248</span></a><span class="sd">        It&#39;s not possible to go back.</span>
</span><span id="GeoCountry.set_dense_geometry-1249"><a href="#GeoCountry.set_dense_geometry-1249"><span class="linenos">1249</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoCountry.set_dense_geometry-1250"><a href="#GeoCountry.set_dense_geometry-1250"><span class="linenos">1250</span></a>
</span><span id="GeoCountry.set_dense_geometry-1251"><a href="#GeoCountry.set_dense_geometry-1251"><span class="linenos">1251</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dense_geometry</span><span class="p">():</span>
</span><span id="GeoCountry.set_dense_geometry-1252"><a href="#GeoCountry.set_dense_geometry-1252"><span class="linenos">1252</span></a>            <span class="k">return</span>
</span><span id="GeoCountry.set_dense_geometry-1253"><a href="#GeoCountry.set_dense_geometry-1253"><span class="linenos">1253</span></a>
</span><span id="GeoCountry.set_dense_geometry-1254"><a href="#GeoCountry.set_dense_geometry-1254"><span class="linenos">1254</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_main_geometry</span><span class="p">():</span>
</span><span id="GeoCountry.set_dense_geometry-1255"><a href="#GeoCountry.set_dense_geometry-1255"><span class="linenos">1255</span></a>            <span class="k">raise</span> <span class="n">CoaError</span><span class="p">(</span><span class="s2">&quot;You already set the main geometry. Cannot set the dense geometry now.&quot;</span><span class="p">)</span>
</span><span id="GeoCountry.set_dense_geometry-1256"><a href="#GeoCountry.set_dense_geometry-1256"><span class="linenos">1256</span></a>
</span><span id="GeoCountry.set_dense_geometry-1257"><a href="#GeoCountry.set_dense_geometry-1257"><span class="linenos">1257</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_exploded_geometry</span><span class="p">():</span>
</span><span id="GeoCountry.set_dense_geometry-1258"><a href="#GeoCountry.set_dense_geometry-1258"><span class="linenos">1258</span></a>            <span class="k">raise</span> <span class="n">CoaError</span><span class="p">(</span><span class="s2">&quot;You already set the exploded geometry. Cannot set the dense geometry now.&quot;</span><span class="p">)</span>
</span><span id="GeoCountry.set_dense_geometry-1259"><a href="#GeoCountry.set_dense_geometry-1259"><span class="linenos">1259</span></a>
</span><span id="GeoCountry.set_dense_geometry-1260"><a href="#GeoCountry.set_dense_geometry-1260"><span class="linenos">1260</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;FRA&#39;</span><span class="p">:</span>
</span><span id="GeoCountry.set_dense_geometry-1261"><a href="#GeoCountry.set_dense_geometry-1261"><span class="linenos">1261</span></a>            <span class="c1">#.drop([&#39;id_geofla&#39;,&#39;code_reg&#39;,&#39;nom_reg&#39;,&#39;x_chf_lieu&#39;,&#39;y_chf_lieu&#39;,&#39;x_centroid&#39;,&#39;y_centroid&#39;,&#39;Code département&#39;,&#39;Nom du département&#39;,&#39;Population municipale&#39;],axis=1,inplace=True) # removing some column without interest</span>
</span><span id="GeoCountry.set_dense_geometry-1262"><a href="#GeoCountry.set_dense_geometry-1262"><span class="linenos">1262</span></a>            <span class="c1"># moving artificially (if needed) outre-mer area to be near to metropole for map representations</span>
</span><span id="GeoCountry.set_dense_geometry-1263"><a href="#GeoCountry.set_dense_geometry-1263"><span class="linenos">1263</span></a>
</span><span id="GeoCountry.set_dense_geometry-1264"><a href="#GeoCountry.set_dense_geometry-1264"><span class="linenos">1264</span></a>            <span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="GeoCountry.set_dense_geometry-1265"><a href="#GeoCountry.set_dense_geometry-1265"><span class="linenos">1265</span></a>            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">poi</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="GeoCountry.set_dense_geometry-1266"><a href="#GeoCountry.set_dense_geometry-1266"><span class="linenos">1266</span></a>                <span class="n">x</span><span class="o">=</span><span class="mi">0</span>
</span><span id="GeoCountry.set_dense_geometry-1267"><a href="#GeoCountry.set_dense_geometry-1267"><span class="linenos">1267</span></a>                <span class="n">y</span><span class="o">=</span><span class="mi">0</span>
</span><span id="GeoCountry.set_dense_geometry-1268"><a href="#GeoCountry.set_dense_geometry-1268"><span class="linenos">1268</span></a>                <span class="n">w</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="s2">&quot;code_subregion&quot;</span><span class="p">]</span>
</span><span id="GeoCountry.set_dense_geometry-1269"><a href="#GeoCountry.set_dense_geometry-1269"><span class="linenos">1269</span></a>                <span class="k">if</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_list_translation</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="GeoCountry.set_dense_geometry-1270"><a href="#GeoCountry.set_dense_geometry-1270"><span class="linenos">1270</span></a>                    <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_list_translation</span><span class="p">[</span><span class="n">w</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GeoCountry.set_dense_geometry-1271"><a href="#GeoCountry.set_dense_geometry-1271"><span class="linenos">1271</span></a>                    <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_list_translation</span><span class="p">[</span><span class="n">w</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</span><span id="GeoCountry.set_dense_geometry-1272"><a href="#GeoCountry.set_dense_geometry-1272"><span class="linenos">1272</span></a>                <span class="n">g</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">],</span> <span class="n">xoff</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">yoff</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
</span><span id="GeoCountry.set_dense_geometry-1273"><a href="#GeoCountry.set_dense_geometry-1273"><span class="linenos">1273</span></a>                <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</span><span id="GeoCountry.set_dense_geometry-1274"><a href="#GeoCountry.set_dense_geometry-1274"><span class="linenos">1274</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">tmp</span>
</span><span id="GeoCountry.set_dense_geometry-1275"><a href="#GeoCountry.set_dense_geometry-1275"><span class="linenos">1275</span></a>
</span><span id="GeoCountry.set_dense_geometry-1276"><a href="#GeoCountry.set_dense_geometry-1276"><span class="linenos">1276</span></a>            <span class="c1"># Remove COM with dense geometry true, too many islands to manage</span>
</span><span id="GeoCountry.set_dense_geometry-1277"><a href="#GeoCountry.set_dense_geometry-1277"><span class="linenos">1277</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">code_subregion</span><span class="o">!=</span><span class="s1">&#39;980&#39;</span><span class="p">]</span>
</span><span id="GeoCountry.set_dense_geometry-1278"><a href="#GeoCountry.set_dense_geometry-1278"><span class="linenos">1278</span></a>
</span><span id="GeoCountry.set_dense_geometry-1279"><a href="#GeoCountry.set_dense_geometry-1279"><span class="linenos">1279</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;USA&#39;</span><span class="p">:</span>
</span><span id="GeoCountry.set_dense_geometry-1280"><a href="#GeoCountry.set_dense_geometry-1280"><span class="linenos">1280</span></a>            <span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="GeoCountry.set_dense_geometry-1281"><a href="#GeoCountry.set_dense_geometry-1281"><span class="linenos">1281</span></a>            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">poi</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="GeoCountry.set_dense_geometry-1282"><a href="#GeoCountry.set_dense_geometry-1282"><span class="linenos">1282</span></a>                <span class="n">x</span><span class="o">=</span><span class="mi">0</span>
</span><span id="GeoCountry.set_dense_geometry-1283"><a href="#GeoCountry.set_dense_geometry-1283"><span class="linenos">1283</span></a>                <span class="n">y</span><span class="o">=</span><span class="mi">0</span>
</span><span id="GeoCountry.set_dense_geometry-1284"><a href="#GeoCountry.set_dense_geometry-1284"><span class="linenos">1284</span></a>                <span class="n">w</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="s2">&quot;code_subregion&quot;</span><span class="p">]</span>
</span><span id="GeoCountry.set_dense_geometry-1285"><a href="#GeoCountry.set_dense_geometry-1285"><span class="linenos">1285</span></a>                <span class="k">if</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_list_translation</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="GeoCountry.set_dense_geometry-1286"><a href="#GeoCountry.set_dense_geometry-1286"><span class="linenos">1286</span></a>                    <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_list_translation</span><span class="p">[</span><span class="n">w</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GeoCountry.set_dense_geometry-1287"><a href="#GeoCountry.set_dense_geometry-1287"><span class="linenos">1287</span></a>                    <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_list_translation</span><span class="p">[</span><span class="n">w</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</span><span id="GeoCountry.set_dense_geometry-1288"><a href="#GeoCountry.set_dense_geometry-1288"><span class="linenos">1288</span></a>                    <span class="n">g</span><span class="o">=</span><span class="n">sa</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">sa</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">],</span><span class="n">xoff</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">yoff</span><span class="o">=</span><span class="n">y</span><span class="p">),</span>\
</span><span id="GeoCountry.set_dense_geometry-1289"><a href="#GeoCountry.set_dense_geometry-1289"><span class="linenos">1289</span></a>                                            <span class="n">xfact</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_list_scale</span><span class="p">[</span><span class="n">w</span><span class="p">],</span><span class="n">yfact</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_list_scale</span><span class="p">[</span><span class="n">w</span><span class="p">],</span><span class="n">origin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_list_center</span><span class="p">[</span><span class="n">w</span><span class="p">])</span>
</span><span id="GeoCountry.set_dense_geometry-1290"><a href="#GeoCountry.set_dense_geometry-1290"><span class="linenos">1290</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="GeoCountry.set_dense_geometry-1291"><a href="#GeoCountry.set_dense_geometry-1291"><span class="linenos">1291</span></a>                    <span class="n">g</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">]</span>
</span><span id="GeoCountry.set_dense_geometry-1292"><a href="#GeoCountry.set_dense_geometry-1292"><span class="linenos">1292</span></a>
</span><span id="GeoCountry.set_dense_geometry-1293"><a href="#GeoCountry.set_dense_geometry-1293"><span class="linenos">1293</span></a>                <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</span><span id="GeoCountry.set_dense_geometry-1294"><a href="#GeoCountry.set_dense_geometry-1294"><span class="linenos">1294</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">tmp</span>
</span><span id="GeoCountry.set_dense_geometry-1295"><a href="#GeoCountry.set_dense_geometry-1295"><span class="linenos">1295</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GeoCountry.set_dense_geometry-1296"><a href="#GeoCountry.set_dense_geometry-1296"><span class="linenos">1296</span></a>            <span class="k">raise</span> <span class="n">CoaError</span><span class="p">(</span><span class="s2">&quot;The current country does not have dense geometry support.&quot;</span><span class="p">)</span>
</span><span id="GeoCountry.set_dense_geometry-1297"><a href="#GeoCountry.set_dense_geometry-1297"><span class="linenos">1297</span></a>
</span><span id="GeoCountry.set_dense_geometry-1298"><a href="#GeoCountry.set_dense_geometry-1298"><span class="linenos">1298</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_country_data_region</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GeoCountry.set_dense_geometry-1299"><a href="#GeoCountry.set_dense_geometry-1299"><span class="linenos">1299</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_country_data_subregion</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GeoCountry.set_dense_geometry-1300"><a href="#GeoCountry.set_dense_geometry-1300"><span class="linenos">1300</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_dense_geometry</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="GeoCountry.set_dense_geometry-1301"><a href="#GeoCountry.set_dense_geometry-1301"><span class="linenos">1301</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_main_geometry</span> <span class="o">=</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>If used, we're using for the current country a dense geometry forsubregions
and regions.
It's not possible to go back.</p>
</div>


                            </div>
                            <div id="GeoCountry.set_exploded_geometry" class="classattr">
                                        <input id="GeoCountry.set_exploded_geometry-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_exploded_geometry</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GeoCountry.set_exploded_geometry-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GeoCountry.set_exploded_geometry"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GeoCountry.set_exploded_geometry-1303"><a href="#GeoCountry.set_exploded_geometry-1303"><span class="linenos">1303</span></a>    <span class="k">def</span> <span class="nf">set_exploded_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GeoCountry.set_exploded_geometry-1304"><a href="#GeoCountry.set_exploded_geometry-1304"><span class="linenos">1304</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;  If used, we&#39;re using for the current country a dense geometry forsubregions</span>
</span><span id="GeoCountry.set_exploded_geometry-1305"><a href="#GeoCountry.set_exploded_geometry-1305"><span class="linenos">1305</span></a><span class="sd">        and regions.</span>
</span><span id="GeoCountry.set_exploded_geometry-1306"><a href="#GeoCountry.set_exploded_geometry-1306"><span class="linenos">1306</span></a><span class="sd">        Moreover we&#39;re exploding internal dense geometry for some countries (currently IdF</span>
</span><span id="GeoCountry.set_exploded_geometry-1307"><a href="#GeoCountry.set_exploded_geometry-1307"><span class="linenos">1307</span></a><span class="sd">        for France, only).</span>
</span><span id="GeoCountry.set_exploded_geometry-1308"><a href="#GeoCountry.set_exploded_geometry-1308"><span class="linenos">1308</span></a>
</span><span id="GeoCountry.set_exploded_geometry-1309"><a href="#GeoCountry.set_exploded_geometry-1309"><span class="linenos">1309</span></a><span class="sd">        It&#39;s not possible to go back.</span>
</span><span id="GeoCountry.set_exploded_geometry-1310"><a href="#GeoCountry.set_exploded_geometry-1310"><span class="linenos">1310</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoCountry.set_exploded_geometry-1311"><a href="#GeoCountry.set_exploded_geometry-1311"><span class="linenos">1311</span></a>
</span><span id="GeoCountry.set_exploded_geometry-1312"><a href="#GeoCountry.set_exploded_geometry-1312"><span class="linenos">1312</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_main_geometry</span><span class="p">():</span>
</span><span id="GeoCountry.set_exploded_geometry-1313"><a href="#GeoCountry.set_exploded_geometry-1313"><span class="linenos">1313</span></a>            <span class="k">raise</span> <span class="n">CoaError</span><span class="p">(</span><span class="s2">&quot;You already set the main geometry. Cannot set the exploded geometry now.&quot;</span><span class="p">)</span>
</span><span id="GeoCountry.set_exploded_geometry-1314"><a href="#GeoCountry.set_exploded_geometry-1314"><span class="linenos">1314</span></a>
</span><span id="GeoCountry.set_exploded_geometry-1315"><a href="#GeoCountry.set_exploded_geometry-1315"><span class="linenos">1315</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dense_geometry</span><span class="p">():</span>
</span><span id="GeoCountry.set_exploded_geometry-1316"><a href="#GeoCountry.set_exploded_geometry-1316"><span class="linenos">1316</span></a>            <span class="k">raise</span> <span class="n">CoaError</span><span class="p">(</span><span class="s2">&quot;You already set the dense geometry. Cannot set the exploded geometry now.&quot;</span><span class="p">)</span>
</span><span id="GeoCountry.set_exploded_geometry-1317"><a href="#GeoCountry.set_exploded_geometry-1317"><span class="linenos">1317</span></a>
</span><span id="GeoCountry.set_exploded_geometry-1318"><a href="#GeoCountry.set_exploded_geometry-1318"><span class="linenos">1318</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_exploded_geometry</span><span class="p">():</span>
</span><span id="GeoCountry.set_exploded_geometry-1319"><a href="#GeoCountry.set_exploded_geometry-1319"><span class="linenos">1319</span></a>            <span class="k">return</span>
</span><span id="GeoCountry.set_exploded_geometry-1320"><a href="#GeoCountry.set_exploded_geometry-1320"><span class="linenos">1320</span></a>
</span><span id="GeoCountry.set_exploded_geometry-1321"><a href="#GeoCountry.set_exploded_geometry-1321"><span class="linenos">1321</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_dense_geometry</span><span class="p">()</span>
</span><span id="GeoCountry.set_exploded_geometry-1322"><a href="#GeoCountry.set_exploded_geometry-1322"><span class="linenos">1322</span></a>
</span><span id="GeoCountry.set_exploded_geometry-1323"><a href="#GeoCountry.set_exploded_geometry-1323"><span class="linenos">1323</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;FRA&#39;</span><span class="p">:</span>
</span><span id="GeoCountry.set_exploded_geometry-1324"><a href="#GeoCountry.set_exploded_geometry-1324"><span class="linenos">1324</span></a>            <span class="c1"># Add Ile de France zoom</span>
</span><span id="GeoCountry.set_exploded_geometry-1325"><a href="#GeoCountry.set_exploded_geometry-1325"><span class="linenos">1325</span></a>            <span class="n">idf_translation</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">6.5</span><span class="p">,</span><span class="o">-</span><span class="mi">5</span><span class="p">)</span>
</span><span id="GeoCountry.set_exploded_geometry-1326"><a href="#GeoCountry.set_exploded_geometry-1326"><span class="linenos">1326</span></a>            <span class="n">idf_scale</span><span class="o">=</span><span class="mi">3</span>
</span><span id="GeoCountry.set_exploded_geometry-1327"><a href="#GeoCountry.set_exploded_geometry-1327"><span class="linenos">1327</span></a>            <span class="n">idf_center</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span><span class="mi">43</span><span class="p">)</span>
</span><span id="GeoCountry.set_exploded_geometry-1328"><a href="#GeoCountry.set_exploded_geometry-1328"><span class="linenos">1328</span></a>            <span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="GeoCountry.set_exploded_geometry-1329"><a href="#GeoCountry.set_exploded_geometry-1329"><span class="linenos">1329</span></a>            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">poi</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="GeoCountry.set_exploded_geometry-1330"><a href="#GeoCountry.set_exploded_geometry-1330"><span class="linenos">1330</span></a>                <span class="n">g</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">]</span>
</span><span id="GeoCountry.set_exploded_geometry-1331"><a href="#GeoCountry.set_exploded_geometry-1331"><span class="linenos">1331</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;75&#39;</span><span class="p">,</span><span class="s1">&#39;91&#39;</span><span class="p">,</span><span class="s1">&#39;92&#39;</span><span class="p">,</span><span class="s1">&#39;93&#39;</span><span class="p">,</span><span class="s1">&#39;94&#39;</span><span class="p">,</span><span class="s1">&#39;95&#39;</span><span class="p">,</span><span class="s1">&#39;77&#39;</span><span class="p">,</span><span class="s1">&#39;78&#39;</span><span class="p">]:</span>
</span><span id="GeoCountry.set_exploded_geometry-1332"><a href="#GeoCountry.set_exploded_geometry-1332"><span class="linenos">1332</span></a>                    <span class="n">g2</span><span class="o">=</span><span class="n">sa</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">sa</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="n">xoff</span><span class="o">=</span><span class="n">idf_translation</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">yoff</span><span class="o">=</span><span class="n">idf_translation</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>\
</span><span id="GeoCountry.set_exploded_geometry-1333"><a href="#GeoCountry.set_exploded_geometry-1333"><span class="linenos">1333</span></a>                                            <span class="n">xfact</span><span class="o">=</span><span class="n">idf_scale</span><span class="p">,</span><span class="n">yfact</span><span class="o">=</span><span class="n">idf_scale</span><span class="p">,</span><span class="n">origin</span><span class="o">=</span><span class="n">idf_center</span><span class="p">)</span>
</span><span id="GeoCountry.set_exploded_geometry-1334"><a href="#GeoCountry.set_exploded_geometry-1334"><span class="linenos">1334</span></a>                    <span class="n">g</span><span class="o">=</span><span class="n">g2</span> <span class="c1"># so.unary_union([g,g2]) # uncomment if you want a copy</span>
</span><span id="GeoCountry.set_exploded_geometry-1335"><a href="#GeoCountry.set_exploded_geometry-1335"><span class="linenos">1335</span></a>                <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</span><span id="GeoCountry.set_exploded_geometry-1336"><a href="#GeoCountry.set_exploded_geometry-1336"><span class="linenos">1336</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">tmp</span>
</span><span id="GeoCountry.set_exploded_geometry-1337"><a href="#GeoCountry.set_exploded_geometry-1337"><span class="linenos">1337</span></a>
</span><span id="GeoCountry.set_exploded_geometry-1338"><a href="#GeoCountry.set_exploded_geometry-1338"><span class="linenos">1338</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_dense_geometry</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="GeoCountry.set_exploded_geometry-1339"><a href="#GeoCountry.set_exploded_geometry-1339"><span class="linenos">1339</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_main_geometry</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="GeoCountry.set_exploded_geometry-1340"><a href="#GeoCountry.set_exploded_geometry-1340"><span class="linenos">1340</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_exploded_geometry</span> <span class="o">=</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>If used, we're using for the current country a dense geometry forsubregions
and regions.
Moreover we're exploding internal dense geometry for some countries (currently IdF
for France, only).</p>

<p>It's not possible to go back.</p>
</div>


                            </div>
                            <div id="GeoCountry.set_main_geometry" class="classattr">
                                        <input id="GeoCountry.set_main_geometry-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_main_geometry</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GeoCountry.set_main_geometry-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GeoCountry.set_main_geometry"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GeoCountry.set_main_geometry-1342"><a href="#GeoCountry.set_main_geometry-1342"><span class="linenos">1342</span></a>    <span class="k">def</span> <span class="nf">set_main_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GeoCountry.set_main_geometry-1343"><a href="#GeoCountry.set_main_geometry-1343"><span class="linenos">1343</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;  If used, we&#39;re using only for the current country the main</span>
</span><span id="GeoCountry.set_main_geometry-1344"><a href="#GeoCountry.set_main_geometry-1344"><span class="linenos">1344</span></a><span class="sd">        geometry for subregions and regions.</span>
</span><span id="GeoCountry.set_main_geometry-1345"><a href="#GeoCountry.set_main_geometry-1345"><span class="linenos">1345</span></a><span class="sd">        It&#39;s not possible to go back.</span>
</span><span id="GeoCountry.set_main_geometry-1346"><a href="#GeoCountry.set_main_geometry-1346"><span class="linenos">1346</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoCountry.set_main_geometry-1347"><a href="#GeoCountry.set_main_geometry-1347"><span class="linenos">1347</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_main_geometry</span><span class="p">():</span>
</span><span id="GeoCountry.set_main_geometry-1348"><a href="#GeoCountry.set_main_geometry-1348"><span class="linenos">1348</span></a>            <span class="k">return</span>
</span><span id="GeoCountry.set_main_geometry-1349"><a href="#GeoCountry.set_main_geometry-1349"><span class="linenos">1349</span></a>
</span><span id="GeoCountry.set_main_geometry-1350"><a href="#GeoCountry.set_main_geometry-1350"><span class="linenos">1350</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dense_geometry</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_exploded_geometry</span><span class="p">():</span>
</span><span id="GeoCountry.set_main_geometry-1351"><a href="#GeoCountry.set_main_geometry-1351"><span class="linenos">1351</span></a>            <span class="k">raise</span> <span class="n">CoaError</span><span class="p">(</span><span class="s2">&quot;You already set the dense or exploded geometry. Cannot set the main geometry now.&quot;</span><span class="p">)</span>
</span><span id="GeoCountry.set_main_geometry-1352"><a href="#GeoCountry.set_main_geometry-1352"><span class="linenos">1352</span></a>
</span><span id="GeoCountry.set_main_geometry-1353"><a href="#GeoCountry.set_main_geometry-1353"><span class="linenos">1353</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;FRA&#39;</span><span class="p">:</span>
</span><span id="GeoCountry.set_main_geometry-1354"><a href="#GeoCountry.set_main_geometry-1354"><span class="linenos">1354</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_list_translation</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span>
</span><span id="GeoCountry.set_main_geometry-1355"><a href="#GeoCountry.set_main_geometry-1355"><span class="linenos">1355</span></a>            <span class="c1"># Remove COM with main geometry true, too many islands to manage</span>
</span><span id="GeoCountry.set_main_geometry-1356"><a href="#GeoCountry.set_main_geometry-1356"><span class="linenos">1356</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">code_subregion</span><span class="o">!=</span><span class="s1">&#39;980&#39;</span><span class="p">]</span>
</span><span id="GeoCountry.set_main_geometry-1357"><a href="#GeoCountry.set_main_geometry-1357"><span class="linenos">1357</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;USA&#39;</span><span class="p">:</span>
</span><span id="GeoCountry.set_main_geometry-1358"><a href="#GeoCountry.set_main_geometry-1358"><span class="linenos">1358</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_list_translation</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span>
</span><span id="GeoCountry.set_main_geometry-1359"><a href="#GeoCountry.set_main_geometry-1359"><span class="linenos">1359</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GeoCountry.set_main_geometry-1360"><a href="#GeoCountry.set_main_geometry-1360"><span class="linenos">1360</span></a>            <span class="k">raise</span> <span class="n">CoaError</span><span class="p">(</span><span class="s2">&quot;The current country does not have dense geometry support.&quot;</span><span class="p">)</span>
</span><span id="GeoCountry.set_main_geometry-1361"><a href="#GeoCountry.set_main_geometry-1361"><span class="linenos">1361</span></a>
</span><span id="GeoCountry.set_main_geometry-1362"><a href="#GeoCountry.set_main_geometry-1362"><span class="linenos">1362</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_country_data_region</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GeoCountry.set_main_geometry-1363"><a href="#GeoCountry.set_main_geometry-1363"><span class="linenos">1363</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_country_data_subregion</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GeoCountry.set_main_geometry-1364"><a href="#GeoCountry.set_main_geometry-1364"><span class="linenos">1364</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_main_geometry</span> <span class="o">=</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>If used, we're using only for the current country the main
geometry for subregions and regions.
It's not possible to go back.</p>
</div>


                            </div>
                            <div id="GeoCountry.is_dense_geometry" class="classattr">
                                        <input id="GeoCountry.is_dense_geometry-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_dense_geometry</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GeoCountry.is_dense_geometry-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GeoCountry.is_dense_geometry"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GeoCountry.is_dense_geometry-1366"><a href="#GeoCountry.is_dense_geometry-1366"><span class="linenos">1366</span></a>    <span class="k">def</span> <span class="nf">is_dense_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GeoCountry.is_dense_geometry-1367"><a href="#GeoCountry.is_dense_geometry-1367"><span class="linenos">1367</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the self._is_dense_geometry variable</span>
</span><span id="GeoCountry.is_dense_geometry-1368"><a href="#GeoCountry.is_dense_geometry-1368"><span class="linenos">1368</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoCountry.is_dense_geometry-1369"><a href="#GeoCountry.is_dense_geometry-1369"><span class="linenos">1369</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_dense_geometry</span>
</span></pre></div>


            <div class="docstring"><p>Return the self._is_dense_geometry variable</p>
</div>


                            </div>
                            <div id="GeoCountry.is_exploded_geometry" class="classattr">
                                        <input id="GeoCountry.is_exploded_geometry-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_exploded_geometry</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GeoCountry.is_exploded_geometry-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GeoCountry.is_exploded_geometry"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GeoCountry.is_exploded_geometry-1371"><a href="#GeoCountry.is_exploded_geometry-1371"><span class="linenos">1371</span></a>    <span class="k">def</span> <span class="nf">is_exploded_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GeoCountry.is_exploded_geometry-1372"><a href="#GeoCountry.is_exploded_geometry-1372"><span class="linenos">1372</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the self._is_exploded_geometry variable</span>
</span><span id="GeoCountry.is_exploded_geometry-1373"><a href="#GeoCountry.is_exploded_geometry-1373"><span class="linenos">1373</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoCountry.is_exploded_geometry-1374"><a href="#GeoCountry.is_exploded_geometry-1374"><span class="linenos">1374</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_exploded_geometry</span>
</span></pre></div>


            <div class="docstring"><p>Return the self._is_exploded_geometry variable</p>
</div>


                            </div>
                            <div id="GeoCountry.is_main_geometry" class="classattr">
                                        <input id="GeoCountry.is_main_geometry-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_main_geometry</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GeoCountry.is_main_geometry-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GeoCountry.is_main_geometry"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GeoCountry.is_main_geometry-1376"><a href="#GeoCountry.is_main_geometry-1376"><span class="linenos">1376</span></a>    <span class="k">def</span> <span class="nf">is_main_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GeoCountry.is_main_geometry-1377"><a href="#GeoCountry.is_main_geometry-1377"><span class="linenos">1377</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the self._is_main_geometry variable</span>
</span><span id="GeoCountry.is_main_geometry-1378"><a href="#GeoCountry.is_main_geometry-1378"><span class="linenos">1378</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoCountry.is_main_geometry-1379"><a href="#GeoCountry.is_main_geometry-1379"><span class="linenos">1379</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_main_geometry</span>
</span></pre></div>


            <div class="docstring"><p>Return the self._is_main_geometry variable</p>
</div>


                            </div>
                            <div id="GeoCountry.get_source" class="classattr">
                                        <input id="GeoCountry.get_source-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_source</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GeoCountry.get_source-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GeoCountry.get_source"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GeoCountry.get_source-1381"><a href="#GeoCountry.get_source-1381"><span class="linenos">1381</span></a>    <span class="k">def</span> <span class="nf">get_source</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GeoCountry.get_source-1382"><a href="#GeoCountry.get_source-1382"><span class="linenos">1382</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Return informations about URL sources</span>
</span><span id="GeoCountry.get_source-1383"><a href="#GeoCountry.get_source-1383"><span class="linenos">1383</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoCountry.get_source-1384"><a href="#GeoCountry.get_source-1384"><span class="linenos">1384</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GeoCountry.get_source-1385"><a href="#GeoCountry.get_source-1385"><span class="linenos">1385</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()]</span>
</span><span id="GeoCountry.get_source-1386"><a href="#GeoCountry.get_source-1386"><span class="linenos">1386</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GeoCountry.get_source-1387"><a href="#GeoCountry.get_source-1387"><span class="linenos">1387</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_dict</span>
</span></pre></div>


            <div class="docstring"><p>Return informations about URL sources</p>
</div>


                            </div>
                            <div id="GeoCountry.get_country" class="classattr">
                                        <input id="GeoCountry.get_country-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_country</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GeoCountry.get_country-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GeoCountry.get_country"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GeoCountry.get_country-1389"><a href="#GeoCountry.get_country-1389"><span class="linenos">1389</span></a>    <span class="k">def</span> <span class="nf">get_country</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GeoCountry.get_country-1390"><a href="#GeoCountry.get_country-1390"><span class="linenos">1390</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Return the current country used.</span>
</span><span id="GeoCountry.get_country-1391"><a href="#GeoCountry.get_country-1391"><span class="linenos">1391</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoCountry.get_country-1392"><a href="#GeoCountry.get_country-1392"><span class="linenos">1392</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country</span>
</span></pre></div>


            <div class="docstring"><p>Return the current country used.</p>
</div>


                            </div>
                            <div id="GeoCountry.get_list_countries" class="classattr">
                                        <input id="GeoCountry.get_list_countries-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_list_countries</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GeoCountry.get_list_countries-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GeoCountry.get_list_countries"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GeoCountry.get_list_countries-1394"><a href="#GeoCountry.get_list_countries-1394"><span class="linenos">1394</span></a>    <span class="k">def</span> <span class="nf">get_list_countries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GeoCountry.get_list_countries-1395"><a href="#GeoCountry.get_list_countries-1395"><span class="linenos">1395</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; This function returns back the list of supported countries</span>
</span><span id="GeoCountry.get_list_countries-1396"><a href="#GeoCountry.get_list_countries-1396"><span class="linenos">1396</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoCountry.get_list_countries-1397"><a href="#GeoCountry.get_list_countries-1397"><span class="linenos">1397</span></a>        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_info_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
</span></pre></div>


            <div class="docstring"><p>This function returns back the list of supported countries</p>
</div>


                            </div>
                            <div id="GeoCountry.is_init" class="classattr">
                                        <input id="GeoCountry.is_init-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_init</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GeoCountry.is_init-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GeoCountry.is_init"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GeoCountry.is_init-1399"><a href="#GeoCountry.is_init-1399"><span class="linenos">1399</span></a>    <span class="k">def</span> <span class="nf">is_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GeoCountry.is_init-1400"><a href="#GeoCountry.is_init-1400"><span class="linenos">1400</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Test if the country is initialized. Return True if it is. False if not.</span>
</span><span id="GeoCountry.is_init-1401"><a href="#GeoCountry.is_init-1401"><span class="linenos">1401</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoCountry.is_init-1402"><a href="#GeoCountry.is_init-1402"><span class="linenos">1402</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GeoCountry.is_init-1403"><a href="#GeoCountry.is_init-1403"><span class="linenos">1403</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="GeoCountry.is_init-1404"><a href="#GeoCountry.is_init-1404"><span class="linenos">1404</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GeoCountry.is_init-1405"><a href="#GeoCountry.is_init-1405"><span class="linenos">1405</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Test if the country is initialized. Return True if it is. False if not.</p>
</div>


                            </div>
                            <div id="GeoCountry.test_is_init" class="classattr">
                                        <input id="GeoCountry.test_is_init-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">test_is_init</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GeoCountry.test_is_init-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GeoCountry.test_is_init"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GeoCountry.test_is_init-1407"><a href="#GeoCountry.test_is_init-1407"><span class="linenos">1407</span></a>    <span class="k">def</span> <span class="nf">test_is_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GeoCountry.test_is_init-1408"><a href="#GeoCountry.test_is_init-1408"><span class="linenos">1408</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Test if the country is initialized. If not, raise a CoaDbError.</span>
</span><span id="GeoCountry.test_is_init-1409"><a href="#GeoCountry.test_is_init-1409"><span class="linenos">1409</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoCountry.test_is_init-1410"><a href="#GeoCountry.test_is_init-1410"><span class="linenos">1410</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_init</span><span class="p">():</span>
</span><span id="GeoCountry.test_is_init-1411"><a href="#GeoCountry.test_is_init-1411"><span class="linenos">1411</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="GeoCountry.test_is_init-1412"><a href="#GeoCountry.test_is_init-1412"><span class="linenos">1412</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GeoCountry.test_is_init-1413"><a href="#GeoCountry.test_is_init-1413"><span class="linenos">1413</span></a>            <span class="k">raise</span> <span class="n">CoaDbError</span><span class="p">(</span><span class="s2">&quot;The country is not set. Use a constructor with non empty country string.&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Test if the country is initialized. If not, raise a CoaDbError.</p>
</div>


                            </div>
                            <div id="GeoCountry.get_region_list" class="classattr">
                                        <input id="GeoCountry.get_region_list-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_region_list</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GeoCountry.get_region_list-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GeoCountry.get_region_list"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GeoCountry.get_region_list-1415"><a href="#GeoCountry.get_region_list-1415"><span class="linenos">1415</span></a>    <span class="k">def</span> <span class="nf">get_region_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GeoCountry.get_region_list-1416"><a href="#GeoCountry.get_region_list-1416"><span class="linenos">1416</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Return the list of available regions with code, name and geometry</span>
</span><span id="GeoCountry.get_region_list-1417"><a href="#GeoCountry.get_region_list-1417"><span class="linenos">1417</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoCountry.get_region_list-1418"><a href="#GeoCountry.get_region_list-1418"><span class="linenos">1418</span></a>        <span class="n">cols</span><span class="o">=</span><span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list_properties</span><span class="p">()</span> <span class="k">if</span> <span class="s1">&#39;_region&#39;</span> <span class="ow">in</span> <span class="n">c</span><span class="p">]</span>
</span><span id="GeoCountry.get_region_list-1419"><a href="#GeoCountry.get_region_list-1419"><span class="linenos">1419</span></a>        <span class="n">cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;geometry&#39;</span><span class="p">)</span>
</span><span id="GeoCountry.get_region_list-1420"><a href="#GeoCountry.get_region_list-1420"><span class="linenos">1420</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="kc">True</span><span class="p">)[</span><span class="n">cols</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Return the list of available regions with code, name and geometry</p>
</div>


                            </div>
                            <div id="GeoCountry.is_region" class="classattr">
                                        <input id="GeoCountry.is_region-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_region</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">r</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GeoCountry.is_region-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GeoCountry.is_region"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GeoCountry.is_region-1422"><a href="#GeoCountry.is_region-1422"><span class="linenos">1422</span></a>    <span class="k">def</span> <span class="nf">is_region</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">r</span><span class="p">):</span>
</span><span id="GeoCountry.is_region-1423"><a href="#GeoCountry.is_region-1423"><span class="linenos">1423</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Return False if r is a not a known region, return the correctly capitalized name if ok</span>
</span><span id="GeoCountry.is_region-1424"><a href="#GeoCountry.is_region-1424"><span class="linenos">1424</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoCountry.is_region-1425"><a href="#GeoCountry.is_region-1425"><span class="linenos">1425</span></a>        <span class="n">r</span><span class="o">=</span><span class="n">tostdstring</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</span><span id="GeoCountry.is_region-1426"><a href="#GeoCountry.is_region-1426"><span class="linenos">1426</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_region_list</span><span class="p">()</span><span class="o">.</span><span class="n">name_region</span><span class="o">.</span><span class="n">to_list</span><span class="p">():</span>
</span><span id="GeoCountry.is_region-1427"><a href="#GeoCountry.is_region-1427"><span class="linenos">1427</span></a>            <span class="k">if</span> <span class="n">tostdstring</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="n">r</span><span class="p">:</span>
</span><span id="GeoCountry.is_region-1428"><a href="#GeoCountry.is_region-1428"><span class="linenos">1428</span></a>                <span class="k">return</span> <span class="n">i</span>
</span><span id="GeoCountry.is_region-1429"><a href="#GeoCountry.is_region-1429"><span class="linenos">1429</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Return False if r is a not a known region, return the correctly capitalized name if ok</p>
</div>


                            </div>
                            <div id="GeoCountry.get_subregion_list" class="classattr">
                                        <input id="GeoCountry.get_subregion_list-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_subregion_list</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GeoCountry.get_subregion_list-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GeoCountry.get_subregion_list"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GeoCountry.get_subregion_list-1431"><a href="#GeoCountry.get_subregion_list-1431"><span class="linenos">1431</span></a>    <span class="k">def</span> <span class="nf">get_subregion_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GeoCountry.get_subregion_list-1432"><a href="#GeoCountry.get_subregion_list-1432"><span class="linenos">1432</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Return the list of available subregions with code, name and geometry</span>
</span><span id="GeoCountry.get_subregion_list-1433"><a href="#GeoCountry.get_subregion_list-1433"><span class="linenos">1433</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoCountry.get_subregion_list-1434"><a href="#GeoCountry.get_subregion_list-1434"><span class="linenos">1434</span></a>        <span class="n">cols</span><span class="o">=</span><span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list_properties</span><span class="p">()</span> <span class="k">if</span> <span class="s1">&#39;_subregion&#39;</span> <span class="ow">in</span> <span class="n">c</span> <span class="p">]</span>
</span><span id="GeoCountry.get_subregion_list-1435"><a href="#GeoCountry.get_subregion_list-1435"><span class="linenos">1435</span></a>        <span class="n">cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;geometry&#39;</span><span class="p">)</span>
</span><span id="GeoCountry.get_subregion_list-1436"><a href="#GeoCountry.get_subregion_list-1436"><span class="linenos">1436</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">()[</span><span class="n">cols</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Return the list of available subregions with code, name and geometry</p>
</div>


                            </div>
                            <div id="GeoCountry.is_subregion" class="classattr">
                                        <input id="GeoCountry.is_subregion-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_subregion</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">r</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GeoCountry.is_subregion-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GeoCountry.is_subregion"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GeoCountry.is_subregion-1438"><a href="#GeoCountry.is_subregion-1438"><span class="linenos">1438</span></a>    <span class="k">def</span> <span class="nf">is_subregion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">r</span><span class="p">):</span>
</span><span id="GeoCountry.is_subregion-1439"><a href="#GeoCountry.is_subregion-1439"><span class="linenos">1439</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Return False if r is a not a known region, return the correctly capitalized name if ok</span>
</span><span id="GeoCountry.is_subregion-1440"><a href="#GeoCountry.is_subregion-1440"><span class="linenos">1440</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoCountry.is_subregion-1441"><a href="#GeoCountry.is_subregion-1441"><span class="linenos">1441</span></a>        <span class="n">r2</span><span class="o">=</span><span class="n">tostdstring</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</span><span id="GeoCountry.is_subregion-1442"><a href="#GeoCountry.is_subregion-1442"><span class="linenos">1442</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_subregion_list</span><span class="p">()</span><span class="o">.</span><span class="n">name_subregion</span><span class="o">.</span><span class="n">to_list</span><span class="p">():</span>
</span><span id="GeoCountry.is_subregion-1443"><a href="#GeoCountry.is_subregion-1443"><span class="linenos">1443</span></a>            <span class="k">if</span> <span class="n">tostdstring</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="n">r2</span><span class="p">:</span>
</span><span id="GeoCountry.is_subregion-1444"><a href="#GeoCountry.is_subregion-1444"><span class="linenos">1444</span></a>                <span class="k">return</span> <span class="n">i</span>
</span><span id="GeoCountry.is_subregion-1445"><a href="#GeoCountry.is_subregion-1445"><span class="linenos">1445</span></a>        <span class="n">a</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_subregion_list</span><span class="p">()[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_subregion_list</span><span class="p">()</span><span class="o">.</span><span class="n">code_subregion</span><span class="o">==</span><span class="n">r</span><span class="p">]</span><span class="o">.</span><span class="n">name_subregion</span><span class="o">.</span><span class="n">values</span>
</span><span id="GeoCountry.is_subregion-1446"><a href="#GeoCountry.is_subregion-1446"><span class="linenos">1446</span></a>        <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="GeoCountry.is_subregion-1447"><a href="#GeoCountry.is_subregion-1447"><span class="linenos">1447</span></a>            <span class="k">return</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GeoCountry.is_subregion-1448"><a href="#GeoCountry.is_subregion-1448"><span class="linenos">1448</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Return False if r is a not a known region, return the correctly capitalized name if ok</p>
</div>


                            </div>
                            <div id="GeoCountry.get_subregions_from_region" class="classattr">
                                        <input id="GeoCountry.get_subregions_from_region-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_subregions_from_region</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GeoCountry.get_subregions_from_region-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GeoCountry.get_subregions_from_region"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GeoCountry.get_subregions_from_region-1450"><a href="#GeoCountry.get_subregions_from_region-1450"><span class="linenos">1450</span></a>    <span class="k">def</span> <span class="nf">get_subregions_from_region</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="GeoCountry.get_subregions_from_region-1451"><a href="#GeoCountry.get_subregions_from_region-1451"><span class="linenos">1451</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Return the list of subregions within a specified region.</span>
</span><span id="GeoCountry.get_subregions_from_region-1452"><a href="#GeoCountry.get_subregions_from_region-1452"><span class="linenos">1452</span></a><span class="sd">        Should give either the code or the name of the region as strings in kwarg : code=# or name=#</span>
</span><span id="GeoCountry.get_subregions_from_region-1453"><a href="#GeoCountry.get_subregions_from_region-1453"><span class="linenos">1453</span></a><span class="sd">        Output default is &#39;code&#39; of subregions. Can be changed with output=&#39;name&#39;.</span>
</span><span id="GeoCountry.get_subregions_from_region-1454"><a href="#GeoCountry.get_subregions_from_region-1454"><span class="linenos">1454</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoCountry.get_subregions_from_region-1455"><a href="#GeoCountry.get_subregions_from_region-1455"><span class="linenos">1455</span></a>        <span class="n">kwargs_test</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;code&#39;</span><span class="p">,</span><span class="s1">&#39;output&#39;</span><span class="p">],</span><span class="s1">&#39;Should give either name or code of region. Output can be changed with the output option.&#39;</span><span class="p">)</span>
</span><span id="GeoCountry.get_subregions_from_region-1456"><a href="#GeoCountry.get_subregions_from_region-1456"><span class="linenos">1456</span></a>        <span class="n">code</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
</span><span id="GeoCountry.get_subregions_from_region-1457"><a href="#GeoCountry.get_subregions_from_region-1457"><span class="linenos">1457</span></a>        <span class="n">name</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
</span><span id="GeoCountry.get_subregions_from_region-1458"><a href="#GeoCountry.get_subregions_from_region-1458"><span class="linenos">1458</span></a>        <span class="n">out</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">,</span><span class="s1">&#39;code&#39;</span><span class="p">)</span>
</span><span id="GeoCountry.get_subregions_from_region-1459"><a href="#GeoCountry.get_subregions_from_region-1459"><span class="linenos">1459</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">code</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span> <span class="o">^</span> <span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="GeoCountry.get_subregions_from_region-1460"><a href="#GeoCountry.get_subregions_from_region-1460"><span class="linenos">1460</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s2">&quot;Should give either code or name of region, not both.&quot;</span><span class="p">)</span>
</span><span id="GeoCountry.get_subregions_from_region-1461"><a href="#GeoCountry.get_subregions_from_region-1461"><span class="linenos">1461</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">out</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span>
</span><span id="GeoCountry.get_subregions_from_region-1462"><a href="#GeoCountry.get_subregions_from_region-1462"><span class="linenos">1462</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s2">&quot;Should set output either as &#39;code&#39; or &#39;name&#39; for subregions.&quot;</span><span class="p">)</span>
</span><span id="GeoCountry.get_subregions_from_region-1463"><a href="#GeoCountry.get_subregions_from_region-1463"><span class="linenos">1463</span></a>
</span><span id="GeoCountry.get_subregions_from_region-1464"><a href="#GeoCountry.get_subregions_from_region-1464"><span class="linenos">1464</span></a>        <span class="k">if</span> <span class="n">name</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GeoCountry.get_subregions_from_region-1465"><a href="#GeoCountry.get_subregions_from_region-1465"><span class="linenos">1465</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
</span><span id="GeoCountry.get_subregions_from_region-1466"><a href="#GeoCountry.get_subregions_from_region-1466"><span class="linenos">1466</span></a>                <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s2">&quot;Name should be given as string.&quot;</span><span class="p">)</span>
</span><span id="GeoCountry.get_subregions_from_region-1467"><a href="#GeoCountry.get_subregions_from_region-1467"><span class="linenos">1467</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_region_list</span><span class="p">()[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">():</span>
</span><span id="GeoCountry.get_subregions_from_region-1468"><a href="#GeoCountry.get_subregions_from_region-1468"><span class="linenos">1468</span></a>                <span class="k">raise</span> <span class="n">CoaWhereError</span> <span class="p">(</span><span class="s2">&quot;The region &quot;</span><span class="o">+</span><span class="n">name</span><span class="o">+</span><span class="s2">&quot; does not exist for country &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()</span><span class="o">+</span><span class="s2">&quot;. See get_region_list().&quot;</span><span class="p">)</span>
</span><span id="GeoCountry.get_subregions_from_region-1469"><a href="#GeoCountry.get_subregions_from_region-1469"><span class="linenos">1469</span></a>            <span class="n">cut</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="kc">True</span><span class="p">)[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">name</span><span class="p">)</span>
</span><span id="GeoCountry.get_subregions_from_region-1470"><a href="#GeoCountry.get_subregions_from_region-1470"><span class="linenos">1470</span></a>
</span><span id="GeoCountry.get_subregions_from_region-1471"><a href="#GeoCountry.get_subregions_from_region-1471"><span class="linenos">1471</span></a>        <span class="k">if</span> <span class="n">code</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GeoCountry.get_subregions_from_region-1472"><a href="#GeoCountry.get_subregions_from_region-1472"><span class="linenos">1472</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">code</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
</span><span id="GeoCountry.get_subregions_from_region-1473"><a href="#GeoCountry.get_subregions_from_region-1473"><span class="linenos">1473</span></a>                <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s2">&quot;Name should be given as string.&quot;</span><span class="p">)</span>
</span><span id="GeoCountry.get_subregions_from_region-1474"><a href="#GeoCountry.get_subregions_from_region-1474"><span class="linenos">1474</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">code</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_region_list</span><span class="p">()[</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">():</span>
</span><span id="GeoCountry.get_subregions_from_region-1475"><a href="#GeoCountry.get_subregions_from_region-1475"><span class="linenos">1475</span></a>                <span class="k">raise</span> <span class="n">CoaWhereError</span><span class="p">(</span><span class="s2">&quot;The region &quot;</span><span class="o">+</span><span class="n">code</span><span class="o">+</span><span class="s2">&quot; does not exist for country &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()</span><span class="o">+</span><span class="s2">&quot;. See get_region_list().&quot;</span><span class="p">)</span>
</span><span id="GeoCountry.get_subregions_from_region-1476"><a href="#GeoCountry.get_subregions_from_region-1476"><span class="linenos">1476</span></a>            <span class="n">cut</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="kc">True</span><span class="p">)[</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">code</span><span class="p">)</span>
</span><span id="GeoCountry.get_subregions_from_region-1477"><a href="#GeoCountry.get_subregions_from_region-1477"><span class="linenos">1477</span></a>
</span><span id="GeoCountry.get_subregions_from_region-1478"><a href="#GeoCountry.get_subregions_from_region-1478"><span class="linenos">1478</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="kc">True</span><span class="p">)[</span><span class="n">cut</span><span class="p">][</span><span class="n">out</span><span class="o">+</span><span class="s1">&#39;_subregion&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="c1">#to_list()</span>
</span></pre></div>


            <div class="docstring"><p>Return the list of subregions within a specified region.
Should give either the code or the name of the region as strings in kwarg : code=# or name=#
Output default is 'code' of subregions. Can be changed with output='name'.</p>
</div>


                            </div>
                            <div id="GeoCountry.get_subregions_from_list_of_region_names" class="classattr">
                                        <input id="GeoCountry.get_subregions_from_list_of_region_names-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_subregions_from_list_of_region_names</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">l</span>, </span><span class="param"><span class="n">output</span><span class="o">=</span><span class="s1">&#39;code&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GeoCountry.get_subregions_from_list_of_region_names-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GeoCountry.get_subregions_from_list_of_region_names"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GeoCountry.get_subregions_from_list_of_region_names-1480"><a href="#GeoCountry.get_subregions_from_list_of_region_names-1480"><span class="linenos">1480</span></a>    <span class="k">def</span> <span class="nf">get_subregions_from_list_of_region_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;code&#39;</span><span class="p">):</span>
</span><span id="GeoCountry.get_subregions_from_list_of_region_names-1481"><a href="#GeoCountry.get_subregions_from_list_of_region_names-1481"><span class="linenos">1481</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Return the list of subregions according to list of region names given.</span>
</span><span id="GeoCountry.get_subregions_from_list_of_region_names-1482"><a href="#GeoCountry.get_subregions_from_list_of_region_names-1482"><span class="linenos">1482</span></a><span class="sd">        The output argument (&#39;code&#39; as default) is given to the get_subregions_from_region function.</span>
</span><span id="GeoCountry.get_subregions_from_list_of_region_names-1483"><a href="#GeoCountry.get_subregions_from_list_of_region_names-1483"><span class="linenos">1483</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoCountry.get_subregions_from_list_of_region_names-1484"><a href="#GeoCountry.get_subregions_from_list_of_region_names-1484"><span class="linenos">1484</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
</span><span id="GeoCountry.get_subregions_from_list_of_region_names-1485"><a href="#GeoCountry.get_subregions_from_list_of_region_names-1485"><span class="linenos">1485</span></a>            <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s2">&quot;Should provide list as argument&quot;</span><span class="p">)</span>
</span><span id="GeoCountry.get_subregions_from_list_of_region_names-1486"><a href="#GeoCountry.get_subregions_from_list_of_region_names-1486"><span class="linenos">1486</span></a>        <span class="n">s</span><span class="o">=</span><span class="p">[]</span>
</span><span id="GeoCountry.get_subregions_from_list_of_region_names-1487"><a href="#GeoCountry.get_subregions_from_list_of_region_names-1487"><span class="linenos">1487</span></a>        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
</span><span id="GeoCountry.get_subregions_from_list_of_region_names-1488"><a href="#GeoCountry.get_subregions_from_list_of_region_names-1488"><span class="linenos">1488</span></a>            <span class="n">s</span><span class="o">=</span><span class="n">s</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">get_subregions_from_region</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">r</span><span class="p">,</span><span class="n">output</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
</span><span id="GeoCountry.get_subregions_from_list_of_region_names-1489"><a href="#GeoCountry.get_subregions_from_list_of_region_names-1489"><span class="linenos">1489</span></a>        <span class="k">return</span> <span class="n">s</span>
</span></pre></div>


            <div class="docstring"><p>Return the list of subregions according to list of region names given.
The output argument ('code' as default) is given to the get_subregions_from_region function.</p>
</div>


                            </div>
                            <div id="GeoCountry.get_regions_from_subregion" class="classattr">
                                        <input id="GeoCountry.get_regions_from_subregion-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_regions_from_subregion</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">code</span>, </span><span class="param"><span class="n">output</span><span class="o">=</span><span class="s1">&#39;code&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GeoCountry.get_regions_from_subregion-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GeoCountry.get_regions_from_subregion"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GeoCountry.get_regions_from_subregion-1491"><a href="#GeoCountry.get_regions_from_subregion-1491"><span class="linenos">1491</span></a>    <span class="k">def</span> <span class="nf">get_regions_from_subregion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">code</span><span class="p">,</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;code&#39;</span><span class="p">):</span>
</span><span id="GeoCountry.get_regions_from_subregion-1492"><a href="#GeoCountry.get_regions_from_subregion-1492"><span class="linenos">1492</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Return the list of regions where the subregion, given by a code, is.</span>
</span><span id="GeoCountry.get_regions_from_subregion-1493"><a href="#GeoCountry.get_regions_from_subregion-1493"><span class="linenos">1493</span></a><span class="sd">        Output default is &#39;code&#39; of subregions. Can be changer with output=&#39;name&#39;.</span>
</span><span id="GeoCountry.get_regions_from_subregion-1494"><a href="#GeoCountry.get_regions_from_subregion-1494"><span class="linenos">1494</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoCountry.get_regions_from_subregion-1495"><a href="#GeoCountry.get_regions_from_subregion-1495"><span class="linenos">1495</span></a>
</span><span id="GeoCountry.get_regions_from_subregion-1496"><a href="#GeoCountry.get_regions_from_subregion-1496"><span class="linenos">1496</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">output</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span>
</span><span id="GeoCountry.get_regions_from_subregion-1497"><a href="#GeoCountry.get_regions_from_subregion-1497"><span class="linenos">1497</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;The output option should be &quot;code&quot; or &quot;name&quot; only&#39;</span><span class="p">)</span>
</span><span id="GeoCountry.get_regions_from_subregion-1498"><a href="#GeoCountry.get_regions_from_subregion-1498"><span class="linenos">1498</span></a>
</span><span id="GeoCountry.get_regions_from_subregion-1499"><a href="#GeoCountry.get_regions_from_subregion-1499"><span class="linenos">1499</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">code</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_subregion_list</span><span class="p">()[</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">():</span>
</span><span id="GeoCountry.get_regions_from_subregion-1500"><a href="#GeoCountry.get_regions_from_subregion-1500"><span class="linenos">1500</span></a>            <span class="k">raise</span> <span class="n">CoaWhereError</span><span class="p">(</span><span class="s2">&quot;The subregion &quot;</span><span class="o">+</span><span class="n">code</span><span class="o">+</span><span class="s2">&quot; does not exist for country &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()</span><span class="o">+</span><span class="s2">&quot;. See get_subregion_list().&quot;</span><span class="p">)</span>
</span><span id="GeoCountry.get_regions_from_subregion-1501"><a href="#GeoCountry.get_regions_from_subregion-1501"><span class="linenos">1501</span></a>
</span><span id="GeoCountry.get_regions_from_subregion-1502"><a href="#GeoCountry.get_regions_from_subregion-1502"><span class="linenos">1502</span></a>        <span class="n">l</span><span class="o">=</span><span class="p">[]</span>
</span><span id="GeoCountry.get_regions_from_subregion-1503"><a href="#GeoCountry.get_regions_from_subregion-1503"><span class="linenos">1503</span></a>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="GeoCountry.get_regions_from_subregion-1504"><a href="#GeoCountry.get_regions_from_subregion-1504"><span class="linenos">1504</span></a>            <span class="k">if</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">code_subregion</span><span class="p">:</span>
</span><span id="GeoCountry.get_regions_from_subregion-1505"><a href="#GeoCountry.get_regions_from_subregion-1505"><span class="linenos">1505</span></a>                <span class="k">if</span> <span class="n">output</span> <span class="o">==</span> <span class="s1">&#39;code&#39;</span><span class="p">:</span>
</span><span id="GeoCountry.get_regions_from_subregion-1506"><a href="#GeoCountry.get_regions_from_subregion-1506"><span class="linenos">1506</span></a>                    <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">code_region</span><span class="p">)</span>
</span><span id="GeoCountry.get_regions_from_subregion-1507"><a href="#GeoCountry.get_regions_from_subregion-1507"><span class="linenos">1507</span></a>                <span class="k">else</span><span class="p">:</span> <span class="c1"># due to first test, that&#39;s for sure name</span>
</span><span id="GeoCountry.get_regions_from_subregion-1508"><a href="#GeoCountry.get_regions_from_subregion-1508"><span class="linenos">1508</span></a>                    <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">name_region</span><span class="p">)</span>
</span><span id="GeoCountry.get_regions_from_subregion-1509"><a href="#GeoCountry.get_regions_from_subregion-1509"><span class="linenos">1509</span></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">l</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Return the list of regions where the subregion, given by a code, is.
Output default is 'code' of subregions. Can be changer with output='name'.</p>
</div>


                            </div>
                            <div id="GeoCountry.get_regions_from_list_of_subregion_codes" class="classattr">
                                        <input id="GeoCountry.get_regions_from_list_of_subregion_codes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_regions_from_list_of_subregion_codes</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">l</span>, </span><span class="param"><span class="n">output</span><span class="o">=</span><span class="s1">&#39;code&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GeoCountry.get_regions_from_list_of_subregion_codes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GeoCountry.get_regions_from_list_of_subregion_codes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GeoCountry.get_regions_from_list_of_subregion_codes-1511"><a href="#GeoCountry.get_regions_from_list_of_subregion_codes-1511"><span class="linenos">1511</span></a>    <span class="k">def</span> <span class="nf">get_regions_from_list_of_subregion_codes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;code&#39;</span><span class="p">):</span>
</span><span id="GeoCountry.get_regions_from_list_of_subregion_codes-1512"><a href="#GeoCountry.get_regions_from_list_of_subregion_codes-1512"><span class="linenos">1512</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Return the list of regions according to list of subregion names given.</span>
</span><span id="GeoCountry.get_regions_from_list_of_subregion_codes-1513"><a href="#GeoCountry.get_regions_from_list_of_subregion_codes-1513"><span class="linenos">1513</span></a><span class="sd">        The output argument (&#39;code&#39; as default) is given to the get_regions_from_subregion function.</span>
</span><span id="GeoCountry.get_regions_from_list_of_subregion_codes-1514"><a href="#GeoCountry.get_regions_from_list_of_subregion_codes-1514"><span class="linenos">1514</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoCountry.get_regions_from_list_of_subregion_codes-1515"><a href="#GeoCountry.get_regions_from_list_of_subregion_codes-1515"><span class="linenos">1515</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
</span><span id="GeoCountry.get_regions_from_list_of_subregion_codes-1516"><a href="#GeoCountry.get_regions_from_list_of_subregion_codes-1516"><span class="linenos">1516</span></a>            <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s2">&quot;Should provide list as argument&quot;</span><span class="p">)</span>
</span><span id="GeoCountry.get_regions_from_list_of_subregion_codes-1517"><a href="#GeoCountry.get_regions_from_list_of_subregion_codes-1517"><span class="linenos">1517</span></a>        <span class="n">s</span><span class="o">=</span><span class="p">[]</span>
</span><span id="GeoCountry.get_regions_from_list_of_subregion_codes-1518"><a href="#GeoCountry.get_regions_from_list_of_subregion_codes-1518"><span class="linenos">1518</span></a>        <span class="k">for</span> <span class="n">sr</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
</span><span id="GeoCountry.get_regions_from_list_of_subregion_codes-1519"><a href="#GeoCountry.get_regions_from_list_of_subregion_codes-1519"><span class="linenos">1519</span></a>            <span class="n">s</span><span class="o">=</span><span class="n">s</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">get_regions_from_subregion</span><span class="p">(</span><span class="n">sr</span><span class="p">,</span><span class="n">output</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
</span><span id="GeoCountry.get_regions_from_list_of_subregion_codes-1520"><a href="#GeoCountry.get_regions_from_list_of_subregion_codes-1520"><span class="linenos">1520</span></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Return the list of regions according to list of subregion names given.
The output argument ('code' as default) is given to the get_regions_from_subregion function.</p>
</div>


                            </div>
                            <div id="GeoCountry.get_regions_from_macroregion" class="classattr">
                                        <input id="GeoCountry.get_regions_from_macroregion-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_regions_from_macroregion</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GeoCountry.get_regions_from_macroregion-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GeoCountry.get_regions_from_macroregion"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GeoCountry.get_regions_from_macroregion-1522"><a href="#GeoCountry.get_regions_from_macroregion-1522"><span class="linenos">1522</span></a>    <span class="k">def</span> <span class="nf">get_regions_from_macroregion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="GeoCountry.get_regions_from_macroregion-1523"><a href="#GeoCountry.get_regions_from_macroregion-1523"><span class="linenos">1523</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Return the list of regions included in another macroregion</span>
</span><span id="GeoCountry.get_regions_from_macroregion-1524"><a href="#GeoCountry.get_regions_from_macroregion-1524"><span class="linenos">1524</span></a><span class="sd">        Can provide input as code= or name=</span>
</span><span id="GeoCountry.get_regions_from_macroregion-1525"><a href="#GeoCountry.get_regions_from_macroregion-1525"><span class="linenos">1525</span></a><span class="sd">        Can provide output as &#39;name&#39; or &#39;code&#39; (default).</span>
</span><span id="GeoCountry.get_regions_from_macroregion-1526"><a href="#GeoCountry.get_regions_from_macroregion-1526"><span class="linenos">1526</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoCountry.get_regions_from_macroregion-1527"><a href="#GeoCountry.get_regions_from_macroregion-1527"><span class="linenos">1527</span></a>        <span class="n">kwargs_test</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;code&#39;</span><span class="p">,</span><span class="s1">&#39;output&#39;</span><span class="p">],</span><span class="s1">&#39;Should give either name or code of region. Output can be changed with the output option.&#39;</span><span class="p">)</span>
</span><span id="GeoCountry.get_regions_from_macroregion-1528"><a href="#GeoCountry.get_regions_from_macroregion-1528"><span class="linenos">1528</span></a>        <span class="n">code</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
</span><span id="GeoCountry.get_regions_from_macroregion-1529"><a href="#GeoCountry.get_regions_from_macroregion-1529"><span class="linenos">1529</span></a>        <span class="n">name</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
</span><span id="GeoCountry.get_regions_from_macroregion-1530"><a href="#GeoCountry.get_regions_from_macroregion-1530"><span class="linenos">1530</span></a>        <span class="n">out</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">,</span><span class="s1">&#39;code&#39;</span><span class="p">)</span>
</span><span id="GeoCountry.get_regions_from_macroregion-1531"><a href="#GeoCountry.get_regions_from_macroregion-1531"><span class="linenos">1531</span></a>
</span><span id="GeoCountry.get_regions_from_macroregion-1532"><a href="#GeoCountry.get_regions_from_macroregion-1532"><span class="linenos">1532</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">code</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span> <span class="o">^</span> <span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="GeoCountry.get_regions_from_macroregion-1533"><a href="#GeoCountry.get_regions_from_macroregion-1533"><span class="linenos">1533</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s2">&quot;Should give either code or name of region, not both.&quot;</span><span class="p">)</span>
</span><span id="GeoCountry.get_regions_from_macroregion-1534"><a href="#GeoCountry.get_regions_from_macroregion-1534"><span class="linenos">1534</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">out</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span>
</span><span id="GeoCountry.get_regions_from_macroregion-1535"><a href="#GeoCountry.get_regions_from_macroregion-1535"><span class="linenos">1535</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s2">&quot;Should set output either as &#39;code&#39; or &#39;name&#39; for subregions.&quot;</span><span class="p">)</span>
</span><span id="GeoCountry.get_regions_from_macroregion-1536"><a href="#GeoCountry.get_regions_from_macroregion-1536"><span class="linenos">1536</span></a>
</span><span id="GeoCountry.get_regions_from_macroregion-1537"><a href="#GeoCountry.get_regions_from_macroregion-1537"><span class="linenos">1537</span></a>        <span class="n">dict_input</span><span class="o">=</span><span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">]}</span>
</span><span id="GeoCountry.get_regions_from_macroregion-1538"><a href="#GeoCountry.get_regions_from_macroregion-1538"><span class="linenos">1538</span></a>        <span class="n">r_out</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_regions_from_list_of_subregion_codes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_subregions_from_region</span><span class="p">(</span><span class="o">**</span><span class="n">dict_input</span><span class="p">),</span><span class="n">output</span><span class="o">=</span><span class="n">out</span><span class="p">)</span>
</span><span id="GeoCountry.get_regions_from_macroregion-1539"><a href="#GeoCountry.get_regions_from_macroregion-1539"><span class="linenos">1539</span></a>
</span><span id="GeoCountry.get_regions_from_macroregion-1540"><a href="#GeoCountry.get_regions_from_macroregion-1540"><span class="linenos">1540</span></a>        <span class="c1"># remove the input</span>
</span><span id="GeoCountry.get_regions_from_macroregion-1541"><a href="#GeoCountry.get_regions_from_macroregion-1541"><span class="linenos">1541</span></a>        <span class="n">rl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_region_list</span><span class="p">()</span>
</span><span id="GeoCountry.get_regions_from_macroregion-1542"><a href="#GeoCountry.get_regions_from_macroregion-1542"><span class="linenos">1542</span></a>        <span class="k">if</span> <span class="n">code</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GeoCountry.get_regions_from_macroregion-1543"><a href="#GeoCountry.get_regions_from_macroregion-1543"><span class="linenos">1543</span></a>            <span class="k">if</span> <span class="n">out</span><span class="o">==</span><span class="s1">&#39;code&#39;</span><span class="p">:</span>
</span><span id="GeoCountry.get_regions_from_macroregion-1544"><a href="#GeoCountry.get_regions_from_macroregion-1544"><span class="linenos">1544</span></a>                <span class="nb">input</span><span class="o">=</span><span class="n">rl</span><span class="p">[</span><span class="n">rl</span><span class="o">.</span><span class="n">code_region</span><span class="o">==</span><span class="n">code</span><span class="p">]</span><span class="o">.</span><span class="n">name_region</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span><span id="GeoCountry.get_regions_from_macroregion-1545"><a href="#GeoCountry.get_regions_from_macroregion-1545"><span class="linenos">1545</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="GeoCountry.get_regions_from_macroregion-1546"><a href="#GeoCountry.get_regions_from_macroregion-1546"><span class="linenos">1546</span></a>                <span class="nb">input</span><span class="o">=</span><span class="n">code</span>
</span><span id="GeoCountry.get_regions_from_macroregion-1547"><a href="#GeoCountry.get_regions_from_macroregion-1547"><span class="linenos">1547</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GeoCountry.get_regions_from_macroregion-1548"><a href="#GeoCountry.get_regions_from_macroregion-1548"><span class="linenos">1548</span></a>            <span class="k">if</span> <span class="n">out</span><span class="o">==</span><span class="s1">&#39;name&#39;</span><span class="p">:</span>
</span><span id="GeoCountry.get_regions_from_macroregion-1549"><a href="#GeoCountry.get_regions_from_macroregion-1549"><span class="linenos">1549</span></a>                <span class="nb">input</span><span class="o">=</span><span class="n">name</span>
</span><span id="GeoCountry.get_regions_from_macroregion-1550"><a href="#GeoCountry.get_regions_from_macroregion-1550"><span class="linenos">1550</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="GeoCountry.get_regions_from_macroregion-1551"><a href="#GeoCountry.get_regions_from_macroregion-1551"><span class="linenos">1551</span></a>                <span class="nb">input</span><span class="o">=</span><span class="n">rl</span><span class="p">[</span><span class="n">rl</span><span class="o">.</span><span class="n">name_region</span><span class="o">==</span><span class="n">code</span><span class="p">]</span><span class="o">.</span><span class="n">code_region</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span><span id="GeoCountry.get_regions_from_macroregion-1552"><a href="#GeoCountry.get_regions_from_macroregion-1552"><span class="linenos">1552</span></a>
</span><span id="GeoCountry.get_regions_from_macroregion-1553"><a href="#GeoCountry.get_regions_from_macroregion-1553"><span class="linenos">1553</span></a>        <span class="k">if</span> <span class="nb">input</span> <span class="ow">in</span> <span class="n">r_out</span><span class="p">:</span>
</span><span id="GeoCountry.get_regions_from_macroregion-1554"><a href="#GeoCountry.get_regions_from_macroregion-1554"><span class="linenos">1554</span></a>            <span class="n">r_out</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
</span><span id="GeoCountry.get_regions_from_macroregion-1555"><a href="#GeoCountry.get_regions_from_macroregion-1555"><span class="linenos">1555</span></a>
</span><span id="GeoCountry.get_regions_from_macroregion-1556"><a href="#GeoCountry.get_regions_from_macroregion-1556"><span class="linenos">1556</span></a>        <span class="c1"># Append the input in the right position, the macro region should be at the end</span>
</span><span id="GeoCountry.get_regions_from_macroregion-1557"><a href="#GeoCountry.get_regions_from_macroregion-1557"><span class="linenos">1557</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">r_out</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># the input is not a macro region but just a region</span>
</span><span id="GeoCountry.get_regions_from_macroregion-1558"><a href="#GeoCountry.get_regions_from_macroregion-1558"><span class="linenos">1558</span></a>            <span class="n">r_out</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">input</span><span class="p">)</span>
</span><span id="GeoCountry.get_regions_from_macroregion-1559"><a href="#GeoCountry.get_regions_from_macroregion-1559"><span class="linenos">1559</span></a>        <span class="k">else</span><span class="p">:</span> <span class="c1"># the input is a real macro region</span>
</span><span id="GeoCountry.get_regions_from_macroregion-1560"><a href="#GeoCountry.get_regions_from_macroregion-1560"><span class="linenos">1560</span></a>            <span class="n">r_out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
</span><span id="GeoCountry.get_regions_from_macroregion-1561"><a href="#GeoCountry.get_regions_from_macroregion-1561"><span class="linenos">1561</span></a>
</span><span id="GeoCountry.get_regions_from_macroregion-1562"><a href="#GeoCountry.get_regions_from_macroregion-1562"><span class="linenos">1562</span></a>        <span class="k">return</span> <span class="n">r_out</span>
</span></pre></div>


            <div class="docstring"><p>Return the list of regions included in another macroregion
Can provide input as code= or name=
Can provide output as 'name' or 'code' (default).</p>
</div>


                            </div>
                            <div id="GeoCountry.get_list_properties" class="classattr">
                                        <input id="GeoCountry.get_list_properties-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_list_properties</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GeoCountry.get_list_properties-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GeoCountry.get_list_properties"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GeoCountry.get_list_properties-1564"><a href="#GeoCountry.get_list_properties-1564"><span class="linenos">1564</span></a>    <span class="k">def</span> <span class="nf">get_list_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GeoCountry.get_list_properties-1565"><a href="#GeoCountry.get_list_properties-1565"><span class="linenos">1565</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the list of available properties for the current country</span>
</span><span id="GeoCountry.get_list_properties-1566"><a href="#GeoCountry.get_list_properties-1566"><span class="linenos">1566</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoCountry.get_list_properties-1567"><a href="#GeoCountry.get_list_properties-1567"><span class="linenos">1567</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_is_init</span><span class="p">():</span>
</span><span id="GeoCountry.get_list_properties-1568"><a href="#GeoCountry.get_list_properties-1568"><span class="linenos">1568</span></a>            <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span>
</span></pre></div>


            <div class="docstring"><p>Return the list of available properties for the current country</p>
</div>


                            </div>
                            <div id="GeoCountry.get_data" class="classattr">
                                        <input id="GeoCountry.get_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_data</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">region_version</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GeoCountry.get_data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GeoCountry.get_data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GeoCountry.get_data-1570"><a href="#GeoCountry.get_data-1570"><span class="linenos">1570</span></a>    <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">region_version</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="GeoCountry.get_data-1571"><a href="#GeoCountry.get_data-1571"><span class="linenos">1571</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the whole geopandas data.</span>
</span><span id="GeoCountry.get_data-1572"><a href="#GeoCountry.get_data-1572"><span class="linenos">1572</span></a><span class="sd">        If region_version = True (not default), the pandas output is region based focalized.</span>
</span><span id="GeoCountry.get_data-1573"><a href="#GeoCountry.get_data-1573"><span class="linenos">1573</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoCountry.get_data-1574"><a href="#GeoCountry.get_data-1574"><span class="linenos">1574</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_is_init</span><span class="p">():</span>
</span><span id="GeoCountry.get_data-1575"><a href="#GeoCountry.get_data-1575"><span class="linenos">1575</span></a>            <span class="k">if</span> <span class="n">region_version</span><span class="p">:</span>
</span><span id="GeoCountry.get_data-1576"><a href="#GeoCountry.get_data-1576"><span class="linenos">1576</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data_region</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span> <span class="c1"># i.e. is None</span>
</span><span id="GeoCountry.get_data-1577"><a href="#GeoCountry.get_data-1577"><span class="linenos">1577</span></a>                    <span class="n">col_reg</span><span class="o">=</span><span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">if</span> <span class="s1">&#39;_region&#39;</span> <span class="ow">in</span> <span class="n">c</span><span class="p">]</span>
</span><span id="GeoCountry.get_data-1578"><a href="#GeoCountry.get_data-1578"><span class="linenos">1578</span></a>                    <span class="n">col</span><span class="o">=</span><span class="n">col_reg</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="GeoCountry.get_data-1579"><a href="#GeoCountry.get_data-1579"><span class="linenos">1579</span></a>                    <span class="n">col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;geometry&#39;</span><span class="p">)</span> <span class="c1"># to merge the geometry of subregions</span>
</span><span id="GeoCountry.get_data-1580"><a href="#GeoCountry.get_data-1580"><span class="linenos">1580</span></a>                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list_properties</span><span class="p">():</span>
</span><span id="GeoCountry.get_data-1581"><a href="#GeoCountry.get_data-1581"><span class="linenos">1581</span></a>                        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;_subregion&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">)</span> <span class="ow">and</span> <span class="n">pd</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_numeric_dtype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="n">p</span><span class="p">]):</span>
</span><span id="GeoCountry.get_data-1582"><a href="#GeoCountry.get_data-1582"><span class="linenos">1582</span></a>                            <span class="n">col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span><span id="GeoCountry.get_data-1583"><a href="#GeoCountry.get_data-1583"><span class="linenos">1583</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;code_subregion&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
</span><span id="GeoCountry.get_data-1584"><a href="#GeoCountry.get_data-1584"><span class="linenos">1584</span></a>                        <span class="n">col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">)</span> <span class="c1"># to get the list of subregion in region</span>
</span><span id="GeoCountry.get_data-1585"><a href="#GeoCountry.get_data-1585"><span class="linenos">1585</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;name_subregion&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
</span><span id="GeoCountry.get_data-1586"><a href="#GeoCountry.get_data-1586"><span class="linenos">1586</span></a>                        <span class="n">col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">)</span> <span class="c1"># to get the list of subregion name in region</span>
</span><span id="GeoCountry.get_data-1587"><a href="#GeoCountry.get_data-1587"><span class="linenos">1587</span></a>
</span><span id="GeoCountry.get_data-1588"><a href="#GeoCountry.get_data-1588"><span class="linenos">1588</span></a>                    <span class="n">pr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="GeoCountry.get_data-1589"><a href="#GeoCountry.get_data-1589"><span class="linenos">1589</span></a>
</span><span id="GeoCountry.get_data-1590"><a href="#GeoCountry.get_data-1590"><span class="linenos">1590</span></a>                    <span class="c1"># Country specific management</span>
</span><span id="GeoCountry.get_data-1591"><a href="#GeoCountry.get_data-1591"><span class="linenos">1591</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;FRA&#39;</span><span class="p">:</span> <span class="c1"># manage pseudo &#39;FRA&#39; regions &#39;Métropole&#39; and &#39;Outre-mer&#39;</span>
</span><span id="GeoCountry.get_data-1592"><a href="#GeoCountry.get_data-1592"><span class="linenos">1592</span></a>                        <span class="n">metropole_cut</span><span class="o">=</span><span class="n">pr</span><span class="o">.</span><span class="n">code_region</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">10</span>
</span><span id="GeoCountry.get_data-1593"><a href="#GeoCountry.get_data-1593"><span class="linenos">1593</span></a>                        <span class="n">pr_metropole</span><span class="o">=</span><span class="n">pr</span><span class="p">[</span><span class="n">metropole_cut</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="GeoCountry.get_data-1594"><a href="#GeoCountry.get_data-1594"><span class="linenos">1594</span></a>                        <span class="n">pr_metropole</span><span class="p">[</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;999&#39;</span>
</span><span id="GeoCountry.get_data-1595"><a href="#GeoCountry.get_data-1595"><span class="linenos">1595</span></a>                        <span class="n">pr_metropole</span><span class="p">[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;Métropole&#39;</span>
</span><span id="GeoCountry.get_data-1596"><a href="#GeoCountry.get_data-1596"><span class="linenos">1596</span></a>                        <span class="n">pr_metropole</span><span class="p">[</span><span class="s1">&#39;flag_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
</span><span id="GeoCountry.get_data-1597"><a href="#GeoCountry.get_data-1597"><span class="linenos">1597</span></a>                        <span class="n">pr_outremer</span><span class="o">=</span><span class="n">pr</span><span class="p">[</span><span class="o">~</span><span class="n">metropole_cut</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="GeoCountry.get_data-1598"><a href="#GeoCountry.get_data-1598"><span class="linenos">1598</span></a>                        <span class="n">pr_outremer</span><span class="p">[</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;000&#39;</span>
</span><span id="GeoCountry.get_data-1599"><a href="#GeoCountry.get_data-1599"><span class="linenos">1599</span></a>                        <span class="n">pr_outremer</span><span class="p">[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;Outre-mer&#39;</span>
</span><span id="GeoCountry.get_data-1600"><a href="#GeoCountry.get_data-1600"><span class="linenos">1600</span></a>                        <span class="n">pr_outremer</span><span class="p">[</span><span class="s1">&#39;flag_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
</span><span id="GeoCountry.get_data-1601"><a href="#GeoCountry.get_data-1601"><span class="linenos">1601</span></a>
</span><span id="GeoCountry.get_data-1602"><a href="#GeoCountry.get_data-1602"><span class="linenos">1602</span></a>                        <span class="n">pr</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pr</span><span class="p">,</span><span class="n">pr_metropole</span><span class="p">],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry.get_data-1603"><a href="#GeoCountry.get_data-1603"><span class="linenos">1603</span></a>                        <span class="n">pr</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pr</span><span class="p">,</span><span class="n">pr_outremer</span><span class="p">],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry.get_data-1604"><a href="#GeoCountry.get_data-1604"><span class="linenos">1604</span></a>                        <span class="c1">#pr=pr.append(pr_metropole,ignore_index=True).append(pr_outremer,ignore_index=True)</span>
</span><span id="GeoCountry.get_data-1605"><a href="#GeoCountry.get_data-1605"><span class="linenos">1605</span></a>
</span><span id="GeoCountry.get_data-1606"><a href="#GeoCountry.get_data-1606"><span class="linenos">1606</span></a>                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;ESP&#39;</span> <span class="p">:</span> <span class="c1"># manage pseudo &#39;ESP&#39; regions within and outside continent</span>
</span><span id="GeoCountry.get_data-1607"><a href="#GeoCountry.get_data-1607"><span class="linenos">1607</span></a>                        <span class="n">islands_cut</span><span class="o">=</span><span class="n">pr</span><span class="o">.</span><span class="n">code_region</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;05&#39;</span><span class="p">])</span>
</span><span id="GeoCountry.get_data-1608"><a href="#GeoCountry.get_data-1608"><span class="linenos">1608</span></a>                        <span class="n">pr_metropole</span><span class="o">=</span><span class="n">pr</span><span class="p">[</span><span class="o">~</span><span class="n">islands_cut</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="GeoCountry.get_data-1609"><a href="#GeoCountry.get_data-1609"><span class="linenos">1609</span></a>                        <span class="n">pr_metropole</span><span class="p">[</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;99&#39;</span>
</span><span id="GeoCountry.get_data-1610"><a href="#GeoCountry.get_data-1610"><span class="linenos">1610</span></a>                        <span class="n">pr_metropole</span><span class="p">[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;España peninsular&#39;</span>
</span><span id="GeoCountry.get_data-1611"><a href="#GeoCountry.get_data-1611"><span class="linenos">1611</span></a>                        <span class="n">pr_metropole</span><span class="p">[</span><span class="s1">&#39;flag_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
</span><span id="GeoCountry.get_data-1612"><a href="#GeoCountry.get_data-1612"><span class="linenos">1612</span></a>
</span><span id="GeoCountry.get_data-1613"><a href="#GeoCountry.get_data-1613"><span class="linenos">1613</span></a>                        <span class="n">pr_outremer</span><span class="o">=</span><span class="n">pr</span><span class="p">[</span><span class="n">islands_cut</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="GeoCountry.get_data-1614"><a href="#GeoCountry.get_data-1614"><span class="linenos">1614</span></a>                        <span class="n">pr_outremer</span><span class="p">[</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;00&#39;</span>
</span><span id="GeoCountry.get_data-1615"><a href="#GeoCountry.get_data-1615"><span class="linenos">1615</span></a>                        <span class="n">pr_outremer</span><span class="p">[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;Islas españolas&#39;</span>
</span><span id="GeoCountry.get_data-1616"><a href="#GeoCountry.get_data-1616"><span class="linenos">1616</span></a>                        <span class="n">pr_outremer</span><span class="p">[</span><span class="s1">&#39;flag_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
</span><span id="GeoCountry.get_data-1617"><a href="#GeoCountry.get_data-1617"><span class="linenos">1617</span></a>
</span><span id="GeoCountry.get_data-1618"><a href="#GeoCountry.get_data-1618"><span class="linenos">1618</span></a>                        <span class="n">pr</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pr</span><span class="p">,</span><span class="n">pr_metropole</span><span class="p">,</span><span class="n">pr_outremer</span><span class="p">],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry.get_data-1619"><a href="#GeoCountry.get_data-1619"><span class="linenos">1619</span></a>
</span><span id="GeoCountry.get_data-1620"><a href="#GeoCountry.get_data-1620"><span class="linenos">1620</span></a>                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;PRT&#39;</span> <span class="p">:</span> <span class="c1"># manage pseudo &#39;PRT&#39; regions within and outside continent</span>
</span><span id="GeoCountry.get_data-1621"><a href="#GeoCountry.get_data-1621"><span class="linenos">1621</span></a>                        <span class="n">islands_cut</span><span class="o">=</span><span class="n">pr</span><span class="o">.</span><span class="n">code_region</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;PT.AC&#39;</span><span class="p">,</span><span class="s1">&#39;PT.MA&#39;</span><span class="p">])</span>
</span><span id="GeoCountry.get_data-1622"><a href="#GeoCountry.get_data-1622"><span class="linenos">1622</span></a>                        <span class="n">pr_metropole</span><span class="o">=</span><span class="n">pr</span><span class="p">[</span><span class="o">~</span><span class="n">islands_cut</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="GeoCountry.get_data-1623"><a href="#GeoCountry.get_data-1623"><span class="linenos">1623</span></a>                        <span class="n">pr_metropole</span><span class="p">[</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;PT.99&#39;</span>
</span><span id="GeoCountry.get_data-1624"><a href="#GeoCountry.get_data-1624"><span class="linenos">1624</span></a>                        <span class="n">pr_metropole</span><span class="p">[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;Portugal continental&#39;</span>
</span><span id="GeoCountry.get_data-1625"><a href="#GeoCountry.get_data-1625"><span class="linenos">1625</span></a>                        <span class="n">pr_metropole</span><span class="p">[</span><span class="s1">&#39;flag_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
</span><span id="GeoCountry.get_data-1626"><a href="#GeoCountry.get_data-1626"><span class="linenos">1626</span></a>
</span><span id="GeoCountry.get_data-1627"><a href="#GeoCountry.get_data-1627"><span class="linenos">1627</span></a>                        <span class="n">pr_outremer</span><span class="o">=</span><span class="n">pr</span><span class="p">[</span><span class="n">islands_cut</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="GeoCountry.get_data-1628"><a href="#GeoCountry.get_data-1628"><span class="linenos">1628</span></a>                        <span class="n">pr_outremer</span><span class="p">[</span><span class="s1">&#39;code_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;PT.00&#39;</span>
</span><span id="GeoCountry.get_data-1629"><a href="#GeoCountry.get_data-1629"><span class="linenos">1629</span></a>                        <span class="n">pr_outremer</span><span class="p">[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;Ilhas portuguesas&#39;</span>
</span><span id="GeoCountry.get_data-1630"><a href="#GeoCountry.get_data-1630"><span class="linenos">1630</span></a>                        <span class="n">pr_outremer</span><span class="p">[</span><span class="s1">&#39;flag_region&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
</span><span id="GeoCountry.get_data-1631"><a href="#GeoCountry.get_data-1631"><span class="linenos">1631</span></a>
</span><span id="GeoCountry.get_data-1632"><a href="#GeoCountry.get_data-1632"><span class="linenos">1632</span></a>                        <span class="n">pr</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pr</span><span class="p">,</span><span class="n">pr_metropole</span><span class="p">],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry.get_data-1633"><a href="#GeoCountry.get_data-1633"><span class="linenos">1633</span></a>                        <span class="n">pr</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pr</span><span class="p">,</span><span class="n">pr_outremer</span><span class="p">],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry.get_data-1634"><a href="#GeoCountry.get_data-1634"><span class="linenos">1634</span></a>                        <span class="c1">#pr=pr.append(pr_metropole,ignore_index=True).append(pr_outremer,ignore_index=True)</span>
</span><span id="GeoCountry.get_data-1635"><a href="#GeoCountry.get_data-1635"><span class="linenos">1635</span></a>
</span><span id="GeoCountry.get_data-1636"><a href="#GeoCountry.get_data-1636"><span class="linenos">1636</span></a>                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;USA&#39;</span><span class="p">:</span>
</span><span id="GeoCountry.get_data-1637"><a href="#GeoCountry.get_data-1637"><span class="linenos">1637</span></a>                        <span class="n">usa_col</span><span class="o">=</span><span class="n">pr</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="GeoCountry.get_data-1638"><a href="#GeoCountry.get_data-1638"><span class="linenos">1638</span></a>                        <span class="c1">#usa_col.remove(&#39;_subregion&#39;) # Remove numeric column, if not, the dissolve does not work properly</span>
</span><span id="GeoCountry.get_data-1639"><a href="#GeoCountry.get_data-1639"><span class="linenos">1639</span></a>                        <span class="c1">#usa_col.remove(&#39;area_subregion&#39;) # idem</span>
</span><span id="GeoCountry.get_data-1640"><a href="#GeoCountry.get_data-1640"><span class="linenos">1640</span></a>                        <span class="n">pr</span><span class="o">=</span><span class="n">pr</span><span class="p">[</span><span class="n">usa_col</span><span class="p">]</span>
</span><span id="GeoCountry.get_data-1641"><a href="#GeoCountry.get_data-1641"><span class="linenos">1641</span></a>
</span><span id="GeoCountry.get_data-1642"><a href="#GeoCountry.get_data-1642"><span class="linenos">1642</span></a>                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;EUR&#39;</span><span class="p">:</span>
</span><span id="GeoCountry.get_data-1643"><a href="#GeoCountry.get_data-1643"><span class="linenos">1643</span></a>                        <span class="n">pr</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pr</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">isnull</span><span class="p">(),</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sg</span><span class="o">.</span><span class="n">Point</span><span class="p">()</span>  <span class="c1"># For correct geometry merge</span>
</span><span id="GeoCountry.get_data-1644"><a href="#GeoCountry.get_data-1644"><span class="linenos">1644</span></a>                        <span class="n">pr</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pr</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span> <span class="c1"># needed with geopandas 0.10.2&#39; for EUR data only (apparently)</span>
</span><span id="GeoCountry.get_data-1645"><a href="#GeoCountry.get_data-1645"><span class="linenos">1645</span></a>
</span><span id="GeoCountry.get_data-1646"><a href="#GeoCountry.get_data-1646"><span class="linenos">1646</span></a>                    <span class="n">pr</span><span class="p">[</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">pr</span><span class="o">.</span><span class="n">code_subregion</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span><span class="n">x</span><span class="p">])</span>
</span><span id="GeoCountry.get_data-1647"><a href="#GeoCountry.get_data-1647"><span class="linenos">1647</span></a>                    <span class="n">pr</span><span class="p">[</span><span class="s1">&#39;name_subregion&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">pr</span><span class="o">.</span><span class="n">name_subregion</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span><span class="n">x</span><span class="p">])</span>
</span><span id="GeoCountry.get_data-1648"><a href="#GeoCountry.get_data-1648"><span class="linenos">1648</span></a>
</span><span id="GeoCountry.get_data-1649"><a href="#GeoCountry.get_data-1649"><span class="linenos">1649</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_country_data_region</span><span class="o">=</span><span class="n">pr</span><span class="o">.</span><span class="n">dissolve</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="n">col_reg</span><span class="p">,</span><span class="n">aggfunc</span><span class="o">=</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">()))</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;code_region&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="GeoCountry.get_data-1650"><a href="#GeoCountry.get_data-1650"><span class="linenos">1650</span></a>                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;population&#39;</span><span class="p">,</span><span class="s1">&#39;area&#39;</span><span class="p">]:</span>
</span><span id="GeoCountry.get_data-1651"><a href="#GeoCountry.get_data-1651"><span class="linenos">1651</span></a>                        <span class="k">if</span> <span class="n">x</span><span class="o">+</span><span class="s1">&#39;_subregion&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data_region</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="GeoCountry.get_data-1652"><a href="#GeoCountry.get_data-1652"><span class="linenos">1652</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">_country_data_region</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">x</span><span class="o">+</span><span class="s1">&#39;_subregion&#39;</span><span class="p">:</span><span class="n">x</span><span class="o">+</span><span class="s1">&#39;_region&#39;</span><span class="p">},</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GeoCountry.get_data-1653"><a href="#GeoCountry.get_data-1653"><span class="linenos">1653</span></a>
</span><span id="GeoCountry.get_data-1654"><a href="#GeoCountry.get_data-1654"><span class="linenos">1654</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data_region</span>
</span><span id="GeoCountry.get_data-1655"><a href="#GeoCountry.get_data-1655"><span class="linenos">1655</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="GeoCountry.get_data-1656"><a href="#GeoCountry.get_data-1656"><span class="linenos">1656</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data_subregion</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span> <span class="c1">#i.e. is None</span>
</span><span id="GeoCountry.get_data-1657"><a href="#GeoCountry.get_data-1657"><span class="linenos">1657</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_country_data_subregion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">)</span>
</span><span id="GeoCountry.get_data-1658"><a href="#GeoCountry.get_data-1658"><span class="linenos">1658</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data_subregion</span>
</span></pre></div>


            <div class="docstring"><p>Return the whole geopandas data.
If region_version = True (not default), the pandas output is region based focalized.</p>
</div>


                            </div>
                            <div id="GeoCountry.add_field" class="classattr">
                                        <input id="GeoCountry.add_field-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_field</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GeoCountry.add_field-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GeoCountry.add_field"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GeoCountry.add_field-1660"><a href="#GeoCountry.add_field-1660"><span class="linenos">1660</span></a>    <span class="k">def</span> <span class="nf">add_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="GeoCountry.add_field-1661"><a href="#GeoCountry.add_field-1661"><span class="linenos">1661</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a the data pandas.Dataframe with an additionnal column with property prop.</span>
</span><span id="GeoCountry.add_field-1662"><a href="#GeoCountry.add_field-1662"><span class="linenos">1662</span></a>
</span><span id="GeoCountry.add_field-1663"><a href="#GeoCountry.add_field-1663"><span class="linenos">1663</span></a><span class="sd">        Arguments :</span>
</span><span id="GeoCountry.add_field-1664"><a href="#GeoCountry.add_field-1664"><span class="linenos">1664</span></a><span class="sd">        input        : pandas.Dataframe object. Mandatory.</span>
</span><span id="GeoCountry.add_field-1665"><a href="#GeoCountry.add_field-1665"><span class="linenos">1665</span></a><span class="sd">        field        : field of properties to add. Should be within the get_list_prop() list. Mandatory.</span>
</span><span id="GeoCountry.add_field-1666"><a href="#GeoCountry.add_field-1666"><span class="linenos">1666</span></a><span class="sd">        input_key    : input geo key of the input pandas dataframe. Default  &#39;where&#39;</span>
</span><span id="GeoCountry.add_field-1667"><a href="#GeoCountry.add_field-1667"><span class="linenos">1667</span></a><span class="sd">        geofield     : internal geo field to make the merge. Default &#39;code_subregion&#39;</span>
</span><span id="GeoCountry.add_field-1668"><a href="#GeoCountry.add_field-1668"><span class="linenos">1668</span></a><span class="sd">        region_merging : Boolean value. Default False, except if the geofield contains &#39;_region&#39;.</span>
</span><span id="GeoCountry.add_field-1669"><a href="#GeoCountry.add_field-1669"><span class="linenos">1669</span></a><span class="sd">                       If True, the merge between input dans GeoCountry data is done within the</span>
</span><span id="GeoCountry.add_field-1670"><a href="#GeoCountry.add_field-1670"><span class="linenos">1670</span></a><span class="sd">                       region version of the data, not the subregion data which is the default</span>
</span><span id="GeoCountry.add_field-1671"><a href="#GeoCountry.add_field-1671"><span class="linenos">1671</span></a><span class="sd">                       behavious.</span>
</span><span id="GeoCountry.add_field-1672"><a href="#GeoCountry.add_field-1672"><span class="linenos">1672</span></a><span class="sd">        overload   : Allow to overload a field. Boolean value. Default : False</span>
</span><span id="GeoCountry.add_field-1673"><a href="#GeoCountry.add_field-1673"><span class="linenos">1673</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GeoCountry.add_field-1674"><a href="#GeoCountry.add_field-1674"><span class="linenos">1674</span></a>
</span><span id="GeoCountry.add_field-1675"><a href="#GeoCountry.add_field-1675"><span class="linenos">1675</span></a>        <span class="c1"># Test of args</span>
</span><span id="GeoCountry.add_field-1676"><a href="#GeoCountry.add_field-1676"><span class="linenos">1676</span></a>        <span class="n">kwargs_test</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;input&#39;</span><span class="p">,</span><span class="s1">&#39;field&#39;</span><span class="p">,</span><span class="s1">&#39;input_key&#39;</span><span class="p">,</span><span class="s1">&#39;geofield&#39;</span><span class="p">,</span><span class="s1">&#39;geotype&#39;</span><span class="p">,</span><span class="s1">&#39;overload&#39;</span><span class="p">],</span>
</span><span id="GeoCountry.add_field-1677"><a href="#GeoCountry.add_field-1677"><span class="linenos">1677</span></a>            <span class="s1">&#39;Bad args used in the add_field() function.&#39;</span><span class="p">)</span>
</span><span id="GeoCountry.add_field-1678"><a href="#GeoCountry.add_field-1678"><span class="linenos">1678</span></a>
</span><span id="GeoCountry.add_field-1679"><a href="#GeoCountry.add_field-1679"><span class="linenos">1679</span></a>        <span class="c1"># Testing input</span>
</span><span id="GeoCountry.add_field-1680"><a href="#GeoCountry.add_field-1680"><span class="linenos">1680</span></a>        <span class="n">data</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span> <span class="c1"># the panda</span>
</span><span id="GeoCountry.add_field-1681"><a href="#GeoCountry.add_field-1681"><span class="linenos">1681</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
</span><span id="GeoCountry.add_field-1682"><a href="#GeoCountry.add_field-1682"><span class="linenos">1682</span></a>            <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s1">&#39;You should provide a valid input pandas&#39;</span>
</span><span id="GeoCountry.add_field-1683"><a href="#GeoCountry.add_field-1683"><span class="linenos">1683</span></a>                <span class="s1">&#39; DataFrame as input. See help.&#39;</span><span class="p">)</span>
</span><span id="GeoCountry.add_field-1684"><a href="#GeoCountry.add_field-1684"><span class="linenos">1684</span></a>        <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="GeoCountry.add_field-1685"><a href="#GeoCountry.add_field-1685"><span class="linenos">1685</span></a>
</span><span id="GeoCountry.add_field-1686"><a href="#GeoCountry.add_field-1686"><span class="linenos">1686</span></a>        <span class="c1"># Testing input_key</span>
</span><span id="GeoCountry.add_field-1687"><a href="#GeoCountry.add_field-1687"><span class="linenos">1687</span></a>        <span class="n">input_key</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;input_key&#39;</span><span class="p">,</span><span class="s1">&#39;where&#39;</span><span class="p">)</span>
</span><span id="GeoCountry.add_field-1688"><a href="#GeoCountry.add_field-1688"><span class="linenos">1688</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_key</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
</span><span id="GeoCountry.add_field-1689"><a href="#GeoCountry.add_field-1689"><span class="linenos">1689</span></a>            <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s1">&#39;The input_key should be given as a string.&#39;</span><span class="p">)</span>
</span><span id="GeoCountry.add_field-1690"><a href="#GeoCountry.add_field-1690"><span class="linenos">1690</span></a>        <span class="k">if</span> <span class="n">input_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
</span><span id="GeoCountry.add_field-1691"><a href="#GeoCountry.add_field-1691"><span class="linenos">1691</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;The input_key &quot;&#39;</span><span class="o">+</span><span class="n">input_key</span><span class="o">+</span><span class="s1">&#39;&quot; given is &#39;</span>
</span><span id="GeoCountry.add_field-1692"><a href="#GeoCountry.add_field-1692"><span class="linenos">1692</span></a>                <span class="s1">&#39;not a valid column name of the input pandas dataframe.&#39;</span><span class="p">)</span>
</span><span id="GeoCountry.add_field-1693"><a href="#GeoCountry.add_field-1693"><span class="linenos">1693</span></a>
</span><span id="GeoCountry.add_field-1694"><a href="#GeoCountry.add_field-1694"><span class="linenos">1694</span></a>        <span class="c1"># Testing geofield</span>
</span><span id="GeoCountry.add_field-1695"><a href="#GeoCountry.add_field-1695"><span class="linenos">1695</span></a>        <span class="n">geofield</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;geofield&#39;</span><span class="p">,</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">)</span>
</span><span id="GeoCountry.add_field-1696"><a href="#GeoCountry.add_field-1696"><span class="linenos">1696</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geofield</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
</span><span id="GeoCountry.add_field-1697"><a href="#GeoCountry.add_field-1697"><span class="linenos">1697</span></a>            <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s1">&#39;The geofield should be given as a string.&#39;</span><span class="p">)</span>
</span><span id="GeoCountry.add_field-1698"><a href="#GeoCountry.add_field-1698"><span class="linenos">1698</span></a>        <span class="k">if</span> <span class="n">geofield</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_country_data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
</span><span id="GeoCountry.add_field-1699"><a href="#GeoCountry.add_field-1699"><span class="linenos">1699</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;The geofield &quot;&#39;</span><span class="o">+</span><span class="n">geofield</span><span class="o">+</span><span class="s1">&#39;&quot; given is &#39;</span>
</span><span id="GeoCountry.add_field-1700"><a href="#GeoCountry.add_field-1700"><span class="linenos">1700</span></a>                <span class="s1">&#39;not a valid column name of the available data. &#39;</span>
</span><span id="GeoCountry.add_field-1701"><a href="#GeoCountry.add_field-1701"><span class="linenos">1701</span></a>                <span class="s1">&#39;See get_list_properties() for valid fields.&#39;</span><span class="p">)</span>
</span><span id="GeoCountry.add_field-1702"><a href="#GeoCountry.add_field-1702"><span class="linenos">1702</span></a>
</span><span id="GeoCountry.add_field-1703"><a href="#GeoCountry.add_field-1703"><span class="linenos">1703</span></a>        <span class="n">region_merging</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;region_merging&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
</span><span id="GeoCountry.add_field-1704"><a href="#GeoCountry.add_field-1704"><span class="linenos">1704</span></a>        <span class="k">if</span> <span class="n">region_merging</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GeoCountry.add_field-1705"><a href="#GeoCountry.add_field-1705"><span class="linenos">1705</span></a>            <span class="k">if</span> <span class="s1">&#39;_region&#39;</span> <span class="ow">in</span> <span class="n">geofield</span><span class="p">:</span>
</span><span id="GeoCountry.add_field-1706"><a href="#GeoCountry.add_field-1706"><span class="linenos">1706</span></a>                <span class="n">region_merging</span><span class="o">=</span><span class="kc">True</span>
</span><span id="GeoCountry.add_field-1707"><a href="#GeoCountry.add_field-1707"><span class="linenos">1707</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="GeoCountry.add_field-1708"><a href="#GeoCountry.add_field-1708"><span class="linenos">1708</span></a>                <span class="n">region_merging</span><span class="o">=</span><span class="kc">False</span>
</span><span id="GeoCountry.add_field-1709"><a href="#GeoCountry.add_field-1709"><span class="linenos">1709</span></a>
</span><span id="GeoCountry.add_field-1710"><a href="#GeoCountry.add_field-1710"><span class="linenos">1710</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">region_merging</span><span class="p">,</span><span class="nb">bool</span><span class="p">):</span>
</span><span id="GeoCountry.add_field-1711"><a href="#GeoCountry.add_field-1711"><span class="linenos">1711</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;The region_mergin key should be boolean. See help.&#39;</span><span class="p">)</span>
</span><span id="GeoCountry.add_field-1712"><a href="#GeoCountry.add_field-1712"><span class="linenos">1712</span></a>
</span><span id="GeoCountry.add_field-1713"><a href="#GeoCountry.add_field-1713"><span class="linenos">1713</span></a>        <span class="c1"># Testing fields</span>
</span><span id="GeoCountry.add_field-1714"><a href="#GeoCountry.add_field-1714"><span class="linenos">1714</span></a>        <span class="n">prop</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;field&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span> <span class="c1"># field list</span>
</span><span id="GeoCountry.add_field-1715"><a href="#GeoCountry.add_field-1715"><span class="linenos">1715</span></a>        <span class="k">if</span> <span class="n">prop</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GeoCountry.add_field-1716"><a href="#GeoCountry.add_field-1716"><span class="linenos">1716</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;No field given. See help.&#39;</span><span class="p">)</span>
</span><span id="GeoCountry.add_field-1717"><a href="#GeoCountry.add_field-1717"><span class="linenos">1717</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
</span><span id="GeoCountry.add_field-1718"><a href="#GeoCountry.add_field-1718"><span class="linenos">1718</span></a>            <span class="n">prop</span><span class="o">=</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span> <span class="c1"># make the prop input a list if needed</span>
</span><span id="GeoCountry.add_field-1719"><a href="#GeoCountry.add_field-1719"><span class="linenos">1719</span></a>
</span><span id="GeoCountry.add_field-1720"><a href="#GeoCountry.add_field-1720"><span class="linenos">1720</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">):</span>
</span><span id="GeoCountry.add_field-1721"><a href="#GeoCountry.add_field-1721"><span class="linenos">1721</span></a>            <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s2">&quot;Each property should be a string whereas &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; is not a list of string.&quot;</span><span class="p">)</span>
</span><span id="GeoCountry.add_field-1722"><a href="#GeoCountry.add_field-1722"><span class="linenos">1722</span></a>
</span><span id="GeoCountry.add_field-1723"><a href="#GeoCountry.add_field-1723"><span class="linenos">1723</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_list_properties</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">):</span>
</span><span id="GeoCountry.add_field-1724"><a href="#GeoCountry.add_field-1724"><span class="linenos">1724</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s2">&quot;The property &quot;</span><span class="o">+</span><span class="n">prop</span><span class="o">+</span><span class="s2">&quot; is not available for country &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">get_country</span><span class="p">()</span><span class="o">+</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
</span><span id="GeoCountry.add_field-1725"><a href="#GeoCountry.add_field-1725"><span class="linenos">1725</span></a>
</span><span id="GeoCountry.add_field-1726"><a href="#GeoCountry.add_field-1726"><span class="linenos">1726</span></a>        <span class="c1"># Testing overload</span>
</span><span id="GeoCountry.add_field-1727"><a href="#GeoCountry.add_field-1727"><span class="linenos">1727</span></a>        <span class="n">overload</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;overload&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
</span><span id="GeoCountry.add_field-1728"><a href="#GeoCountry.add_field-1728"><span class="linenos">1728</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">overload</span><span class="p">,</span><span class="nb">bool</span><span class="p">):</span>
</span><span id="GeoCountry.add_field-1729"><a href="#GeoCountry.add_field-1729"><span class="linenos">1729</span></a>            <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s1">&#39;The overload option should be a boolean.&#39;</span><span class="p">)</span>
</span><span id="GeoCountry.add_field-1730"><a href="#GeoCountry.add_field-1730"><span class="linenos">1730</span></a>
</span><span id="GeoCountry.add_field-1731"><a href="#GeoCountry.add_field-1731"><span class="linenos">1731</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">overload</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">):</span>
</span><span id="GeoCountry.add_field-1732"><a href="#GeoCountry.add_field-1732"><span class="linenos">1732</span></a>            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;Some fields already exist in you panda &#39;</span>
</span><span id="GeoCountry.add_field-1733"><a href="#GeoCountry.add_field-1733"><span class="linenos">1733</span></a>                <span class="s1">&#39;dataframe columns. You may set overload to True.&#39;</span><span class="p">)</span>
</span><span id="GeoCountry.add_field-1734"><a href="#GeoCountry.add_field-1734"><span class="linenos">1734</span></a>
</span><span id="GeoCountry.add_field-1735"><a href="#GeoCountry.add_field-1735"><span class="linenos">1735</span></a>        <span class="c1"># Is the oject properly initialized ?</span>
</span><span id="GeoCountry.add_field-1736"><a href="#GeoCountry.add_field-1736"><span class="linenos">1736</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">test_is_init</span><span class="p">()</span>
</span><span id="GeoCountry.add_field-1737"><a href="#GeoCountry.add_field-1737"><span class="linenos">1737</span></a>
</span><span id="GeoCountry.add_field-1738"><a href="#GeoCountry.add_field-1738"><span class="linenos">1738</span></a>        <span class="c1"># Now let&#39;s go for merging</span>
</span><span id="GeoCountry.add_field-1739"><a href="#GeoCountry.add_field-1739"><span class="linenos">1739</span></a>        <span class="n">prop</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;code_subregion&#39;</span><span class="p">)</span>
</span><span id="GeoCountry.add_field-1740"><a href="#GeoCountry.add_field-1740"><span class="linenos">1740</span></a>        <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">region_merging</span><span class="p">)[</span><span class="n">prop</span><span class="p">],</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">left_on</span><span class="o">=</span><span class="n">input_key</span><span class="p">,</span>\
</span><span id="GeoCountry.add_field-1741"><a href="#GeoCountry.add_field-1741"><span class="linenos">1741</span></a>                            <span class="n">right_on</span><span class="o">=</span><span class="n">geofield</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Return a the data pandas.Dataframe with an additionnal column with property prop.</p>

<p>Arguments :
input        : pandas.Dataframe object. Mandatory.
field        : field of properties to add. Should be within the get_list_prop() list. Mandatory.
input_key    : input geo key of the input pandas dataframe. Default  'where'
geofield     : internal geo field to make the merge. Default 'code_subregion'
region_merging : Boolean value. Default False, except if the geofield contains '_region'.
               If True, the merge between input dans GeoCountry data is done within the
               region version of the data, not the subregion data which is the default
               behavious.
overload   : Allow to overload a field. Boolean value. Default : False</p>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>