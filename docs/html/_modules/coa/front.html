<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>coa.front &mdash; Pycoa dev documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> Pycoa
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../coa.html">coa package</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Pycoa</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Module code</a> &raquo;</li>
      <li>coa.front</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for coa.front</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;Project : PyCoA - Copyright Â©pycoa.fr</span>
<span class="sd">Date :    april 2020 - march 2021</span>
<span class="sd">Authors : Olivier Dadoun, Julien Browaeys, Tristan Beau</span>
<span class="sd">License: See joint LICENSE file</span>

<span class="sd">Module : coa.front</span>

<span class="sd">About :</span>
<span class="sd">-------</span>

<span class="sd">This is the PyCoA front end functions. It provides easy access and</span>
<span class="sd">use of the whole PyCoA framework in a simplified way.</span>
<span class="sd">The use can change the database, the type of data, the output format</span>
<span class="sd">with keywords (see help of functions below).</span>

<span class="sd">Basic usage</span>
<span class="sd">-----------</span>
<span class="sd">** plotting covid deaths (default value) vs. time **</span>
<span class="sd">    import coa.front as cf</span>

<span class="sd">    cf.plot(where=&#39;France&#39;)  # where keyword is mandatory</span>
<span class="sd">** getting recovered data for some countries **</span>

<span class="sd">    cf.get(where=[&#39;Spain&#39;,&#39;Italy&#39;],which=&#39;recovered&#39;)</span>
<span class="sd">** listing available database and which data can be used **</span>
<span class="sd">    cf.listwhom()</span>
<span class="sd">    cf.setwhom(&#39;jhu&#39;) # return available keywords (aka &#39;which&#39; data)</span>
<span class="sd">    cf.listwhich()   # idem</span>
<span class="sd">    cf.listwhat()    # return available time series type (weekly,</span>
<span class="sd">                     # daily...)</span>
<span class="sd">    cf.plot(option=&#39;sumall&#39;) # return the cumulative plot for all countries</span>
<span class="sd">                     # for default which keyword. See cf.listwhich() and</span>
<span class="sd">                     # and other cf.list**() function (see below)</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># --- Imports ----------------------------------------------------------</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">bokeh.io</span> <span class="kn">import</span> <span class="n">show</span><span class="p">,</span> <span class="n">output_notebook</span>
<span class="kn">import</span> <span class="nn">types</span>

<span class="kn">from</span> <span class="nn">coa.tools</span> <span class="kn">import</span> <span class="n">kwargs_test</span><span class="p">,</span> <span class="n">extract_dates</span><span class="p">,</span> <span class="n">get_db_list_dict</span><span class="p">,</span> <span class="n">info</span>
<span class="kn">import</span> <span class="nn">coa.covid19</span> <span class="k">as</span> <span class="nn">coco</span>
<span class="kn">from</span> <span class="nn">coa.error</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">coa._version</span>
<span class="kn">import</span> <span class="nn">coa.geo</span> <span class="k">as</span> <span class="nn">coge</span>

<span class="n">output_notebook</span><span class="p">(</span><span class="n">hide_banner</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># --- Needed global private variables ----------------------------------</span>
<span class="n">_listwhom</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">get_db_list_dict</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

<span class="k">if</span> <span class="s1">&#39;coa_db&#39;</span> <span class="ow">in</span> <span class="n">__builtins__</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">__builtins__</span><span class="p">[</span><span class="s1">&#39;coa_db&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">_listwhom</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">CoaDbError</span><span class="p">(</span><span class="s2">&quot;The variable __builtin__.coa_db set to &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">__builtins__</span><span class="p">[</span><span class="s1">&#39;coa_db&#39;</span><span class="p">])</span> <span class="o">+</span>
                         <span class="s2">&quot; which is an invalid db. Error.&quot;</span><span class="p">)</span>
    <span class="n">_whom</span> <span class="o">=</span> <span class="n">__builtins__</span><span class="p">[</span><span class="s1">&#39;coa_db&#39;</span><span class="p">]</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">_whom</span> <span class="o">=</span> <span class="n">_listwhom</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># default base</span>

<span class="n">_db</span><span class="p">,</span> <span class="n">_cocoplot</span> <span class="o">=</span> <span class="n">coco</span><span class="o">.</span><span class="n">DataBase</span><span class="o">.</span><span class="n">factory</span><span class="p">(</span><span class="n">_whom</span><span class="p">)</span>  <span class="c1"># initialization with default</span>
<span class="n">_gi</span> <span class="o">=</span> <span class="kc">None</span>

<span class="n">_dict_bypop</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;no&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;100&#39;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span><span class="s1">&#39;1k&#39;</span><span class="p">:</span><span class="mf">1e3</span><span class="p">,</span><span class="s1">&#39;100k&#39;</span><span class="p">:</span><span class="mf">1e5</span><span class="p">,</span><span class="s1">&#39;1M&#39;</span><span class="p">:</span><span class="mf">1e6</span><span class="p">,</span><span class="s1">&#39;pop&#39;</span><span class="p">:</span><span class="mf">1.</span><span class="p">}</span>

<span class="n">_listwhat</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cumul&#39;</span><span class="p">,</span>  <span class="c1"># first one is default, nota:  we must avoid uppercases</span>
             <span class="s1">&#39;daily&#39;</span><span class="p">,</span>
             <span class="s1">&#39;weekly&#39;</span><span class="p">]</span>

<span class="n">_listoutput</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;pandas&#39;</span><span class="p">,</span><span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="s1">&#39;dict&#39;</span><span class="p">,</span> <span class="s1">&#39;array&#39;</span><span class="p">]</span>  <span class="c1"># first one is default for get</span>

<span class="n">_listvisu</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;bokeh&#39;</span><span class="p">,</span> <span class="s1">&#39;folium&#39;</span><span class="p">]</span>


<span class="c1"># --- Front end functions ----------------------------------------------</span>

<span class="c1"># ----------------------------------------------------------------------</span>
<span class="c1"># --- getversion() -----------------------------------------------------</span>
<span class="c1"># ----------------------------------------------------------------------</span>
<div class="viewcode-block" id="getversion"><a class="viewcode-back" href="../../coa.front.html#coa.front.getversion">[docs]</a><span class="k">def</span> <span class="nf">getversion</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Return the current running version of pycoa.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">coa</span><span class="o">.</span><span class="n">_version</span><span class="o">.</span><span class="n">__version__</span></div>


<span class="c1"># ----------------------------------------------------------------------</span>
<span class="c1"># --- listoutput() -----------------------------------------------------</span>
<span class="c1"># ----------------------------------------------------------------------</span>

<div class="viewcode-block" id="listoutput"><a class="viewcode-back" href="../../coa.front.html#coa.front.listoutput">[docs]</a><span class="k">def</span> <span class="nf">listoutput</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Return the list of currently available output types for the</span>
<span class="sd">    get() function. The first one is the default output given if</span>
<span class="sd">    not specified.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_listoutput</span></div>


<span class="c1"># ----------------------------------------------------------------------</span>
<span class="c1"># --- listvisu() -------------------------------------------------------</span>
<span class="c1"># ----------------------------------------------------------------------</span>
<div class="viewcode-block" id="listvisu"><a class="viewcode-back" href="../../coa.front.html#coa.front.listvisu">[docs]</a><span class="k">def</span> <span class="nf">listvisu</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Return the list of currently available visualization for the</span>
<span class="sd">    map() function. The first one is the default output given if</span>
<span class="sd">    not specified.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_listvisu</span></div>


<span class="c1"># ----------------------------------------------------------------------</span>
<span class="c1"># --- listwhom() -------------------------------------------------------</span>
<span class="c1"># ----------------------------------------------------------------------</span>

<div class="viewcode-block" id="listwhom"><a class="viewcode-back" href="../../coa.front.html#coa.front.listwhom">[docs]</a><span class="k">def</span> <span class="nf">listwhom</span><span class="p">(</span><span class="n">detailed</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the list of currently avalailable databases for covid19</span>
<span class="sd">     data in PyCoA.</span>
<span class="sd">     The first one is the default one.</span>

<span class="sd">     If detailed=True, gives information location of each given database.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">detailed</span><span class="p">):</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">get_db_list_dict</span><span class="p">())</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;index&#39;</span><span class="p">:</span><span class="s1">&#39;Database&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;WW/iso3&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="s1">&#39;GranularitÃ©&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="s1">&#39;WW/Name&#39;</span><span class="p">})</span>
            <span class="k">return</span> <span class="n">df</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_db</span><span class="o">.</span><span class="n">get_available_database</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;Waiting for a boolean !&#39;</span><span class="p">)</span></div>


<span class="c1"># ----------------------------------------------------------------------</span>
<span class="c1"># --- listwhat() -------------------------------------------------------</span>
<span class="c1"># ----------------------------------------------------------------------</span>

<div class="viewcode-block" id="listwhat"><a class="viewcode-back" href="../../coa.front.html#coa.front.listwhat">[docs]</a><span class="k">def</span> <span class="nf">listwhat</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Return the list of currently avalailable type of series available.</span>
<span class="sd">     The first one is the default one.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_listwhat</span></div>


<span class="c1"># ----------------------------------------------------------------------</span>
<span class="c1"># --- listoption() -----------------------------------------------------</span>
<span class="c1"># ----------------------------------------------------------------------</span>

<div class="viewcode-block" id="listoption"><a class="viewcode-back" href="../../coa.front.html#coa.front.listoption">[docs]</a><span class="k">def</span> <span class="nf">listoption</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Return the list of currently avalailable option apply to data.</span>
<span class="sd">     Default is no option.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_db</span><span class="o">.</span><span class="n">get_available_options</span><span class="p">()</span></div>


<span class="c1"># ----------------------------------------------------------------------</span>
<span class="c1"># --- listtile() -------------------------------------------------------</span>
<span class="c1"># ----------------------------------------------------------------------</span>

<div class="viewcode-block" id="listtile"><a class="viewcode-back" href="../../coa.front.html#coa.front.listtile">[docs]</a><span class="k">def</span> <span class="nf">listtile</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Return the list of currently avalailable tile option for map()</span>
<span class="sd">     Default is the first one.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_cocoplot</span><span class="o">.</span><span class="n">tiles_list</span><span class="p">()</span></div>


<span class="c1"># ----------------------------------------------------------------------</span>
<span class="c1"># --- listwhich() ------------------------------------------------------</span>
<span class="c1"># ----------------------------------------------------------------------</span>

<div class="viewcode-block" id="listwhich"><a class="viewcode-back" href="../../coa.front.html#coa.front.listwhich">[docs]</a><span class="k">def</span> <span class="nf">listwhich</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Get which are the available fields for the current base.</span>
<span class="sd">    Output is a list of string.</span>
<span class="sd">    By default, the listwhich()[0] is the default which field in other</span>
<span class="sd">    functions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_db</span><span class="o">.</span><span class="n">get_available_keys_words</span><span class="p">()</span></div>


<span class="c1"># ----------------------------------------------------------------------</span>
<span class="c1"># --- listwhere() ------------------------------------------------------</span>
<span class="c1"># ----------------------------------------------------------------------</span>
<div class="viewcode-block" id="listwhere"><a class="viewcode-back" href="../../coa.front.html#coa.front.listwhere">[docs]</a><span class="k">def</span> <span class="nf">listwhere</span><span class="p">(</span><span class="n">clustered</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get the list of available regions/subregions managed by the current database</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">clust</span><span class="p">():</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">_db</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">get_region_list</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">r</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;name_region&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span>

    <span class="k">if</span> <span class="n">clustered</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">clust</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">_db</span><span class="o">.</span><span class="n">db_world</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">_db</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">get_GeoRegion</span><span class="p">()</span><span class="o">.</span><span class="n">get_countries_from_region</span><span class="p">(</span><span class="s1">&#39;world&#39;</span><span class="p">)</span>
            <span class="n">r</span> <span class="o">=</span> <span class="p">[</span><span class="n">_db</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">to_standard</span><span class="p">(</span><span class="n">c</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">r</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">get_db_list_dict</span><span class="p">()[</span><span class="n">_whom</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;subregion&#39;</span><span class="p">:</span>
                <span class="n">pan</span> <span class="o">=</span> <span class="n">_db</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">get_subregion_list</span><span class="p">()</span>
                <span class="n">r</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">pan</span><span class="o">.</span><span class="n">name_subregion</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">clust</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">r</span></div>

<span class="c1"># ----------------------------------------------------------------------</span>
<span class="c1"># --- listbypop() ------------------------------------------------------</span>
<span class="c1"># ----------------------------------------------------------------------</span>

<div class="viewcode-block" id="listbypop"><a class="viewcode-back" href="../../coa.front.html#coa.front.listbypop">[docs]</a><span class="k">def</span> <span class="nf">listbypop</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Get the list of available population normalization</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">_dict_bypop</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div>

<span class="c1"># ----------------------------------------------------------------------</span>
<span class="c1"># --- setwhom() --------------------------------------------------------</span>
<span class="c1"># ----------------------------------------------------------------------</span>

<div class="viewcode-block" id="setwhom"><a class="viewcode-back" href="../../coa.front.html#coa.front.setwhom">[docs]</a><span class="k">def</span> <span class="nf">setwhom</span><span class="p">(</span><span class="n">base</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Set the covid19 database used, given as a string.</span>
<span class="sd">    Please see pycoa.listbase() for the available current list.</span>

<span class="sd">    By default, the listbase()[0] is the default base used in other</span>
<span class="sd">    functions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">_whom</span><span class="p">,</span> <span class="n">_db</span><span class="p">,</span> <span class="n">_cocoplot</span>
    <span class="k">if</span> <span class="n">base</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">listwhom</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">CoaDbError</span><span class="p">(</span><span class="n">base</span> <span class="o">+</span> <span class="s1">&#39; is not a supported database. &#39;</span>
                                <span class="s1">&#39;See pycoa.listbase() for the full list.&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="kc">True</span><span class="p">:</span>  <span class="c1"># force the init #_whom != base:</span>
        <span class="n">_db</span><span class="p">,</span> <span class="n">_cocoplot</span> <span class="o">=</span> <span class="n">coco</span><span class="o">.</span><span class="n">DataBase</span><span class="o">.</span><span class="n">factory</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
        <span class="n">_whom</span> <span class="o">=</span> <span class="n">base</span>

    <span class="k">return</span> <span class="n">listwhich</span><span class="p">()</span></div>


<span class="c1"># ----------------------------------------------------------------------</span>
<span class="c1"># --- getwhom() --------------------------------------------------------</span>
<span class="c1"># ----------------------------------------------------------------------</span>
<div class="viewcode-block" id="getwhom"><a class="viewcode-back" href="../../coa.front.html#coa.front.getwhom">[docs]</a><span class="k">def</span> <span class="nf">getwhom</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Return the current base which is used</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_whom</span></div>


<span class="c1"># ----------------------------------------------------------------------</span>
<span class="c1"># --- get(**kwargs) ----------------------------------------------------</span>
<span class="c1"># ----------------------------------------------------------------------</span>

<div class="viewcode-block" id="getinfo"><a class="viewcode-back" href="../../coa.front.html#coa.front.getinfo">[docs]</a><span class="k">def</span> <span class="nf">getinfo</span><span class="p">(</span><span class="n">which</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return keyword_definition for the db selected</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#if not which:</span>
        <span class="c1">#which = listwhich()[0]</span>
    <span class="c1">#    print(&#39;Load default which:&#39;,which)</span>
    <span class="c1">#elif which not in listwhich():</span>
    <span class="c1">#    raise CoaKeyError(&#39;Which option &#39; + which + &#39; not supported. &#39;</span>
    <span class="c1">#                                                &#39;See listwhich() for list.&#39;)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">_db</span><span class="o">.</span><span class="n">get_keyword_definition</span><span class="p">(</span><span class="n">which</span><span class="p">),</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">url:&#39;</span><span class="p">,</span> <span class="n">_db</span><span class="o">.</span><span class="n">get_keyword_url</span><span class="p">(</span><span class="n">which</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">(more info &#39;</span><span class="p">,</span><span class="n">_db</span><span class="o">.</span><span class="n">get_keyword_url</span><span class="p">(</span><span class="n">which</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;)&#39;</span><span class="p">)</span></div>

<span class="c1"># ----------------------------------------------------------------------</span>
<span class="c1"># --- get(**kwargs) ----------------------------------------------------</span>
<span class="c1"># ----------------------------------------------------------------------</span>
<div class="viewcode-block" id="get"><a class="viewcode-back" href="../../coa.front.html#coa.front.get">[docs]</a><span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return covid19 data in specified format output (default, by list)</span>
<span class="sd">    for specified locations (&#39;where&#39; keyword).</span>
<span class="sd">    The used database is set by the setbase() function but can be</span>
<span class="sd">    changed on the fly (&#39;whom&#39; keyword)</span>
<span class="sd">    Keyword arguments</span>
<span class="sd">    -----------------</span>

<span class="sd">    where  --   a single string of location, or list of (mandatory,</span>
<span class="sd">                no default value)</span>
<span class="sd">    which  --   what sort of data to deliver ( &#39;death&#39;,&#39;confirmed&#39;,</span>
<span class="sd">                &#39;recovered&#39; for &#39;jhu&#39; default database). See listwhich() function</span>
<span class="sd">                for full list according to the used database.</span>

<span class="sd">    what   --   which data are computed, either in cumulative mode</span>
<span class="sd">                (&#39;cumul&#39;, default value), or &#39;daily&#39; (diff with previous day</span>
<span class="sd">                and &#39;weekly&#39; (diff with previous week). See</span>
<span class="sd">                listwhich() for fullist of available</span>
<span class="sd">                Full list of what keyword with the listwhat() function.</span>

<span class="sd">    whom   --   Database specification (overload the setbase()</span>
<span class="sd">                function). See listwhom() for supported list</span>

<span class="sd">    when   --   dates are given under the format dd/mm/yyyy. In the when</span>
<span class="sd">                option, one can give one date which will be the end of</span>
<span class="sd">                the data slice. Or one can give two dates separated with</span>
<span class="sd">                &quot;:&quot;, which will define the time cut for the output data</span>
<span class="sd">                btw those two dates.</span>

<span class="sd">    output --   output format returned ( pandas (default), array (numpy.array),</span>
<span class="sd">                dict or list). See listoutput() function.</span>

<span class="sd">    option --   pre-computing option.</span>
<span class="sd">                * nonneg means that negative daily balance is pushed back</span>
<span class="sd">                to previousdays in order to have a cumulative function which is</span>
<span class="sd">                monotonous increasing.</span>
<span class="sd">                * nofillnan means that nan value won&#39;t be filled.</span>
<span class="sd">                * smooth7 will perform a 7 day window average of data</span>
<span class="sd">                * sumall will return integrated over locations given via the</span>
<span class="sd">                where keyword. If using double bracket notation, the sumall</span>
<span class="sd">                option is applied for each bracketed member of the where arg.</span>

<span class="sd">                By default : no option.</span>
<span class="sd">                See listoption().</span>
<span class="sd">    bypop --    normalize by population (if available for the selected database).</span>
<span class="sd">                * by default, &#39;no&#39; normalization</span>
<span class="sd">                * can normalize by &#39;100&#39;, &#39;1k&#39;, &#39;100k&#39; or &#39;1M&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kwargs_test</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;where&#39;</span><span class="p">,</span> <span class="s1">&#39;what&#39;</span><span class="p">,</span> <span class="s1">&#39;which&#39;</span><span class="p">,</span> <span class="s1">&#39;whom&#39;</span><span class="p">,</span> <span class="s1">&#39;when&#39;</span><span class="p">,</span> <span class="s1">&#39;output&#39;</span><span class="p">,</span> <span class="s1">&#39;option&#39;</span><span class="p">,</span> <span class="s1">&#39;bins&#39;</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span>\
                        <span class="s1">&#39;visu&#39;</span><span class="p">,</span> <span class="s1">&#39;tile&#39;</span><span class="p">,</span><span class="s1">&#39;typeofplot&#39;</span><span class="p">,</span><span class="s1">&#39;dateslider&#39;</span><span class="p">,</span><span class="s1">&#39;maplabel&#39;</span><span class="p">,</span><span class="s1">&#39;typeofhist&#39;</span><span class="p">,</span><span class="s1">&#39;mode&#39;</span><span class="p">,</span><span class="s1">&#39;guideline&#39;</span><span class="p">,</span><span class="s1">&#39;bypop&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;plot_width&#39;</span><span class="p">,</span><span class="s1">&#39;plot_height&#39;</span><span class="p">,</span><span class="s1">&#39;textcopyright&#39;</span><span class="p">,</span><span class="s1">&#39;textcopyrightposition&#39;</span><span class="p">],</span>
                <span class="s1">&#39;Bad args used in the pycoa.get() function.&#39;</span><span class="p">)</span>
    <span class="c1"># no dateslider currently</span>

    <span class="k">global</span> <span class="n">_db</span><span class="p">,</span> <span class="n">_whom</span><span class="p">,</span> <span class="n">_gi</span>
    <span class="n">where</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;where&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">what</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;what&#39;</span><span class="p">,</span> <span class="n">listwhat</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">which</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;which&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">whom</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;whom&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">option</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;option&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">when</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;when&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;mode&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mode&#39;</span><span class="p">)</span>
    <span class="n">option</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;option&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">bypop</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;bypop&#39;</span><span class="p">,</span><span class="s1">&#39;no&#39;</span><span class="p">)</span>

    <span class="n">output</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;output&#39;</span><span class="p">,</span> <span class="n">listoutput</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">output</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">listoutput</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;Output option &#39;</span> <span class="o">+</span> <span class="n">output</span> <span class="o">+</span> <span class="s1">&#39; not supported. See help().&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">whom</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">whom</span> <span class="o">=</span> <span class="n">_whom</span>
    <span class="k">if</span> <span class="n">whom</span> <span class="o">!=</span> <span class="n">_whom</span><span class="p">:</span>
        <span class="n">setwhom</span><span class="p">(</span><span class="n">whom</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">([</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">listwhat</span><span class="p">()</span> <span class="k">if</span> <span class="n">what</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">s</span><span class="p">)]):</span>
        <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;What option &#39;</span> <span class="o">+</span> <span class="n">what</span> <span class="o">+</span> <span class="s1">&#39; not supported. &#39;</span>
                                                  <span class="s1">&#39;See listwhat() for full list.&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">which</span><span class="p">:</span>
        <span class="n">which</span> <span class="o">=</span> <span class="n">listwhich</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">which</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">listwhich</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;Which option &#39;</span> <span class="o">+</span> <span class="n">which</span> <span class="o">+</span> <span class="s1">&#39; not supported. &#39;</span>
                                                    <span class="s1">&#39;See listwhich() for list.&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">bypop</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">listbypop</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;The bypop arg should be selected in &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">listbypop</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; only.&#39;</span><span class="p">)</span>

    <span class="n">pandy</span> <span class="o">=</span> <span class="n">_db</span><span class="o">.</span><span class="n">get_stats</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="n">which</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">where</span><span class="p">,</span> <span class="n">option</span><span class="o">=</span><span class="n">option</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;where&#39;</span><span class="p">})</span>
    <span class="n">when_beg</span><span class="p">,</span> <span class="n">when_end</span> <span class="o">=</span> <span class="n">extract_dates</span><span class="p">(</span><span class="n">when</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">when_end</span> <span class="o">&gt;</span> <span class="n">pandy</span><span class="p">[[</span><span class="n">which</span><span class="p">,</span><span class="s1">&#39;date&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">max</span><span class="p">():</span>
        <span class="n">when_end</span> <span class="o">=</span> <span class="n">pandy</span><span class="p">[[</span><span class="n">which</span><span class="p">,</span><span class="s1">&#39;date&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

    <span class="n">db_first_date</span> <span class="o">=</span> <span class="n">pandy</span><span class="p">[[</span><span class="n">which</span><span class="p">,</span><span class="s1">&#39;date&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">db_last_date</span> <span class="o">=</span> <span class="n">pandy</span><span class="p">[[</span><span class="n">which</span><span class="p">,</span><span class="s1">&#39;date&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">when_beg</span> <span class="o">&lt;</span> <span class="n">db_first_date</span><span class="p">:</span>
        <span class="n">when_beg</span> <span class="o">=</span> <span class="n">db_first_date</span>
    <span class="k">if</span> <span class="n">when_end</span> <span class="o">&gt;</span> <span class="n">db_last_date</span><span class="p">:</span>
        <span class="n">when_end</span> <span class="o">=</span> <span class="n">db_last_date</span>
    <span class="c1"># when cut</span>
    <span class="k">if</span> <span class="n">when_beg</span> <span class="o">&gt;</span>  <span class="n">pandy</span><span class="p">[[</span><span class="n">which</span><span class="p">,</span><span class="s1">&#39;date&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="ow">or</span> <span class="n">when_end</span> <span class="o">&gt;</span>  <span class="n">pandy</span><span class="p">[[</span><span class="n">which</span><span class="p">,</span><span class="s1">&#39;date&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">max</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">CoaNoData</span><span class="p">(</span><span class="s2">&quot;No available data after &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span> <span class="n">pandy</span><span class="p">[[</span><span class="n">which</span><span class="p">,</span><span class="s1">&#39;date&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>

    <span class="n">pandy</span> <span class="o">=</span> <span class="n">pandy</span><span class="p">[(</span><span class="n">pandy</span><span class="o">.</span><span class="n">date</span> <span class="o">&gt;=</span> <span class="n">when_beg</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">pandy</span><span class="o">.</span><span class="n">date</span> <span class="o">&lt;=</span> <span class="n">when_end</span><span class="p">)]</span>
    <span class="n">pandy</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="n">pop_field</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="c1"># manage pop norm if asked</span>

    <span class="k">if</span> <span class="n">bypop</span> <span class="o">!=</span> <span class="s1">&#39;no&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pandy</span><span class="p">[</span><span class="s1">&#39;codelocation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">list</span><span class="p">):</span>
            <span class="n">pandy</span> <span class="o">=</span> <span class="n">pandy</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s1">&#39;codelocation&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">_db</span><span class="o">.</span><span class="n">db_world</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_gi</span><span class="p">,</span><span class="n">coa</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">GeoInfo</span><span class="p">):</span>
                <span class="n">_gi</span> <span class="o">=</span> <span class="n">coge</span><span class="o">.</span><span class="n">GeoInfo</span><span class="p">()</span>
            <span class="n">pop_field</span><span class="o">=</span><span class="s1">&#39;population&#39;</span>
            <span class="n">pandy</span> <span class="o">=</span> <span class="n">_gi</span><span class="o">.</span><span class="n">add_field</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="n">pandy</span><span class="p">,</span><span class="n">field</span><span class="o">=</span><span class="n">pop_field</span><span class="p">,</span><span class="n">geofield</span><span class="o">=</span><span class="s1">&#39;codelocation&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_gi</span><span class="p">,</span><span class="n">coa</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">GeoCountry</span><span class="p">):</span>
                <span class="n">_gi</span><span class="o">=</span><span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_gi</span><span class="o">.</span><span class="n">get_country</span><span class="p">()</span> <span class="o">!=</span> <span class="n">_db</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">get_country</span><span class="p">():</span>
                    <span class="n">_gi</span><span class="o">=</span><span class="kc">None</span>

            <span class="k">if</span> <span class="n">_gi</span> <span class="o">==</span> <span class="kc">None</span> <span class="p">:</span>
                <span class="n">_gi</span> <span class="o">=</span> <span class="n">_db</span><span class="o">.</span><span class="n">geo</span>
            <span class="n">pop_field</span><span class="o">=</span><span class="s1">&#39;population_subregion&#39;</span>
            <span class="k">if</span> <span class="n">pop_field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_gi</span><span class="o">.</span><span class="n">get_list_properties</span><span class="p">():</span>
                <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;The population information not available for this country. No normalization possible&#39;</span><span class="p">)</span>

            <span class="n">pandy</span><span class="o">=</span><span class="n">_gi</span><span class="o">.</span><span class="n">add_field</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="n">pandy</span><span class="p">,</span><span class="n">field</span><span class="o">=</span><span class="n">pop_field</span><span class="p">,</span><span class="n">input_key</span><span class="o">=</span><span class="s1">&#39;codelocation&#39;</span><span class="p">)</span>

        <span class="n">clust</span> <span class="o">=</span> <span class="n">pandy</span><span class="p">[</span><span class="s1">&#39;clustername&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">clust</span><span class="p">:</span>
            <span class="n">pandyi</span> <span class="o">=</span> <span class="n">pandy</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span> <span class="n">pandy</span><span class="p">[</span><span class="s1">&#39;clustername&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span> <span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">pandyi</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">pop_field</span><span class="p">]</span> <span class="o">=</span> <span class="n">pandyi</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;codelocation&#39;</span><span class="p">)[</span><span class="n">pop_field</span><span class="p">]</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">cody</span> <span class="o">=</span> <span class="p">[</span><span class="n">pandyi</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;codelocation&#39;</span><span class="p">)[</span><span class="s1">&#39;codelocation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">pandyi</span><span class="p">)</span>
            <span class="n">pandyi</span> <span class="o">=</span> <span class="n">pandyi</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">codelocation</span><span class="o">=</span><span class="n">cody</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">pandyi</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pandyi</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">([</span><span class="s1">&#39;date&#39;</span><span class="p">,</span><span class="s1">&#39;clustername&#39;</span><span class="p">])</span>
        <span class="n">pandy</span> <span class="o">=</span> <span class="n">df</span>

        <span class="n">pandy</span><span class="p">[</span><span class="n">pop_field</span><span class="p">]</span><span class="o">=</span><span class="n">pandy</span><span class="p">[</span><span class="n">pop_field</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">what</span><span class="p">:</span>
            <span class="n">pandy</span><span class="p">[</span><span class="n">what</span><span class="o">+</span><span class="s1">&#39; per &#39;</span><span class="o">+</span><span class="n">bypop</span><span class="p">]</span><span class="o">=</span><span class="n">pandy</span><span class="p">[</span><span class="n">what</span><span class="p">]</span><span class="o">/</span><span class="n">pandy</span><span class="p">[</span><span class="n">pop_field</span><span class="p">]</span><span class="o">*</span><span class="n">_dict_bypop</span><span class="p">[</span><span class="n">bypop</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pandy</span><span class="p">[</span><span class="n">which</span><span class="o">+</span><span class="s1">&#39; per &#39;</span><span class="o">+</span><span class="n">bypop</span><span class="p">]</span><span class="o">=</span><span class="n">pandy</span><span class="p">[</span><span class="n">which</span><span class="p">]</span><span class="o">/</span><span class="n">pandy</span><span class="p">[</span><span class="n">pop_field</span><span class="p">]</span><span class="o">*</span><span class="n">_dict_bypop</span><span class="p">[</span><span class="n">bypop</span><span class="p">]</span>
    <span class="c1"># casted_data = None</span>
    <span class="k">if</span> <span class="n">output</span> <span class="o">==</span> <span class="s1">&#39;pandas&#39;</span><span class="p">:</span>
        <span class="n">pandy</span> <span class="o">=</span> <span class="n">pandy</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">([</span><span class="s1">&#39;date&#39;</span><span class="p">,</span><span class="s1">&#39;clustername&#39;</span><span class="p">])</span>
        <span class="n">pandy</span> <span class="o">=</span> <span class="n">pandy</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cumul&#39;</span><span class="p">])</span>
        <span class="n">pandy</span><span class="p">[</span><span class="s1">&#39;cumul&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pandy</span><span class="p">[</span><span class="n">which</span><span class="p">]</span>
        <span class="n">casted_data</span> <span class="o">=</span> <span class="n">pandy</span>
    <span class="c1"># print(pandy)</span>
    <span class="c1"># casted_data = pd.pivot_table(pandy, index=&#39;date&#39;,columns=&#39;where&#39;,values=col_name).to_dict(&#39;series&#39;)</span>
    <span class="c1"># print(pandy)</span>
    <span class="k">elif</span> <span class="n">output</span> <span class="o">==</span> <span class="s1">&#39;dict&#39;</span><span class="p">:</span>
        <span class="n">casted_data</span> <span class="o">=</span> <span class="n">pandy</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s1">&#39;split&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">output</span> <span class="o">==</span> <span class="s1">&#39;list&#39;</span> <span class="ow">or</span> <span class="n">output</span> <span class="o">==</span> <span class="s1">&#39;array&#39;</span><span class="p">:</span>
        <span class="n">my_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">keys</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">pandy</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">vc</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]</span>
            <span class="n">my_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vc</span><span class="p">)</span>
        <span class="n">casted_data</span> <span class="o">=</span> <span class="n">my_list</span>
        <span class="k">if</span> <span class="n">output</span> <span class="o">==</span> <span class="s1">&#39;array&#39;</span><span class="p">:</span>
            <span class="n">casted_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pandy</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;Unknown output.&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">casted_data</span></div>

<div class="viewcode-block" id="saveoutput"><a class="viewcode-back" href="../../coa.front.html#coa.front.saveoutput">[docs]</a><span class="k">def</span> <span class="nf">saveoutput</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Export pycoas pandas as an output file selected by output argument</span>
<span class="sd">        &#39;pandas&#39;: pandas to save</span>
<span class="sd">        &#39;saveformat&#39;: excel (default) or csv</span>
<span class="sd">        &#39;savename&#39;: None (default pycoaout+ &#39;.xlsx/.csv&#39;)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">global</span> <span class="n">_db</span>
    <span class="n">kwargs_test</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;pandas&#39;</span><span class="p">,</span><span class="s1">&#39;saveformat&#39;</span><span class="p">,</span><span class="s1">&#39;savename&#39;</span><span class="p">],</span> <span class="s1">&#39;Bad args used in the pycoa.saveoutput function.&#39;</span><span class="p">)</span>
    <span class="n">pandy</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pandas&#39;</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">())</span>
    <span class="n">saveformat</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;saveformat&#39;</span><span class="p">,</span> <span class="s1">&#39;excel&#39;</span><span class="p">)</span>
    <span class="n">savename</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;savename&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pandy</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;Pandas to save is mandatory there is not default !&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_db</span><span class="o">.</span><span class="n">saveoutput</span><span class="p">(</span><span class="n">pandas</span><span class="o">=</span><span class="n">pandy</span><span class="p">,</span><span class="n">saveformat</span><span class="o">=</span><span class="n">saveformat</span><span class="p">,</span><span class="n">savename</span><span class="o">=</span><span class="n">savename</span><span class="p">)</span></div>

<div class="viewcode-block" id="merger"><a class="viewcode-back" href="../../coa.front.html#coa.front.merger">[docs]</a><span class="k">def</span> <span class="nf">merger</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Merge two or more pycoa pandas from get_stats operation</span>
<span class="sd">    &#39;coapandas&#39;: list (min 2D) of pandas from stats</span>
<span class="sd">    &#39;whichcol&#39;: list variable associate to the coapandas list to be retrieve</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">global</span> <span class="n">_db</span>
    <span class="n">kwargs_test</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,[</span><span class="s1">&#39;coapandas&#39;</span><span class="p">,</span> <span class="s1">&#39;whichcol&#39;</span><span class="p">],</span> <span class="s1">&#39;Bad args used in the pycoa.merger function.&#39;</span><span class="p">)</span>
    <span class="n">listpandy</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;coapandas&#39;</span><span class="p">,[])</span>
    <span class="n">listcol</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;whichcol&#39;</span><span class="p">,[])</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">listpandy</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">listcol</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
       <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;List of pandas / List of columns keep  is mandatory there is not default !&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
       <span class="k">return</span> <span class="n">_db</span><span class="o">.</span><span class="n">merger</span><span class="p">(</span><span class="n">coapandas</span> <span class="o">=</span> <span class="n">listpandy</span><span class="p">,</span><span class="n">whichcol</span> <span class="o">=</span> <span class="n">listcol</span><span class="p">)</span></div>

<span class="c1"># ----------------------------------------------------------------------</span>
<span class="c1"># --- chartsinput_deco(f)</span>
<span class="c1"># ------  with wraps</span>
<span class="c1"># ----------  wrapper(*args, **kwargs)</span>
<span class="c1">#---------------------------------------</span>
<span class="c1"># ----------------------------------------------------------------------</span>
<div class="viewcode-block" id="chartsinput_deco"><a class="viewcode-back" href="../../coa.front.html#coa.front.chartsinput_deco">[docs]</a><span class="k">def</span> <span class="nf">chartsinput_deco</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Main decorator it mainly deals with arg testings</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            wrapper dealing with arg testing</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">kwargs_test</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span>
                    <span class="p">[</span><span class="s1">&#39;where&#39;</span><span class="p">,</span> <span class="s1">&#39;what&#39;</span><span class="p">,</span> <span class="s1">&#39;which&#39;</span><span class="p">,</span> <span class="s1">&#39;whom&#39;</span><span class="p">,</span> <span class="s1">&#39;when&#39;</span><span class="p">,</span> <span class="s1">&#39;input&#39;</span><span class="p">,</span> <span class="s1">&#39;input_field&#39;</span><span class="p">,</span>\
                    <span class="s1">&#39;title&#39;</span><span class="p">,</span><span class="s1">&#39;typeofplot&#39;</span><span class="p">,</span><span class="s1">&#39;typeofhist&#39;</span><span class="p">,</span><span class="s1">&#39;bins&#39;</span><span class="p">,</span><span class="s1">&#39;visu&#39;</span><span class="p">,</span><span class="s1">&#39;tile&#39;</span><span class="p">,</span><span class="s1">&#39;dateslider&#39;</span><span class="p">,</span><span class="s1">&#39;maplabel&#39;</span><span class="p">,</span><span class="s1">&#39;option&#39;</span><span class="p">,</span><span class="s1">&#39;mode&#39;</span><span class="p">,</span><span class="s1">&#39;guideline&#39;</span><span class="p">,</span><span class="s1">&#39;bypop&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;plot_width&#39;</span><span class="p">,</span><span class="s1">&#39;plot_height&#39;</span><span class="p">,</span><span class="s1">&#39;textcopyright&#39;</span><span class="p">,</span><span class="s1">&#39;textcopyrightposition&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;Bad args used in the pycoa function.&#39;</span><span class="p">)</span>
        <span class="n">input_arg</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">input_field</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;input_field&#39;</span><span class="p">)</span>
        <span class="n">where</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;where&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">what</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;what&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">when</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;when&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">option</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;option&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_arg</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="n">input_field</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;input_field&#39;</span><span class="p">,</span> <span class="n">listwhich</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
            <span class="c1">#if input_field not in input_arg.columns:</span>
            <span class="c1">#    raise CoaKeyError(&quot;Cannot find &quot; + str(input_field) + &quot; field in the pandas data. &quot;</span>
            <span class="c1">#                                                          &quot;Set a proper input_field key.&quot;)</span>
            <span class="k">if</span> <span class="s1">&#39;option&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s2">&quot;Cannot use option with input pandas data. &quot;</span>
                                  <span class="s2">&quot;Use option within the get() function instead.&quot;</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;input&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_arg</span>
        <span class="k">elif</span> <span class="n">input_arg</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;input&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;pandas&#39;</span><span class="p">)</span>
            <span class="n">which</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;which&#39;</span><span class="p">,</span> <span class="n">listwhich</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">what</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;what&#39;</span><span class="p">,</span> <span class="n">listwhat</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">option</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;option&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s1">&#39;Waiting input as valid pycoa pandas &#39;</span>
                               <span class="s1">&#39;dataframe. See help.&#39;</span><span class="p">)</span>

        <span class="n">bypop</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;bypop&#39;</span><span class="p">,</span><span class="s1">&#39;no&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">bypop</span> <span class="o">!=</span> <span class="s1">&#39;no&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">what</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;what&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">what</span><span class="o">+</span><span class="s1">&#39; per &#39;</span><span class="o">+</span><span class="n">bypop</span>
                <span class="n">input_field</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;what&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;which&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">which</span><span class="o">+</span><span class="s1">&#39; per &#39;</span><span class="o">+</span><span class="n">bypop</span>
                <span class="n">input_field</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;which&#39;</span><span class="p">]</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;input_field&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_field</span>
        <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">wrapper</span></div>
<span class="c1"># ----------------------------------------------------------------------</span>
<span class="c1"># --- map(**kwargs) ----------------------------------------------------</span>
<span class="c1"># ----------------------------------------------------------------------</span>
<div class="viewcode-block" id="map"><a class="viewcode-back" href="../../coa.front.html#coa.front.map">[docs]</a><span class="nd">@chartsinput_deco</span>
<span class="k">def</span> <span class="nf">map</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a map according to arguments and options.</span>
<span class="sd">    See help(map).</span>
<span class="sd">    - 2 types of visu are avalailable so far : bokeh or folium (see listvisu())</span>
<span class="sd">    by default visu=&#39;bokeh&#39;</span>
<span class="sd">    - In the default case (i.e visu=&#39;bokeh&#39;) available option are :</span>
<span class="sd">        - dateslider=True: a date slider is called and displayed on the right part of the map</span>
<span class="sd">        - maplabel = text, value are displayed directly on the map</span>
<span class="sd">                   = spark, sparkline are displayed directly on the map</span>
<span class="sd">                   = tickmap%, colormap tick are in %</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">visu</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;visu&#39;</span><span class="p">,</span> <span class="n">listvisu</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">)</span>
    <span class="n">input_field</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;input_field&#39;</span><span class="p">)</span>
    <span class="n">dateslider</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dateslider&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">maplabel</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;maplabel&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">maplabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">maplabel</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
            <span class="n">maplabel</span> <span class="o">=</span> <span class="p">[</span><span class="n">maplabel</span><span class="p">]</span>
        <span class="k">if</span>  <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">maplabel</span> <span class="k">if</span> <span class="n">a</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">,</span><span class="s1">&#39;spark&#39;</span><span class="p">,</span><span class="s1">&#39;tickmap%&#39;</span><span class="p">]</span> <span class="p">]):</span>
            <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s1">&#39;Waiting a correct maplabel value. See help.&#39;</span><span class="p">)</span>

    <span class="n">sparkline</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">dateslider</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;dateslider&#39;</span><span class="p">]</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;cursor_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dateslider</span>
    <span class="k">if</span> <span class="n">maplabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;maplabel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="s1">&#39;text&#39;</span> <span class="ow">in</span> <span class="n">maplabel</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;maplabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;tickmap%&#39;</span> <span class="ow">in</span> <span class="n">maplabel</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;maplabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;tickmap%&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s1">&#39;spark&#39;</span> <span class="ow">in</span> <span class="n">maplabel</span><span class="p">:</span>
            <span class="n">sparkline</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s1">&#39;Waiting for a valide label visualisation: text, spark or tickmap%&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">visu</span> <span class="o">==</span> <span class="s1">&#39;bokeh&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">sparkline</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">show</span><span class="p">(</span><span class="n">_cocoplot</span><span class="o">.</span><span class="n">pycoa_map</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">input_field</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">show</span><span class="p">(</span><span class="n">_cocoplot</span><span class="o">.</span><span class="n">pycoa_sparkmap</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">input_field</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">visu</span> <span class="o">==</span> <span class="s1">&#39;folium&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">dateslider</span> <span class="ow">or</span> <span class="n">maplabel</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;Not available with folium map, you should considere to use bokeh map visu in this case&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_cocoplot</span><span class="o">.</span><span class="n">pycoa_mapfolium</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">input_field</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">CoaTypeError</span><span class="p">(</span><span class="s1">&#39;Waiting for a valid visualisation. So far: </span><span class="se">\&#39;</span><span class="s1">bokeh</span><span class="se">\&#39;</span><span class="s1"> or </span><span class="se">\&#39;</span><span class="s1">folium</span><span class="se">\&#39;</span><span class="s1">.See help.&#39;</span><span class="p">)</span></div>
<span class="c1"># ----------------------------------------------------------------------</span>
<span class="c1"># --- hist(**kwargs) ---------------------------------------------------</span>
<span class="c1"># ----------------------------------------------------------------------</span>
<div class="viewcode-block" id="hist"><a class="viewcode-back" href="../../coa.front.html#coa.front.hist">[docs]</a><span class="nd">@chartsinput_deco</span>
<span class="k">def</span> <span class="nf">hist</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create histogram according to arguments.</span>
<span class="sd">    See help(hist).</span>
<span class="sd">    Keyword arguments</span>
<span class="sd">    -----------------</span>

<span class="sd">    where (mandatory if no input), what, which, whom, when : (see help(get))</span>

<span class="sd">    input       --  input data to plot within the pycoa framework (e.g.</span>
<span class="sd">                    after some analysis or filtering). Default is None which</span>
<span class="sd">                    means that we use the basic raw data through the get</span>
<span class="sd">                    function.</span>
<span class="sd">                    When the &#39;input&#39; keyword is set, where, what, which,</span>
<span class="sd">                    whom when keywords are ignored.</span>
<span class="sd">                    input should be given as valid pycoa pandas dataframe.</span>

<span class="sd">    input_field --  is the name of the field of the input pandas to plot.</span>
<span class="sd">                    Default is &#39;deaths/cumul&#39;, the default output field of</span>
<span class="sd">                    the get() function.</span>

<span class="sd">    width_height : width and height of the picture .</span>
<span class="sd">                If specified should be a list of width and height.</span>
<span class="sd">                For instance width_height=[400,500]</span>

<span class="sd">    typeofhist  --  &#39;bylocation&#39; (default), &#39;byvalue&#39; or pie</span>

<span class="sd">    bins        --  number of bins used, only available for &#39;byvalue&#39; type of</span>
<span class="sd">                    histograms.</span>
<span class="sd">                    If none provided, a default value will be used.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">)</span>
    <span class="n">input_field</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;input_field&#39;</span><span class="p">)</span>
    <span class="n">dateslider</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dateslider&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">typeofhist</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;typeofhist&#39;</span><span class="p">,</span> <span class="s1">&#39;bylocation&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">dateslider</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;dateslider&#39;</span><span class="p">]</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;cursor_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dateslider</span>

    <span class="k">if</span> <span class="n">typeofhist</span> <span class="o">==</span> <span class="s1">&#39;bylocation&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;bins&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s2">&quot;The bins keyword cannot be set with histograms by location. See help.&quot;</span><span class="p">)</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">_cocoplot</span><span class="o">.</span><span class="n">pycoa_horizonhisto</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">input_field</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">typeofhist</span> <span class="o">==</span> <span class="s1">&#39;byvalue&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">dateslider</span><span class="p">:</span>
            <span class="n">info</span><span class="p">(</span><span class="s1">&#39;dateslider not implemented for typeofhist=</span><span class="se">\&#39;</span><span class="s1">byvalue</span><span class="se">\&#39;</span><span class="s1">.&#39;</span><span class="p">)</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">_cocoplot</span><span class="o">.</span><span class="n">pycoa_horizonhisto</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">input_field</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">_cocoplot</span><span class="o">.</span><span class="n">pycoa_histo</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">input_field</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">typeofhist</span> <span class="o">==</span> <span class="s1">&#39;pie&#39;</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">_cocoplot</span><span class="o">.</span><span class="n">pycoa_pie</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">input_field</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;Unknown typeofhist value. Should be bylocation or byvalue.&#39;</span><span class="p">)</span>
    <span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span></div>

<span class="c1"># ----------------------------------------------------------------------</span>
<span class="c1"># --- plot(**kwargs) ---------------------------------------------------</span>
<span class="c1"># ----------------------------------------------------------------------</span>
<div class="viewcode-block" id="plot"><a class="viewcode-back" href="../../coa.front.html#coa.front.plot">[docs]</a><span class="nd">@chartsinput_deco</span>
<span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a date plot according to arguments. See help(plot).</span>
<span class="sd">    Keyword arguments</span>
<span class="sd">    -----------------</span>

<span class="sd">    where (mandatory), what, which, whom, when : (see help(get))</span>

<span class="sd">    input       --  input data to plot within the pycoa framework (e.g.</span>
<span class="sd">                    after some analysis or filtering). Default is None which</span>
<span class="sd">                    means that we use the basic raw data through the get</span>
<span class="sd">                    function.</span>
<span class="sd">                    When the &#39;input&#39; keyword is set, where, what, which,</span>
<span class="sd">                    whom when keywords are ignored.</span>
<span class="sd">                    input should be given as valid pycoa pandas dataframe.</span>

<span class="sd">    input_field --  is the name of the field of the input pandas to plot.</span>
<span class="sd">                    Default is &#39;deaths/cumul&#39;, the default output field of</span>
<span class="sd">                    the get() function.</span>

<span class="sd">    width_height : width and height of the picture .</span>
<span class="sd">                If specified should be a list of width and height. For instance width_height=[400,500]</span>

<span class="sd">    title       --  to force the title of the plot</span>

<span class="sd">    typeofplot  -- &#39;date&#39; (default), &#39;menulocation&#39; or &#39;versus&#39;</span>
<span class="sd">                   &#39;date&#39;:date plot</span>
<span class="sd">                   &#39;menulocation&#39;: date plot with two scroll menu locations.</span>
<span class="sd">                                    Usefull to study the behaviour of a variable for two different countries.</span>
<span class="sd">                   &#39;versus&#39;: plot variable against an other one.</span>
<span class="sd">                             For this type of plot one should used &#39;input&#39; and &#39;input_field&#39; (not fully tested).</span>
<span class="sd">                             Moreover dim(input_field) must be 2.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">)</span>
    <span class="n">input_field</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;input_field&#39;</span><span class="p">)</span>
    <span class="n">typeofplot</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;typeofplot&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;typeofplot&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">typeofplot</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;typeofplot&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">typeofplot</span> <span class="o">==</span> <span class="s1">&#39;date&#39;</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">_cocoplot</span><span class="o">.</span><span class="n">pycoa_date_plot</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span><span class="n">input_field</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">typeofplot</span> <span class="o">==</span> <span class="s1">&#39;versus&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">input_field</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_field</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">_cocoplot</span><span class="o">.</span><span class="n">pycoa_plot</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">input_field</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;typeofplot is versus but dim(input_field)!=2, versus has not effect ...&#39;</span><span class="p">)</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">_cocoplot</span><span class="o">.</span><span class="n">pycoa_date_plot</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">input_field</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">typeofplot</span> <span class="o">==</span> <span class="s1">&#39;menulocation&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">input_field</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_field</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;typeofplot is menulocation but dim(input_field)&gt;1, menulocation has not effect ...&#39;</span><span class="p">)</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">_cocoplot</span><span class="o">.</span><span class="n">pycoa_scrollingmenu</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">input_field</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">CoaKeyError</span><span class="p">(</span><span class="s1">&#39;Unknown typeofplot value. Should be date, versus or menulocation.&#39;</span><span class="p">)</span>
    <span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Pycoa.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>